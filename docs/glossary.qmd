---
pagetitle: "Atlas Glossary"
nb-authors:
  - Hannah Lang
  - Lolita Muller
  - Brayden Youngberg
  - Pete Stewart
date-created: "2025-11-10"
date-edited: today

csv2json:
  - input: /data/docs/glossary.csv
    output: /data/docs/glossary.json

format:
  html:
    include-in-header:
      - text: |
          <script src="./../components/backToTop.js"></script>
          <script src="./../components/atlasToc.js"></script>
---

```{=html}
<atlas-toc heading-levels="2"></atlas-toc>
```

<back-to-top></back-to-top>

# Atlas Definitions

```{=html}
<input
  type="text"
  id="searchBox"
  placeholder="Search glossary..."
style="margin-bottom: 10px; padding: 8px; width: 100%; max-width: 400px; max-height : 40px;"
/>

<div id="output"></div>
```

```{=html}
<script>
const DATA_URL = "../data/docs/glossary.json";
const LANGUAGES = [
  { code: "EN", label: "English", placeholder: "Search glossary..." },
  { code: "FR", label: "Fran√ßais", placeholder: "Rechercher dans le glossaire..." },
];
const state = {
  currentLang: "EN",
  searchQuery: "",
  sections: [],
};
const searchBox = document.getElementById("searchBox");
const output = document.getElementById("output");

function escapeHtml(str = "") {
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

function sanitizeId(str) {
  return str
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
}

function createSearchIndex(entry) {
  return [
    entry.Term,
    entry.Acronym,
    entry["Definition EN"],
    entry["Definition FR"],
    entry["Tooltip EN"],
    entry["Tooltip FR"],
  ]
    .filter(Boolean)
    .join(" ")
    .toLowerCase();
}

function buildSections(entries) {
  const sections = new Map();

  entries.forEach(entry => {
    const sectionName = entry.Section || "Other";
    if (!sections.has(sectionName)) sections.set(sectionName, []);
    sections.get(sectionName).push({ ...entry, _searchIndex: createSearchIndex(entry) });
  });

  return [...sections.entries()]
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([sectionName, sectionEntries]) => [
      sectionName,
      sectionEntries.sort((a, b) => (a.Term || "").localeCompare(b.Term || "")),
    ]);
}

function updateSearchPlaceholder() {
  if (!searchBox) return;
  const language = LANGUAGES.find(lang => lang.code === state.currentLang);
  searchBox.placeholder = language ? language.placeholder : "Search glossary...";
}

function handleLanguageChange(langCode) {
  state.currentLang = langCode;
  window.currentLang = langCode;
  updateSearchPlaceholder();
  renderGlossary();
  if (typeof updateBackToTopLabel === "function") updateBackToTopLabel();
}

function mountLanguageSelector() {
  const navEnd = document.querySelector(".navbar-nav.ms-auto .nav-item.compact");
  if (!navEnd || document.getElementById("nav-lang-selector")) return;

  const langSel = document.createElement("div");
  langSel.id = "nav-lang-selector";
  langSel.style.display = "flex";
  langSel.style.alignItems = "center";
  langSel.style.marginLeft = "10px";

  const langDiv = document.createElement("div");
  langDiv.style.display = "flex";
  langDiv.style.flexDirection = "column";

  LANGUAGES.forEach(lang => {
    const label = document.createElement("label");
    label.style.fontWeight = "500";
    label.style.cursor = "pointer";

    const input = document.createElement("input");
    input.type = "radio";
    input.name = "language";
    input.value = lang.code;
    input.style.accentColor = "var(--atlasGreen)";
    input.style.marginRight = "5px";
    input.style.cursor = "pointer";
    input.checked = lang.code === state.currentLang;
    input.addEventListener("change", event => {
      if (event.target.checked) handleLanguageChange(lang.code);
    });

    label.appendChild(input);
    label.appendChild(document.createTextNode(lang.label));
    langDiv.appendChild(label);
  });

  langSel.appendChild(langDiv);
  navEnd.parentNode.appendChild(langSel);
}

function debounce(callback, waitMs) {
  let timeoutId;
  return event => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => callback(event), waitMs);
  };
}

function renderGlossary() {
  if (!output) return;

  let html = "<div>";

  state.sections.forEach(([section, entries]) => {
    const filteredEntries = state.searchQuery
      ? entries.filter(entry => entry._searchIndex.includes(state.searchQuery))
      : entries;

    if (!filteredEntries.length) return;

    html += `<h2 id="section-${sanitizeId(section)}">${escapeHtml(section)}</h2>`;

    filteredEntries.forEach(entry => {
      const term = escapeHtml(entry.Term || "");
      const acronym = escapeHtml((entry.Acronym || "").trim());
      const definition = escapeHtml(
        state.currentLang === "EN" ? entry["Definition EN"] || "" : entry["Definition FR"] || ""
      );
      const tooltip = escapeHtml(
        state.currentLang === "EN" ? entry["Tooltip EN"] || "" : entry["Tooltip FR"] || ""
      );

      html += '<div style="margin-bottom: 30px;">';
      html += `<h3 style="color: #555; margin-bottom: 5px; font-size: 1.3em;">${term}${
        acronym ? ` (${acronym})` : ""
      }</h3>`;
      if (tooltip) {
        html += `<p style="color: #667; font-style: italic; margin: 5px 0; font-size: 0.9em;">${tooltip}</p>`;
      }
      if (definition) {
        html += `<p style="color: #444; line-height: 1.6; margin-top: 10px;">${definition}</p>`;
      }
      html += "</div>";
    });
  });

  html += "</div>";
  output.innerHTML = html;
}

fetch(DATA_URL)
  .then(response => {
    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
    return response.json();
  })
  .then(data => {
    state.sections = buildSections(data);
    mountLanguageSelector();
    updateSearchPlaceholder();
    renderGlossary();

    if (searchBox) {
      searchBox.addEventListener(
        "input",
        debounce(event => {
          state.searchQuery = event.target.value.trim().toLowerCase();
          renderGlossary();
        }, 200)
      );
    }
  })
  .catch(error => {
    console.error("Error loading JSON:", error);
    if (output) output.innerHTML = `<p style="color: red;">Error loading glossary: ${error.message}</p>`;
  });
</script>
```
