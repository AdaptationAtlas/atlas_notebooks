class AtlasToc extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0;const h=this.getAttribute("title")||"Contents",c=(this.getAttribute("heading-levels")||"1").split(",").map(t=>parseInt(t.trim(),10)).filter(t=>Number.isInteger(t)&&t>=1&&t<=6),d=(this.getAttribute("ids-to-ignore")||"").split(",").map(t=>t.trim()).filter(Boolean);this.style.display="none",this._panel=document.createElement("div"),this._panel.className="atlas-toc atlas-toc-floating",this._panel.innerHTML=`
      <span class="atlas-toc-heading">${h}</span>
      <div class="atlas-toc-links"></div>
    `,document.body.appendChild(this._panel),this._linksContainer=this._panel.querySelector(".atlas-toc-links"),this._headingLevels=c.length?c:[1],this._ignoredIdSet=new Set(d),this._sections=[],this._links=[],this._sectionIndexMap=new Map,this._activeIndex=null,this._usingScrollFallback=!1;const _=t=>t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-");this._updateHeadingList=()=>{const t=this._headingLevels.map(e=>`h${e}`).join(", "),n=document.querySelectorAll(t),s=document.createElement("div");this._sections=[],this._links=[],this._sectionIndexMap=new Map,this._activeIndex=null,n.forEach(e=>{const o=e.textContent.trim();let i=e.id;if(!i){i=_(o);let a=1,r=i;for(;document.getElementById(r);)r=`${i}-${a++}`;e.id=r,i=r}if(this._ignoredIdSet.has(i))return;const l=document.createElement("a");l.href=`#${i}`,l.textContent=o||"[Empty Heading]",l.classList.add("toc-link"),s.appendChild(l),this._links.push(l),this._sections.push(e),this._sectionIndexMap.set(e,this._sections.length-1)}),this._linksContainer.innerHTML="",this._linksContainer.appendChild(s),this._observeSections(),typeof this._layout=="function"&&this._layout()},this._setActiveLink=t=>{this._links.forEach(n=>n.classList.remove("active")),t&&t.classList.add("active")},this._setActiveIndex=t=>{t<0||t>=this._links.length||this._activeIndex!==t&&(this._activeIndex=t,this._setActiveLink(this._links[t]))},this._isNearPageBottom=()=>window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-24,this._updateBottomState=()=>{this._links.length&&this._isNearPageBottom()&&this._setActiveIndex(this._links.length-1)},this._onScroll=()=>{if(!this._sections.length)return;if(this._isNearPageBottom()){this._setActiveIndex(this._links.length-1);return}let t=0,n=1/0;this._sections.forEach((s,e)=>{if(!s)return;const o=s.getBoundingClientRect(),i=Math.abs(o.top-50);i<n&&(n=i,t=e)}),this._setActiveIndex(t)},this._enableScrollFallback=()=>{this._usingScrollFallback||(window.addEventListener("scroll",this._onScroll,{passive:!0}),this._usingScrollFallback=!0)},this._disableScrollFallback=()=>{this._usingScrollFallback&&(window.removeEventListener("scroll",this._onScroll),this._usingScrollFallback=!1)},this._observeSections=()=>{if(this._intersectionObserver&&(this._intersectionObserver.disconnect(),this._intersectionObserver=null),!!this._sections.length){if(!("IntersectionObserver"in window)){this._enableScrollFallback(),this._onScroll();return}this._disableScrollFallback(),this._intersectionObserver=new IntersectionObserver(t=>{let n=this._activeIndex??0,s=-1/0;if(t.forEach(e=>{const o=this._sectionIndexMap.get(e.target);if(o===void 0||!e.isIntersecting)return;const i=1-Math.min(Math.abs(e.boundingClientRect.top-80)/800,1),l=e.intersectionRatio+i;l>s&&(s=l,n=o)}),s!==-1/0){if(this._isNearPageBottom()){this._setActiveIndex(this._links.length-1);return}this._setActiveIndex(n)}},{root:null,rootMargin:"-80px 0px -65% 0px",threshold:[0,.1,.25,.5,1]}),this._sections.forEach(t=>this._intersectionObserver.observe(t)),this._activeIndex===null&&this._links.length&&this._setActiveIndex(0)}},this._observer=new MutationObserver(t=>{let n=!1;for(const s of t)if([...s.addedNodes,...s.removedNodes].some(o=>o.nodeType!==1?!1:this._headingLevels.some(i=>o.matches(`h${i}`)||o.querySelector(`h${i}`)))){n=!0;break}n&&requestAnimationFrame(this._updateHeadingList)}),this._observer.observe(document.body,{childList:!0,subtree:!0}),this._updateHeadingList(),window.addEventListener("scroll",this._updateBottomState,{passive:!0}),this._layout=()=>{if(!this._panel)return;const t=document.getElementById("quarto-document-content");if(!t){this._panel.style.display="none";return}const n=t.getBoundingClientRect(),s=22,e=24,o=180,i=280,l=n.left-e-s;if(l<o||window.innerWidth<=900){this._panel.style.display="none";return}const a=Math.min(i,l);this._panel.style.display="block",this._panel.style.left=`${s}px`,this._panel.style.top="9rem",this._panel.style.width=`${a}px`},this._onResize=()=>this._layout(),window.addEventListener("resize",this._onResize,{passive:!0}),this._layout()}disconnectedCallback(){this._observer&&this._observer.disconnect(),this._intersectionObserver&&this._intersectionObserver.disconnect(),this._onScroll&&window.removeEventListener("scroll",this._onScroll),this._updateBottomState&&window.removeEventListener("scroll",this._updateBottomState),this._onResize&&window.removeEventListener("resize",this._onResize),this._panel&&this._panel.parentNode&&this._panel.parentNode.removeChild(this._panel),this._initialized=!1}}customElements.define("atlas-toc",AtlasToc);
