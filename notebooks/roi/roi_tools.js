import*as p from"https://cdn.jsdelivr.net/npm/d3@7/+esm";export function avlossCalc(n,l,h=!1,c=1e6,M=!0){const s=h?Math.max(0,n-Math.min(l,n)):n*(1-l);if(s<0)return NaN;const r=n,u=(e,R)=>{const m=new Float64Array(e);for(let f=0;f<e;f+=2){const A=Math.random(),b=Math.random(),v=Math.sqrt(-2*Math.log(A)),I=2*Math.PI*b;m[f]=1+v*Math.cos(I)*R,f+1<e&&(m[f+1]=1+v*Math.sin(I)*R)}return m},t=u(c,s),o=u(c,r),a=e=>M?p.median(p.shuffle(Array.from(e)).slice(0,5e4)):p.median(e),i=a(t),g=a(o);let d=0,w=0,x=0;for(let e=0;e<c;e++)t[e]<=i&&(d+=t[e]),o[e]<=g&&(w+=o[e]),x+=o[e];return Math.max(0,(d-w)/x)}export function calcIRR(n,l=.1,h=100,c=1e-6){const M=u=>n.reduce((t,o,a)=>t+o/Math.pow(1+u,a),0);let s=l,r=l+.05;for(let u=0;u<h;u++){const t=M(s),o=M(r),a=o-t;if(Math.abs(a)<1e-10)return null;const i=r-o*(r-s)/a;if(Math.abs(i-r)<c)return i;s=r,r=i}return null}export function calcMIRR(n,l,h){const c=n.length-1,M=n.map(t=>t>0?t:0),s=n.map(t=>t<0?t:0),r=M.reduce((t,o,a)=>t+o*Math.pow(1+h,c-a),0),u=s.reduce((t,o,a)=>t+o/Math.pow(1+l,a),0);return u===0||r<=0?null:Math.pow(r/Math.abs(u),1/c)-1}export function npvDiscreteCumulative(n,l){return n.map((h,c)=>n.slice(0,c+1).reduce((M,s,r)=>M+s/Math.pow(1+l,r),0))}
