<!doctype html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta charset="utf-8"><meta name="generator" content="quarto-1.8.25"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"><title>Atlas Notebook Template</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}</style><script src="../../site_libs/quarto-nav/quarto-nav.js"></script><script src="../../site_libs/quarto-nav/headroom.min.js"></script><link href="../../images/atlas-icon.svg" rel="icon" type="image/svg+xml"><script src="../../site_libs/clipboard/clipboard.min.js"></script><script src="../../site_libs/quarto-html/quarto.js" type="module"></script><script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script><script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script><script src="../../site_libs/quarto-html/popper.min.js"></script><script src="../../site_libs/quarto-html/tippy.umd.min.js"></script><link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles"><script src="../../site_libs/bootstrap/bootstrap.min.js"></script><link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet"><link href="../../site_libs/bootstrap/bootstrap-53a0a1c902e82bd70cf7a7f6e7189f61.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&amp;display=swap" rel="stylesheet"><script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet"><link rel="stylesheet" href="../../styles.css"><link rel="stylesheet" href="roi_styles.css"></head><body class="nav-fixed fullcontent quarto-light"><div id="quarto-search-results"></div><header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme="dark"><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a href="https://adaptationatlas.cgiar.org" class="navbar-brand navbar-brand-logo"><img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo light-content"> <img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo dark-content"></a></div><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="window.quartoToggleHeadroom&&window.quartoToggleHeadroom()"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item"><a class="nav-link" href="../../docs/doc_index.html"><i class="bi bi-info-circle" role="img" aria-label="More Information"></i> <span class="menu-text">Documentation</span></a></li><li class="nav-item"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks/issues/new"><span class="menu-text">Report an Issue</span></a></li><li class="nav-item compact"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks"><i class="bi bi-github" role="img" aria-label="GitHub"></i> <span class="menu-text"></span></a></li></ul></div><div class="quarto-navbar-tools"></div></div></nav></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="18" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 17"><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  atlasTOC<span class="op">,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  atlasHero<span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  dropdown_section<span class="op">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  downloadButton<span class="op">,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  makeTooltipLabel<span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/helpers/uiComponents.ojs"</span><span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>hero_url <span class="op">=</span> <span class="st">"./../../images/default_crop.webp"</span><span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">atlasHero</span>(nbTitle<span class="op">,</span> hero_url)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-3" data-nodetype="expression"></div></div></div></div><section id="overview" class="level1"><h1><span><span id="ojs-element-id-1"></span></span></h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="36" data-source-offset="-29"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 35"><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="38" data-source-offset="-75"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 37"><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block2</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-2" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="40" data-source-offset="-121"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 39"><span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="fu">dropdown_section</span>(</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Definitions"</span><span class="op">,</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">false</span><span class="op">,</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-3" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="52" data-source-offset="-365"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 51"><span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block3</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-4" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="54" data-source-offset="-411"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 53"><span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block4</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-5" data-nodetype="expression"></div></div></div></div></section><section id="project-setup" class="level1"><h1><span><span id="ojs-element-id-2"></span></span></h1><p><span><span id="ojs-element-id-3"></span></span></p><p><span><span id="ojs-element-id-4"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="63" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 62"><span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div style="display: flex; gap: 3em;"&gt;</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_country<span class="sc">}</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_region<span class="sc">}</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_crop<span class="sc">}</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-3" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="73" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 72"><span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> exposure_data</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    regionSet<span class="op">.</span><span class="fu">has</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">iso3</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totals <span class="op">=</span> d3<span class="op">.</span><span class="fu">rollup</span>(</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    data<span class="op">,</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    v <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">sum</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span><span class="op">,</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">crop</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> flatTotals <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(totals<span class="op">,</span> ([admin0_name<span class="op">,</span> crops]) <span class="kw">=&gt;</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(crops<span class="op">,</span> ([crop<span class="op">,</span> value]) <span class="kw">=&gt;</span> ({ admin0_name<span class="op">,</span> crop<span class="op">,</span> value }))</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>  )<span class="op">.</span><span class="fu">flat</span>()<span class="op">;</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _title <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">en</span><span class="op">:</span> <span class="st">"Total VoP for selected regions and crops in each country"</span><span class="op">,</span> </span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fr</span><span class="op">:</span> <span class="st">"Total VoP pour les régions et les cultures sélectionnées dans chaque pays"</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>    <span class="dt">subtitle</span><span class="op">:</span> _title<span class="op">,</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">928</span><span class="op">,</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">tickFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs"> Regions`</span> }<span class="op">,</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">tickFormat</span><span class="op">:</span>(d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>()(d) }<span class="op">,</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Crops"</span><span class="op">,</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barY</span>(flatTotals<span class="op">,</span> {</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-4" data-nodetype="expression"></div></div></div><section id="langnbtext.projectsetup.blocks.costs.h2" class="level2"><h2 data-anchor-id="langnbtext.projectsetup.blocks.costs.h2"><span><span id="ojs-element-id-5"></span></span></h2><p><span><span id="ojs-element-id-6"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="124" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 123"><span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>viewof inputProjectOptions <span class="op">=</span> {</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProjectCost <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">text</span>({</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pattern</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">pattern</span><span class="op">,</span></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">placeholder</span><span class="op">,</span></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">valueString</span></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProjectYears <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(inputOptions_projectYears<span class="op">.</span><span class="at">data</span><span class="op">,</span> {</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="dv">8</span>)</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cost</span><span class="op">:</span> inputProjectCost<span class="op">,</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>      <span class="dt">years</span><span class="op">:</span>inputProjectYears</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> (inputs) <span class="kw">=&gt;</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>        htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 3em"&gt;</span><span class="sc">${</span><span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>          inputs</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-5" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="159" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 158"><span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">calloutTemplate</span>)</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> templateItems <span class="op">=</span> [</span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"money"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatUSD</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(rangeProjectCost)}<span class="op">,</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> inputProjectOptions<span class="op">.</span><span class="at">years</span><span class="op">.</span><span class="at">label</span>}<span class="op">,</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> templateItems)</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>formatted<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-6" data-nodetype="expression"></div></div></div></section><section id="langnbtext.projectsetup.blocks.impacts.h2" class="level2"><h2 data-anchor-id="langnbtext.projectsetup.blocks.impacts.h2"><span><span id="ojs-element-id-7"></span></span></h2><p><span><span id="ojs-element-id-8"></span></span></p></section><section id="select-parameters" class="level2"><h2 data-anchor-id="select-parameters">Select Parameters</h2><p>Choose your model parameters for the analysis.</p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="183" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 182"><span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>viewof selections_econPerfWalkthrough <span class="op">=</span> {</span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_prodImpact <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_Adoption <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_CisImpact <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProdImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">55</span>]<span class="op">,</span></span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_prodImpact<span class="op">,</span></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">30</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputAdoption <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.25</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="fl">0.25</span><span class="op">,</span></span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_Adoption<span class="op">,</span></span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputCisImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">55</span>]<span class="op">,</span></span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_CisImpact<span class="op">,</span></span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">25</span></span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a>      inputProdImpact<span class="op">,</span></span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a>      inputAdoption<span class="op">,</span></span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a>      inputCisImpact</span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> (inputs) <span class="kw">=&gt;</span></span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>        htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 3em"&gt;</span><span class="sc">${</span><span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(</span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a>          inputs</span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true" tabindex="-1"></a>options_econPerfWalkthrough <span class="op">=</span> {</span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> [key<span class="op">,</span> value] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(selections_econPerfWalkthrough)) {</span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true" tabindex="-1"></a>    formatted[key] <span class="op">=</span> {</span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>value<span class="sc">}</span><span class="vs">%`</span><span class="op">,</span></span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> value <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> formatted<span class="op">;</span></span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-7-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-7-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="266" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 265"><span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _discountLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="st">"Discount Rate"</span><span class="op">,</span></span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="st">"The Discount rate is..."</span><span class="op">,</span></span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _roiLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="st">"ROI"</span><span class="op">,</span></span>
<span id="cb12-274"><a href="#cb12-274" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="st">"The ROI is..."</span><span class="op">,</span></span>
<span id="cb12-275"><a href="#cb12-275" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">dropdown_section</span>(</span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Advanced Controls"</span><span class="op">,</span></span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span><span class="op">,</span></span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> (x <span class="op">*</span> <span class="dv">100</span>)<span class="op">,</span> <span class="dt">label</span> <span class="op">:</span> _discountLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.12</span>} </span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span> viewof discountRate</span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">0.5</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> _roiLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.62</span>} </span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span> viewof bcr</span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-8" data-nodetype="expression"></div></div></div></section></section><section id="investment-returns" class="level1"><h1><span><span id="ojs-element-id-9"></span></span></h1><p><span><span id="ojs-element-id-10"></span></span></p><p><span><span id="ojs-element-id-11"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="303" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 302"><span id="cb13-303"><a href="#cb13-303" aria-hidden="true" tabindex="-1"></a><span class="fu">bigNumbersResults</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-9" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="308" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 307"><span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a><span class="fu">resultTable</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-10-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="309" data-source-offset="-15"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 308"><span id="cb15-309"><a href="#cb15-309" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadButton</span>(</span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true" tabindex="-1"></a>  walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span><span class="op">,</span></span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a>  <span class="st">"roi_data.csv"</span><span class="op">,</span></span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Download"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Télécharger"</span> })<span class="op">,</span></span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-10-2" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="316" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 315"><span id="cb16-316"><a href="#cb16-316" aria-hidden="true" tabindex="-1"></a><span class="fu">resultPlot</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-11" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="320" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 319"><span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a>indicatorSelector <span class="op">=</span> {</span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a>  <span class="co">// bind input so tooltip can be dynamic</span></span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">select</span>(dataPickMetric<span class="op">,</span> {</span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">indicator</span>)<span class="op">,</span></span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> pickMetricWalkthrough<span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">labelFull</span><span class="op">,</span></span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span> viewof pickMetricWalkthrough</span>
<span id="cb17-330"><a href="#cb17-330" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-331"><a href="#cb17-331" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-12" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="335" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 334"><span id="cb18-335"><a href="#cb18-335" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-336"><a href="#cb18-336" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listWhat <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">what</span>)</span>
<span id="cb18-337"><a href="#cb18-337" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listInterpret <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">interpret</span>)</span>
<span id="cb18-338"><a href="#cb18-338" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listTell <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb18-339"><a href="#cb18-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-340"><a href="#cb18-340" aria-hidden="true" tabindex="-1"></a>  <span class="co">// indicator info</span></span>
<span id="cb18-341"><a href="#cb18-341" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">labelFull</span><span class="sc">}</span></span>
<span id="cb18-342"><a href="#cb18-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-343"><a href="#cb18-343" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listWhat<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span><span class="sc">}</span></span>
<span id="cb18-344"><a href="#cb18-344" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listInterpret<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span><span class="sc">}</span></span>
<span id="cb18-345"><a href="#cb18-345" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listTell<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span><span class="sc">}</span></span>
<span id="cb18-346"><a href="#cb18-346" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb18-347"><a href="#cb18-347" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-13" data-nodetype="expression"></div></div></div><p><span><span id="ojs-element-id-12"></span></span></p></section><section id="summary" class="level1"><h1><span><span id="ojs-element-id-13"></span></span></h1><p><span><span id="ojs-element-id-14"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="357" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 356"><span id="cb19-357"><a href="#cb19-357" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb19-358"><a href="#cb19-358" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_rate <span class="op">=</span> (discountRate <span class="op">*</span> <span class="dv">100</span>) <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb19-359"><a href="#cb19-359" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> farm_bcr <span class="op">=</span> bcr<span class="op">;</span></span>
<span id="cb19-360"><a href="#cb19-360" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> methods_title <span class="op">=</span> nbMethods<span class="op">;</span></span>
<span id="cb19-361"><a href="#cb19-361" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-362"><a href="#cb19-362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block2</span>)</span>
<span id="cb19-363"><a href="#cb19-363" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> templateItems <span class="op">=</span> [</span>
<span id="cb19-364"><a href="#cb19-364" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"npvDisountRate"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> npv_rate}<span class="op">,</span></span>
<span id="cb19-365"><a href="#cb19-365" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"farmBcr"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> farm_bcr}<span class="op">,</span></span>
<span id="cb19-366"><a href="#cb19-366" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"methodsSourcesTitle"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> methods_title}<span class="op">,</span></span>
<span id="cb19-367"><a href="#cb19-367" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb19-368"><a href="#cb19-368" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> templateItems)</span>
<span id="cb19-369"><a href="#cb19-369" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>formatted<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb19-370"><a href="#cb19-370" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-14" data-nodetype="expression"></div></div></div></section><section id="methods" class="level1"><h1><span><span id="ojs-element-id-15"></span></span></h1><p><span><span id="ojs-element-id-16"></span></span></p></section><section id="appendix" class="level1"><h1><span><span id="ojs-element-id-17"></span></span></h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="381" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 380"><span id="cb20-381"><a href="#cb20-381" aria-hidden="true" tabindex="-1"></a>toc_bottom <span class="op">=</span> <span class="fu">atlasTOC</span>({</span>
<span id="cb20-382"><a href="#cb20-382" aria-hidden="true" tabindex="-1"></a>  <span class="dt">skip</span><span class="op">:</span> [<span class="st">"notebook-title"</span><span class="op">,</span> <span class="st">"appendix"</span><span class="op">,</span> <span class="st">"source-code"</span>]<span class="op">,</span> <span class="co">// These should be the section headings in the {# headings}</span></span>
<span id="cb20-383"><a href="#cb20-383" aria-hidden="true" tabindex="-1"></a>  <span class="dt">heading</span><span class="op">:</span> <span class="vs">`&lt;b&gt;</span><span class="sc">${</span>Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(<span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">toc</span>))<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">,</span></span>
<span id="cb20-384"><a href="#cb20-384" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb20-385"><a href="#cb20-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-386"><a href="#cb20-386" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb20-387"><a href="#cb20-387" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class='floating-toc'&gt;</span></span>
<span id="cb20-388"><a href="#cb20-388" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>toc_bottom<span class="sc">}</span></span>
<span id="cb20-389"><a href="#cb20-389" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb20-390"><a href="#cb20-390" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-15-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-15-2" data-nodetype="expression"></div></div></div></div></section><section id="source-code" class="level1"><h1>Source code</h1><section id="data-import-and-cleaning" class="level2"><h2 data-anchor-id="data-import-and-cleaning">Data import and cleaning</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="402" data-source-offset="-50"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 401"><span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> {</span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> db <span class="op">=</span> <span class="cf">await</span> DuckDBClient<span class="op">.</span><span class="fu">of</span>({</span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cv_raw</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/faostat_prod_cv.parquet"</span>)</span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a><span class="vs">    CREATE TABLE exposure AS  -- data is ~ 1 mb so table possibly more performant</span></span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT</span></span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a><span class="vs">        iso3,</span></span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin1_name,</span></span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a><span class="vs">        REGEXP_REPLACE(crop, '-tropical|-highland', '') AS crop,</span></span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a><span class="vs">        CONCAT(exposure, '_', unit) AS exposure,</span></span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a><span class="vs">        SUM(value) AS value</span></span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM read_parquet("s3://digital-atlas/domain=exposure/type=combined/source=glw4-2020_spam2020AA/region=ssa/processing=atlas-harmonized/variable=vop_nominal-usd-2021.parquet")</span></span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE</span></span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin2_name IS NULL</span></span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND (tech = 'all' OR tech IS NULL)</span></span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND isfinite(value)</span></span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND crop !~ '(^other-|rest-of|temperate-fruit|tropical-fruit|vegetables)'</span></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a><span class="vs">      GROUP BY</span></span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a><span class="vs">        iso3,</span></span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin1_name,</span></span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a><span class="vs">        crop,</span></span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a><span class="vs">        CONCAT(exposure, '_', unit)</span></span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)</span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a><span class="vs">    CREATE VIEW cv AS</span></span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT</span></span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a><span class="vs">        -- clean and standardize crop names</span></span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a><span class="vs">        REGEXP_REPLACE(</span></span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a><span class="vs">          REGEXP_REPLACE(</span></span>
<span id="cb21-435"><a href="#cb21-435" aria-hidden="true" tabindex="-1"></a><span class="vs">            REPLACE(REPLACE(crop, '_meat', ''), ' ', '-'),</span></span>
<span id="cb21-436"><a href="#cb21-436" aria-hidden="true" tabindex="-1"></a><span class="vs">            'goat$', 'goats'</span></span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a><span class="vs">          ),</span></span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a><span class="vs">          'pig$', 'pigs'</span></span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a><span class="vs">        ) AS crop,</span></span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a><span class="vs">        value_filled AS cv</span></span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE NOT (crop ILIKE '%milk%' OR crop ILIKE '%eggs%' OR LOWER(crop) = 'total')</span></span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a><span class="vs">      -- add robusta-coffee and small-millet substitutes</span></span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT admin0_name, 'robusta-coffee', value_filled AS cv</span></span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE crop = 'arabica-coffee'</span></span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT admin0_name, 'small-millet', value_filled AS cv</span></span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE crop = 'pearl-millet';</span></span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb21-455"><a href="#cb21-455" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db<span class="op">;</span></span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> {</span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> country_list <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/shared/atlas_countries.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filteredCountries <span class="op">=</span> country_list</span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((c) <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">include</span> <span class="op">&amp;&amp;</span> c<span class="op">.</span><span class="at">iso3c</span> <span class="op">!==</span> <span class="st">"SDN"</span>)</span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(({ include<span class="op">,</span> <span class="op">...</span>rest }) <span class="kw">=&gt;</span> rest)<span class="op">;</span></span>
<span id="cb21-463"><a href="#cb21-463" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> filteredCountries<span class="op">;</span></span>
<span id="cb21-464"><a href="#cb21-464" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-16-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-16-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="470" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 469"><span id="cb22-470"><a href="#cb22-470" aria-hidden="true" tabindex="-1"></a>dataAdminRegions <span class="op">=</span> {</span>
<span id="cb22-471"><a href="#cb22-471" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> regions <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb22-472"><a href="#cb22-472" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT DISTINCT admin0_name, admin1_name, iso3</span></span>
<span id="cb22-473"><a href="#cb22-473" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM exposure</span></span>
<span id="cb22-474"><a href="#cb22-474" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE admin1_name IS NOT null</span></span>
<span id="cb22-475"><a href="#cb22-475" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND iso3 in ('</span><span class="sc">${</span>select_country<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb22-476"><a href="#cb22-476" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)</span>
<span id="cb22-477"><a href="#cb22-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-478"><a href="#cb22-478" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> regions<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> ({</span>
<span id="cb22-479"><a href="#cb22-479" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>row<span class="op">,</span></span>
<span id="cb22-480"><a href="#cb22-480" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>row<span class="op">.</span><span class="at">iso3</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>row<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb22-481"><a href="#cb22-481" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb22-482"><a href="#cb22-482" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-483"><a href="#cb22-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-484"><a href="#cb22-484" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">TODO</span><span class="co">: Need to add translations and label cleaning to items</span></span>
<span id="cb22-485"><a href="#cb22-485" aria-hidden="true" tabindex="-1"></a>dataCrops <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb22-486"><a href="#cb22-486" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT DISTINCT crop AS item</span></span>
<span id="cb22-487"><a href="#cb22-487" aria-hidden="true" tabindex="-1"></a><span class="vs">  FROM exposure</span></span>
<span id="cb22-488"><a href="#cb22-488" aria-hidden="true" tabindex="-1"></a><span class="vs">  ORDER BY item</span></span>
<span id="cb22-489"><a href="#cb22-489" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-17-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-17-2" data-nodetype="declaration"></div></div></div></div></section><section id="inputs" class="level2"><h2 data-anchor-id="inputs">Inputs</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="496" data-source-offset="-43"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 495"><span id="cb23-496"><a href="#cb23-496" aria-hidden="true" tabindex="-1"></a>inputOptions_projectCost <span class="op">=</span> {</span>
<span id="cb23-497"><a href="#cb23-497" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb23-498"><a href="#cb23-498" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="fl">1e6</span><span class="op">,</span> <span class="fl">5e8</span>]<span class="op">,</span></span>
<span id="cb23-499"><a href="#cb23-499" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costInput</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb23-500"><a href="#cb23-500" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costInput</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb23-501"><a href="#cb23-501" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e5</span><span class="op">,</span></span>
<span id="cb23-502"><a href="#cb23-502" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">50_000_000</span><span class="op">,</span></span>
<span id="cb23-503"><a href="#cb23-503" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'$.3s'</span>)<span class="op">,</span></span>
<span id="cb23-504"><a href="#cb23-504" aria-hidden="true" tabindex="-1"></a>    <span class="dt">outputWidth</span><span class="op">:</span> <span class="dv">90</span><span class="op">,</span></span>
<span id="cb23-505"><a href="#cb23-505" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Ex. $5,000,000"</span><span class="op">,</span></span>
<span id="cb23-506"><a href="#cb23-506" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pattern</span><span class="op">:</span> <span class="st">"^[$]?[1-9]+[0-9,$]*$"</span><span class="op">,</span></span>
<span id="cb23-507"><a href="#cb23-507" aria-hidden="true" tabindex="-1"></a>    <span class="dt">valueString</span><span class="op">:</span> <span class="st">"$50,000,000"</span></span>
<span id="cb23-508"><a href="#cb23-508" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-509"><a href="#cb23-509" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-510"><a href="#cb23-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-511"><a href="#cb23-511" aria-hidden="true" tabindex="-1"></a>inputOptions_projectYears <span class="op">=</span> {</span>
<span id="cb23-512"><a href="#cb23-512" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb23-513"><a href="#cb23-513" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">year</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span></span>
<span id="cb23-514"><a href="#cb23-514" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb23-515"><a href="#cb23-515" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb23-516"><a href="#cb23-516" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">16</span>]<span class="op">,</span></span>
<span id="cb23-517"><a href="#cb23-517" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> d3</span>
<span id="cb23-518"><a href="#cb23-518" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">range</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">16</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb23-519"><a href="#cb23-519" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>years<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d }))<span class="op">,</span></span>
<span id="cb23-520"><a href="#cb23-520" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb23-521"><a href="#cb23-521" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb23-522"><a href="#cb23-522" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb23-523"><a href="#cb23-523" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb23-524"><a href="#cb23-524" aria-hidden="true" tabindex="-1"></a>    <span class="dt">outputWidth</span><span class="op">:</span> <span class="dv">90</span></span>
<span id="cb23-525"><a href="#cb23-525" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb23-526"><a href="#cb23-526" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-18-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-18-2" data-nodetype="declaration"></div></div></div></div><section id="scope-selectors---country-region-crop" class="level3"><h3 data-anchor-id="scope-selectors---country-region-crop">Scope Selectors - country, region, crop</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="531" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 530"><span id="cb24-531"><a href="#cb24-531" aria-hidden="true" tabindex="-1"></a>viewof select_country <span class="op">=</span> {</span>
<span id="cb24-532"><a href="#cb24-532" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> countries</span>
<span id="cb24-533"><a href="#cb24-533" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb24-534"><a href="#cb24-534" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">iso3c</span><span class="op">,</span> <span class="co">//Migrating to iso codes for future flexability</span></span>
<span id="cb24-535"><a href="#cb24-535" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(d<span class="op">.</span><span class="at">translation</span>)</span>
<span id="cb24-536"><a href="#cb24-536" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb24-537"><a href="#cb24-537" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb24-538"><a href="#cb24-538" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb24-539"><a href="#cb24-539" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb24-540"><a href="#cb24-540" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb24-541"><a href="#cb24-541" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">countryDropdown</span><span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb24-542"><a href="#cb24-542" aria-hidden="true" tabindex="-1"></a>      )    </span>
<span id="cb24-543"><a href="#cb24-543" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb24-544"><a href="#cb24-544" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb24-545"><a href="#cb24-545" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select Countries..."</span><span class="op">,</span></span>
<span id="cb24-546"><a href="#cb24-546" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb24-547"><a href="#cb24-547" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> [<span class="st">"KEN"</span><span class="op">,</span> <span class="st">"TZA"</span>]<span class="op">,</span></span>
<span id="cb24-548"><a href="#cb24-548" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-549"><a href="#cb24-549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-550"><a href="#cb24-550" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span> <span class="co">// Noisy input, so delay it a bit.</span></span>
<span id="cb24-551"><a href="#cb24-551" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-19" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="557" data-source-offset="-31"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 556"><span id="cb25-557"><a href="#cb25-557" aria-hidden="true" tabindex="-1"></a>viewof select_region <span class="op">=</span> {</span>
<span id="cb25-558"><a href="#cb25-558" aria-hidden="true" tabindex="-1"></a>  <span class="co">// filter regions based on country id's</span></span>
<span id="cb25-559"><a href="#cb25-559" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filteredRegions <span class="op">=</span> dataAdminRegions</span>
<span id="cb25-560"><a href="#cb25-560" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const translateCountry = (d) =&gt; _lang(td.admin0_name.values?.[d]);</span></span>
<span id="cb25-561"><a href="#cb25-561" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> translateCountry <span class="op">=</span> (iso) <span class="kw">=&gt;</span> <span class="fu">_lang</span>(countries<span class="op">.</span><span class="fu">find</span>((c) <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">iso3c</span> <span class="op">===</span> iso)<span class="op">.</span><span class="at">translation</span>)<span class="op">;</span></span>
<span id="cb25-562"><a href="#cb25-562" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> filteredRegions<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb25-563"><a href="#cb25-563" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb25-564"><a href="#cb25-564" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">translateCountry</span>(d<span class="op">.</span><span class="at">iso3</span>)<span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb25-565"><a href="#cb25-565" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb25-566"><a href="#cb25-566" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedIds <span class="op">=</span> filteredRegions<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb25-567"><a href="#cb25-567" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> {</span>
<span id="cb25-568"><a href="#cb25-568" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb25-569"><a href="#cb25-569" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">regionDropdown</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb25-570"><a href="#cb25-570" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-571"><a href="#cb25-571" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb25-572"><a href="#cb25-572" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({<span class="dt">labelText</span><span class="op">:</span> text<span class="op">.</span><span class="at">label</span><span class="op">,</span> <span class="dt">tooltipText</span><span class="op">:</span> text<span class="op">.</span><span class="at">tooltip</span>})<span class="op">,</span></span>
<span id="cb25-573"><a href="#cb25-573" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb25-574"><a href="#cb25-574" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select regions..."</span><span class="op">,</span></span>
<span id="cb25-575"><a href="#cb25-575" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb25-576"><a href="#cb25-576" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> selectedIds</span>
<span id="cb25-577"><a href="#cb25-577" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-578"><a href="#cb25-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-579"><a href="#cb25-579" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb25-580"><a href="#cb25-580" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-581"><a href="#cb25-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-582"><a href="#cb25-582" aria-hidden="true" tabindex="-1"></a>select_region</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-20-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-20-2" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="585" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 584"><span id="cb26-585"><a href="#cb26-585" aria-hidden="true" tabindex="-1"></a><span class="co">// admin multi-select: countries</span></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a>viewof select_crop <span class="op">=</span> {</span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataCrops</span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">item</span><span class="op">,</span></span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(d<span class="op">.</span><span class="at">item</span>) <span class="co">//</span><span class="al">TODO</span><span class="co">: Add translations</span></span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb26-592"><a href="#cb26-592" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span>b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">label</span> <span class="op">&gt;</span> b<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb26-593"><a href="#cb26-593" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedId <span class="op">=</span> dataCrops</span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> [<span class="st">"bean"</span><span class="op">,</span> <span class="st">"goats"</span><span class="op">,</span> <span class="st">"maize"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">item</span>))</span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">item</span>)<span class="op">;</span></span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> {</span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">commodity</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">commodityDropdown</span><span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-601"><a href="#cb26-601" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb26-602"><a href="#cb26-602" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb26-603"><a href="#cb26-603" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> text<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> text<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select crops..."</span><span class="op">,</span></span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> selectedId</span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb26-612"><a href="#cb26-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-613"><a href="#cb26-613" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-21" data-nodetype="declaration"></div></div></div></section></section><section id="economic-input-variables" class="level2"><h2 data-anchor-id="economic-input-variables">Economic Input Variables</h2><section id="main-control-variables" class="level3"><h3 data-anchor-id="main-control-variables">Main Control Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="623" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 622"><span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a>rangeProjectCost <span class="op">=</span> {</span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unpack <span class="op">=</span> <span class="bu">Number</span>(inputProjectOptions<span class="op">.</span><span class="at">cost</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">[,|$]</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>))</span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> number <span class="op">=</span> <span class="bu">Number</span>(unpack)</span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> number</span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a>projectYears <span class="op">=</span> inputProjectOptions<span class="op">.</span><span class="at">years</span><span class="op">.</span><span class="at">value</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-22-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-22-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="632" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 631"><span id="cb28-632"><a href="#cb28-632" aria-hidden="true" tabindex="-1"></a>render_econPerfWalkthrough <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb28-633"><a href="#cb28-633" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> terms <span class="op">=</span> {</span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a>    <span class="dt">none</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">none</span><span class="op">,</span> {</span>
<span id="cb28-635"><a href="#cb28-635" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb28-636"><a href="#cb28-636" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-637"><a href="#cb28-637" aria-hidden="true" tabindex="-1"></a>    <span class="dt">low</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">low</span><span class="op">,</span> {</span>
<span id="cb28-638"><a href="#cb28-638" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb28-639"><a href="#cb28-639" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-640"><a href="#cb28-640" aria-hidden="true" tabindex="-1"></a>    <span class="dt">moderate</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">moderate</span><span class="op">,</span> {</span>
<span id="cb28-641"><a href="#cb28-641" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb28-642"><a href="#cb28-642" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-643"><a href="#cb28-643" aria-hidden="true" tabindex="-1"></a>    <span class="dt">high</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">high</span><span class="op">,</span> {</span>
<span id="cb28-644"><a href="#cb28-644" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb28-645"><a href="#cb28-645" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-646"><a href="#cb28-646" aria-hidden="true" tabindex="-1"></a>    <span class="dt">incremental</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">incremental</span>)<span class="op">,</span></span>
<span id="cb28-647"><a href="#cb28-647" aria-hidden="true" tabindex="-1"></a>    <span class="dt">transformative</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb28-648"><a href="#cb28-648" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">transformative</span><span class="op">,</span></span>
<span id="cb28-649"><a href="#cb28-649" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb28-650"><a href="#cb28-650" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb28-651"><a href="#cb28-651" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataProdImpact <span class="op">=</span> [</span>
<span id="cb28-652"><a href="#cb28-652" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`10% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">incremental</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span> }<span class="op">,</span></span>
<span id="cb28-653"><a href="#cb28-653" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`20%`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.2</span> }<span class="op">,</span></span>
<span id="cb28-654"><a href="#cb28-654" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`30% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.3</span> }<span class="op">,</span></span>
<span id="cb28-655"><a href="#cb28-655" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`40%`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.4</span> }<span class="op">,</span></span>
<span id="cb28-656"><a href="#cb28-656" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`50% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">transformative</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span> }<span class="op">,</span></span>
<span id="cb28-657"><a href="#cb28-657" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb28-658"><a href="#cb28-658" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProdImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataProdImpact<span class="op">,</span> {</span>
<span id="cb28-659"><a href="#cb28-659" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb28-660"><a href="#cb28-660" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb28-661"><a href="#cb28-661" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb28-662"><a href="#cb28-662" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb28-663"><a href="#cb28-663" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb28-664"><a href="#cb28-664" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb28-665"><a href="#cb28-665" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb28-666"><a href="#cb28-666" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-667"><a href="#cb28-667" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb28-668"><a href="#cb28-668" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataProdImpact<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.3</span>)<span class="op">,</span></span>
<span id="cb28-669"><a href="#cb28-669" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb28-670"><a href="#cb28-670" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataAdoption <span class="op">=</span> [</span>
<span id="cb28-671"><a href="#cb28-671" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`0.5% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">low</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.005</span> }<span class="op">,</span></span>
<span id="cb28-672"><a href="#cb28-672" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`1% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.01</span> }<span class="op">,</span></span>
<span id="cb28-673"><a href="#cb28-673" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`2% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">high</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.02</span> }<span class="op">,</span></span>
<span id="cb28-674"><a href="#cb28-674" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb28-675"><a href="#cb28-675" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputAdoption <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdoption<span class="op">,</span> {</span>
<span id="cb28-676"><a href="#cb28-676" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb28-677"><a href="#cb28-677" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb28-678"><a href="#cb28-678" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb28-679"><a href="#cb28-679" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb28-680"><a href="#cb28-680" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb28-681"><a href="#cb28-681" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb28-682"><a href="#cb28-682" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb28-683"><a href="#cb28-683" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-684"><a href="#cb28-684" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb28-685"><a href="#cb28-685" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataAdoption<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.01</span>)<span class="op">,</span></span>
<span id="cb28-686"><a href="#cb28-686" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb28-687"><a href="#cb28-687" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataCisImpact <span class="op">=</span> [</span>
<span id="cb28-688"><a href="#cb28-688" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`0% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">none</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb28-689"><a href="#cb28-689" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`10% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">low</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span> }<span class="op">,</span></span>
<span id="cb28-690"><a href="#cb28-690" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`25% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.25</span> }<span class="op">,</span></span>
<span id="cb28-691"><a href="#cb28-691" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`50% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">high</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span> }<span class="op">,</span></span>
<span id="cb28-692"><a href="#cb28-692" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb28-693"><a href="#cb28-693" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputCisImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataCisImpact<span class="op">,</span> {</span>
<span id="cb28-694"><a href="#cb28-694" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb28-695"><a href="#cb28-695" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb28-696"><a href="#cb28-696" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb28-697"><a href="#cb28-697" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb28-698"><a href="#cb28-698" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb28-699"><a href="#cb28-699" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb28-700"><a href="#cb28-700" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb28-701"><a href="#cb28-701" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-702"><a href="#cb28-702" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb28-703"><a href="#cb28-703" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataCisImpact<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.25</span>)<span class="op">,</span></span>
<span id="cb28-704"><a href="#cb28-704" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb28-705"><a href="#cb28-705" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb28-706"><a href="#cb28-706" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-707"><a href="#cb28-707" aria-hidden="true" tabindex="-1"></a>      inputProdImpact<span class="op">,</span></span>
<span id="cb28-708"><a href="#cb28-708" aria-hidden="true" tabindex="-1"></a>      inputAdoption<span class="op">,</span></span>
<span id="cb28-709"><a href="#cb28-709" aria-hidden="true" tabindex="-1"></a>      inputCisImpact<span class="op">,</span></span>
<span id="cb28-710"><a href="#cb28-710" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb28-711"><a href="#cb28-711" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-712"><a href="#cb28-712" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> (inputs) <span class="kw">=&gt;</span></span>
<span id="cb28-713"><a href="#cb28-713" aria-hidden="true" tabindex="-1"></a>        htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 3em"&gt;</span><span class="sc">${</span><span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(</span>
<span id="cb28-714"><a href="#cb28-714" aria-hidden="true" tabindex="-1"></a>          inputs<span class="op">,</span></span>
<span id="cb28-715"><a href="#cb28-715" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb28-716"><a href="#cb28-716" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb28-717"><a href="#cb28-717" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb28-718"><a href="#cb28-718" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-23" data-nodetype="declaration"></div></div></div></section><section id="advanced-control-variables" class="level3"><h3 data-anchor-id="advanced-control-variables">Advanced Control Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="725" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 724"><span id="cb29-725"><a href="#cb29-725" aria-hidden="true" tabindex="-1"></a>viewof discountRate <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span>{<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> (x <span class="op">*</span> <span class="dv">100</span>)<span class="op">,</span> <span class="dt">label</span> <span class="op">:</span> <span class="st">"Discount Rate"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.12</span>} ) <span class="co">// 0-1 as a pct</span></span>
<span id="cb29-726"><a href="#cb29-726" aria-hidden="true" tabindex="-1"></a>viewof bcr <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"BCR"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.62</span>} )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-24-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-24-2" data-nodetype="declaration"></div></div></div></div></section><section id="other-selections" class="level3"><h3 data-anchor-id="other-selections">Other Selections</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="731" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 730"><span id="cb30-731"><a href="#cb30-731" aria-hidden="true" tabindex="-1"></a><span class="co">// Plot Variable</span></span>
<span id="cb30-732"><a href="#cb30-732" aria-hidden="true" tabindex="-1"></a><span class="co">// base selector for metric type</span></span>
<span id="cb30-733"><a href="#cb30-733" aria-hidden="true" tabindex="-1"></a>viewof pickMetricWalkthrough <span class="op">=</span> {</span>
<span id="cb30-734"><a href="#cb30-734" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataPickMetric<span class="op">,</span> {</span>
<span id="cb30-735"><a href="#cb30-735" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">indicator</span>)<span class="op">,</span></span>
<span id="cb30-736"><a href="#cb30-736" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">labelFull</span><span class="op">,</span></span>
<span id="cb30-737"><a href="#cb30-737" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataPickMetric<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"irr"</span>)</span>
<span id="cb30-738"><a href="#cb30-738" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb30-739"><a href="#cb30-739" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-25" data-nodetype="declaration"></div></div></div></section></section><section id="elements" class="level2"><h2 data-anchor-id="elements">Elements</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="746" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 745"><span id="cb31-746"><a href="#cb31-746" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { dropdownInput<span class="op">,</span> dropdownCSS } <span class="im">from</span> <span class="st">"/helpers/uiComponents.ojs"</span><span class="op">;</span></span>
<span id="cb31-747"><a href="#cb31-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-748"><a href="#cb31-748" aria-hidden="true" tabindex="-1"></a>dropdownCSS<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-26-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-26-2" data-nodetype="expression"></div></div></div></div></section><section id="helper-functions" class="level2"><h2 data-anchor-id="helper-functions">Helper Functions</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="755" data-source-offset="-14"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 754"><span id="cb32-755"><a href="#cb32-755" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">formatUSD</span>({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) {</span>
<span id="cb32-756"><a href="#cb32-756" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatter <span class="op">=</span> <span class="fu">formatNumCompactShort</span>({ locale })<span class="op">;</span></span>
<span id="cb32-757"><a href="#cb32-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-758"><a href="#cb32-758" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (number) <span class="kw">=&gt;</span> {</span>
<span id="cb32-759"><a href="#cb32-759" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formattedNum <span class="op">=</span> <span class="fu">formatter</span>(number)<span class="op">;</span></span>
<span id="cb32-760"><a href="#cb32-760" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"$"</span> <span class="op">+</span> formattedNum<span class="op">;</span></span>
<span id="cb32-761"><a href="#cb32-761" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb32-762"><a href="#cb32-762" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-763"><a href="#cb32-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-764"><a href="#cb32-764" aria-hidden="true" tabindex="-1"></a><span class="co">// format number, short notation</span></span>
<span id="cb32-765"><a href="#cb32-765" aria-hidden="true" tabindex="-1"></a>formatNumCompactShort <span class="op">=</span> ({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) <span class="kw">=&gt;</span></span>
<span id="cb32-766"><a href="#cb32-766" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(locale<span class="op">,</span> {</span>
<span id="cb32-767"><a href="#cb32-767" aria-hidden="true" tabindex="-1"></a>    <span class="dt">notation</span><span class="op">:</span> <span class="st">"compact"</span><span class="op">,</span></span>
<span id="cb32-768"><a href="#cb32-768" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compactDisplay</span><span class="op">:</span> <span class="st">"short"</span><span class="op">,</span></span>
<span id="cb32-769"><a href="#cb32-769" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="at">format</span><span class="op">;</span></span>
<span id="cb32-770"><a href="#cb32-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-771"><a href="#cb32-771" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">formatCurrencyAuto</span>(value<span class="op">,</span> precision <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb32-772"><a href="#cb32-772" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> absVal <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(value)<span class="op">;</span></span>
<span id="cb32-773"><a href="#cb32-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-774"><a href="#cb32-774" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (absVal <span class="op">&gt;=</span> <span class="fl">1e9</span>) {</span>
<span id="cb32-775"><a href="#cb32-775" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`$</span><span class="sc">${</span>(value <span class="op">/</span> <span class="fl">1e9</span>)<span class="op">.</span><span class="fu">toFixed</span>(precision)<span class="sc">}</span><span class="vs">B`</span><span class="op">;</span></span>
<span id="cb32-776"><a href="#cb32-776" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (absVal <span class="op">&gt;=</span> <span class="fl">1e6</span>) {</span>
<span id="cb32-777"><a href="#cb32-777" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`$</span><span class="sc">${</span>(value <span class="op">/</span> <span class="fl">1e6</span>)<span class="op">.</span><span class="fu">toFixed</span>(precision)<span class="sc">}</span><span class="vs">M`</span><span class="op">;</span></span>
<span id="cb32-778"><a href="#cb32-778" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (absVal <span class="op">&gt;=</span> <span class="fl">1e3</span>) {</span>
<span id="cb32-779"><a href="#cb32-779" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`$</span><span class="sc">${</span>(value <span class="op">/</span> <span class="fl">1e3</span>)<span class="op">.</span><span class="fu">toFixed</span>(precision)<span class="sc">}</span><span class="vs">K`</span><span class="op">;</span></span>
<span id="cb32-780"><a href="#cb32-780" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb32-781"><a href="#cb32-781" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`$</span><span class="sc">${</span>value<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb32-782"><a href="#cb32-782" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-783"><a href="#cb32-783" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-27-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-27-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-27-3" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="786" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 785"><span id="cb33-786"><a href="#cb33-786" aria-hidden="true" tabindex="-1"></a>debounce <span class="op">=</span> (input<span class="op">,</span> delay <span class="op">=</span> <span class="dv">500</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb33-787"><a href="#cb33-787" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> DelayedEvent <span class="kw">extends</span> <span class="bu">Event</span> {}</span>
<span id="cb33-788"><a href="#cb33-788" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> id<span class="op">;</span></span>
<span id="cb33-789"><a href="#cb33-789" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb33-790"><a href="#cb33-790" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (e <span class="kw">instanceof</span> DelayedEvent) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb33-791"><a href="#cb33-791" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">stopImmediatePropagation</span>()<span class="op">;</span></span>
<span id="cb33-792"><a href="#cb33-792" aria-hidden="true" tabindex="-1"></a>    <span class="pp">clearTimeout</span>(id)<span class="op">;</span></span>
<span id="cb33-793"><a href="#cb33-793" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="pp">setTimeout</span>(</span>
<span id="cb33-794"><a href="#cb33-794" aria-hidden="true" tabindex="-1"></a>      () <span class="kw">=&gt;</span> input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="fu">DelayedEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">,</span></span>
<span id="cb33-795"><a href="#cb33-795" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">,</span></span>
<span id="cb33-796"><a href="#cb33-796" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb33-797"><a href="#cb33-797" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-798"><a href="#cb33-798" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input<span class="op">;</span></span>
<span id="cb33-799"><a href="#cb33-799" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-28" data-nodetype="declaration"></div></div></div></section><section id="language" class="level2"><h2 data-anchor-id="language">Language</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="809" data-source-offset="-67"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 808"><span id="cb34-809"><a href="#cb34-809" aria-hidden="true" tabindex="-1"></a>nbTitle <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb34-810"><a href="#cb34-810" aria-hidden="true" tabindex="-1"></a>  <span class="dt">en</span><span class="op">:</span> <span class="st">"Estimate Economic Returns on Adaptation"</span><span class="op">,</span></span>
<span id="cb34-811"><a href="#cb34-811" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Estimer les retours sur économiques l'adaptation"</span><span class="op">,</span></span>
<span id="cb34-812"><a href="#cb34-812" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb34-813"><a href="#cb34-813" aria-hidden="true" tabindex="-1"></a><span class="co">// key_insights = _lang({en: "Key Insights", fr: "Résumé"})</span></span>
<span id="cb34-814"><a href="#cb34-814" aria-hidden="true" tabindex="-1"></a>nbOverview <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Overview"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Vue d’Ensemble"</span> })<span class="op">;</span></span>
<span id="cb34-815"><a href="#cb34-815" aria-hidden="true" tabindex="-1"></a>heading1 <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Project Set-Up"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Configuration de Project"</span> })<span class="op">;</span></span>
<span id="cb34-816"><a href="#cb34-816" aria-hidden="true" tabindex="-1"></a>heading2 <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Investment Returns"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Retours d'Investissements"</span> })<span class="op">;</span></span>
<span id="cb34-817"><a href="#cb34-817" aria-hidden="true" tabindex="-1"></a>nbSummary <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Summary"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Résumé"</span> })<span class="op">;</span></span>
<span id="cb34-818"><a href="#cb34-818" aria-hidden="true" tabindex="-1"></a>nbMethods <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Methods &amp; Sources"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Méthodes &amp; Sources"</span> })<span class="op">;</span></span>
<span id="cb34-819"><a href="#cb34-819" aria-hidden="true" tabindex="-1"></a>appendix <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">appendix</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-6" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-7" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="823" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 822"><span id="cb35-823"><a href="#cb35-823" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { lang <span class="im">as</span> Lang } <span class="im">from</span> <span class="st">"/helpers/lang.js"</span></span>
<span id="cb35-824"><a href="#cb35-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-825"><a href="#cb35-825" aria-hidden="true" tabindex="-1"></a>general_translations <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/shared/generalTranslations.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb35-826"><a href="#cb35-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-827"><a href="#cb35-827" aria-hidden="true" tabindex="-1"></a>nbText <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/translations.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb35-828"><a href="#cb35-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-829"><a href="#cb35-829" aria-hidden="true" tabindex="-1"></a>languages <span class="op">=</span> [</span>
<span id="cb35-830"><a href="#cb35-830" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"en"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"English"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">'en-US'</span> }<span class="op">,</span></span>
<span id="cb35-831"><a href="#cb35-831" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"fr"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Français"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">'fr-FR'</span> }</span>
<span id="cb35-832"><a href="#cb35-832" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb35-833"><a href="#cb35-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-834"><a href="#cb35-834" aria-hidden="true" tabindex="-1"></a>defaultLangKey <span class="op">=</span> {</span>
<span id="cb35-835"><a href="#cb35-835" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> name <span class="op">=</span> <span class="st">"lang"</span><span class="op">;</span></span>
<span id="cb35-836"><a href="#cb35-836" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> list <span class="op">=</span> languages<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb35-837"><a href="#cb35-837" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defaultKey <span class="op">=</span> <span class="st">"en"</span><span class="op">;</span></span>
<span id="cb35-838"><a href="#cb35-838" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> queryParam <span class="op">=</span> <span class="cf">await</span> Lang<span class="op">.</span><span class="fu">getParamFromList</span>({ name<span class="op">,</span> list })<span class="op">;</span></span>
<span id="cb35-839"><a href="#cb35-839" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> queryParam <span class="op">??</span> defaultKey<span class="op">;</span></span>
<span id="cb35-840"><a href="#cb35-840" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-841"><a href="#cb35-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-842"><a href="#cb35-842" aria-hidden="true" tabindex="-1"></a>_lang <span class="op">=</span> Lang<span class="op">.</span><span class="fu">lg</span>(masterLanguage<span class="op">.</span><span class="at">key</span>)</span>
<span id="cb35-843"><a href="#cb35-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-844"><a href="#cb35-844" aria-hidden="true" tabindex="-1"></a>viewof masterLanguage <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb35-845"><a href="#cb35-845" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Main language toggle"</span><span class="op">,</span></span>
<span id="cb35-846"><a href="#cb35-846" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb35-847"><a href="#cb35-847" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> languages<span class="op">.</span><span class="fu">find</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">key</span> <span class="op">===</span> defaultLangKey)<span class="op">,</span></span>
<span id="cb35-848"><a href="#cb35-848" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-6" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-7" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="852" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 851"><span id="cb36-852"><a href="#cb36-852" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">NavbarLangSelector</span>(language_obj<span class="op">,</span> masterLanguage) {</span>
<span id="cb36-853"><a href="#cb36-853" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> navEnd <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">".navbar-nav.ms-auto .nav-item.compact"</span>)<span class="op">;</span></span>
<span id="cb36-854"><a href="#cb36-854" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (navEnd) {</span>
<span id="cb36-855"><a href="#cb36-855" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> existingLangSelector <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"nav-lang-selector"</span>)<span class="op">;</span></span>
<span id="cb36-856"><a href="#cb36-856" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>existingLangSelector) {</span>
<span id="cb36-857"><a href="#cb36-857" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lang_sel <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb36-858"><a href="#cb36-858" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">radio</span>(language_obj<span class="op">,</span> {</span>
<span id="cb36-859"><a href="#cb36-859" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> <span class="st">""</span><span class="op">,</span></span>
<span id="cb36-860"><a href="#cb36-860" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span></span>
<span id="cb36-861"><a href="#cb36-861" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb36-862"><a href="#cb36-862" aria-hidden="true" tabindex="-1"></a>        viewof masterLanguage</span>
<span id="cb36-863"><a href="#cb36-863" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb36-864"><a href="#cb36-864" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">id</span> <span class="op">=</span> <span class="st">"nav-lang-selector"</span><span class="op">;</span></span>
<span id="cb36-865"><a href="#cb36-865" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-866"><a href="#cb36-866" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Hack the css together for the observable inputs</span></span>
<span id="cb36-867"><a href="#cb36-867" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"flex"</span><span class="op">;</span></span>
<span id="cb36-868"><a href="#cb36-868" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">alignItems</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb36-869"><a href="#cb36-869" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">marginLeft</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb36-870"><a href="#cb36-870" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lang_div <span class="op">=</span> lang_sel<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb36-871"><a href="#cb36-871" aria-hidden="true" tabindex="-1"></a>      lang_div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"flex"</span><span class="op">;</span></span>
<span id="cb36-872"><a href="#cb36-872" aria-hidden="true" tabindex="-1"></a>      lang_div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">flexDirection</span> <span class="op">=</span> <span class="st">"column"</span><span class="op">;</span></span>
<span id="cb36-873"><a href="#cb36-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-874"><a href="#cb36-874" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Insert the new item after the GitHub icon and other elements</span></span>
<span id="cb36-875"><a href="#cb36-875" aria-hidden="true" tabindex="-1"></a>      navEnd<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="fu">appendChild</span>(lang_sel)<span class="op">;</span></span>
<span id="cb36-876"><a href="#cb36-876" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-877"><a href="#cb36-877" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-878"><a href="#cb36-878" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-879"><a href="#cb36-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-880"><a href="#cb36-880" aria-hidden="true" tabindex="-1"></a><span class="fu">NavbarLangSelector</span>(languages<span class="op">,</span> masterLanguage)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-2" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="883" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 882"><span id="cb37-883"><a href="#cb37-883" aria-hidden="true" tabindex="-1"></a>prettyLanguageView <span class="op">=</span> {</span>
<span id="cb37-884"><a href="#cb37-884" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb37-885"><a href="#cb37-885" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb37-886"><a href="#cb37-886" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">language</span>)<span class="op">,</span></span>
<span id="cb37-887"><a href="#cb37-887" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span></span>
<span id="cb37-888"><a href="#cb37-888" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb37-889"><a href="#cb37-889" aria-hidden="true" tabindex="-1"></a>    viewof masterLanguage</span>
<span id="cb37-890"><a href="#cb37-890" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb37-891"><a href="#cb37-891" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-32" data-nodetype="declaration"></div></div></div><section id="markdown-notebook-text" class="level3"><h3 data-anchor-id="markdown-notebook-text">Markdown notebook text</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="897" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 896"><span id="cb38-897"><a href="#cb38-897" aria-hidden="true" tabindex="-1"></a>dataPickMetric <span class="op">=</span> {</span>
<span id="cb38-898"><a href="#cb38-898" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb38-899"><a href="#cb38-899" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-900"><a href="#cb38-900" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"irr"</span><span class="op">,</span></span>
<span id="cb38-901"><a href="#cb38-901" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"irr"</span><span class="op">,</span></span>
<span id="cb38-902"><a href="#cb38-902" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb38-903"><a href="#cb38-903" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb38-904"><a href="#cb38-904" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb38-905"><a href="#cb38-905" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb38-906"><a href="#cb38-906" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb38-907"><a href="#cb38-907" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb38-908"><a href="#cb38-908" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb38-909"><a href="#cb38-909" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb38-910"><a href="#cb38-910" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb38-911"><a href="#cb38-911" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb38-912"><a href="#cb38-912" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb38-913"><a href="#cb38-913" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-914"><a href="#cb38-914" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"mirr"</span><span class="op">,</span></span>
<span id="cb38-915"><a href="#cb38-915" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"mirr"</span><span class="op">,</span></span>
<span id="cb38-916"><a href="#cb38-916" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb38-917"><a href="#cb38-917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb38-918"><a href="#cb38-918" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb38-919"><a href="#cb38-919" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb38-920"><a href="#cb38-920" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb38-921"><a href="#cb38-921" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb38-922"><a href="#cb38-922" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb38-923"><a href="#cb38-923" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb38-924"><a href="#cb38-924" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb38-925"><a href="#cb38-925" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb38-926"><a href="#cb38-926" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb38-927"><a href="#cb38-927" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-928"><a href="#cb38-928" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"npv"</span><span class="op">,</span></span>
<span id="cb38-929"><a href="#cb38-929" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"npv"</span><span class="op">,</span></span>
<span id="cb38-930"><a href="#cb38-930" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb38-931"><a href="#cb38-931" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb38-932"><a href="#cb38-932" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb38-933"><a href="#cb38-933" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb38-934"><a href="#cb38-934" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb38-935"><a href="#cb38-935" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb38-936"><a href="#cb38-936" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb38-937"><a href="#cb38-937" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb38-938"><a href="#cb38-938" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb38-939"><a href="#cb38-939" aria-hidden="true" tabindex="-1"></a>       <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatCurrencyAuto</span>(d<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb38-940"><a href="#cb38-940" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb38-941"><a href="#cb38-941" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-942"><a href="#cb38-942" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"bcr"</span><span class="op">,</span></span>
<span id="cb38-943"><a href="#cb38-943" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"discounted_bcr"</span><span class="op">,</span></span>
<span id="cb38-944"><a href="#cb38-944" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb38-945"><a href="#cb38-945" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb38-946"><a href="#cb38-946" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb38-947"><a href="#cb38-947" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb38-948"><a href="#cb38-948" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb38-949"><a href="#cb38-949" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb38-950"><a href="#cb38-950" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb38-951"><a href="#cb38-951" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb38-952"><a href="#cb38-952" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb38-953"><a href="#cb38-953" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".2f"</span>)</span>
<span id="cb38-954"><a href="#cb38-954" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-955"><a href="#cb38-955" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb38-956"><a href="#cb38-956" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-33" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="960" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 959"><span id="cb39-960"><a href="#cb39-960" aria-hidden="true" tabindex="-1"></a>renderReview1 <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb39-961"><a href="#cb39-961" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langBasePath <span class="op">=</span> nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">insightReview</span><span class="op">.</span><span class="at">setupBlock</span><span class="op">;</span></span>
<span id="cb39-962"><a href="#cb39-962" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langMissingTemplate <span class="op">=</span> <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">missingMessage</span><span class="op">,</span> {</span>
<span id="cb39-963"><a href="#cb39-963" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-964"><a href="#cb39-964" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb39-965"><a href="#cb39-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-966"><a href="#cb39-966" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isoSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_country)<span class="op">;</span></span>
<span id="cb39-967"><a href="#cb39-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-968"><a href="#cb39-968" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0List <span class="op">=</span> countries</span>
<span id="cb39-969"><a href="#cb39-969" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> isoSet<span class="op">.</span><span class="fu">has</span>(d<span class="op">.</span><span class="at">iso3c</span>))</span>
<span id="cb39-970"><a href="#cb39-970" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span>)<span class="op">;</span></span>
<span id="cb39-971"><a href="#cb39-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-972"><a href="#cb39-972" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cropList <span class="op">=</span> select_crop<span class="op">;</span></span>
<span id="cb39-973"><a href="#cb39-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-974"><a href="#cb39-974" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const cropList = adminCropChoices.crops.sort((a,b) =&gt; _lang(a.translation) &gt; _lang(b.translation));</span></span>
<span id="cb39-975"><a href="#cb39-975" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> truncateSize <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb39-976"><a href="#cb39-976" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0ListTruncated <span class="op">=</span> admin0List<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> truncateSize)<span class="op">;</span></span>
<span id="cb39-977"><a href="#cb39-977" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cropListTruncated <span class="op">=</span> cropList<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> truncateSize)<span class="op">;</span> <span class="co">// .map((d) =&gt; _lang(d.translation));</span></span>
<span id="cb39-978"><a href="#cb39-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-979"><a href="#cb39-979" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (admin0List<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">||</span> cropList<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb39-980"><a href="#cb39-980" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>langMissingTemplate<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb39-981"><a href="#cb39-981" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-982"><a href="#cb39-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-983"><a href="#cb39-983" aria-hidden="true" tabindex="-1"></a>  <span class="co">// new code</span></span>
<span id="cb39-984"><a href="#cb39-984" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropCount <span class="op">=</span> cropList<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb39-985"><a href="#cb39-985" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropWord <span class="op">=</span></span>
<span id="cb39-986"><a href="#cb39-986" aria-hidden="true" tabindex="-1"></a>    cropList<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb39-987"><a href="#cb39-987" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb39-988"><a href="#cb39-988" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-989"><a href="#cb39-989" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb39-990"><a href="#cb39-990" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb39-991"><a href="#cb39-991" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-992"><a href="#cb39-992" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb39-993"><a href="#cb39-993" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropList <span class="op">=</span> <span class="vs">`(**</span><span class="sc">${</span>cropListTruncated<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>)<span class="sc">}${</span></span>
<span id="cb39-994"><a href="#cb39-994" aria-hidden="true" tabindex="-1"></a>    cropList<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> truncateSize <span class="op">?</span> <span class="st">"..."</span> <span class="op">:</span> <span class="st">""</span></span>
<span id="cb39-995"><a href="#cb39-995" aria-hidden="true" tabindex="-1"></a>  <span class="sc">}</span><span class="vs">**)`</span><span class="op">;</span></span>
<span id="cb39-996"><a href="#cb39-996" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCrop <span class="op">=</span> <span class="vs">`**</span><span class="sc">${</span>insertCropCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertCropWord<span class="sc">}</span><span class="vs">** </span><span class="sc">${</span>insertCropList<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb39-997"><a href="#cb39-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-998"><a href="#cb39-998" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegionCount <span class="op">=</span> select_region<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb39-999"><a href="#cb39-999" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegionWord <span class="op">=</span></span>
<span id="cb39-1000"><a href="#cb39-1000" aria-hidden="true" tabindex="-1"></a>    insertRegionCount <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb39-1001"><a href="#cb39-1001" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb39-1002"><a href="#cb39-1002" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-1003"><a href="#cb39-1003" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb39-1004"><a href="#cb39-1004" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb39-1005"><a href="#cb39-1005" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-1006"><a href="#cb39-1006" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb39-1007"><a href="#cb39-1007" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegion <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>insertRegionCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertRegionWord<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb39-1008"><a href="#cb39-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1009"><a href="#cb39-1009" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryCount <span class="op">=</span> admin0List<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb39-1010"><a href="#cb39-1010" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryWord <span class="op">=</span></span>
<span id="cb39-1011"><a href="#cb39-1011" aria-hidden="true" tabindex="-1"></a>    insertCountryCount <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb39-1012"><a href="#cb39-1012" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb39-1013"><a href="#cb39-1013" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-1014"><a href="#cb39-1014" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb39-1015"><a href="#cb39-1015" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb39-1016"><a href="#cb39-1016" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-1017"><a href="#cb39-1017" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb39-1018"><a href="#cb39-1018" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryList <span class="op">=</span> <span class="vs">`(**</span><span class="sc">${</span>admin0ListTruncated<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>)<span class="sc">}${</span></span>
<span id="cb39-1019"><a href="#cb39-1019" aria-hidden="true" tabindex="-1"></a>    insertCountryCount <span class="op">&gt;</span> truncateSize <span class="op">?</span> <span class="st">"..."</span> <span class="op">:</span> <span class="st">""</span></span>
<span id="cb39-1020"><a href="#cb39-1020" aria-hidden="true" tabindex="-1"></a>  <span class="sc">}</span><span class="vs">**)`</span><span class="op">;</span></span>
<span id="cb39-1021"><a href="#cb39-1021" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountry <span class="op">=</span> <span class="vs">`**</span><span class="sc">${</span>insertCountryCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertCountryWord<span class="sc">}</span><span class="vs">** </span><span class="sc">${</span>insertCountryList<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb39-1022"><a href="#cb39-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1023"><a href="#cb39-1023" aria-hidden="true" tabindex="-1"></a>  <span class="co">// insert to template</span></span>
<span id="cb39-1024"><a href="#cb39-1024" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTemplate <span class="op">=</span> <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">template</span><span class="op">,</span> {</span>
<span id="cb39-1025"><a href="#cb39-1025" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-1026"><a href="#cb39-1026" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb39-1027"><a href="#cb39-1027" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTemplateItems <span class="op">=</span> [</span>
<span id="cb39-1028"><a href="#cb39-1028" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"crop_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertCrop }<span class="op">,</span></span>
<span id="cb39-1029"><a href="#cb39-1029" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"region_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertRegion }<span class="op">,</span></span>
<span id="cb39-1030"><a href="#cb39-1030" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"country_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertCountry }<span class="op">,</span></span>
<span id="cb39-1031"><a href="#cb39-1031" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb39-1032"><a href="#cb39-1032" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"cost_string"</span><span class="op">,</span></span>
<span id="cb39-1033"><a href="#cb39-1033" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="fu">formatUSD</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })(rangeProjectCost)<span class="op">,</span></span>
<span id="cb39-1034"><a href="#cb39-1034" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb39-1035"><a href="#cb39-1035" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"year_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projectYears <span class="op">+</span> <span class="st">" years"</span> }<span class="op">,</span> <span class="co">//</span><span class="al">TODO</span><span class="co">: add correct "years" string at end of this</span></span>
<span id="cb39-1036"><a href="#cb39-1036" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb39-1037"><a href="#cb39-1037" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectionFormattedTemplate <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb39-1038"><a href="#cb39-1038" aria-hidden="true" tabindex="-1"></a>    langTemplate<span class="op">,</span></span>
<span id="cb39-1039"><a href="#cb39-1039" aria-hidden="true" tabindex="-1"></a>    langTemplateItems<span class="op">,</span></span>
<span id="cb39-1040"><a href="#cb39-1040" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb39-1041"><a href="#cb39-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1042"><a href="#cb39-1042" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>selectionFormattedTemplate<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb39-1043"><a href="#cb39-1043" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-34" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1047" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1046"><span id="cb40-1047"><a href="#cb40-1047" aria-hidden="true" tabindex="-1"></a>renderReview2 <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb40-1048"><a href="#cb40-1048" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> investmentTemplate <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb40-1049"><a href="#cb40-1049" aria-hidden="true" tabindex="-1"></a>    nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">insightReview</span><span class="op">.</span><span class="at">indicatorBlock</span><span class="op">,</span></span>
<span id="cb40-1050"><a href="#cb40-1050" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb40-1051"><a href="#cb40-1051" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> investmentTemplateItems <span class="op">=</span> [</span>
<span id="cb40-1052"><a href="#cb40-1052" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb40-1053"><a href="#cb40-1053" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"prod_impact_label"</span><span class="op">,</span></span>
<span id="cb40-1054"><a href="#cb40-1054" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb40-1055"><a href="#cb40-1055" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb40-1056"><a href="#cb40-1056" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb40-1057"><a href="#cb40-1057" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"adoption_rate_label"</span><span class="op">,</span></span>
<span id="cb40-1058"><a href="#cb40-1058" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb40-1059"><a href="#cb40-1059" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb40-1060"><a href="#cb40-1060" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb40-1061"><a href="#cb40-1061" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"cis_impact_label"</span><span class="op">,</span></span>
<span id="cb40-1062"><a href="#cb40-1062" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb40-1063"><a href="#cb40-1063" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb40-1064"><a href="#cb40-1064" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"year_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projectYears <span class="op">+</span> <span class="st">" years"</span> }<span class="op">,</span></span>
<span id="cb40-1065"><a href="#cb40-1065" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb40-1066"><a href="#cb40-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-1067"><a href="#cb40-1067" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(investmentTemplate<span class="op">,</span> investmentTemplateItems)<span class="sc">}</span><span class="vs">:`</span><span class="op">;</span></span>
<span id="cb40-1068"><a href="#cb40-1068" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-35" data-nodetype="declaration"></div></div></div></section><section id="result-elements" class="level3"><h3 data-anchor-id="result-elements">Result Elements</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1074" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1073"><span id="cb41-1074"><a href="#cb41-1074" aria-hidden="true" tabindex="-1"></a>bigNumbersResults <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb41-1075"><a href="#cb41-1075" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb41-1076"><a href="#cb41-1076" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> e <span class="op">=</span> walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span><span class="op">?.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> y)<span class="op">;</span></span>
<span id="cb41-1077"><a href="#cb41-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1078"><a href="#cb41-1078" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataPickMetric<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb41-1079"><a href="#cb41-1079" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> value<span class="op">;</span></span>
<span id="cb41-1080"><a href="#cb41-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1081"><a href="#cb41-1081" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"irr"</span> <span class="op">&amp;&amp;</span> e<span class="op">?.</span><span class="at">irr</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb41-1082"><a href="#cb41-1082" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">.</span><span class="at">irr</span><span class="op">;</span> <span class="co">// IRR as percentage</span></span>
<span id="cb41-1083"><a href="#cb41-1083" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"mirr"</span> <span class="op">&amp;&amp;</span> e<span class="op">?.</span><span class="at">mirr</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb41-1084"><a href="#cb41-1084" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">.</span><span class="at">mirr</span><span class="op">;</span> <span class="co">// MIRR as percentage</span></span>
<span id="cb41-1085"><a href="#cb41-1085" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (</span>
<span id="cb41-1086"><a href="#cb41-1086" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"npv"</span> <span class="op">&amp;&amp;</span></span>
<span id="cb41-1087"><a href="#cb41-1087" aria-hidden="true" tabindex="-1"></a>      e<span class="op">?.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span></span>
<span id="cb41-1088"><a href="#cb41-1088" aria-hidden="true" tabindex="-1"></a>      e<span class="op">?.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span></span>
<span id="cb41-1089"><a href="#cb41-1089" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb41-1090"><a href="#cb41-1090" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> <span class="op">+</span>(e<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">-</span> e<span class="op">.</span><span class="at">discounted_cost_cum</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="co">// NPV, 1 dp</span></span>
<span id="cb41-1091"><a href="#cb41-1091" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"bcr"</span>) {</span>
<span id="cb41-1092"><a href="#cb41-1092" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">?.</span><span class="at">discounted_bcr</span><span class="op">;</span></span>
<span id="cb41-1093"><a href="#cb41-1093" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-1094"><a href="#cb41-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1095"><a href="#cb41-1095" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>d<span class="op">,</span> value }<span class="op">;</span></span>
<span id="cb41-1096"><a href="#cb41-1096" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb41-1097"><a href="#cb41-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1098"><a href="#cb41-1098" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb41-1099"><a href="#cb41-1099" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;style&gt;</span></span>
<span id="cb41-1100"><a href="#cb41-1100" aria-hidden="true" tabindex="-1"></a><span class="vs">    .outer-div {</span></span>
<span id="cb41-1101"><a href="#cb41-1101" aria-hidden="true" tabindex="-1"></a><span class="vs">      display: flex;</span></span>
<span id="cb41-1102"><a href="#cb41-1102" aria-hidden="true" tabindex="-1"></a><span class="vs">      gap: 2em;</span></span>
<span id="cb41-1103"><a href="#cb41-1103" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1104"><a href="#cb41-1104" aria-hidden="true" tabindex="-1"></a><span class="vs">    .inner-div {</span></span>
<span id="cb41-1105"><a href="#cb41-1105" aria-hidden="true" tabindex="-1"></a><span class="vs">      width: 30%;</span></span>
<span id="cb41-1106"><a href="#cb41-1106" aria-hidden="true" tabindex="-1"></a><span class="vs">      padding: 80px 30px;</span></span>
<span id="cb41-1107"><a href="#cb41-1107" aria-hidden="true" tabindex="-1"></a><span class="vs">      border: 1px solid #efefef;</span></span>
<span id="cb41-1108"><a href="#cb41-1108" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1109"><a href="#cb41-1109" aria-hidden="true" tabindex="-1"></a><span class="vs">    .label {</span></span>
<span id="cb41-1110"><a href="#cb41-1110" aria-hidden="true" tabindex="-1"></a><span class="vs">      display: block;</span></span>
<span id="cb41-1111"><a href="#cb41-1111" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-weight: 400;</span></span>
<span id="cb41-1112"><a href="#cb41-1112" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-size: 14px;</span></span>
<span id="cb41-1113"><a href="#cb41-1113" aria-hidden="true" tabindex="-1"></a><span class="vs">      text-transform: uppercase;</span></span>
<span id="cb41-1114"><a href="#cb41-1114" aria-hidden="true" tabindex="-1"></a><span class="vs">      color: #666;</span></span>
<span id="cb41-1115"><a href="#cb41-1115" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1116"><a href="#cb41-1116" aria-hidden="true" tabindex="-1"></a><span class="vs">    .value {</span></span>
<span id="cb41-1117"><a href="#cb41-1117" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-weight: bold;</span></span>
<span id="cb41-1118"><a href="#cb41-1118" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-size: 42px; </span></span>
<span id="cb41-1119"><a href="#cb41-1119" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1120"><a href="#cb41-1120" aria-hidden="true" tabindex="-1"></a><span class="vs">    .negative {</span></span>
<span id="cb41-1121"><a href="#cb41-1121" aria-hidden="true" tabindex="-1"></a><span class="vs">      color: #EC5A47;</span></span>
<span id="cb41-1122"><a href="#cb41-1122" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1123"><a href="#cb41-1123" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card {</span></span>
<span id="cb41-1124"><a href="#cb41-1124" aria-hidden="true" tabindex="-1"></a><span class="vs">        position: relative;</span></span>
<span id="cb41-1125"><a href="#cb41-1125" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: inline-block;</span></span>
<span id="cb41-1126"><a href="#cb41-1126" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb41-1127"><a href="#cb41-1127" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 100%;</span></span>
<span id="cb41-1128"><a href="#cb41-1128" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1129"><a href="#cb41-1129" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card .tooltiptext-card {</span></span>
<span id="cb41-1130"><a href="#cb41-1130" aria-hidden="true" tabindex="-1"></a><span class="vs">        position: absolute;</span></span>
<span id="cb41-1131"><a href="#cb41-1131" aria-hidden="true" tabindex="-1"></a><span class="vs">        z-index: 1;</span></span>
<span id="cb41-1132"><a href="#cb41-1132" aria-hidden="true" tabindex="-1"></a><span class="vs">        visibility: hidden; </span></span>
<span id="cb41-1133"><a href="#cb41-1133" aria-hidden="true" tabindex="-1"></a><span class="vs">        left: 0;</span></span>
<span id="cb41-1134"><a href="#cb41-1134" aria-hidden="true" tabindex="-1"></a><span class="vs">        bottom: 90%;</span></span>
<span id="cb41-1135"><a href="#cb41-1135" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #efefef;</span></span>
<span id="cb41-1136"><a href="#cb41-1136" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #333;</span></span>
<span id="cb41-1137"><a href="#cb41-1137" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 14px 20px;</span></span>
<span id="cb41-1138"><a href="#cb41-1138" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb41-1139"><a href="#cb41-1139" aria-hidden="true" tabindex="-1"></a><span class="vs">        line-height: 1.6;</span></span>
<span id="cb41-1140"><a href="#cb41-1140" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: left;</span></span>
<span id="cb41-1141"><a href="#cb41-1141" aria-hidden="true" tabindex="-1"></a><span class="vs">        opacity: 0;</span></span>
<span id="cb41-1142"><a href="#cb41-1142" aria-hidden="true" tabindex="-1"></a><span class="vs">        transition: opacity 0.3s;</span></span>
<span id="cb41-1143"><a href="#cb41-1143" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1144"><a href="#cb41-1144" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card:hover .tooltiptext-card {</span></span>
<span id="cb41-1145"><a href="#cb41-1145" aria-hidden="true" tabindex="-1"></a><span class="vs">        visibility: visible;</span></span>
<span id="cb41-1146"><a href="#cb41-1146" aria-hidden="true" tabindex="-1"></a><span class="vs">        opacity: 1;</span></span>
<span id="cb41-1147"><a href="#cb41-1147" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: default;</span></span>
<span id="cb41-1148"><a href="#cb41-1148" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb41-1149"><a href="#cb41-1149" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/style&gt;</span></span>
<span id="cb41-1150"><a href="#cb41-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1151"><a href="#cb41-1151" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;body&gt;</span></span>
<span id="cb41-1152"><a href="#cb41-1152" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="outer-div"&gt;</span></span>
<span id="cb41-1153"><a href="#cb41-1153" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>data<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb41-1154"><a href="#cb41-1154" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div class="inner-div"&gt;</span></span>
<span id="cb41-1155"><a href="#cb41-1155" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;span class="tooltip-card"&gt;</span></span>
<span id="cb41-1156"><a href="#cb41-1156" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="tooltiptext-card"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">tooltip</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb41-1157"><a href="#cb41-1157" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="value </span><span class="sc">${</span>d<span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"negative"</span> <span class="op">:</span> <span class="st">""</span><span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span></span>
<span id="cb41-1158"><a href="#cb41-1158" aria-hidden="true" tabindex="-1"></a>              d<span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> d<span class="op">.</span><span class="fu">yFormat</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">:</span> <span class="st">"---"</span></span>
<span id="cb41-1159"><a href="#cb41-1159" aria-hidden="true" tabindex="-1"></a>            <span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb41-1160"><a href="#cb41-1160" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="label"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">labelFull</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb41-1161"><a href="#cb41-1161" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/span&gt;</span></span>
<span id="cb41-1162"><a href="#cb41-1162" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb41-1163"><a href="#cb41-1163" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">}</span></span>
<span id="cb41-1164"><a href="#cb41-1164" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb41-1165"><a href="#cb41-1165" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/body&gt;`</span><span class="op">;</span></span>
<span id="cb41-1166"><a href="#cb41-1166" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-36" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1170" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1169"><span id="cb42-1170"><a href="#cb42-1170" aria-hidden="true" tabindex="-1"></a>resultTable <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb42-1171"><a href="#cb42-1171" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">formatAbbreviatedNumber</span>(num) {</span>
<span id="cb42-1172"><a href="#cb42-1172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (num <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="pp">isNaN</span>(num)) <span class="cf">return</span> <span class="st">"—"</span><span class="op">;</span></span>
<span id="cb42-1173"><a href="#cb42-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1174"><a href="#cb42-1174" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> absNum <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(num)<span class="op">;</span></span>
<span id="cb42-1175"><a href="#cb42-1175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (absNum <span class="op">&gt;=</span> <span class="fl">1e9</span>) <span class="cf">return</span> (num <span class="op">/</span> <span class="fl">1e9</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">"B"</span><span class="op">;</span></span>
<span id="cb42-1176"><a href="#cb42-1176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (absNum <span class="op">&gt;=</span> <span class="fl">1e6</span>) <span class="cf">return</span> (num <span class="op">/</span> <span class="fl">1e6</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">"M"</span><span class="op">;</span></span>
<span id="cb42-1177"><a href="#cb42-1177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (absNum <span class="op">&gt;=</span> <span class="fl">1e3</span>) <span class="cf">return</span> (num <span class="op">/</span> <span class="fl">1e3</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">"K"</span><span class="op">;</span></span>
<span id="cb42-1178"><a href="#cb42-1178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb42-1179"><a href="#cb42-1179" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-1180"><a href="#cb42-1180" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedYear <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb42-1181"><a href="#cb42-1181" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> enriched <span class="op">=</span> (walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span> <span class="op">??</span> [])<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb42-1182"><a href="#cb42-1182" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">&lt;=</span> selectedYear<span class="op">,</span></span>
<span id="cb42-1183"><a href="#cb42-1183" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb42-1184"><a href="#cb42-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1185"><a href="#cb42-1185" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> headerNames <span class="op">=</span> [</span>
<span id="cb42-1186"><a href="#cb42-1186" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Year"</span><span class="op">,</span></span>
<span id="cb42-1187"><a href="#cb42-1187" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benefit"</span><span class="op">,</span></span>
<span id="cb42-1188"><a href="#cb42-1188" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cost"</span><span class="op">,</span></span>
<span id="cb42-1189"><a href="#cb42-1189" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cashflow"</span><span class="op">,</span></span>
<span id="cb42-1190"><a href="#cb42-1190" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Discounted Benefit (cum)"</span><span class="op">,</span></span>
<span id="cb42-1191"><a href="#cb42-1191" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Discounted Cost (cum)"</span><span class="op">,</span></span>
<span id="cb42-1192"><a href="#cb42-1192" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Discounted NPV (cum)"</span><span class="op">,</span></span>
<span id="cb42-1193"><a href="#cb42-1193" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Discounted BCR"</span><span class="op">,</span></span>
<span id="cb42-1194"><a href="#cb42-1194" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IRR"</span><span class="op">,</span></span>
<span id="cb42-1195"><a href="#cb42-1195" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MIRR"</span><span class="op">,</span></span>
<span id="cb42-1196"><a href="#cb42-1196" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb42-1197"><a href="#cb42-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1198"><a href="#cb42-1198" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb42-1199"><a href="#cb42-1199" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;style&gt;</span></span>
<span id="cb42-1200"><a href="#cb42-1200" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table {</span></span>
<span id="cb42-1201"><a href="#cb42-1201" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-family: sans-serif;</span></span>
<span id="cb42-1202"><a href="#cb42-1202" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-collapse: collapse;</span></span>
<span id="cb42-1203"><a href="#cb42-1203" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 13.75px;</span></span>
<span id="cb42-1204"><a href="#cb42-1204" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-top: 1em;</span></span>
<span id="cb42-1205"><a href="#cb42-1205" aria-hidden="true" tabindex="-1"></a><span class="vs">        min-width: 100%;</span></span>
<span id="cb42-1206"><a href="#cb42-1206" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb42-1207"><a href="#cb42-1207" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table th, .econ-table td {</span></span>
<span id="cb42-1208"><a href="#cb42-1208" aria-hidden="true" tabindex="-1"></a><span class="vs">        border: 1px solid #ddd;</span></span>
<span id="cb42-1209"><a href="#cb42-1209" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 6px 10px;</span></span>
<span id="cb42-1210"><a href="#cb42-1210" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: right;</span></span>
<span id="cb42-1211"><a href="#cb42-1211" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb42-1212"><a href="#cb42-1212" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table th {</span></span>
<span id="cb42-1213"><a href="#cb42-1213" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #f4f4f4;</span></span>
<span id="cb42-1214"><a href="#cb42-1214" aria-hidden="true" tabindex="-1"></a><span class="vs">        white-space: normal;</span></span>
<span id="cb42-1215"><a href="#cb42-1215" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb42-1216"><a href="#cb42-1216" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb42-1217"><a href="#cb42-1217" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table td.year-col {</span></span>
<span id="cb42-1218"><a href="#cb42-1218" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb42-1219"><a href="#cb42-1219" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: bold;</span></span>
<span id="cb42-1220"><a href="#cb42-1220" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb42-1221"><a href="#cb42-1221" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table tr.final-row td {</span></span>
<span id="cb42-1222"><a href="#cb42-1222" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: bold;</span></span>
<span id="cb42-1223"><a href="#cb42-1223" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #f1f1f1;</span></span>
<span id="cb42-1224"><a href="#cb42-1224" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb42-1225"><a href="#cb42-1225" aria-hidden="true" tabindex="-1"></a><span class="vs">      .table-container {</span></span>
<span id="cb42-1226"><a href="#cb42-1226" aria-hidden="true" tabindex="-1"></a><span class="vs">        overflow-x: auto;</span></span>
<span id="cb42-1227"><a href="#cb42-1227" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: block;</span></span>
<span id="cb42-1228"><a href="#cb42-1228" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding-bottom: 4px;</span></span>
<span id="cb42-1229"><a href="#cb42-1229" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb42-1230"><a href="#cb42-1230" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/style&gt;</span></span>
<span id="cb42-1231"><a href="#cb42-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1232"><a href="#cb42-1232" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="table-container"&gt;</span></span>
<span id="cb42-1233"><a href="#cb42-1233" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;table class="econ-table"&gt;</span></span>
<span id="cb42-1234"><a href="#cb42-1234" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;thead&gt;</span></span>
<span id="cb42-1235"><a href="#cb42-1235" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;tr&gt;</span></span>
<span id="cb42-1236"><a href="#cb42-1236" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">${</span>headerNames<span class="op">.</span><span class="fu">map</span>((h) <span class="kw">=&gt;</span> <span class="fu">html</span><span class="vs">`&lt;th title="</span><span class="sc">${</span>h<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>h<span class="sc">}</span><span class="vs">&lt;/th&gt;`</span>)<span class="sc">}</span></span>
<span id="cb42-1237"><a href="#cb42-1237" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/tr&gt;</span></span>
<span id="cb42-1238"><a href="#cb42-1238" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/thead&gt;</span></span>
<span id="cb42-1239"><a href="#cb42-1239" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;tbody&gt;</span></span>
<span id="cb42-1240"><a href="#cb42-1240" aria-hidden="true" tabindex="-1"></a><span class="vs">          </span><span class="sc">${</span>enriched<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb42-1241"><a href="#cb42-1241" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> isFinal <span class="op">=</span> i <span class="op">===</span> enriched<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb42-1242"><a href="#cb42-1242" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> npv_i <span class="op">=</span></span>
<span id="cb42-1243"><a href="#cb42-1243" aria-hidden="true" tabindex="-1"></a>              d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span></span>
<span id="cb42-1244"><a href="#cb42-1244" aria-hidden="true" tabindex="-1"></a>                <span class="op">?</span> d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">-</span> d<span class="op">.</span><span class="at">discounted_cost_cum</span></span>
<span id="cb42-1245"><a href="#cb42-1245" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb42-1246"><a href="#cb42-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1247"><a href="#cb42-1247" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;tr class=</span><span class="sc">${</span>isFinal <span class="op">?</span> <span class="st">"final-row"</span> <span class="op">:</span> <span class="st">""</span><span class="sc">}</span><span class="vs">&gt;</span></span>
<span id="cb42-1248"><a href="#cb42-1248" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td class="year-col"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">year</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1249"><a href="#cb42-1249" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">project_benefit</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`$</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(d<span class="op">.</span><span class="at">project_benefit</span>)<span class="op">.</span><span class="fu">toLocaleString</span>()<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1250"><a href="#cb42-1250" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">cost</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`$</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(d<span class="op">.</span><span class="at">cost</span>)<span class="op">.</span><span class="fu">toLocaleString</span>()<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1251"><a href="#cb42-1251" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">cashflow</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`$</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(d<span class="op">.</span><span class="at">cashflow</span>)<span class="op">.</span><span class="fu">toLocaleString</span>()<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1252"><a href="#cb42-1252" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`$</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(d<span class="op">.</span><span class="at">discounted_benefit_cum</span>)<span class="op">.</span><span class="fu">toLocaleString</span>()<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1253"><a href="#cb42-1253" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`$</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(d<span class="op">.</span><span class="at">discounted_cost_cum</span>)<span class="op">.</span><span class="fu">toLocaleString</span>()<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1254"><a href="#cb42-1254" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>npv_i <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`$</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(npv_i)<span class="op">.</span><span class="fu">toLocaleString</span>()<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1255"><a href="#cb42-1255" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_bcr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> d<span class="op">.</span><span class="at">discounted_bcr</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1256"><a href="#cb42-1256" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">irr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>(d<span class="op">.</span><span class="at">irr</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">%`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1257"><a href="#cb42-1257" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">mirr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>(d<span class="op">.</span><span class="at">mirr</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">%`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb42-1258"><a href="#cb42-1258" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/tr&gt;`</span><span class="op">;</span></span>
<span id="cb42-1259"><a href="#cb42-1259" aria-hidden="true" tabindex="-1"></a>          })<span class="sc">}</span></span>
<span id="cb42-1260"><a href="#cb42-1260" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/tbody&gt;</span></span>
<span id="cb42-1261"><a href="#cb42-1261" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/table&gt;</span></span>
<span id="cb42-1262"><a href="#cb42-1262" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb42-1263"><a href="#cb42-1263" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb42-1264"><a href="#cb42-1264" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-37" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1268" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1267"><span id="cb43-1268"><a href="#cb43-1268" aria-hidden="true" tabindex="-1"></a>resultPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb43-1269"><a href="#cb43-1269" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectYearCutoff <span class="op">=</span> walkthroughSelections<span class="op">.</span><span class="at">project_years</span><span class="op">;</span></span>
<span id="cb43-1270"><a href="#cb43-1270" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selector <span class="op">=</span> pickMetricWalkthrough<span class="op">;</span></span>
<span id="cb43-1271"><a href="#cb43-1271" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotData <span class="op">=</span> walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span> <span class="op">??</span> []<span class="op">;</span></span>
<span id="cb43-1272"><a href="#cb43-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1273"><a href="#cb43-1273" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Always include all years for consistent x-axis</span></span>
<span id="cb43-1274"><a href="#cb43-1274" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fullYears <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">9</span>)<span class="op">;</span> <span class="co">// 0 to 8 inclusive</span></span>
<span id="cb43-1275"><a href="#cb43-1275" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> completePlotData <span class="op">=</span> fullYears<span class="op">.</span><span class="fu">map</span>((y) <span class="kw">=&gt;</span> {</span>
<span id="cb43-1276"><a href="#cb43-1276" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> row <span class="op">=</span> plotData<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> y)<span class="op">;</span></span>
<span id="cb43-1277"><a href="#cb43-1277" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> row <span class="op">??</span> { <span class="dt">year</span><span class="op">:</span> y }<span class="op">;</span></span>
<span id="cb43-1278"><a href="#cb43-1278" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb43-1279"><a href="#cb43-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1280"><a href="#cb43-1280" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ruleYValue <span class="op">=</span> selector<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"bcr"</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb43-1281"><a href="#cb43-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1282"><a href="#cb43-1282" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb43-1283"><a href="#cb43-1283" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb43-1284"><a href="#cb43-1284" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb43-1285"><a href="#cb43-1285" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inset</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb43-1286"><a href="#cb43-1286" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb43-1287"><a href="#cb43-1287" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb43-1288"><a href="#cb43-1288" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">exploreIndicators</span><span class="op">.</span><span class="at">projectYear</span><span class="op">,</span></span>
<span id="cb43-1289"><a href="#cb43-1289" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1290"><a href="#cb43-1290" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> fullYears<span class="op">,</span></span>
<span id="cb43-1291"><a href="#cb43-1291" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> <span class="st">"d"</span><span class="op">,</span></span>
<span id="cb43-1292"><a href="#cb43-1292" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb43-1293"><a href="#cb43-1293" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelArrow</span><span class="op">:</span> <span class="st">"none"</span><span class="op">,</span></span>
<span id="cb43-1294"><a href="#cb43-1294" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1295"><a href="#cb43-1295" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb43-1296"><a href="#cb43-1296" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb43-1297"><a href="#cb43-1297" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb43-1298"><a href="#cb43-1298" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1299"><a href="#cb43-1299" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb43-1300"><a href="#cb43-1300" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>({</span>
<span id="cb43-1301"><a href="#cb43-1301" aria-hidden="true" tabindex="-1"></a>        <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb43-1302"><a href="#cb43-1302" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb43-1303"><a href="#cb43-1303" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickFormat</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb43-1304"><a href="#cb43-1304" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb43-1305"><a href="#cb43-1305" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb43-1306"><a href="#cb43-1306" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> d <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"#EC5A47"</span><span class="op">;</span></span>
<span id="cb43-1307"><a href="#cb43-1307" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb43-1308"><a href="#cb43-1308" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb43-1309"><a href="#cb43-1309" aria-hidden="true" tabindex="-1"></a>      <span class="co">// horizontal reference line</span></span>
<span id="cb43-1310"><a href="#cb43-1310" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([ruleYValue]<span class="op">,</span> {</span>
<span id="cb43-1311"><a href="#cb43-1311" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb43-1312"><a href="#cb43-1312" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeDasharray</span><span class="op">:</span> [<span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb43-1313"><a href="#cb43-1313" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb43-1314"><a href="#cb43-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1315"><a href="#cb43-1315" aria-hidden="true" tabindex="-1"></a>      <span class="co">// line</span></span>
<span id="cb43-1316"><a href="#cb43-1316" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">line</span>(completePlotData<span class="op">,</span> {</span>
<span id="cb43-1317"><a href="#cb43-1317" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb43-1318"><a href="#cb43-1318" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb43-1319"><a href="#cb43-1319" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb43-1320"><a href="#cb43-1320" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb43-1321"><a href="#cb43-1321" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb43-1322"><a href="#cb43-1322" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1323"><a href="#cb43-1323" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb43-1324"><a href="#cb43-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1325"><a href="#cb43-1325" aria-hidden="true" tabindex="-1"></a>      <span class="co">// dots</span></span>
<span id="cb43-1326"><a href="#cb43-1326" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(completePlotData<span class="op">,</span> {</span>
<span id="cb43-1327"><a href="#cb43-1327" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb43-1328"><a href="#cb43-1328" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb43-1329"><a href="#cb43-1329" aria-hidden="true" tabindex="-1"></a>        <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb43-1330"><a href="#cb43-1330" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb43-1331"><a href="#cb43-1331" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb43-1332"><a href="#cb43-1332" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb43-1333"><a href="#cb43-1333" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> {</span>
<span id="cb43-1334"><a href="#cb43-1334" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb43-1335"><a href="#cb43-1335" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1336"><a href="#cb43-1336" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb43-1337"><a href="#cb43-1337" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb43-1338"><a href="#cb43-1338" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb43-1339"><a href="#cb43-1339" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb43-1340"><a href="#cb43-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1341"><a href="#cb43-1341" aria-hidden="true" tabindex="-1"></a>      <span class="co">// highlight selected year</span></span>
<span id="cb43-1342"><a href="#cb43-1342" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb43-1343"><a href="#cb43-1343" aria-hidden="true" tabindex="-1"></a>        completePlotData<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> projectYearCutoff)<span class="op">,</span></span>
<span id="cb43-1344"><a href="#cb43-1344" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb43-1345"><a href="#cb43-1345" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb43-1346"><a href="#cb43-1346" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb43-1347"><a href="#cb43-1347" aria-hidden="true" tabindex="-1"></a>          <span class="dt">r</span><span class="op">:</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb43-1348"><a href="#cb43-1348" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb43-1349"><a href="#cb43-1349" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d[selector<span class="op">.</span><span class="at">columnName</span>] <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"#333"</span> <span class="op">:</span> <span class="st">"#EC5A47"</span>)<span class="op">,</span></span>
<span id="cb43-1350"><a href="#cb43-1350" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb43-1351"><a href="#cb43-1351" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb43-1352"><a href="#cb43-1352" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1353"><a href="#cb43-1353" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb43-1354"><a href="#cb43-1354" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb43-1355"><a href="#cb43-1355" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-38" data-nodetype="declaration"></div></div></div></section></section><section id="data-analysis-and-processing" class="level2"><h2 data-anchor-id="data-analysis-and-processing">Data Analysis and Processing</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1361" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1360"><span id="cb44-1361"><a href="#cb44-1361" aria-hidden="true" tabindex="-1"></a>admin0_names <span class="op">=</span> {</span>
<span id="cb44-1362"><a href="#cb44-1362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isoSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_country)<span class="op">;</span></span>
<span id="cb44-1363"><a href="#cb44-1363" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> countries</span>
<span id="cb44-1364"><a href="#cb44-1364" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> isoSet<span class="op">.</span><span class="fu">has</span>(d<span class="op">.</span><span class="at">iso3c</span>))</span>
<span id="cb44-1365"><a href="#cb44-1365" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span>)<span class="op">;</span></span>
<span id="cb44-1366"><a href="#cb44-1366" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-39" data-nodetype="declaration"></div></div></div><section id="cv-data" class="level3"><h3 data-anchor-id="cv-data">CV Data</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1374" data-source-offset="-50"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1373"><span id="cb45-1374"><a href="#cb45-1374" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb45-1375"><a href="#cb45-1375" aria-hidden="true" tabindex="-1"></a>  avlossCalc<span class="op">,</span></span>
<span id="cb45-1376"><a href="#cb45-1376" aria-hidden="true" tabindex="-1"></a>  calcMIRR<span class="op">,</span></span>
<span id="cb45-1377"><a href="#cb45-1377" aria-hidden="true" tabindex="-1"></a>  calcIRR<span class="op">,</span></span>
<span id="cb45-1378"><a href="#cb45-1378" aria-hidden="true" tabindex="-1"></a>  npvDiscreteCumulative<span class="op">,</span></span>
<span id="cb45-1379"><a href="#cb45-1379" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/notebooks/roi/roi_tools.js"</span><span class="op">;</span></span>
<span id="cb45-1380"><a href="#cb45-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1381"><a href="#cb45-1381" aria-hidden="true" tabindex="-1"></a>irrnpv <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/irr-npv@1.0.1?min"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-40-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-40-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1385" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1384"><span id="cb46-1385"><a href="#cb46-1385" aria-hidden="true" tabindex="-1"></a>mutable cv_result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb46-1386"><a href="#cb46-1386" aria-hidden="true" tabindex="-1"></a>mutable cv_cache_key <span class="op">=</span> <span class="st">''</span><span class="op">;</span></span>
<span id="cb46-1387"><a href="#cb46-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1388"><a href="#cb46-1388" aria-hidden="true" tabindex="-1"></a>calcCV <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb46-1389"><a href="#cb46-1389" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cis_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb46-1390"><a href="#cb46-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1391"><a href="#cb46-1391" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cache_key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>[<span class="op">...</span>admin0_names]<span class="op">.</span><span class="fu">sort</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>[<span class="op">...</span>select_crop]<span class="op">.</span><span class="fu">sort</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>cis_impact<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb46-1392"><a href="#cb46-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1393"><a href="#cb46-1393" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cv_cache_key <span class="op">===</span> cache_key) {</span>
<span id="cb46-1394"><a href="#cb46-1394" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Skipped cv run as inputs the same'</span>)<span class="op">;</span></span>
<span id="cb46-1395"><a href="#cb46-1395" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cv_result<span class="op">;</span></span>
<span id="cb46-1396"><a href="#cb46-1396" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-1397"><a href="#cb46-1397" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-1398"><a href="#cb46-1398" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Running the cv analysis as inputs changed'</span>)</span>
<span id="cb46-1399"><a href="#cb46-1399" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb46-1400"><a href="#cb46-1400" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb46-1401"><a href="#cb46-1401" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM cv</span></span>
<span id="cb46-1402"><a href="#cb46-1402" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE crop in ('</span><span class="sc">${</span>select_crop<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb46-1403"><a href="#cb46-1403" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND admin0_name in ('</span><span class="sc">${</span>admin0_names<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">') -- This needs the a0_name rather than iso3</span></span>
<span id="cb46-1404"><a href="#cb46-1404" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb46-1405"><a href="#cb46-1405" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-1406"><a href="#cb46-1406" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_monteCarlo <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>(</span>
<span id="cb46-1407"><a href="#cb46-1407" aria-hidden="true" tabindex="-1"></a>    cv_data<span class="op">.</span><span class="fu">map</span>(<span class="kw">async</span> ({ crop<span class="op">,</span> admin0_name<span class="op">,</span> cv }) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1408"><a href="#cb46-1408" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> av <span class="op">=</span> <span class="cf">await</span> <span class="fu">avlossCalc</span>(cv<span class="op">,</span> cis_impact)<span class="op">;</span></span>
<span id="cb46-1409"><a href="#cb46-1409" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> avloss <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="bu">Number</span>(av<span class="op">.</span><span class="at">toFixed</span><span class="op">?.</span>(<span class="dv">4</span>) <span class="op">??</span> av))<span class="op">;</span></span>
<span id="cb46-1410"><a href="#cb46-1410" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { admin0_name<span class="op">,</span> crop<span class="op">,</span> cv<span class="op">,</span> cis_impact<span class="op">,</span> avloss }<span class="op">;</span></span>
<span id="cb46-1411"><a href="#cb46-1411" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb46-1412"><a href="#cb46-1412" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb46-1413"><a href="#cb46-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1414"><a href="#cb46-1414" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_index <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb46-1415"><a href="#cb46-1415" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> { admin0_name<span class="op">,</span> crop<span class="op">,</span> avloss } <span class="kw">of</span> cv_monteCarlo) {</span>
<span id="cb46-1416"><a href="#cb46-1416" aria-hidden="true" tabindex="-1"></a>    cv_index<span class="op">.</span><span class="fu">set</span>(<span class="vs">`</span><span class="sc">${</span>admin0_name<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>crop<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> avloss)<span class="op">;</span></span>
<span id="cb46-1417"><a href="#cb46-1417" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-1418"><a href="#cb46-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1419"><a href="#cb46-1419" aria-hidden="true" tabindex="-1"></a>  mutable cv_result <span class="op">=</span> cv_index</span>
<span id="cb46-1420"><a href="#cb46-1420" aria-hidden="true" tabindex="-1"></a>  mutable cv_cache_key <span class="op">=</span> cache_key</span>
<span id="cb46-1421"><a href="#cb46-1421" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> cv_index</span>
<span id="cb46-1422"><a href="#cb46-1422" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-41-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-41-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-41-3" data-nodetype="declaration"></div></div></div></div></section><section id="other-roi-x-exposure-variables" class="level3"><h3 data-anchor-id="other-roi-x-exposure-variables">Other ROI X Exposure Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1427" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1426"><span id="cb47-1427"><a href="#cb47-1427" aria-hidden="true" tabindex="-1"></a><span class="co">// getExposureData = async (crops, countries) =&gt; {</span></span>
<span id="cb47-1428"><a href="#cb47-1428" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">NOTE</span><span class="co">: Making this a dataset rather than a function so it only re-runs when crop or country change.</span></span>
<span id="cb47-1429"><a href="#cb47-1429" aria-hidden="true" tabindex="-1"></a><span class="co">// Defaulting to all admin 1 data as all admin regions are selected by defualt and this</span></span>
<span id="cb47-1430"><a href="#cb47-1430" aria-hidden="true" tabindex="-1"></a><span class="co">// will prevent having to have users re-query the datasets when changing regions in a county.</span></span>
<span id="cb47-1431"><a href="#cb47-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1432"><a href="#cb47-1432" aria-hidden="true" tabindex="-1"></a>exposure_data <span class="op">=</span> {</span>
<span id="cb47-1433"><a href="#cb47-1433" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> crops <span class="op">=</span> select_crop<span class="op">;</span></span>
<span id="cb47-1434"><a href="#cb47-1434" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> countries <span class="op">=</span> select_country<span class="op">;</span></span>
<span id="cb47-1435"><a href="#cb47-1435" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb47-1436"><a href="#cb47-1436" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb47-1437"><a href="#cb47-1437" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM exposure</span></span>
<span id="cb47-1438"><a href="#cb47-1438" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE crop in ('</span><span class="sc">${</span>crops<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb47-1439"><a href="#cb47-1439" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND iso3 in ('</span><span class="sc">${</span>countries<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb47-1440"><a href="#cb47-1440" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- POSSIBLY add admin1 name filter, but defaults to full country, so maybe bigger query is better. </span></span>
<span id="cb47-1441"><a href="#cb47-1441" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)<span class="op">;</span></span>
<span id="cb47-1442"><a href="#cb47-1442" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb47-1443"><a href="#cb47-1443" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-42" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1447" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1446"><span id="cb48-1447"><a href="#cb48-1447" aria-hidden="true" tabindex="-1"></a>crop_adoption <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb48-1448"><a href="#cb48-1448" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Globals from the notebook</span></span>
<span id="cb48-1449"><a href="#cb48-1449" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adoption <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb48-1450"><a href="#cb48-1450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb48-1451"><a href="#cb48-1451" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> prod_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb48-1452"><a href="#cb48-1452" aria-hidden="true" tabindex="-1"></a>  <span class="co">// let data = await getExposureData(select_crop, select_country);</span></span>
<span id="cb48-1453"><a href="#cb48-1453" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> exposure_data<span class="op">;</span></span>
<span id="cb48-1454"><a href="#cb48-1454" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb48-1455"><a href="#cb48-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-1456"><a href="#cb48-1456" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> row <span class="kw">of</span> data) {</span>
<span id="cb48-1457"><a href="#cb48-1457" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> value <span class="op">=</span> row<span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb48-1458"><a href="#cb48-1458" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xPrev <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb48-1459"><a href="#cb48-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-1460"><a href="#cb48-1460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> years<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb48-1461"><a href="#cb48-1461" aria-hidden="true" tabindex="-1"></a>      <span class="co">// cumulative adoption</span></span>
<span id="cb48-1462"><a href="#cb48-1462" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> x<span class="op">;</span></span>
<span id="cb48-1463"><a href="#cb48-1463" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb48-1464"><a href="#cb48-1464" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(value <span class="op">*</span> adoption <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb48-1465"><a href="#cb48-1465" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb48-1466"><a href="#cb48-1466" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((value <span class="op">-</span> xPrev) <span class="op">*</span> adoption <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> xPrev<span class="op">;</span></span>
<span id="cb48-1467"><a href="#cb48-1467" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb48-1468"><a href="#cb48-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-1469"><a href="#cb48-1469" aria-hidden="true" tabindex="-1"></a>      xPrev <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb48-1470"><a href="#cb48-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-1471"><a href="#cb48-1471" aria-hidden="true" tabindex="-1"></a>      <span class="co">// push a long-form row</span></span>
<span id="cb48-1472"><a href="#cb48-1472" aria-hidden="true" tabindex="-1"></a>      result<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb48-1473"><a href="#cb48-1473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin0_name</span><span class="op">:</span> row<span class="op">.</span><span class="at">admin0_name</span><span class="op">,</span></span>
<span id="cb48-1474"><a href="#cb48-1474" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin1_name</span><span class="op">:</span> row<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span></span>
<span id="cb48-1475"><a href="#cb48-1475" aria-hidden="true" tabindex="-1"></a>        <span class="dt">iso3c</span><span class="op">:</span> row<span class="op">.</span><span class="at">iso3</span><span class="op">,</span></span>
<span id="cb48-1476"><a href="#cb48-1476" aria-hidden="true" tabindex="-1"></a>        <span class="dt">crop</span><span class="op">:</span> row<span class="op">.</span><span class="at">crop</span><span class="op">,</span></span>
<span id="cb48-1477"><a href="#cb48-1477" aria-hidden="true" tabindex="-1"></a>        <span class="dt">exposure</span><span class="op">:</span> row<span class="op">.</span><span class="at">exposure</span><span class="op">,</span></span>
<span id="cb48-1478"><a href="#cb48-1478" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> row<span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb48-1479"><a href="#cb48-1479" aria-hidden="true" tabindex="-1"></a>        <span class="dt">adoption</span><span class="op">:</span> adoption<span class="op">,</span></span>
<span id="cb48-1480"><a href="#cb48-1480" aria-hidden="true" tabindex="-1"></a>        <span class="dt">prod_impact</span><span class="op">:</span> prod_impact<span class="op">,</span></span>
<span id="cb48-1481"><a href="#cb48-1481" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year_char</span><span class="op">:</span> <span class="vs">`y</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb48-1482"><a href="#cb48-1482" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> i<span class="op">,</span></span>
<span id="cb48-1483"><a href="#cb48-1483" aria-hidden="true" tabindex="-1"></a>        <span class="dt">result</span><span class="op">:</span> x<span class="op">,</span></span>
<span id="cb48-1484"><a href="#cb48-1484" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb48-1485"><a href="#cb48-1485" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-1486"><a href="#cb48-1486" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-1487"><a href="#cb48-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-1488"><a href="#cb48-1488" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">.</span><span class="fu">map</span>((row) <span class="kw">=&gt;</span> {</span>
<span id="cb48-1489"><a href="#cb48-1489" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result_w_impact <span class="op">=</span></span>
<span id="cb48-1490"><a href="#cb48-1490" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(row<span class="op">.</span><span class="at">result</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> (row<span class="op">.</span><span class="at">prod_impact</span> <span class="op">??</span> <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb48-1491"><a href="#cb48-1491" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_impact <span class="op">=</span></span>
<span id="cb48-1492"><a href="#cb48-1492" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((result_w_impact <span class="op">-</span> row<span class="op">.</span><span class="at">result</span>) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb48-1493"><a href="#cb48-1493" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>row<span class="op">,</span> result_w_impact<span class="op">,</span> marginal_impact }<span class="op">;</span></span>
<span id="cb48-1494"><a href="#cb48-1494" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb48-1495"><a href="#cb48-1495" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb48-1496"><a href="#cb48-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-1497"><a href="#cb48-1497" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">NOTE</span><span class="co">: QAQC RESULTS:</span></span>
<span id="cb48-1498"><a href="#cb48-1498" aria-hidden="true" tabindex="-1"></a><span class="co">// 1 region &amp; crop: PERFECT - This output matches the R script output exactly</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-43" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1502" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1501"><span id="cb49-1502"><a href="#cb49-1502" aria-hidden="true" tabindex="-1"></a>roiResults <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb49-1503"><a href="#cb49-1503" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> index <span class="op">=</span> <span class="cf">await</span> <span class="fu">calcCV</span>()<span class="op">;</span></span>
<span id="cb49-1504"><a href="#cb49-1504" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">crop_adoption</span>()<span class="op">;</span></span>
<span id="cb49-1505"><a href="#cb49-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1506"><a href="#cb49-1506" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> withImpact <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>((row) <span class="kw">=&gt;</span> {</span>
<span id="cb49-1507"><a href="#cb49-1507" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>row<span class="op">.</span><span class="at">admin0_name</span><span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>row<span class="op">.</span><span class="at">crop</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb49-1508"><a href="#cb49-1508" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> avloss <span class="op">=</span> index<span class="op">.</span><span class="fu">get</span>(key) <span class="op">??</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// default to 0 if missing</span></span>
<span id="cb49-1509"><a href="#cb49-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1510"><a href="#cb49-1510" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result_w_impact_cis <span class="op">=</span></span>
<span id="cb49-1511"><a href="#cb49-1511" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(row<span class="op">.</span><span class="at">result_w_impact</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> avloss) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb49-1512"><a href="#cb49-1512" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_cis <span class="op">=</span></span>
<span id="cb49-1513"><a href="#cb49-1513" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((result_w_impact_cis <span class="op">-</span> row<span class="op">.</span><span class="at">result_w_impact</span>) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb49-1514"><a href="#cb49-1514" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_impact_cis <span class="op">=</span></span>
<span id="cb49-1515"><a href="#cb49-1515" aria-hidden="true" tabindex="-1"></a>      (marginal_cis <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> (row<span class="op">.</span><span class="at">marginal_impact</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb49-1516"><a href="#cb49-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1517"><a href="#cb49-1517" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb49-1518"><a href="#cb49-1518" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>row<span class="op">,</span></span>
<span id="cb49-1519"><a href="#cb49-1519" aria-hidden="true" tabindex="-1"></a>      avloss<span class="op">,</span></span>
<span id="cb49-1520"><a href="#cb49-1520" aria-hidden="true" tabindex="-1"></a>      result_w_impact_cis<span class="op">,</span></span>
<span id="cb49-1521"><a href="#cb49-1521" aria-hidden="true" tabindex="-1"></a>      marginal_cis<span class="op">,</span></span>
<span id="cb49-1522"><a href="#cb49-1522" aria-hidden="true" tabindex="-1"></a>      marginal_impact_cis<span class="op">,</span></span>
<span id="cb49-1523"><a href="#cb49-1523" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb49-1524"><a href="#cb49-1524" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb49-1525"><a href="#cb49-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1526"><a href="#cb49-1526" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> withImpact<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb49-1527"><a href="#cb49-1527" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> project_benefit <span class="op">=</span></span>
<span id="cb49-1528"><a href="#cb49-1528" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((d<span class="op">.</span><span class="at">marginal_impact_cis</span> <span class="op">-</span> d<span class="op">.</span><span class="at">marginal_impact_cis</span> <span class="op">/</span> bcr) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span></span>
<span id="cb49-1529"><a href="#cb49-1529" aria-hidden="true" tabindex="-1"></a>      <span class="dv">10</span><span class="op">;</span></span>
<span id="cb49-1530"><a href="#cb49-1530" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cis_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb49-1531"><a href="#cb49-1531" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>d<span class="op">,</span> bcr<span class="op">,</span> cis_impact<span class="op">,</span> project_benefit }<span class="op">;</span></span>
<span id="cb49-1532"><a href="#cb49-1532" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb49-1533"><a href="#cb49-1533" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb49-1534"><a href="#cb49-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1535"><a href="#cb49-1535" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">NOTE</span><span class="co">: QAQC RESULTS:</span></span>
<span id="cb49-1536"><a href="#cb49-1536" aria-hidden="true" tabindex="-1"></a><span class="co">// 1 region &amp; crop: Good - Output is close, the MC simulation gives different results, but the difference is few $100 each time</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-44" data-nodetype="declaration"></div></div></div></section><section id="roi-x-inputs-calculations" class="level3"><h3 data-anchor-id="roi-x-inputs-calculations">ROI X inputs Calculations</h3><section id="sum-across-admins-and-crops" class="level4"><h4 data-anchor-id="sum-across-admins-and-crops">Sum across admins and crops</h4><p>We select all the data for admin regions and crops, and sum up to get the benefit across all parameter combos.</p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1547" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1546"><span id="cb50-1547"><a href="#cb50-1547" aria-hidden="true" tabindex="-1"></a>regionSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_region)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-45" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1551" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1550"><span id="cb51-1551"><a href="#cb51-1551" aria-hidden="true" tabindex="-1"></a>recipe_dataSummed <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb51-1552"><a href="#cb51-1552" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"wait"</span><span class="op">;</span></span>
<span id="cb51-1553"><a href="#cb51-1553" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> roi_data <span class="op">=</span> <span class="cf">await</span> <span class="fu">roiResults</span>()<span class="op">;</span></span>
<span id="cb51-1554"><a href="#cb51-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1555"><a href="#cb51-1555" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filter down on this step to the selected regions</span></span>
<span id="cb51-1556"><a href="#cb51-1556" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> roi_data_filtered <span class="op">=</span> roi_data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb51-1557"><a href="#cb51-1557" aria-hidden="true" tabindex="-1"></a>    regionSet<span class="op">.</span><span class="fu">has</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">iso3c</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb51-1558"><a href="#cb51-1558" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb51-1559"><a href="#cb51-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1560"><a href="#cb51-1560" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> aggregated <span class="op">=</span> d3</span>
<span id="cb51-1561"><a href="#cb51-1561" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatGroup</span>(</span>
<span id="cb51-1562"><a href="#cb51-1562" aria-hidden="true" tabindex="-1"></a>      roi_data_filtered<span class="op">,</span></span>
<span id="cb51-1563"><a href="#cb51-1563" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">adoption</span><span class="op">,</span></span>
<span id="cb51-1564"><a href="#cb51-1564" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prod_impact</span><span class="op">,</span></span>
<span id="cb51-1565"><a href="#cb51-1565" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cis_impact</span><span class="op">,</span></span>
<span id="cb51-1566"><a href="#cb51-1566" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bcr</span><span class="op">,</span></span>
<span id="cb51-1567"><a href="#cb51-1567" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span><span class="op">,</span></span>
<span id="cb51-1568"><a href="#cb51-1568" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-1569"><a href="#cb51-1569" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(([adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> year<span class="op">,</span> group]) <span class="kw">=&gt;</span> ({</span>
<span id="cb51-1570"><a href="#cb51-1570" aria-hidden="true" tabindex="-1"></a>      adoption<span class="op">,</span></span>
<span id="cb51-1571"><a href="#cb51-1571" aria-hidden="true" tabindex="-1"></a>      prod_impact<span class="op">,</span></span>
<span id="cb51-1572"><a href="#cb51-1572" aria-hidden="true" tabindex="-1"></a>      cis_impact<span class="op">,</span></span>
<span id="cb51-1573"><a href="#cb51-1573" aria-hidden="true" tabindex="-1"></a>      bcr<span class="op">,</span></span>
<span id="cb51-1574"><a href="#cb51-1574" aria-hidden="true" tabindex="-1"></a>      year<span class="op">,</span></span>
<span id="cb51-1575"><a href="#cb51-1575" aria-hidden="true" tabindex="-1"></a>      <span class="dt">project_benefit</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">sum</span>(group<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">project_benefit</span>)<span class="op">,</span></span>
<span id="cb51-1576"><a href="#cb51-1576" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb51-1577"><a href="#cb51-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1578"><a href="#cb51-1578" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"default"</span><span class="op">;</span></span>
<span id="cb51-1579"><a href="#cb51-1579" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> aggregated<span class="op">;</span></span>
<span id="cb51-1580"><a href="#cb51-1580" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-46" data-nodetype="declaration"></div></div></div></section><section id="define-project-payment-schedule" class="level4"><h4 data-anchor-id="define-project-payment-schedule">Define project payment schedule</h4><p>Below we define the project cost schedule</p><ul><li>Cost is evenly distributed across years (<ul><li>Ex. 1M over 5 years is 200K, 400K, 600K, 800K, 1M; the first year has no project benefit ($200K, 0 benefit)</li></ul></li></ul><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1592" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1591"><span id="cb52-1592"><a href="#cb52-1592" aria-hidden="true" tabindex="-1"></a>recipe_paymentSchedule <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> projectYears })<span class="op">.</span><span class="fu">map</span>((_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb52-1593"><a href="#cb52-1593" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb52-1594"><a href="#cb52-1594" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> i<span class="op">,</span></span>
<span id="cb52-1595"><a href="#cb52-1595" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cost</span><span class="op">:</span> (<span class="dv">1</span> <span class="op">/</span> projectYears) <span class="op">*</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb52-1596"><a href="#cb52-1596" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cost_cum</span><span class="op">:</span> ((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> projectYears) <span class="op">*</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb52-1597"><a href="#cb52-1597" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb52-1598"><a href="#cb52-1598" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-47" data-nodetype="declaration"></div></div></div></section><section id="add-project-scope-to-data" class="level4"><h4 data-anchor-id="add-project-scope-to-data">Add project scope to data</h4><ul><li>Add a zero year at the start (the return rate is hardcoded to one year)</li><li>Also if the project cost is zero, return an empty array</li></ul><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="1607" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1606"><span id="cb53-1607"><a href="#cb53-1607" aria-hidden="true" tabindex="-1"></a>recipe_dataCashflow <span class="op">=</span> {</span>
<span id="cb53-1608"><a href="#cb53-1608" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>rangeProjectCost <span class="op">||</span> rangeProjectCost <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb53-1609"><a href="#cb53-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1610"><a href="#cb53-1610" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payByYear <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(recipe_paymentSchedule<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">year</span><span class="op">,</span> d]))<span class="op">;</span></span>
<span id="cb53-1611"><a href="#cb53-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1612"><a href="#cb53-1612" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">recipe_dataSummed</span>()<span class="op">;</span></span>
<span id="cb53-1613"><a href="#cb53-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1614"><a href="#cb53-1614" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3</span>
<span id="cb53-1615"><a href="#cb53-1615" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatGroup</span>(</span>
<span id="cb53-1616"><a href="#cb53-1616" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb53-1617"><a href="#cb53-1617" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">adoption</span><span class="op">,</span></span>
<span id="cb53-1618"><a href="#cb53-1618" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prod_impact</span><span class="op">,</span></span>
<span id="cb53-1619"><a href="#cb53-1619" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cis_impact</span><span class="op">,</span></span>
<span id="cb53-1620"><a href="#cb53-1620" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bcr</span><span class="op">,</span></span>
<span id="cb53-1621"><a href="#cb53-1621" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-1622"><a href="#cb53-1622" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatMap</span>(([adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> rows]) <span class="kw">=&gt;</span> {</span>
<span id="cb53-1623"><a href="#cb53-1623" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> allRows <span class="op">=</span> [</span>
<span id="cb53-1624"><a href="#cb53-1624" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>rows<span class="op">,</span></span>
<span id="cb53-1625"><a href="#cb53-1625" aria-hidden="true" tabindex="-1"></a>        { adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">project_benefit</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb53-1626"><a href="#cb53-1626" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb53-1627"><a href="#cb53-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1628"><a href="#cb53-1628" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> allRows<span class="op">.</span><span class="fu">map</span>((r) <span class="kw">=&gt;</span> {</span>
<span id="cb53-1629"><a href="#cb53-1629" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> pay <span class="op">=</span> payByYear<span class="op">.</span><span class="fu">get</span>(r<span class="op">.</span><span class="at">year</span>) <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb53-1630"><a href="#cb53-1630" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cost <span class="op">=</span> pay<span class="op">.</span><span class="at">cost</span> <span class="op">??</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb53-1631"><a href="#cb53-1631" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cost_cum <span class="op">=</span> pay<span class="op">.</span><span class="at">cost_cum</span> <span class="op">??</span> rangeProjectCost<span class="op">;</span></span>
<span id="cb53-1632"><a href="#cb53-1632" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb53-1633"><a href="#cb53-1633" aria-hidden="true" tabindex="-1"></a>          <span class="op">...</span>r<span class="op">,</span></span>
<span id="cb53-1634"><a href="#cb53-1634" aria-hidden="true" tabindex="-1"></a>          cost<span class="op">,</span></span>
<span id="cb53-1635"><a href="#cb53-1635" aria-hidden="true" tabindex="-1"></a>          cost_cum<span class="op">,</span></span>
<span id="cb53-1636"><a href="#cb53-1636" aria-hidden="true" tabindex="-1"></a>          <span class="dt">cashflow</span><span class="op">:</span> (r<span class="op">.</span><span class="at">project_benefit</span> <span class="op">??</span> <span class="dv">0</span>) <span class="op">-</span> cost<span class="op">,</span></span>
<span id="cb53-1637"><a href="#cb53-1637" aria-hidden="true" tabindex="-1"></a>          <span class="dt">discount_rate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb53-1638"><a href="#cb53-1638" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb53-1639"><a href="#cb53-1639" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb53-1640"><a href="#cb53-1640" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb53-1641"><a href="#cb53-1641" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-48" data-nodetype="declaration"></div></div></div></section><section id="format-that-into-final-indicators" class="level4"><h4 data-anchor-id="format-that-into-final-indicators">Format that into final indicators</h4><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="1648" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1647"><span id="cb54-1648"><a href="#cb54-1648" aria-hidden="true" tabindex="-1"></a>walkthroughEconomicIndicators <span class="op">=</span> {</span>
<span id="cb54-1649"><a href="#cb54-1649" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selection <span class="op">=</span> walkthroughSelections<span class="op">;</span></span>
<span id="cb54-1650"><a href="#cb54-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1651"><a href="#cb54-1651" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> recipe_dataCashflow</span>
<span id="cb54-1652"><a href="#cb54-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1653"><a href="#cb54-1653" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb54-1654"><a href="#cb54-1654" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> benefit <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">project_benefit</span>)<span class="op">;</span></span>
<span id="cb54-1655"><a href="#cb54-1655" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cost <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cost</span>)<span class="op">;</span></span>
<span id="cb54-1656"><a href="#cb54-1656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cashflow <span class="op">=</span> benefit<span class="op">.</span><span class="fu">map</span>((b<span class="op">,</span> i) <span class="kw">=&gt;</span> b <span class="op">-</span> cost[i])<span class="op">;</span></span>
<span id="cb54-1657"><a href="#cb54-1657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> discountRate <span class="op">=</span> selection<span class="op">.</span><span class="at">discount_rate</span><span class="op">;</span></span>
<span id="cb54-1658"><a href="#cb54-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1659"><a href="#cb54-1659" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(cashflow<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb54-1660"><a href="#cb54-1660" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_benefit <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(benefit<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb54-1661"><a href="#cb54-1661" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_cost <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(cost<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb54-1662"><a href="#cb54-1662" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> discounted_bcr <span class="op">=</span> npv_benefit<span class="op">.</span><span class="fu">map</span>((b<span class="op">,</span> i) <span class="kw">=&gt;</span> npv_cost[i] <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> b <span class="op">/</span> npv_cost[i])<span class="op">;</span></span>
<span id="cb54-1663"><a href="#cb54-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1664"><a href="#cb54-1664" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_irr <span class="op">=</span> <span class="fu">calcIRR</span>(cashflow)<span class="op">;</span></span>
<span id="cb54-1665"><a href="#cb54-1665" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_mirr <span class="op">=</span> <span class="fu">calcMIRR</span>(cashflow<span class="op">,</span> discountRate<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb54-1666"><a href="#cb54-1666" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_npv <span class="op">=</span> npv<span class="op">.</span><span class="fu">at</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb54-1667"><a href="#cb54-1667" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_bcr <span class="op">=</span> discounted_bcr<span class="op">.</span><span class="fu">at</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb54-1668"><a href="#cb54-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1669"><a href="#cb54-1669" aria-hidden="true" tabindex="-1"></a>  <span class="co">// === Enriched table</span></span>
<span id="cb54-1670"><a href="#cb54-1670" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> enrichedData <span class="op">=</span> years<span class="op">.</span><span class="fu">map</span>((year<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb54-1671"><a href="#cb54-1671" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cashflowToDate <span class="op">=</span> cashflow<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb54-1672"><a href="#cb54-1672" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb54-1673"><a href="#cb54-1673" aria-hidden="true" tabindex="-1"></a>      year<span class="op">,</span></span>
<span id="cb54-1674"><a href="#cb54-1674" aria-hidden="true" tabindex="-1"></a>      <span class="dt">project_benefit</span><span class="op">:</span> benefit[i]<span class="op">,</span></span>
<span id="cb54-1675"><a href="#cb54-1675" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cost</span><span class="op">:</span> cost[i]<span class="op">,</span></span>
<span id="cb54-1676"><a href="#cb54-1676" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cashflow</span><span class="op">:</span> cashflow[i]<span class="op">,</span></span>
<span id="cb54-1677"><a href="#cb54-1677" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_benefit_cum</span><span class="op">:</span> npv_benefit[i]<span class="op">,</span></span>
<span id="cb54-1678"><a href="#cb54-1678" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_cost_cum</span><span class="op">:</span> npv_cost[i]<span class="op">,</span></span>
<span id="cb54-1679"><a href="#cb54-1679" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_bcr</span><span class="op">:</span> discounted_bcr[i]<span class="op">,</span></span>
<span id="cb54-1680"><a href="#cb54-1680" aria-hidden="true" tabindex="-1"></a>      <span class="dt">irr</span><span class="op">:</span> <span class="fu">calcIRR</span>(cashflowToDate)<span class="op">*</span><span class="dv">100</span><span class="op">,</span></span>
<span id="cb54-1681"><a href="#cb54-1681" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mirr</span><span class="op">:</span> <span class="fu">calcMIRR</span>(cashflowToDate<span class="op">,</span> discountRate<span class="op">,</span> discountRate)<span class="op">*</span><span class="dv">100</span><span class="op">,</span></span>
<span id="cb54-1682"><a href="#cb54-1682" aria-hidden="true" tabindex="-1"></a>      <span class="dt">npv</span><span class="op">:</span> npv[i]</span>
<span id="cb54-1683"><a href="#cb54-1683" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb54-1684"><a href="#cb54-1684" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb54-1685"><a href="#cb54-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1686"><a href="#cb54-1686" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb54-1687"><a href="#cb54-1687" aria-hidden="true" tabindex="-1"></a>    <span class="dt">summary</span><span class="op">:</span> {</span>
<span id="cb54-1688"><a href="#cb54-1688" aria-hidden="true" tabindex="-1"></a>      proj_npv<span class="op">,</span></span>
<span id="cb54-1689"><a href="#cb54-1689" aria-hidden="true" tabindex="-1"></a>      proj_irr<span class="op">,</span></span>
<span id="cb54-1690"><a href="#cb54-1690" aria-hidden="true" tabindex="-1"></a>      proj_mirr<span class="op">,</span></span>
<span id="cb54-1691"><a href="#cb54-1691" aria-hidden="true" tabindex="-1"></a>      proj_bcr</span>
<span id="cb54-1692"><a href="#cb54-1692" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb54-1693"><a href="#cb54-1693" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enriched</span><span class="op">:</span> enrichedData</span>
<span id="cb54-1694"><a href="#cb54-1694" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb54-1695"><a href="#cb54-1695" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-1696"><a href="#cb54-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1697"><a href="#cb54-1697" aria-hidden="true" tabindex="-1"></a>walkthroughEconomicIndicators<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-49-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-49-2" data-nodetype="expression"></div></div></div></div></section><section id="calculate-final-values" class="level4"><h4 data-anchor-id="calculate-final-values">Calculate final values</h4><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="1703" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1702"><span id="cb55-1703"><a href="#cb55-1703" aria-hidden="true" tabindex="-1"></a>recipe_dataFinancialValues <span class="op">=</span> recipe_dataCashflow<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i<span class="op">,</span> arr) <span class="kw">=&gt;</span> {</span>
<span id="cb55-1704"><a href="#cb55-1704" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cashflowArray <span class="op">=</span> arr</span>
<span id="cb55-1705"><a href="#cb55-1705" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb55-1706"><a href="#cb55-1706" aria-hidden="true" tabindex="-1"></a>      (x) <span class="kw">=&gt;</span></span>
<span id="cb55-1707"><a href="#cb55-1707" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="at">adoption</span> <span class="op">===</span> d<span class="op">.</span><span class="at">adoption</span> <span class="op">&amp;&amp;</span></span>
<span id="cb55-1708"><a href="#cb55-1708" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="at">prod_impact</span> <span class="op">===</span> d<span class="op">.</span><span class="at">prod_impact</span> <span class="op">&amp;&amp;</span></span>
<span id="cb55-1709"><a href="#cb55-1709" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="at">cis_impact</span> <span class="op">===</span> d<span class="op">.</span><span class="at">cis_impact</span> <span class="op">&amp;&amp;</span></span>
<span id="cb55-1710"><a href="#cb55-1710" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="at">bcr</span> <span class="op">===</span> d<span class="op">.</span><span class="at">bcr</span> <span class="op">&amp;&amp;</span></span>
<span id="cb55-1711"><a href="#cb55-1711" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="at">discount_rate</span> <span class="op">===</span> d<span class="op">.</span><span class="at">discount_rate</span> <span class="op">&amp;&amp;</span></span>
<span id="cb55-1712"><a href="#cb55-1712" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="at">year</span> <span class="op">&lt;=</span> d<span class="op">.</span><span class="at">year</span><span class="op">,</span></span>
<span id="cb55-1713"><a href="#cb55-1713" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1714"><a href="#cb55-1714" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">cashflow</span>)<span class="op">;</span></span>
<span id="cb55-1715"><a href="#cb55-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1716"><a href="#cb55-1716" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_npv <span class="op">=</span> irrnpv<span class="op">.</span><span class="fu">npv</span>(cashflowArray<span class="op">,</span> d<span class="op">.</span><span class="at">discount_rate</span>)<span class="op">;</span></span>
<span id="cb55-1717"><a href="#cb55-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1718"><a href="#cb55-1718" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb55-1719"><a href="#cb55-1719" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb55-1720"><a href="#cb55-1720" aria-hidden="true" tabindex="-1"></a>    cashflowArray<span class="op">,</span></span>
<span id="cb55-1721"><a href="#cb55-1721" aria-hidden="true" tabindex="-1"></a>    <span class="dt">proj_irr</span><span class="op">:</span> irrnpv<span class="op">.</span><span class="fu">irr</span>(cashflowArray)<span class="op">,</span></span>
<span id="cb55-1722"><a href="#cb55-1722" aria-hidden="true" tabindex="-1"></a>    proj_npv<span class="op">,</span></span>
<span id="cb55-1723"><a href="#cb55-1723" aria-hidden="true" tabindex="-1"></a>    <span class="dt">proj_bcr</span><span class="op">:</span> proj_npv <span class="op">/</span> d<span class="op">.</span><span class="at">cost_cum</span><span class="op">,</span></span>
<span id="cb55-1724"><a href="#cb55-1724" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb55-1725"><a href="#cb55-1725" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb55-1726"><a href="#cb55-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1727"><a href="#cb55-1727" aria-hidden="true" tabindex="-1"></a>recipe_dataFinancialValues<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-50-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-50-2" data-nodetype="expression"></div></div></div></div><p>At this point, following the recipe, we have the timeseries for the selected parameters, with financial values calculated. Specifically:</p><ul><li>adoption</li><li>prod_impact</li><li>cis_impact</li><li>bcr</li><li>discount_rate</li></ul><p>Across:</p><ul><li>year</li></ul><p>Data:</p><ul><li>project_benifit</li><li>cost and cashflow</li><li>Project IRR</li><li>Project NPV</li><li>Project BCR</li></ul></section></section></section><section id="selections" class="level2"><h2 data-anchor-id="selections">Selections</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="1753" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1752"><span id="cb56-1753"><a href="#cb56-1753" aria-hidden="true" tabindex="-1"></a>walkthroughSelections <span class="op">=</span> {</span>
<span id="cb56-1754"><a href="#cb56-1754" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb56-1755"><a href="#cb56-1755" aria-hidden="true" tabindex="-1"></a>    <span class="dt">countries</span><span class="op">:</span> select_country<span class="op">,</span></span>
<span id="cb56-1756"><a href="#cb56-1756" aria-hidden="true" tabindex="-1"></a>    <span class="dt">regions</span><span class="op">:</span> select_region<span class="op">,</span></span>
<span id="cb56-1757"><a href="#cb56-1757" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crops</span><span class="op">:</span> select_crop<span class="op">,</span></span>
<span id="cb56-1758"><a href="#cb56-1758" aria-hidden="true" tabindex="-1"></a>    <span class="dt">project_years</span><span class="op">:</span> projectYears<span class="op">,</span></span>
<span id="cb56-1759"><a href="#cb56-1759" aria-hidden="true" tabindex="-1"></a>    <span class="dt">project_cost</span><span class="op">:</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb56-1760"><a href="#cb56-1760" aria-hidden="true" tabindex="-1"></a>    <span class="dt">prod_impact</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb56-1761"><a href="#cb56-1761" aria-hidden="true" tabindex="-1"></a>    <span class="dt">adoption</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb56-1762"><a href="#cb56-1762" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cis_impact</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb56-1763"><a href="#cb56-1763" aria-hidden="true" tabindex="-1"></a>    <span class="dt">discount_rate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb56-1764"><a href="#cb56-1764" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bcr</span><span class="op">:</span> bcr<span class="op">,</span></span>
<span id="cb56-1765"><a href="#cb56-1765" aria-hidden="true" tabindex="-1"></a>    <span class="co">// time_horizon: options_econPerfWalkthrough.inputTime.value,</span></span>
<span id="cb56-1766"><a href="#cb56-1766" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb56-1767"><a href="#cb56-1767" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-51" data-nodetype="declaration"></div></div></div><div class="ojs-auto-generated hidden"><script type="ojs-module-contents">eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7bmJPdmVydmlld308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2hlYWRpbmcxfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7X2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3Mub3BlbmVyMSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0zIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5vcGVuZXIyKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmgyKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTUifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLnRleHQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7X2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5oMil9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRleHQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7aGVhZGluZzJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC05In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtyZW5kZXJSZXZpZXcxKCl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7cmVuZGVyUmV2aWV3MigpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuY2xvc2VyMSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7bmJTdW1tYXJ5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTMifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5zdW1tYXJ5LmJsb2Nrcy5ibG9jazEpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke25iTWV0aG9kc308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE1In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtfbGFuZyhuYlRleHQubWV0aG9kcy5pbnRybyl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7YXBwZW5kaXh9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNyJ9XX0=</script></div></section></section></main><script type="ojs-module-contents">eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7XG4gIGF0bGFzVE9DLFxuICBhdGxhc0hlcm8sXG4gIGRyb3Bkb3duX3NlY3Rpb24sXG4gIGRvd25sb2FkQnV0dG9uLFxuICBtYWtlVG9vbHRpcExhYmVsLFxufSBmcm9tIFwiL2hlbHBlcnMvdWlDb21wb25lbnRzLm9qc1wiO1xuXG5oZXJvX3VybCA9IFwiLi8uLi8uLi9pbWFnZXMvZGVmYXVsdF9jcm9wLndlYnBcIjtcblxuYXRsYXNIZXJvKG5iVGl0bGUsIGhlcm9fdXJsKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIFRleHQgZm9yIG92ZXJ2aWV3IHNlY3Rpb25cbm1kYCR7X2xhbmcobmJUZXh0Lm92ZXJ2aWV3LmJsb2Nrcy5ibG9jazEpfWA7XG5cbm1kYCR7X2xhbmcobmJUZXh0Lm92ZXJ2aWV3LmJsb2Nrcy5ibG9jazIpfWA7XG5cbmRyb3Bkb3duX3NlY3Rpb24oXG4gIFwiRGVmaW5pdGlvbnNcIixcbiAgZmFsc2UsXG4gIG1kYCR7X2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLm92ZXJ2aWV3KX1gLFxuXG4gIG1kYCR7X2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci5vdmVydmlldyl9YCxcblxuICBtZGAke19sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi5vdmVydmlldyl9YCxcblxuICBtZGAke19sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmJjci5vdmVydmlldyl9YCxcbik7XG5cbm1kYCR7X2xhbmcobmJUZXh0Lm92ZXJ2aWV3LmJsb2Nrcy5ibG9jazMpfWA7XG5cbm1kYCR7X2xhbmcobmJUZXh0Lm92ZXJ2aWV3LmJsb2Nrcy5ibG9jazQpfWA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodGwuaHRtbGBcbjxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBnYXA6IDNlbTtcIj5cbiAgICAke3ZpZXdvZiBzZWxlY3RfY291bnRyeX1cbiAgICAke3ZpZXdvZiBzZWxlY3RfcmVnaW9ufVxuICAgICR7dmlld29mIHNlbGVjdF9jcm9wfVxuICA8L2Rpdj5cbmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgZGF0YSA9IGV4cG9zdXJlX2RhdGFcbiAgICAuZmlsdGVyKChkKSA9PlxuICAgIHJlZ2lvblNldC5oYXMoYCR7ZC5pc28zfV8ke2QuYWRtaW4xX25hbWV9YCksXG4gICk7XG5cbiAgY29uc3QgdG90YWxzID0gZDMucm9sbHVwKFxuICAgIGRhdGEsXG4gICAgdiA9PiBkMy5zdW0odiwgZCA9PiBkLnZhbHVlKSxcbiAgICBkID0+IGQuYWRtaW4wX25hbWUsXG4gICAgZCA9PiBkLmNyb3BcbiAgKTtcblxuICBjb25zdCBmbGF0VG90YWxzID0gQXJyYXkuZnJvbSh0b3RhbHMsIChbYWRtaW4wX25hbWUsIGNyb3BzXSkgPT5cbiAgICBBcnJheS5mcm9tKGNyb3BzLCAoW2Nyb3AsIHZhbHVlXSkgPT4gKHsgYWRtaW4wX25hbWUsIGNyb3AsIHZhbHVlIH0pKVxuICApLmZsYXQoKTtcblxuICBjb25zdCBfdGl0bGUgPSBfbGFuZyh7XG4gICAgZW46IFwiVG90YWwgVm9QIGZvciBzZWxlY3RlZCByZWdpb25zIGFuZCBjcm9wcyBpbiBlYWNoIGNvdW50cnlcIiwgXG4gICAgZnI6IFwiVG90YWwgVm9QIHBvdXIgbGVzIHJlzIFnaW9ucyBldCBsZXMgY3VsdHVyZXMgc2XMgWxlY3Rpb25uZcyBZXMgZGFucyBjaGFxdWUgcGF5c1wiXG4gIH0pXG5cbiAgcmV0dXJuIFBsb3QucGxvdCh7XG4gICAgc3VidGl0bGU6IF90aXRsZSxcbiAgICBtYXJnaW5MZWZ0OiA1MCxcbiAgICB3aWR0aDogOTI4LFxuICAgIGhlaWdodDogNTAwLFxuICAgIHg6IHsgbGFiZWw6IG51bGwsIHRpY2tGb3JtYXQ6IChkKSA9PiBgJHtkfSBSZWdpb25zYCB9LFxuICAgIHk6IHsgdGlja0Zvcm1hdDooZCkgPT4gZm9ybWF0VVNEKCkoZCkgfSxcbiAgICBjb2xvcjoge1xuICAgICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgICBsZWdlbmQ6IHRydWUsXG4gICAgICBsYWJlbDogXCJDcm9wc1wiLFxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuYmFyWShmbGF0VG90YWxzLCB7XG4gICAgICAgIHg6IFwiYWRtaW4wX25hbWVcIixcbiAgICAgICAgeTogXCJ2YWx1ZVwiLFxuICAgICAgICBmaWxsOiBcImNyb3BcIixcbiAgICAgICAgdGlwOiB0cnVlXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dFByb2plY3RPcHRpb25zID0ge1xuICBjb25zdCBpbnB1dFByb2plY3RDb3N0ID0gSW5wdXRzLnRleHQoe1xuICAgIGxhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0LmxhYmVsLFxuICAgICAgdG9vbHRpcFRleHQ6IGlucHV0T3B0aW9uc19wcm9qZWN0Q29zdC50b29sdGlwXG4gICAgfSksXG4gICAgcGF0dGVybjogaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0LnBhdHRlcm4sXG4gICAgcGxhY2Vob2xkZXI6IGlucHV0T3B0aW9uc19wcm9qZWN0Q29zdC5wbGFjZWhvbGRlcixcbiAgICB2YWx1ZTogaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0LnZhbHVlU3RyaW5nXG4gIH0pO1xuICBjb25zdCBpbnB1dFByb2plY3RZZWFycyA9IElucHV0cy5zZWxlY3QoaW5wdXRPcHRpb25zX3Byb2plY3RZZWFycy5kYXRhLCB7XG4gICAgZm9ybWF0OiAoeCkgPT4geC5sYWJlbCxcbiAgICBsYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IGlucHV0T3B0aW9uc19wcm9qZWN0WWVhcnMubGFiZWwsXG4gICAgICB0b29sdGlwVGV4dDogaW5wdXRPcHRpb25zX3Byb2plY3RZZWFycy50b29sdGlwXG4gICAgfSksXG4gICAgdmFsdWU6IGlucHV0T3B0aW9uc19wcm9qZWN0WWVhcnMuZGF0YS5maW5kKChkKSA9PiBkLnZhbHVlID09IDgpXG4gICAgfSk7XG5cbiAgcmV0dXJuIElucHV0cy5mb3JtKFxuICAgIHtcbiAgICAgIGNvc3Q6IGlucHV0UHJvamVjdENvc3QsXG4gICAgICB5ZWFyczppbnB1dFByb2plY3RZZWFyc1xuICAgIH0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IChpbnB1dHMpID0+XG4gICAgICAgIGh0bC5odG1sYDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBnYXA6IDNlbVwiPiR7T2JqZWN0LnZhbHVlcyhcbiAgICAgICAgICBpbnB1dHNcbiAgICAgICAgKX08L2Rpdj5gXG4gICAgfVxuICApO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZW1wbGF0ZSA9IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmNhbGxvdXRUZW1wbGF0ZSlcbiAgY29uc3QgdGVtcGxhdGVJdGVtcyA9IFtcbiAgICB7bmFtZTogXCJtb25leVwiLCB2YWx1ZTogZm9ybWF0VVNEKHtsb2NhbGU6IGxhbmd1YWdlLmxvY2FsZX0pKHJhbmdlUHJvamVjdENvc3QpfSxcbiAgICB7bmFtZTogXCJ0aW1lXCIsIHZhbHVlOiBpbnB1dFByb2plY3RPcHRpb25zLnllYXJzLmxhYmVsfSxcbiAgXVxuICBjb25zdCBmb3JtYXR0ZWQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKHRlbXBsYXRlLCB0ZW1wbGF0ZUl0ZW1zKVxuICByZXR1cm4gbWRgJHtmb3JtYXR0ZWR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHNlbGVjdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCA9IHtcbiAgY29uc3QgX2xhYmVsX3Byb2RJbXBhY3QgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLnByb2RJbXBhY3REcm9wZG93bi5sYWJlbCxcbiAgICAgICksXG4gICAgICB0b29sdGlwVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLnByb2RJbXBhY3REcm9wZG93bi50b29sdGlwLFxuICAgICAgKSxcbiAgICB9KVxuXG4gIGNvbnN0IF9sYWJlbF9BZG9wdGlvbiA9IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuYWRvcHRpb25SYXRlRHJvcGRvd24ubGFiZWwsXG4gICAgICApLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5hZG9wdGlvblJhdGVEcm9wZG93bi50b29sdGlwLFxuICAgICAgKSxcbiAgICB9KVxuXG4gIGNvbnN0IF9sYWJlbF9DaXNJbXBhY3QgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLmNpc0ltcGFjdERyb3Bkb3duLmxhYmVsLFxuICAgICAgKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuY2lzSW1wYWN0RHJvcGRvd24udG9vbHRpcCxcbiAgICAgICksXG4gICAgfSlcblxuICBjb25zdCBpbnB1dFByb2RJbXBhY3QgPSBJbnB1dHMucmFuZ2UoXG4gICAgWzAsIDU1XSxcbiAgICB7XG4gICAgICBzdGVwOiA1LFxuICAgICAgbGFiZWwgOiBfbGFiZWxfcHJvZEltcGFjdCxcbiAgICAgIHZhbHVlOiAzMFxuICAgIH0sXG4gIClcblxuICBjb25zdCBpbnB1dEFkb3B0aW9uID0gSW5wdXRzLnJhbmdlKFxuICAgIFswLjI1LCAyXSxcbiAgICB7XG4gICAgICBzdGVwOiAwLjI1LFxuICAgICAgbGFiZWwgOiBfbGFiZWxfQWRvcHRpb24sXG4gICAgICB2YWx1ZTogMVxuICAgIH0sXG4gIClcblxuICBjb25zdCBpbnB1dENpc0ltcGFjdCA9IElucHV0cy5yYW5nZShcbiAgICBbMCwgNTVdLFxuICAgIHtcbiAgICAgIHN0ZXA6IDUsXG4gICAgICBsYWJlbCA6IF9sYWJlbF9DaXNJbXBhY3QsXG4gICAgICB2YWx1ZTogMjVcbiAgICB9LFxuICAgIFxuICApXG5cbiAgcmV0dXJuIElucHV0cy5mb3JtKFxuICAgIHtcbiAgICAgIGlucHV0UHJvZEltcGFjdCxcbiAgICAgIGlucHV0QWRvcHRpb24sXG4gICAgICBpbnB1dENpc0ltcGFjdFxufSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogKGlucHV0cykgPT5cbiAgICAgICAgaHRsLmh0bWxgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGdhcDogM2VtXCI+JHtPYmplY3QudmFsdWVzKFxuICAgICAgICAgIGlucHV0c1xuICAgICAgICApfTwvZGl2PmAsXG4gICAgfVxuICApXG59XG5cbm9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCA9IHtcbiAgY29uc3QgZm9ybWF0dGVkID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHNlbGVjdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCkpIHtcbiAgICBmb3JtYXR0ZWRba2V5XSA9IHtcbiAgICAgIGxhYmVsOiBgJHt2YWx1ZX0lYCxcbiAgICAgIHZhbHVlOiB2YWx1ZSAvIDEwMFxuICAgIH07XG4gIH1cbiAgcmV0dXJuIGZvcm1hdHRlZDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgX2Rpc2NvdW50TGFiZWwgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICBsYWJlbFRleHQ6IFwiRGlzY291bnQgUmF0ZVwiLFxuICAgIHRvb2x0aXBUZXh0OiBcIlRoZSBEaXNjb3VudCByYXRlIGlzLi4uXCIsXG4gIH0pXG5cbiAgY29uc3QgX3JvaUxhYmVsID0gbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgbGFiZWxUZXh0OiBcIlJPSVwiLFxuICAgIHRvb2x0aXBUZXh0OiBcIlRoZSBST0kgaXMuLi5cIixcbiAgfSlcblxuICByZXR1cm4gZHJvcGRvd25fc2VjdGlvbihcbiAgICBcIkFkdmFuY2VkIENvbnRyb2xzXCIsXG4gICAgZmFsc2UsXG4gICAgSW5wdXRzLmJpbmQoXG4gICAgICBJbnB1dHMucmFuZ2UoXG4gICAgICAgIFswLCAxXSxcbiAgICAgICAge3N0ZXA6IDAuMDEsIGZvcm1hdDogeCA9PiAoeCAqIDEwMCksIGxhYmVsIDogX2Rpc2NvdW50TGFiZWwsIHZhbHVlOiAwLjEyfSBcbiAgICAgICksIHZpZXdvZiBkaXNjb3VudFJhdGVcbiAgICApLFxuICAgIElucHV0cy5iaW5kKFxuICAgICAgSW5wdXRzLnJhbmdlKFxuICAgICAgICBbMC41LCAyXSxcbiAgICAgICAge3N0ZXA6IDAuMDEsIGxhYmVsOiBfcm9pTGFiZWwsIHZhbHVlOiAxLjYyfSBcbiAgICAgICksIHZpZXdvZiBiY3JcbiAgICApXG4gIClcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJpZ051bWJlcnNSZXN1bHRzKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVzdWx0VGFibGUoKTtcbmRvd25sb2FkQnV0dG9uKFxuICB3YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycz8uZW5yaWNoZWQsXG4gIFwicm9pX2RhdGEuY3N2XCIsXG4gIF9sYW5nKHsgZW46IFwiRG93bmxvYWRcIiwgZnI6IFwiVMOpbMOpY2hhcmdlclwiIH0pLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZXN1bHRQbG90KCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW5kaWNhdG9yU2VsZWN0b3IgPSB7XG4gIC8vIGJpbmQgaW5wdXQgc28gdG9vbHRpcCBjYW4gYmUgZHluYW1pY1xuICByZXR1cm4gSW5wdXRzLmJpbmQoXG4gICAgSW5wdXRzLnNlbGVjdChkYXRhUGlja01ldHJpYywge1xuICAgIGxhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuZ2VuZXJhbC50ZXJtcy5pbmRpY2F0b3IpLFxuICAgICAgdG9vbHRpcFRleHQ6IHBpY2tNZXRyaWNXYWxrdGhyb3VnaC50b29sdGlwLFxuICAgIH0pLFxuICAgIGZvcm1hdDogKHgpID0+IHgubGFiZWxGdWxsLFxuICB9KSwgdmlld29mIHBpY2tNZXRyaWNXYWxrdGhyb3VnaFxuICApXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBsaXN0V2hhdCA9IF9sYW5nKG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuaW5mb0xpc3RIZWFkZXJzLndoYXQpXG4gIGNvbnN0IGxpc3RJbnRlcnByZXQgPSBfbGFuZyhuYlRleHQuaW52ZXN0bWVudFJldHVybnMuYmxvY2tzLmluZm9MaXN0SGVhZGVycy5pbnRlcnByZXQpXG4gIGNvbnN0IGxpc3RUZWxsID0gX2xhbmcobmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5pbmZvTGlzdEhlYWRlcnMudGVsbClcblxuICAvLyBpbmRpY2F0b3IgaW5mb1xuICByZXR1cm4gbWRgIyMjICR7cGlja01ldHJpY1dhbGt0aHJvdWdoLmxhYmVsRnVsbH1cblxuLSAqKiR7bGlzdFdoYXR9Kio6ICR7cGlja01ldHJpY1dhbGt0aHJvdWdoLmluZm8ud2hhdH1cbi0gKioke2xpc3RJbnRlcnByZXR9Kio6ICR7cGlja01ldHJpY1dhbGt0aHJvdWdoLmluZm8uaW50ZXJwcmV0fVxuLSAqKiR7bGlzdFRlbGx9Kio6ICR7cGlja01ldHJpY1dhbGt0aHJvdWdoLmluZm8udGVsbH1cbmBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IG5wdl9yYXRlID0gKGRpc2NvdW50UmF0ZSAqIDEwMCkgKyBcIiVcIjtcbiAgY29uc3QgZmFybV9iY3IgPSBiY3I7XG4gIGNvbnN0IG1ldGhvZHNfdGl0bGUgPSBuYk1ldGhvZHM7XG4gIFxuICBjb25zdCB0ZW1wbGF0ZSA9IF9sYW5nKG5iVGV4dC5zdW1tYXJ5LmJsb2Nrcy5ibG9jazIpXG4gIGNvbnN0IHRlbXBsYXRlSXRlbXMgPSBbXG4gICAge25hbWU6IFwibnB2RGlzb3VudFJhdGVcIiwgdmFsdWU6IG5wdl9yYXRlfSxcbiAgICB7bmFtZTogXCJmYXJtQmNyXCIsIHZhbHVlOiBmYXJtX2Jjcn0sXG4gICAge25hbWU6IFwibWV0aG9kc1NvdXJjZXNUaXRsZVwiLCB2YWx1ZTogbWV0aG9kc190aXRsZX0sXG4gIF1cbiAgY29uc3QgZm9ybWF0dGVkID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyh0ZW1wbGF0ZSwgdGVtcGxhdGVJdGVtcylcbiAgcmV0dXJuIG1kYCR7Zm9ybWF0dGVkfWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ0b2NfYm90dG9tID0gYXRsYXNUT0Moe1xuICBza2lwOiBbXCJub3RlYm9vay10aXRsZVwiLCBcImFwcGVuZGl4XCIsIFwic291cmNlLWNvZGVcIl0sIC8vIFRoZXNlIHNob3VsZCBiZSB0aGUgc2VjdGlvbiBoZWFkaW5ncyBpbiB0aGUgeyMgaGVhZGluZ3N9XG4gIGhlYWRpbmc6IGA8Yj4ke0xhbmcudG9TZW50ZW5jZUNhc2UoX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMudG9jKSl9PC9iPmAsXG59KTtcblxuaHRsLmh0bWxgXG4gICAgICA8ZGl2IGNsYXNzPSdmbG9hdGluZy10b2MnPlxuICAgICAgJHt0b2NfYm90dG9tfVxuICAgICAgPC9kaXY+XG4gICAgICBgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIERhdGEgbG9hZGVyIGNlbGxcbi8vVE9ETzogTW92ZSB0aGlzIHRvIHMzIHBhdGhzXG5kYiA9IHtcbiAgbGV0IGRiID0gYXdhaXQgRHVja0RCQ2xpZW50Lm9mKHtcbiAgICBjdl9yYXc6IEZpbGVBdHRhY2htZW50KFwiL2RhdGEvZWNvbm9taWNSZXR1cm5zL2Zhb3N0YXRfcHJvZF9jdi5wYXJxdWV0XCIpXG4gIH0pXG4gIGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICBDUkVBVEUgVEFCTEUgZXhwb3N1cmUgQVMgIC0tIGRhdGEgaXMgfiAxIG1iIHNvIHRhYmxlIHBvc3NpYmx5IG1vcmUgcGVyZm9ybWFudFxuICAgICAgU0VMRUNUXG4gICAgICAgIGlzbzMsXG4gICAgICAgIGFkbWluMF9uYW1lLFxuICAgICAgICBhZG1pbjFfbmFtZSxcbiAgICAgICAgUkVHRVhQX1JFUExBQ0UoY3JvcCwgJy10cm9waWNhbHwtaGlnaGxhbmQnLCAnJykgQVMgY3JvcCxcbiAgICAgICAgQ09OQ0FUKGV4cG9zdXJlLCAnXycsIHVuaXQpIEFTIGV4cG9zdXJlLFxuICAgICAgICBTVU0odmFsdWUpIEFTIHZhbHVlXG4gICAgICBGUk9NIHJlYWRfcGFycXVldChcInMzOi8vZGlnaXRhbC1hdGxhcy9kb21haW49ZXhwb3N1cmUvdHlwZT1jb21iaW5lZC9zb3VyY2U9Z2x3NC0yMDIwX3NwYW0yMDIwQUEvcmVnaW9uPXNzYS9wcm9jZXNzaW5nPWF0bGFzLWhhcm1vbml6ZWQvdmFyaWFibGU9dm9wX25vbWluYWwtdXNkLTIwMjEucGFycXVldFwiKVxuICAgICAgV0hFUkVcbiAgICAgICAgYWRtaW4yX25hbWUgSVMgTlVMTFxuICAgICAgICBBTkQgKHRlY2ggPSAnYWxsJyBPUiB0ZWNoIElTIE5VTEwpXG4gICAgICAgIEFORCBpc2Zpbml0ZSh2YWx1ZSlcbiAgICAgICAgQU5EIGNyb3AgIX4gJyheb3RoZXItfHJlc3Qtb2Z8dGVtcGVyYXRlLWZydWl0fHRyb3BpY2FsLWZydWl0fHZlZ2V0YWJsZXMpJ1xuICAgICAgR1JPVVAgQllcbiAgICAgICAgaXNvMyxcbiAgICAgICAgYWRtaW4wX25hbWUsXG4gICAgICAgIGFkbWluMV9uYW1lLFxuICAgICAgICBjcm9wLFxuICAgICAgICBDT05DQVQoZXhwb3N1cmUsICdfJywgdW5pdClcbiAgYClcbiAgYXdhaXQgZGIucXVlcnkoYFxuICAgIENSRUFURSBWSUVXIGN2IEFTXG4gICAgICBTRUxFQ1RcbiAgICAgICAgYWRtaW4wX25hbWUsXG4gICAgICAgIC0tIGNsZWFuIGFuZCBzdGFuZGFyZGl6ZSBjcm9wIG5hbWVzXG4gICAgICAgIFJFR0VYUF9SRVBMQUNFKFxuICAgICAgICAgIFJFR0VYUF9SRVBMQUNFKFxuICAgICAgICAgICAgUkVQTEFDRShSRVBMQUNFKGNyb3AsICdfbWVhdCcsICcnKSwgJyAnLCAnLScpLFxuICAgICAgICAgICAgJ2dvYXQkJywgJ2dvYXRzJ1xuICAgICAgICAgICksXG4gICAgICAgICAgJ3BpZyQnLCAncGlncydcbiAgICAgICAgKSBBUyBjcm9wLFxuICAgICAgICB2YWx1ZV9maWxsZWQgQVMgY3ZcbiAgICAgIEZST00gY3ZfcmF3XG4gICAgICBXSEVSRSBOT1QgKGNyb3AgSUxJS0UgJyVtaWxrJScgT1IgY3JvcCBJTElLRSAnJWVnZ3MlJyBPUiBMT1dFUihjcm9wKSA9ICd0b3RhbCcpXG5cbiAgICAgIFVOSU9OIEFMTFxuICAgICAgLS0gYWRkIHJvYnVzdGEtY29mZmVlIGFuZCBzbWFsbC1taWxsZXQgc3Vic3RpdHV0ZXNcbiAgICAgIFNFTEVDVCBhZG1pbjBfbmFtZSwgJ3JvYnVzdGEtY29mZmVlJywgdmFsdWVfZmlsbGVkIEFTIGN2XG4gICAgICBGUk9NIGN2X3Jhd1xuICAgICAgV0hFUkUgY3JvcCA9ICdhcmFiaWNhLWNvZmZlZSdcblxuICAgICAgVU5JT04gQUxMXG4gICAgICBTRUxFQ1QgYWRtaW4wX25hbWUsICdzbWFsbC1taWxsZXQnLCB2YWx1ZV9maWxsZWQgQVMgY3ZcbiAgICAgIEZST00gY3ZfcmF3XG4gICAgICBXSEVSRSBjcm9wID0gJ3BlYXJsLW1pbGxldCc7XG5gKVxuICByZXR1cm4gZGI7XG59O1xuXG5jb3VudHJpZXMgPSB7XG4gIGNvbnN0IGNvdW50cnlfbGlzdCA9IGF3YWl0IEZpbGVBdHRhY2htZW50KFwiL2RhdGEvc2hhcmVkL2F0bGFzX2NvdW50cmllcy5qc29uXCIpLmpzb24oKTtcbiAgY29uc3QgZmlsdGVyZWRDb3VudHJpZXMgPSBjb3VudHJ5X2xpc3RcbiAgICAuZmlsdGVyKChjKSA9PiBjLmluY2x1ZGUgJiYgYy5pc28zYyAhPT0gXCJTRE5cIilcbiAgICAubWFwKCh7IGluY2x1ZGUsIC4uLnJlc3QgfSkgPT4gcmVzdCk7XG4gIHJldHVybiBmaWx0ZXJlZENvdW50cmllcztcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YUFkbWluUmVnaW9ucyA9IHtcbiAgY29uc3QgcmVnaW9ucyA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICBTRUxFQ1QgRElTVElOQ1QgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBpc28zXG4gICAgRlJPTSBleHBvc3VyZVxuICAgIFdIRVJFIGFkbWluMV9uYW1lIElTIE5PVCBudWxsXG4gICAgQU5EIGlzbzMgaW4gKCcke3NlbGVjdF9jb3VudHJ5LmpvaW4oXCInLCAnXCIpfScpXG4gIGApXG5cbiAgcmV0dXJuIHJlZ2lvbnMubWFwKHJvdyA9PiAoe1xuICAgIC4uLnJvdyxcbiAgICBpZDogYCR7cm93LmlzbzN9XyR7cm93LmFkbWluMV9uYW1lfWBcbiAgfSkpO1xufVxuXG4vL1RPRE86IE5lZWQgdG8gYWRkIHRyYW5zbGF0aW9ucyBhbmQgbGFiZWwgY2xlYW5pbmcgdG8gaXRlbXNcbmRhdGFDcm9wcyA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgU0VMRUNUIERJU1RJTkNUIGNyb3AgQVMgaXRlbVxuICBGUk9NIGV4cG9zdXJlXG4gIE9SREVSIEJZIGl0ZW1cbmApXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gRGVmYXVsdHMgYW5kIGdhdXJkIHJhaWxzIGZvciB0aGUgaW5wdXRzXG5pbnB1dE9wdGlvbnNfcHJvamVjdENvc3QgPSB7XG4gIHJldHVybiB7XG4gICAgcmFuZ2U6IFsxZTYsIDVlOF0sXG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmlucHV0cy5jb3N0SW5wdXQubGFiZWwpLFxuICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmlucHV0cy5jb3N0SW5wdXQudG9vbHRpcCksXG4gICAgc3RlcDogMWU1LFxuICAgIHZhbHVlOiA1MF8wMDBfMDAwLFxuICAgIGZvcm1hdDogZDMuZm9ybWF0KCckLjNzJyksXG4gICAgb3V0cHV0V2lkdGg6IDkwLFxuICAgIHBsYWNlaG9sZGVyOiBcIkV4LiAkNSwwMDAsMDAwXCIsXG4gICAgcGF0dGVybjogXCJeWyRdP1sxLTldK1swLTksJF0qJFwiLFxuICAgIHZhbHVlU3RyaW5nOiBcIiQ1MCwwMDAsMDAwXCJcbiAgfVxufVxuXG5pbnB1dE9wdGlvbnNfcHJvamVjdFllYXJzID0ge1xuICBjb25zdCB5ZWFycyA9IF9sYW5nKFxuICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuY29zdHMuaW5wdXRzLnByb2plY3RZZWFyRHJvcGRvd24udGVybXMueWVhci5wbHVyYWwsXG4gICk7XG4gIHJldHVybiB7XG4gICAgcmFuZ2U6IFsyLCAxNl0sXG4gICAgZGF0YTogZDNcbiAgICAgIC5yYW5nZSgyLCAxNiArIDEsIDEpXG4gICAgICAubWFwKChkKSA9PiAoeyBsYWJlbDogYCR7ZH0gJHt5ZWFyc31gLCB2YWx1ZTogZCB9KSksXG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmlucHV0cy5wcm9qZWN0WWVhckRyb3Bkb3duLmxhYmVsKSxcbiAgICB0b29sdGlwOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5jb3N0cy5pbnB1dHMucHJvamVjdFllYXJEcm9wZG93bi50b29sdGlwKSxcbiAgICBzdGVwOiAxLFxuICAgIHZhbHVlOiA4LFxuICAgIG91dHB1dFdpZHRoOiA5MFxuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzZWxlY3RfY291bnRyeSA9IHtcbiAgY29uc3QgZGF0YSA9IGNvdW50cmllc1xuICAgIC5tYXAoKGQpID0+ICh7XG4gICAgICB2YWx1ZTogZC5pc28zYywgLy9NaWdyYXRpbmcgdG8gaXNvIGNvZGVzIGZvciBmdXR1cmUgZmxleGFiaWxpdHlcbiAgICAgIGxhYmVsOiBfbGFuZyhkLnRyYW5zbGF0aW9uKVxuICAgIH0pKVxuICBsZXQgaW5wdXQgPSBkcm9wZG93bklucHV0KHtcbiAgICBpbnB1dExhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY291bnRyeS5wbHVyYWwpLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5sb2NhdGlvbnMuaW5wdXRzLmNvdW50cnlEcm9wZG93bi50b29sdGlwXG4gICAgICApICAgIFxuICAgIH0pLFxuICAgIGlucHV0SWQ6IFwicG9zaXRpb25zVGVzdFwiLFxuICAgIHBsYWNlaG9sZGVyVGV4dDogXCJTZWxlY3QgQ291bnRyaWVzLi4uXCIsXG4gICAgb3B0aW9uczogZGF0YSxcbiAgICBzZWxlY3RlZDogW1wiS0VOXCIsIFwiVFpBXCJdLFxuICB9KTtcbiAgXG4gIHJldHVybiBkZWJvdW5jZShpbnB1dCwgMTAwMCk7IC8vIE5vaXN5IGlucHV0LCBzbyBkZWxheSBpdCBhIGJpdC5cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBhZG1pbiBtdWx0aS1zZWxlY3Q6IHJlZ2lvbnNcbnZpZXdvZiBzZWxlY3RfcmVnaW9uID0ge1xuICAvLyBmaWx0ZXIgcmVnaW9ucyBiYXNlZCBvbiBjb3VudHJ5IGlkJ3NcbiAgY29uc3QgZmlsdGVyZWRSZWdpb25zID0gZGF0YUFkbWluUmVnaW9uc1xuICAvLyBjb25zdCB0cmFuc2xhdGVDb3VudHJ5ID0gKGQpID0+IF9sYW5nKHRkLmFkbWluMF9uYW1lLnZhbHVlcz8uW2RdKTtcbiAgY29uc3QgdHJhbnNsYXRlQ291bnRyeSA9IChpc28pID0+IF9sYW5nKGNvdW50cmllcy5maW5kKChjKSA9PiBjLmlzbzNjID09PSBpc28pLnRyYW5zbGF0aW9uKTtcbiAgY29uc3QgZGF0YSA9IGZpbHRlcmVkUmVnaW9ucy5tYXAoKGQpID0+ICh7XG4gICAgdmFsdWU6IGQuaWQsXG4gICAgbGFiZWw6IGAke3RyYW5zbGF0ZUNvdW50cnkoZC5pc28zKX06ICR7ZC5hZG1pbjFfbmFtZX1gXG4gIH0pKTtcbiAgY29uc3Qgc2VsZWN0ZWRJZHMgPSBmaWx0ZXJlZFJlZ2lvbnMubWFwKChkKSA9PiBkLmlkKTtcbiAgY29uc3QgdGV4dCA9IHtcbiAgICBsYWJlbDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMucmVnaW9uLnBsdXJhbCksXG4gICAgdG9vbHRpcDogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MubG9jYXRpb25zLmlucHV0cy5yZWdpb25Ecm9wZG93bi50b29sdGlwKSxcbiAgfVxuICBjb25zdCBpbnB1dCA9IGRyb3Bkb3duSW5wdXQoe1xuICAgIGlucHV0TGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe2xhYmVsVGV4dDogdGV4dC5sYWJlbCwgdG9vbHRpcFRleHQ6IHRleHQudG9vbHRpcH0pLFxuICAgIGlucHV0SWQ6IFwicG9zaXRpb25zVGVzdFwiLFxuICAgIHBsYWNlaG9sZGVyVGV4dDogXCJTZWxlY3QgcmVnaW9ucy4uLlwiLFxuICAgIG9wdGlvbnM6IGRhdGEsXG4gICAgc2VsZWN0ZWQ6IHNlbGVjdGVkSWRzXG4gIH0pO1xuXG4gIHJldHVybiBkZWJvdW5jZShpbnB1dCwgMTAwMCk7XG59XG5cbnNlbGVjdF9yZWdpb25cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBhZG1pbiBtdWx0aS1zZWxlY3Q6IGNvdW50cmllc1xudmlld29mIHNlbGVjdF9jcm9wID0ge1xuICBjb25zdCBkYXRhID0gZGF0YUNyb3BzXG4gICAgLm1hcCgoZCkgPT4gKHtcbiAgICAgIHZhbHVlOiBkLml0ZW0sXG4gICAgICBsYWJlbDogTGFuZy50b1NlbnRlbmNlQ2FzZShkLml0ZW0pIC8vVE9ETzogQWRkIHRyYW5zbGF0aW9uc1xuICAgIH0pKVxuICAgIC5zb3J0KChhLGIpID0+IGEubGFiZWwgPiBiLmxhYmVsKTtcbiAgY29uc3Qgc2VsZWN0ZWRJZCA9IGRhdGFDcm9wc1xuICAgIC5maWx0ZXIoKGQpID0+IFtcImJlYW5cIiwgXCJnb2F0c1wiLCBcIm1haXplXCJdLmluY2x1ZGVzKGQuaXRlbSkpXG4gICAgLm1hcCgoZCkgPT4gZC5pdGVtKTtcbiAgY29uc3QgdGV4dCA9IHtcbiAgICBsYWJlbDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY29tbW9kaXR5LnBsdXJhbCksXG4gICAgdG9vbHRpcDogX2xhbmcoXG4gICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5sb2NhdGlvbnMuaW5wdXRzLmNvbW1vZGl0eURyb3Bkb3duLnRvb2x0aXBcbiAgICApXG4gIH07XG4gIGNvbnN0IGlucHV0ID0gZHJvcGRvd25JbnB1dCh7XG4gICAgaW5wdXRMYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IHRleHQubGFiZWwsXG4gICAgICB0b29sdGlwVGV4dDogdGV4dC50b29sdGlwXG4gICAgfSksXG4gICAgaW5wdXRJZDogXCJwb3NpdGlvbnNUZXN0XCIsXG4gICAgcGxhY2Vob2xkZXJUZXh0OiBcIlNlbGVjdCBjcm9wcy4uLlwiLFxuICAgIG9wdGlvbnM6IGRhdGEsXG4gICAgc2VsZWN0ZWQ6IHNlbGVjdGVkSWRcbiAgfSk7XG5cbiAgcmV0dXJuIGRlYm91bmNlKGlucHV0LCAxMDAwKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyYW5nZVByb2plY3RDb3N0ID0ge1xuICBjb25zdCB1bnBhY2sgPSBOdW1iZXIoaW5wdXRQcm9qZWN0T3B0aW9ucy5jb3N0LnJlcGxhY2UoL1ssfCRdL2csIFwiXCIpKVxuICBjb25zdCBudW1iZXIgPSBOdW1iZXIodW5wYWNrKVxuICByZXR1cm4gbnVtYmVyXG59XG5cbnByb2plY3RZZWFycyA9IGlucHV0UHJvamVjdE9wdGlvbnMueWVhcnMudmFsdWVcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZW5kZXJfZWNvblBlcmZXYWxrdGhyb3VnaCA9ICgpID0+IHtcbiAgY29uc3QgdGVybXMgPSB7XG4gICAgbm9uZTogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy50ZXJtcy5ub25lLCB7XG4gICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICB9KSxcbiAgICBsb3c6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMudGVybXMubG93LCB7XG4gICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICB9KSxcbiAgICBtb2RlcmF0ZTogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy50ZXJtcy5tb2RlcmF0ZSwge1xuICAgICAga2V5OiBsYW5ndWFnZS5rZXksXG4gICAgfSksXG4gICAgaGlnaDogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy50ZXJtcy5oaWdoLCB7XG4gICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICB9KSxcbiAgICBpbmNyZW1lbnRhbDogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy50ZXJtcy5pbmNyZW1lbnRhbCksXG4gICAgdHJhbnNmb3JtYXRpdmU6IF9sYW5nKFxuICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy50ZXJtcy50cmFuc2Zvcm1hdGl2ZSxcbiAgICApLFxuICB9O1xuICBjb25zdCBkYXRhUHJvZEltcGFjdCA9IFtcbiAgICB7IGxhYmVsOiBgMTAlICgke3Rlcm1zLmluY3JlbWVudGFsfSlgLCB2YWx1ZTogMC4xIH0sXG4gICAgeyBsYWJlbDogYDIwJWAsIHZhbHVlOiAwLjIgfSxcbiAgICB7IGxhYmVsOiBgMzAlICgke3Rlcm1zLm1vZGVyYXRlfSlgLCB2YWx1ZTogMC4zIH0sXG4gICAgeyBsYWJlbDogYDQwJWAsIHZhbHVlOiAwLjQgfSxcbiAgICB7IGxhYmVsOiBgNTAlICgke3Rlcm1zLnRyYW5zZm9ybWF0aXZlfSlgLCB2YWx1ZTogMC41IH0sXG4gIF07XG4gIGNvbnN0IGlucHV0UHJvZEltcGFjdCA9IElucHV0cy5zZWxlY3QoZGF0YVByb2RJbXBhY3QsIHtcbiAgICBsYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5wcm9kSW1wYWN0RHJvcGRvd24ubGFiZWwsXG4gICAgICApLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5wcm9kSW1wYWN0RHJvcGRvd24udG9vbHRpcCxcbiAgICAgICksXG4gICAgfSksXG4gICAgZm9ybWF0OiAoeCkgPT4geC5sYWJlbCxcbiAgICB2YWx1ZTogZGF0YVByb2RJbXBhY3QuZmluZCgoZCkgPT4gZC52YWx1ZSA9PSAwLjMpLFxuICB9KTtcbiAgY29uc3QgZGF0YUFkb3B0aW9uID0gW1xuICAgIHsgbGFiZWw6IGAwLjUlICgke3Rlcm1zLmxvd30pYCwgdmFsdWU6IDAuMDA1IH0sXG4gICAgeyBsYWJlbDogYDElICgke3Rlcm1zLm1vZGVyYXRlfSlgLCB2YWx1ZTogMC4wMSB9LFxuICAgIHsgbGFiZWw6IGAyJSAoJHt0ZXJtcy5oaWdofSlgLCB2YWx1ZTogMC4wMiB9LFxuICBdO1xuICBjb25zdCBpbnB1dEFkb3B0aW9uID0gSW5wdXRzLnNlbGVjdChkYXRhQWRvcHRpb24sIHtcbiAgICBsYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5hZG9wdGlvblJhdGVEcm9wZG93bi5sYWJlbCxcbiAgICAgICksXG4gICAgICB0b29sdGlwVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLmFkb3B0aW9uUmF0ZURyb3Bkb3duLnRvb2x0aXAsXG4gICAgICApLFxuICAgIH0pLFxuICAgIGZvcm1hdDogKHgpID0+IHgubGFiZWwsXG4gICAgdmFsdWU6IGRhdGFBZG9wdGlvbi5maW5kKChkKSA9PiBkLnZhbHVlID09IDAuMDEpLFxuICB9KTtcbiAgY29uc3QgZGF0YUNpc0ltcGFjdCA9IFtcbiAgICB7IGxhYmVsOiBgMCUgKCR7dGVybXMubm9uZX0pYCwgdmFsdWU6IDAgfSxcbiAgICB7IGxhYmVsOiBgMTAlICgke3Rlcm1zLmxvd30pYCwgdmFsdWU6IDAuMSB9LFxuICAgIHsgbGFiZWw6IGAyNSUgKCR7dGVybXMubW9kZXJhdGV9KWAsIHZhbHVlOiAwLjI1IH0sXG4gICAgeyBsYWJlbDogYDUwJSAoJHt0ZXJtcy5oaWdofSlgLCB2YWx1ZTogMC41IH0sXG4gIF07XG4gIGNvbnN0IGlucHV0Q2lzSW1wYWN0ID0gSW5wdXRzLnNlbGVjdChkYXRhQ2lzSW1wYWN0LCB7XG4gICAgbGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuY2lzSW1wYWN0RHJvcGRvd24ubGFiZWwsXG4gICAgICApLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5jaXNJbXBhY3REcm9wZG93bi50b29sdGlwLFxuICAgICAgKSxcbiAgICB9KSxcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsLFxuICAgIHZhbHVlOiBkYXRhQ2lzSW1wYWN0LmZpbmQoKGQpID0+IGQudmFsdWUgPT0gMC4yNSksXG4gIH0pO1xuICByZXR1cm4gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgaW5wdXRQcm9kSW1wYWN0LFxuICAgICAgaW5wdXRBZG9wdGlvbixcbiAgICAgIGlucHV0Q2lzSW1wYWN0LFxuICAgIH0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IChpbnB1dHMpID0+XG4gICAgICAgIGh0bC5odG1sYDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBnYXA6IDNlbVwiPiR7T2JqZWN0LnZhbHVlcyhcbiAgICAgICAgICBpbnB1dHMsXG4gICAgICAgICl9PC9kaXY+YCxcbiAgICB9LFxuICApO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgZGlzY291bnRSYXRlID0gSW5wdXRzLnJhbmdlKFswLCAxXSx7c3RlcDogMC4wMSwgZm9ybWF0OiB4ID0+ICh4ICogMTAwKSwgbGFiZWwgOiBcIkRpc2NvdW50IFJhdGVcIiwgdmFsdWU6IDAuMTJ9ICkgLy8gMC0xIGFzIGEgcGN0XG52aWV3b2YgYmNyID0gSW5wdXRzLnJhbmdlKFswLjUsIDJdLCB7c3RlcDogMC4wMSwgbGFiZWw6IFwiQkNSXCIsIHZhbHVlOiAxLjYyfSApXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gUGxvdCBWYXJpYWJsZVxuLy8gYmFzZSBzZWxlY3RvciBmb3IgbWV0cmljIHR5cGVcbnZpZXdvZiBwaWNrTWV0cmljV2Fsa3Rocm91Z2ggPSB7XG4gIHJldHVybiBJbnB1dHMuc2VsZWN0KGRhdGFQaWNrTWV0cmljLCB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmdlbmVyYWwudGVybXMuaW5kaWNhdG9yKSxcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsRnVsbCxcbiAgICB2YWx1ZTogZGF0YVBpY2tNZXRyaWMuZmluZCgoZCkgPT4gZC5rZXkgPT0gXCJpcnJcIilcbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW1wb3J0IHsgZHJvcGRvd25JbnB1dCwgZHJvcGRvd25DU1MgfSBmcm9tIFwiL2hlbHBlcnMvdWlDb21wb25lbnRzLm9qc1wiO1xuXG5kcm9wZG93bkNTUztcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBGb3JtYXR0aW5nXG5mdW5jdGlvbiBmb3JtYXRVU0QoeyBsb2NhbGUgPSBcImVuLVVTXCIgfSA9IHt9KSB7XG4gIGNvbnN0IGZvcm1hdHRlciA9IGZvcm1hdE51bUNvbXBhY3RTaG9ydCh7IGxvY2FsZSB9KTtcblxuICByZXR1cm4gKG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGZvcm1hdHRlZE51bSA9IGZvcm1hdHRlcihudW1iZXIpO1xuICAgIHJldHVybiBcIiRcIiArIGZvcm1hdHRlZE51bTtcbiAgfTtcbn1cblxuLy8gZm9ybWF0IG51bWJlciwgc2hvcnQgbm90YXRpb25cbmZvcm1hdE51bUNvbXBhY3RTaG9ydCA9ICh7IGxvY2FsZSA9IFwiZW4tVVNcIiB9ID0ge30pID0+XG4gIG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUsIHtcbiAgICBub3RhdGlvbjogXCJjb21wYWN0XCIsXG4gICAgY29tcGFjdERpc3BsYXk6IFwic2hvcnRcIixcbiAgfSkuZm9ybWF0O1xuXG5mdW5jdGlvbiBmb3JtYXRDdXJyZW5jeUF1dG8odmFsdWUsIHByZWNpc2lvbiA9IDEpIHtcbiAgY29uc3QgYWJzVmFsID0gTWF0aC5hYnModmFsdWUpO1xuXG4gIGlmIChhYnNWYWwgPj0gMWU5KSB7XG4gICAgcmV0dXJuIGAkJHsodmFsdWUgLyAxZTkpLnRvRml4ZWQocHJlY2lzaW9uKX1CYDtcbiAgfSBlbHNlIGlmIChhYnNWYWwgPj0gMWU2KSB7XG4gICAgcmV0dXJuIGAkJHsodmFsdWUgLyAxZTYpLnRvRml4ZWQocHJlY2lzaW9uKX1NYDtcbiAgfSBlbHNlIGlmIChhYnNWYWwgPj0gMWUzKSB7XG4gICAgcmV0dXJuIGAkJHsodmFsdWUgLyAxZTMpLnRvRml4ZWQocHJlY2lzaW9uKX1LYDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYCQke3ZhbHVlLnRvRml4ZWQoMSl9YDtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRlYm91bmNlID0gKGlucHV0LCBkZWxheSA9IDUwMCkgPT4ge1xuICBjbGFzcyBEZWxheWVkRXZlbnQgZXh0ZW5kcyBFdmVudCB7fVxuICBsZXQgaWQ7XG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZSkgPT4ge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRGVsYXllZEV2ZW50KSByZXR1cm47XG4gICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICBjbGVhclRpbWVvdXQoaWQpO1xuICAgIGlkID0gc2V0VGltZW91dChcbiAgICAgICgpID0+IGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IERlbGF5ZWRFdmVudChcImlucHV0XCIsIHsgYnViYmxlczogdHJ1ZSB9KSksXG4gICAgICBkZWxheSxcbiAgICApO1xuICB9KTtcbiAgcmV0dXJuIGlucHV0O1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBUaGlzIGNlbGwgaXMgdG8gY29udGFpbiBhbGwgdGhlIGhlYWRpbmdzIGFuZCB0aGUgbm90ZWJvb2sgdGl0bGVcbm5iVGl0bGUgPSBfbGFuZyh7XG4gIGVuOiBcIkVzdGltYXRlIEVjb25vbWljIFJldHVybnMgb24gQWRhcHRhdGlvblwiLFxuICBmcjogXCJFc3RpbWVyIGxlcyByZXRvdXJzIHN1ciDDqWNvbm9taXF1ZXMgbCdhZGFwdGF0aW9uXCIsXG59KTtcbi8vIGtleV9pbnNpZ2h0cyA9IF9sYW5nKHtlbjogXCJLZXkgSW5zaWdodHNcIiwgZnI6IFwiUsOpc3Vtw6lcIn0pXG5uYk92ZXJ2aWV3ID0gX2xhbmcoeyBlbjogXCJPdmVydmlld1wiLCBmcjogXCJWdWUgZOKAmUVuc2VtYmxlXCIgfSk7XG5oZWFkaW5nMSA9IF9sYW5nKHsgZW46IFwiUHJvamVjdCBTZXQtVXBcIiwgZnI6IFwiQ29uZmlndXJhdGlvbiBkZSBQcm9qZWN0XCIgfSk7XG5oZWFkaW5nMiA9IF9sYW5nKHsgZW46IFwiSW52ZXN0bWVudCBSZXR1cm5zXCIsIGZyOiBcIlJldG91cnMgZCdJbnZlc3Rpc3NlbWVudHNcIiB9KTtcbm5iU3VtbWFyeSA9IF9sYW5nKHsgZW46IFwiU3VtbWFyeVwiLCBmcjogXCJSw6lzdW3DqVwiIH0pO1xubmJNZXRob2RzID0gX2xhbmcoeyBlbjogXCJNZXRob2RzICYgU291cmNlc1wiLCBmcjogXCJNw6l0aG9kZXMgJiBTb3VyY2VzXCIgfSk7XG5hcHBlbmRpeCA9IF9sYW5nKGdlbmVyYWxfdHJhbnNsYXRpb25zLmFwcGVuZGl4KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbXBvcnQgeyBsYW5nIGFzIExhbmcgfSBmcm9tIFwiL2hlbHBlcnMvbGFuZy5qc1wiXG5cbmdlbmVyYWxfdHJhbnNsYXRpb25zID0gYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9zaGFyZWQvZ2VuZXJhbFRyYW5zbGF0aW9ucy5qc29uXCIpLmpzb24oKVxuXG5uYlRleHQgPSBhd2FpdCBGaWxlQXR0YWNobWVudChcIi9kYXRhL2Vjb25vbWljUmV0dXJucy90cmFuc2xhdGlvbnMuanNvblwiKS5qc29uKClcblxubGFuZ3VhZ2VzID0gW1xuICB7IGtleTogXCJlblwiLCBsYWJlbDogXCJFbmdsaXNoXCIsIGxvY2FsZTogJ2VuLVVTJyB9LFxuICB7IGtleTogXCJmclwiLCBsYWJlbDogXCJGcmFuw6dhaXNcIiwgbG9jYWxlOiAnZnItRlInIH1cbl1cblxuZGVmYXVsdExhbmdLZXkgPSB7XG4gIGNvbnN0IG5hbWUgPSBcImxhbmdcIjtcbiAgY29uc3QgbGlzdCA9IGxhbmd1YWdlcy5tYXAoKGQpID0+IGQua2V5KTtcbiAgY29uc3QgZGVmYXVsdEtleSA9IFwiZW5cIjtcbiAgY29uc3QgcXVlcnlQYXJhbSA9IGF3YWl0IExhbmcuZ2V0UGFyYW1Gcm9tTGlzdCh7IG5hbWUsIGxpc3QgfSk7XG4gIHJldHVybiBxdWVyeVBhcmFtID8/IGRlZmF1bHRLZXk7XG59XG5cbl9sYW5nID0gTGFuZy5sZyhtYXN0ZXJMYW5ndWFnZS5rZXkpXG5cbnZpZXdvZiBtYXN0ZXJMYW5ndWFnZSA9IElucHV0cy5yYWRpbyhsYW5ndWFnZXMsIHtcbiAgbGFiZWw6IFwiTWFpbiBsYW5ndWFnZSB0b2dnbGVcIixcbiAgZm9ybWF0OiAoZCkgPT4gZC5rZXksXG4gIHZhbHVlOiBsYW5ndWFnZXMuZmluZCgoeCkgPT4geC5rZXkgPT09IGRlZmF1bHRMYW5nS2V5KSxcbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gTmF2YmFyTGFuZ1NlbGVjdG9yKGxhbmd1YWdlX29iaiwgbWFzdGVyTGFuZ3VhZ2UpIHtcbiAgbGV0IG5hdkVuZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubmF2YmFyLW5hdi5tcy1hdXRvIC5uYXYtaXRlbS5jb21wYWN0XCIpO1xuICBpZiAobmF2RW5kKSB7XG4gICAgbGV0IGV4aXN0aW5nTGFuZ1NlbGVjdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuYXYtbGFuZy1zZWxlY3RvclwiKTtcbiAgICBpZiAoIWV4aXN0aW5nTGFuZ1NlbGVjdG9yKSB7XG4gICAgICBsZXQgbGFuZ19zZWwgPSBJbnB1dHMuYmluZChcbiAgICAgICAgSW5wdXRzLnJhZGlvKGxhbmd1YWdlX29iaiwge1xuICAgICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICAgIGZvcm1hdDogKGQpID0+IGQubGFiZWxcbiAgICAgICAgfSksXG4gICAgICAgIHZpZXdvZiBtYXN0ZXJMYW5ndWFnZVxuICAgICAgKTtcbiAgICAgIGxhbmdfc2VsLmlkID0gXCJuYXYtbGFuZy1zZWxlY3RvclwiO1xuICAgICAgXG4gICAgICAvLyBIYWNrIHRoZSBjc3MgdG9nZXRoZXIgZm9yIHRoZSBvYnNlcnZhYmxlIGlucHV0c1xuICAgICAgbGFuZ19zZWwuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgbGFuZ19zZWwuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgICBsYW5nX3NlbC5zdHlsZS5tYXJnaW5MZWZ0ID0gXCIxMHB4XCI7XG4gICAgICBsZXQgbGFuZ19kaXYgPSBsYW5nX3NlbC5xdWVyeVNlbGVjdG9yKFwiZGl2XCIpO1xuICAgICAgbGFuZ19kaXYuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgbGFuZ19kaXYuc3R5bGUuZmxleERpcmVjdGlvbiA9IFwiY29sdW1uXCI7XG5cbiAgICAgIC8vIEluc2VydCB0aGUgbmV3IGl0ZW0gYWZ0ZXIgdGhlIEdpdEh1YiBpY29uIGFuZCBvdGhlciBlbGVtZW50c1xuICAgICAgbmF2RW5kLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobGFuZ19zZWwpO1xuICAgIH1cbiAgfVxufVxuXG5OYXZiYXJMYW5nU2VsZWN0b3IobGFuZ3VhZ2VzLCBtYXN0ZXJMYW5ndWFnZSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwcmV0dHlMYW5ndWFnZVZpZXcgPSB7XG4gIHJldHVybiBJbnB1dHMuYmluZChcbiAgICBJbnB1dHMucmFkaW8obGFuZ3VhZ2VzLCB7XG4gICAgICBsYWJlbDogX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMubGFuZ3VhZ2UpLFxuICAgICAgZm9ybWF0OiAoZCkgPT4gZC5sYWJlbFxuICAgIH0pLFxuICAgIHZpZXdvZiBtYXN0ZXJMYW5ndWFnZVxuICApO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFQaWNrTWV0cmljID0ge1xuICByZXR1cm4gW1xuICAgIHtcbiAgICAgIGtleTogXCJpcnJcIixcbiAgICAgIGNvbHVtbk5hbWU6IFwiaXJyXCIsXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLmxhYmVsKSxcbiAgICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmlyci50b29sdGlwKSxcbiAgICAgIGxhYmVsTG9uZzogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLmxhYmVsTG9uZyksXG4gICAgICBsYWJlbEZ1bGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmlyci5sYWJlbEZ1bGwpLFxuICAgICAgaW5mbzoge1xuICAgICAgICB3aGF0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIuaW5mby53aGF0KSxcbiAgICAgICAgaW50ZXJwcmV0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIuaW5mby5pbnRlcnByZXQpLFxuICAgICAgICB0ZWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIuaW5mby50ZWxsKVxuICAgICAgfSxcbiAgICAgIHlGb3JtYXQ6IChkKSA9PiBgJHtkLnRvRml4ZWQoMSl9JWBcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCJtaXJyXCIsXG4gICAgICBjb2x1bW5OYW1lOiBcIm1pcnJcIixcbiAgICAgIGxhYmVsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLmxhYmVsKSxcbiAgICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm1pcnIudG9vbHRpcCksXG4gICAgICBsYWJlbExvbmc6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm1pcnIubGFiZWxMb25nKSxcbiAgICAgIGxhYmVsRnVsbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci5sYWJlbEZ1bGwpLFxuICAgICAgaW5mbzoge1xuICAgICAgICB3aGF0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLmluZm8ud2hhdCksXG4gICAgICAgIGludGVycHJldDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci5pbmZvLmludGVycHJldCksXG4gICAgICAgIHRlbGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm1pcnIuaW5mby50ZWxsKVxuICAgICAgfSxcbiAgICAgIHlGb3JtYXQ6IChkKSA9PiBgJHtkLnRvRml4ZWQoMSl9JWBcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCJucHZcIixcbiAgICAgIGNvbHVtbk5hbWU6IFwibnB2XCIsXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2LmxhYmVsKSxcbiAgICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi50b29sdGlwKSxcbiAgICAgIGxhYmVsTG9uZzogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2LmxhYmVsTG9uZyksXG4gICAgICBsYWJlbEZ1bGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi5sYWJlbEZ1bGwpLFxuICAgICAgaW5mbzoge1xuICAgICAgICB3aGF0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5ucHYuaW5mby53aGF0KSxcbiAgICAgICAgaW50ZXJwcmV0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5ucHYuaW5mby5pbnRlcnByZXQpLFxuICAgICAgICB0ZWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5ucHYuaW5mby50ZWxsKVxuICAgICAgfSxcbiAgICAgICB5Rm9ybWF0OiAoZCkgPT4gZm9ybWF0Q3VycmVuY3lBdXRvKGQsIDEpXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6IFwiYmNyXCIsXG4gICAgICBjb2x1bW5OYW1lOiBcImRpc2NvdW50ZWRfYmNyXCIsXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLmxhYmVsKSxcbiAgICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmJjci50b29sdGlwKSxcbiAgICAgIGxhYmVsTG9uZzogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLmxhYmVsTG9uZyksXG4gICAgICBsYWJlbEZ1bGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmJjci5sYWJlbEZ1bGwpLFxuICAgICAgaW5mbzoge1xuICAgICAgICB3aGF0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IuaW5mby53aGF0KSxcbiAgICAgICAgaW50ZXJwcmV0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IuaW5mby5pbnRlcnByZXQpLFxuICAgICAgICB0ZWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IuaW5mby50ZWxsKVxuICAgICAgfSxcbiAgICAgIHlGb3JtYXQ6IGQzLmZvcm1hdChcIi4yZlwiKVxuICAgIH1cbiAgXTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZW5kZXJSZXZpZXcxID0gKCkgPT4ge1xuICBjb25zdCBsYW5nQmFzZVBhdGggPSBuYlRleHQuaW52ZXN0bWVudFJldHVybnMuYmxvY2tzLmluc2lnaHRSZXZpZXcuc2V0dXBCbG9jaztcbiAgY29uc3QgbGFuZ01pc3NpbmdUZW1wbGF0ZSA9IF9sYW5nKGxhbmdCYXNlUGF0aC5taXNzaW5nTWVzc2FnZSwge1xuICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICB9KTtcblxuICBjb25zdCBpc29TZXQgPSBuZXcgU2V0KHNlbGVjdF9jb3VudHJ5KTtcblxuICBjb25zdCBhZG1pbjBMaXN0ID0gY291bnRyaWVzXG4gICAgLmZpbHRlcigoZCkgPT4gaXNvU2V0LmhhcyhkLmlzbzNjKSlcbiAgICAubWFwKChkKSA9PiBkLmFkbWluMF9uYW1lKTtcblxuICBjb25zdCBjcm9wTGlzdCA9IHNlbGVjdF9jcm9wO1xuXG4gIC8vIGNvbnN0IGNyb3BMaXN0ID0gYWRtaW5Dcm9wQ2hvaWNlcy5jcm9wcy5zb3J0KChhLGIpID0+IF9sYW5nKGEudHJhbnNsYXRpb24pID4gX2xhbmcoYi50cmFuc2xhdGlvbikpO1xuICBjb25zdCB0cnVuY2F0ZVNpemUgPSAzO1xuICBjb25zdCBhZG1pbjBMaXN0VHJ1bmNhdGVkID0gYWRtaW4wTGlzdC5zbGljZSgwLCB0cnVuY2F0ZVNpemUpO1xuICBjb25zdCBjcm9wTGlzdFRydW5jYXRlZCA9IGNyb3BMaXN0LnNsaWNlKDAsIHRydW5jYXRlU2l6ZSk7IC8vIC5tYXAoKGQpID0+IF9sYW5nKGQudHJhbnNsYXRpb24pKTtcblxuICBpZiAoYWRtaW4wTGlzdC5sZW5ndGggPT0gMCB8fCBjcm9wTGlzdC5sZW5ndGggPT0gMCkge1xuICAgIHJldHVybiBtZGAke2xhbmdNaXNzaW5nVGVtcGxhdGV9YDtcbiAgfVxuXG4gIC8vIG5ldyBjb2RlXG4gIGNvbnN0IGluc2VydENyb3BDb3VudCA9IGNyb3BMaXN0Lmxlbmd0aDtcbiAgY29uc3QgaW5zZXJ0Q3JvcFdvcmQgPVxuICAgIGNyb3BMaXN0Lmxlbmd0aCA9PSAxXG4gICAgICA/IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNyb3Auc2luZ3VsYXIsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSlcbiAgICAgIDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY3JvcC5wbHVyYWwsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSk7XG4gIGNvbnN0IGluc2VydENyb3BMaXN0ID0gYCgqKiR7Y3JvcExpc3RUcnVuY2F0ZWQuam9pbihcIiwgXCIpfSR7XG4gICAgY3JvcExpc3QubGVuZ3RoID4gdHJ1bmNhdGVTaXplID8gXCIuLi5cIiA6IFwiXCJcbiAgfSoqKWA7XG4gIGNvbnN0IGluc2VydENyb3AgPSBgKioke2luc2VydENyb3BDb3VudH0gJHtpbnNlcnRDcm9wV29yZH0qKiAke2luc2VydENyb3BMaXN0fWA7XG5cbiAgY29uc3QgaW5zZXJ0UmVnaW9uQ291bnQgPSBzZWxlY3RfcmVnaW9uLmxlbmd0aDtcbiAgY29uc3QgaW5zZXJ0UmVnaW9uV29yZCA9XG4gICAgaW5zZXJ0UmVnaW9uQ291bnQgPT0gMVxuICAgICAgPyBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5yZWdpb24uc2luZ3VsYXIsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSlcbiAgICAgIDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMucmVnaW9uLnBsdXJhbCwge1xuICAgICAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgICAgICB9KTtcbiAgY29uc3QgaW5zZXJ0UmVnaW9uID0gYCR7aW5zZXJ0UmVnaW9uQ291bnR9ICR7aW5zZXJ0UmVnaW9uV29yZH1gO1xuXG4gIGNvbnN0IGluc2VydENvdW50cnlDb3VudCA9IGFkbWluMExpc3QubGVuZ3RoO1xuICBjb25zdCBpbnNlcnRDb3VudHJ5V29yZCA9XG4gICAgaW5zZXJ0Q291bnRyeUNvdW50ID09IDFcbiAgICAgID8gX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY291bnRyeS5zaW5ndWxhciwge1xuICAgICAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgICAgICB9KVxuICAgICAgOiBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5jb3VudHJ5LnBsdXJhbCwge1xuICAgICAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgICAgICB9KTtcbiAgY29uc3QgaW5zZXJ0Q291bnRyeUxpc3QgPSBgKCoqJHthZG1pbjBMaXN0VHJ1bmNhdGVkLmpvaW4oXCIsIFwiKX0ke1xuICAgIGluc2VydENvdW50cnlDb3VudCA+IHRydW5jYXRlU2l6ZSA/IFwiLi4uXCIgOiBcIlwiXG4gIH0qKilgO1xuICBjb25zdCBpbnNlcnRDb3VudHJ5ID0gYCoqJHtpbnNlcnRDb3VudHJ5Q291bnR9ICR7aW5zZXJ0Q291bnRyeVdvcmR9KiogJHtpbnNlcnRDb3VudHJ5TGlzdH1gO1xuXG4gIC8vIGluc2VydCB0byB0ZW1wbGF0ZVxuICBjb25zdCBsYW5nVGVtcGxhdGUgPSBfbGFuZyhsYW5nQmFzZVBhdGgudGVtcGxhdGUsIHtcbiAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgfSk7XG4gIGNvbnN0IGxhbmdUZW1wbGF0ZUl0ZW1zID0gW1xuICAgIHsgbmFtZTogXCJjcm9wX3N0cmluZ1wiLCB2YWx1ZTogaW5zZXJ0Q3JvcCB9LFxuICAgIHsgbmFtZTogXCJyZWdpb25fc3RyaW5nXCIsIHZhbHVlOiBpbnNlcnRSZWdpb24gfSxcbiAgICB7IG5hbWU6IFwiY291bnRyeV9zdHJpbmdcIiwgdmFsdWU6IGluc2VydENvdW50cnkgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcImNvc3Rfc3RyaW5nXCIsXG4gICAgICB2YWx1ZTogZm9ybWF0VVNEKHsgbG9jYWxlOiBsYW5ndWFnZS5sb2NhbGUgfSkocmFuZ2VQcm9qZWN0Q29zdCksXG4gICAgfSxcbiAgICB7IG5hbWU6IFwieWVhcl9zdHJpbmdcIiwgdmFsdWU6IHByb2plY3RZZWFycyArIFwiIHllYXJzXCIgfSwgLy9UT0RPOiBhZGQgY29ycmVjdCBcInllYXJzXCIgc3RyaW5nIGF0IGVuZCBvZiB0aGlzXG4gIF07XG4gIGNvbnN0IHNlbGVjdGlvbkZvcm1hdHRlZFRlbXBsYXRlID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBsYW5nVGVtcGxhdGUsXG4gICAgbGFuZ1RlbXBsYXRlSXRlbXMsXG4gICk7XG5cbiAgcmV0dXJuIG1kYCR7c2VsZWN0aW9uRm9ybWF0dGVkVGVtcGxhdGV9YDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVuZGVyUmV2aWV3MiA9ICgpID0+IHtcbiAgY29uc3QgaW52ZXN0bWVudFRlbXBsYXRlID0gX2xhbmcoXG4gICAgbmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5pbnNpZ2h0UmV2aWV3LmluZGljYXRvckJsb2NrLFxuICApO1xuICBjb25zdCBpbnZlc3RtZW50VGVtcGxhdGVJdGVtcyA9IFtcbiAgICB7XG4gICAgICBuYW1lOiBcInByb2RfaW1wYWN0X2xhYmVsXCIsXG4gICAgICB2YWx1ZTogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0UHJvZEltcGFjdC5sYWJlbCxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiYWRvcHRpb25fcmF0ZV9sYWJlbFwiLFxuICAgICAgdmFsdWU6IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dEFkb3B0aW9uLmxhYmVsLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJjaXNfaW1wYWN0X2xhYmVsXCIsXG4gICAgICB2YWx1ZTogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0Q2lzSW1wYWN0LmxhYmVsLFxuICAgIH0sXG4gICAgeyBuYW1lOiBcInllYXJfc3RyaW5nXCIsIHZhbHVlOiBwcm9qZWN0WWVhcnMgKyBcIiB5ZWFyc1wiIH0sXG4gIF07XG5cbiAgcmV0dXJuIG1kYCR7TGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhpbnZlc3RtZW50VGVtcGxhdGUsIGludmVzdG1lbnRUZW1wbGF0ZUl0ZW1zKX06YDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYmlnTnVtYmVyc1Jlc3VsdHMgPSAoKSA9PiB7XG4gIGNvbnN0IHkgPSBwcm9qZWN0WWVhcnM7XG4gIGNvbnN0IGUgPSB3YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycz8uZW5yaWNoZWQ/LmZpbmQoKGQpID0+IGQueWVhciA9PT0geSk7XG5cbiAgY29uc3QgZGF0YSA9IGRhdGFQaWNrTWV0cmljLm1hcCgoZCkgPT4ge1xuICAgIGxldCB2YWx1ZTtcblxuICAgIGlmIChkLmtleSA9PT0gXCJpcnJcIiAmJiBlPy5pcnIgIT0gbnVsbCkge1xuICAgICAgdmFsdWUgPSBlLmlycjsgLy8gSVJSIGFzIHBlcmNlbnRhZ2VcbiAgICB9IGVsc2UgaWYgKGQua2V5ID09PSBcIm1pcnJcIiAmJiBlPy5taXJyICE9IG51bGwpIHtcbiAgICAgIHZhbHVlID0gZS5taXJyOyAvLyBNSVJSIGFzIHBlcmNlbnRhZ2VcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgZC5rZXkgPT09IFwibnB2XCIgJiZcbiAgICAgIGU/LmRpc2NvdW50ZWRfYmVuZWZpdF9jdW0gIT0gbnVsbCAmJlxuICAgICAgZT8uZGlzY291bnRlZF9jb3N0X2N1bSAhPSBudWxsXG4gICAgKSB7XG4gICAgICB2YWx1ZSA9ICsoZS5kaXNjb3VudGVkX2JlbmVmaXRfY3VtIC0gZS5kaXNjb3VudGVkX2Nvc3RfY3VtKS50b0ZpeGVkKDEpOyAvLyBOUFYsIDEgZHBcbiAgICB9IGVsc2UgaWYgKGQua2V5ID09PSBcImJjclwiKSB7XG4gICAgICB2YWx1ZSA9IGU/LmRpc2NvdW50ZWRfYmNyO1xuICAgIH1cblxuICAgIHJldHVybiB7IC4uLmQsIHZhbHVlIH07XG4gIH0pO1xuXG4gIHJldHVybiBodGwuaHRtbGBcbiAgPHN0eWxlPlxuICAgIC5vdXRlci1kaXYge1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGdhcDogMmVtO1xuICAgIH1cbiAgICAuaW5uZXItZGl2IHtcbiAgICAgIHdpZHRoOiAzMCU7XG4gICAgICBwYWRkaW5nOiA4MHB4IDMwcHg7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCAjZWZlZmVmO1xuICAgIH1cbiAgICAubGFiZWwge1xuICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICBmb250LXdlaWdodDogNDAwO1xuICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTtcbiAgICAgIGNvbG9yOiAjNjY2O1xuICAgIH1cbiAgICAudmFsdWUge1xuICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICBmb250LXNpemU6IDQycHg7IFxuICAgIH1cbiAgICAubmVnYXRpdmUge1xuICAgICAgY29sb3I6ICNFQzVBNDc7XG4gICAgfVxuICAgIC50b29sdGlwLWNhcmQge1xuICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICB9XG4gICAgLnRvb2x0aXAtY2FyZCAudG9vbHRpcHRleHQtY2FyZCB7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgei1pbmRleDogMTtcbiAgICAgICAgdmlzaWJpbGl0eTogaGlkZGVuOyBcbiAgICAgICAgbGVmdDogMDtcbiAgICAgICAgYm90dG9tOiA5MCU7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlZmVmZWY7XG4gICAgICAgIGNvbG9yOiAjMzMzO1xuICAgICAgICBwYWRkaW5nOiAxNHB4IDIwcHg7XG4gICAgICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICAgICAgbGluZS1oZWlnaHQ6IDEuNjtcbiAgICAgICAgdGV4dC1hbGlnbjogbGVmdDtcbiAgICAgICAgb3BhY2l0eTogMDtcbiAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjNzO1xuICAgIH1cbiAgICAudG9vbHRpcC1jYXJkOmhvdmVyIC50b29sdGlwdGV4dC1jYXJkIHtcbiAgICAgICAgdmlzaWJpbGl0eTogdmlzaWJsZTtcbiAgICAgICAgb3BhY2l0eTogMTtcbiAgICAgICAgY3Vyc29yOiBkZWZhdWx0O1xuICAgIH1cbiAgPC9zdHlsZT5cblxuICA8Ym9keT5cbiAgICA8ZGl2IGNsYXNzPVwib3V0ZXItZGl2XCI+XG4gICAgICAke2RhdGEubWFwKFxuICAgICAgICAoZCkgPT4gaHRsLmh0bWxgPGRpdiBjbGFzcz1cImlubmVyLWRpdlwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwidG9vbHRpcC1jYXJkXCI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRvb2x0aXB0ZXh0LWNhcmRcIj4ke2QudG9vbHRpcH08L3NwYW4+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cInZhbHVlICR7ZC52YWx1ZSAhPSBudWxsICYmIGQudmFsdWUgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJcIn1cIj4ke1xuICAgICAgICAgICAgICBkLnZhbHVlICE9IG51bGwgPyBkLnlGb3JtYXQoZC52YWx1ZSkgOiBcIi0tLVwiXG4gICAgICAgICAgICB9PC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPiR7ZC5sYWJlbEZ1bGx9PC9zcGFuPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+YCxcbiAgICAgICl9XG4gICAgPC9kaXY+XG4gIDwvYm9keT5gO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZXN1bHRUYWJsZSA9ICgpID0+IHtcbiAgZnVuY3Rpb24gZm9ybWF0QWJicmV2aWF0ZWROdW1iZXIobnVtKSB7XG4gICAgaWYgKG51bSA9PSBudWxsIHx8IGlzTmFOKG51bSkpIHJldHVybiBcIuKAlFwiO1xuXG4gICAgY29uc3QgYWJzTnVtID0gTWF0aC5hYnMobnVtKTtcbiAgICBpZiAoYWJzTnVtID49IDFlOSkgcmV0dXJuIChudW0gLyAxZTkpLnRvRml4ZWQoMSkgKyBcIkJcIjtcbiAgICBpZiAoYWJzTnVtID49IDFlNikgcmV0dXJuIChudW0gLyAxZTYpLnRvRml4ZWQoMSkgKyBcIk1cIjtcbiAgICBpZiAoYWJzTnVtID49IDFlMykgcmV0dXJuIChudW0gLyAxZTMpLnRvRml4ZWQoMSkgKyBcIktcIjtcbiAgICByZXR1cm4gbnVtLnRvU3RyaW5nKCk7XG4gIH1cbiAgY29uc3Qgc2VsZWN0ZWRZZWFyID0gcHJvamVjdFllYXJzO1xuICBjb25zdCBlbnJpY2hlZCA9ICh3YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycz8uZW5yaWNoZWQgPz8gW10pLmZpbHRlcihcbiAgICAoZCkgPT4gZC55ZWFyIDw9IHNlbGVjdGVkWWVhcixcbiAgKTtcblxuICBjb25zdCBoZWFkZXJOYW1lcyA9IFtcbiAgICBcIlllYXJcIixcbiAgICBcIkJlbmVmaXRcIixcbiAgICBcIkNvc3RcIixcbiAgICBcIkNhc2hmbG93XCIsXG4gICAgXCJEaXNjb3VudGVkIEJlbmVmaXQgKGN1bSlcIixcbiAgICBcIkRpc2NvdW50ZWQgQ29zdCAoY3VtKVwiLFxuICAgIFwiRGlzY291bnRlZCBOUFYgKGN1bSlcIixcbiAgICBcIkRpc2NvdW50ZWQgQkNSXCIsXG4gICAgXCJJUlJcIixcbiAgICBcIk1JUlJcIixcbiAgXTtcblxuICByZXR1cm4gaHRtbGBcbiAgICA8c3R5bGU+XG4gICAgICAuZWNvbi10YWJsZSB7XG4gICAgICAgIGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmO1xuICAgICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlO1xuICAgICAgICBmb250LXNpemU6IDEzLjc1cHg7XG4gICAgICAgIG1hcmdpbi10b3A6IDFlbTtcbiAgICAgICAgbWluLXdpZHRoOiAxMDAlO1xuICAgICAgfVxuICAgICAgLmVjb24tdGFibGUgdGgsIC5lY29uLXRhYmxlIHRkIHtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDtcbiAgICAgICAgcGFkZGluZzogNnB4IDEwcHg7XG4gICAgICAgIHRleHQtYWxpZ246IHJpZ2h0O1xuICAgICAgfVxuICAgICAgLmVjb24tdGFibGUgdGgge1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjRmNGY0O1xuICAgICAgICB3aGl0ZS1zcGFjZTogbm9ybWFsO1xuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICB9XG4gICAgICAuZWNvbi10YWJsZSB0ZC55ZWFyLWNvbCB7XG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICB9XG4gICAgICAuZWNvbi10YWJsZSB0ci5maW5hbC1yb3cgdGQge1xuICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2YxZjFmMTtcbiAgICAgIH1cbiAgICAgIC50YWJsZS1jb250YWluZXIge1xuICAgICAgICBvdmVyZmxvdy14OiBhdXRvO1xuICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgcGFkZGluZy1ib3R0b206IDRweDtcbiAgICAgIH1cbiAgICA8L3N0eWxlPlxuXG4gICAgPGRpdiBjbGFzcz1cInRhYmxlLWNvbnRhaW5lclwiPlxuICAgICAgPHRhYmxlIGNsYXNzPVwiZWNvbi10YWJsZVwiPlxuICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgPHRyPlxuICAgICAgICAgICAgJHtoZWFkZXJOYW1lcy5tYXAoKGgpID0+IGh0bWxgPHRoIHRpdGxlPVwiJHtofVwiPiR7aH08L3RoPmApfVxuICAgICAgICAgIDwvdHI+XG4gICAgICAgIDwvdGhlYWQ+XG4gICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAke2VucmljaGVkLm1hcCgoZCwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXNGaW5hbCA9IGkgPT09IGVucmljaGVkLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICBjb25zdCBucHZfaSA9XG4gICAgICAgICAgICAgIGQuZGlzY291bnRlZF9iZW5lZml0X2N1bSAhPSBudWxsICYmIGQuZGlzY291bnRlZF9jb3N0X2N1bSAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBkLmRpc2NvdW50ZWRfYmVuZWZpdF9jdW0gLSBkLmRpc2NvdW50ZWRfY29zdF9jdW1cbiAgICAgICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgICAgIHJldHVybiBodG1sYDx0ciBjbGFzcz0ke2lzRmluYWwgPyBcImZpbmFsLXJvd1wiIDogXCJcIn0+XG4gICAgICAgICAgICAgIDx0ZCBjbGFzcz1cInllYXItY29sXCI+JHtkLnllYXJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5wcm9qZWN0X2JlbmVmaXQgIT0gbnVsbCA/IGAkJHtNYXRoLnJvdW5kKGQucHJvamVjdF9iZW5lZml0KS50b0xvY2FsZVN0cmluZygpfWAgOiBcIuKAlFwifTwvdGQ+XG4gICAgICAgICAgICAgIDx0ZD4ke2QuY29zdCAhPSBudWxsID8gYCQke01hdGgucm91bmQoZC5jb3N0KS50b0xvY2FsZVN0cmluZygpfWAgOiBcIuKAlFwifTwvdGQ+XG4gICAgICAgICAgICAgIDx0ZD4ke2QuY2FzaGZsb3cgIT0gbnVsbCA/IGAkJHtNYXRoLnJvdW5kKGQuY2FzaGZsb3cpLnRvTG9jYWxlU3RyaW5nKCl9YCA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5kaXNjb3VudGVkX2JlbmVmaXRfY3VtICE9IG51bGwgPyBgJCR7TWF0aC5yb3VuZChkLmRpc2NvdW50ZWRfYmVuZWZpdF9jdW0pLnRvTG9jYWxlU3RyaW5nKCl9YCA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5kaXNjb3VudGVkX2Nvc3RfY3VtICE9IG51bGwgPyBgJCR7TWF0aC5yb3VuZChkLmRpc2NvdW50ZWRfY29zdF9jdW0pLnRvTG9jYWxlU3RyaW5nKCl9YCA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7bnB2X2kgIT0gbnVsbCA/IGAkJHtNYXRoLnJvdW5kKG5wdl9pKS50b0xvY2FsZVN0cmluZygpfWAgOiBcIuKAlFwifTwvdGQ+XG4gICAgICAgICAgICAgIDx0ZD4ke2QuZGlzY291bnRlZF9iY3IgIT0gbnVsbCA/IGQuZGlzY291bnRlZF9iY3IudG9GaXhlZCgyKSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5pcnIgIT0gbnVsbCA/IGAkeyhkLmlycikudG9GaXhlZCgyKX0lYCA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5taXJyICE9IG51bGwgPyBgJHsoZC5taXJyKS50b0ZpeGVkKDIpfSVgIDogXCLigJRcIn08L3RkPlxuICAgICAgICAgICAgPC90cj5gO1xuICAgICAgICAgIH0pfVxuICAgICAgICA8L3Rib2R5PlxuICAgICAgPC90YWJsZT5cbiAgICA8L2Rpdj5cbiAgYDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVzdWx0UGxvdCA9ICgpID0+IHtcbiAgY29uc3QgcHJvamVjdFllYXJDdXRvZmYgPSB3YWxrdGhyb3VnaFNlbGVjdGlvbnMucHJvamVjdF95ZWFycztcbiAgY29uc3Qgc2VsZWN0b3IgPSBwaWNrTWV0cmljV2Fsa3Rocm91Z2g7XG4gIGNvbnN0IHBsb3REYXRhID0gd2Fsa3Rocm91Z2hFY29ub21pY0luZGljYXRvcnM/LmVucmljaGVkID8/IFtdO1xuXG4gIC8vIEFsd2F5cyBpbmNsdWRlIGFsbCB5ZWFycyBmb3IgY29uc2lzdGVudCB4LWF4aXNcbiAgY29uc3QgZnVsbFllYXJzID0gZDMucmFuZ2UoMCwgOSk7IC8vIDAgdG8gOCBpbmNsdXNpdmVcbiAgY29uc3QgY29tcGxldGVQbG90RGF0YSA9IGZ1bGxZZWFycy5tYXAoKHkpID0+IHtcbiAgICBjb25zdCByb3cgPSBwbG90RGF0YS5maW5kKChkKSA9PiBkLnllYXIgPT09IHkpO1xuICAgIHJldHVybiByb3cgPz8geyB5ZWFyOiB5IH07XG4gIH0pO1xuXG4gIGNvbnN0IHJ1bGVZVmFsdWUgPSBzZWxlY3Rvci5rZXkgPT09IFwiYmNyXCIgPyAxIDogMDtcblxuICByZXR1cm4gUGxvdC5wbG90KHtcbiAgICB3aWR0aCxcbiAgICBtYXJnaW5SaWdodDogODAsXG4gICAgaW5zZXQ6IDUsXG4gICAgeDoge1xuICAgICAgbGFiZWw6IF9sYW5nKFxuICAgICAgICBuYlRleHQuaW52ZXN0bWVudFJldHVybnMuYmxvY2tzLmV4cGxvcmVJbmRpY2F0b3JzLnByb2plY3RZZWFyLFxuICAgICAgKSxcbiAgICAgIHRpY2tzOiBmdWxsWWVhcnMsXG4gICAgICB0aWNrRm9ybWF0OiBcImRcIixcbiAgICAgIGxhYmVsQW5jaG9yOiBcImNlbnRlclwiLFxuICAgICAgbGFiZWxBcnJvdzogXCJub25lXCIsXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBsYWJlbDogc2VsZWN0b3IubGFiZWwsXG4gICAgICB0aWNrRm9ybWF0OiBzZWxlY3Rvci55Rm9ybWF0LFxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuYXhpc1koe1xuICAgICAgICBhbmNob3I6IFwicmlnaHRcIixcbiAgICAgICAgbGFiZWw6IHNlbGVjdG9yLmxhYmVsLFxuICAgICAgICB0aWNrRm9ybWF0OiBzZWxlY3Rvci55Rm9ybWF0LFxuICAgICAgICB0aWNrU2l6ZTogMCxcbiAgICAgICAgY29sb3I6IChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGQgPj0gMCA/IFwiYmxhY2tcIiA6IFwiI0VDNUE0N1wiO1xuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgICAvLyBob3Jpem9udGFsIHJlZmVyZW5jZSBsaW5lXG4gICAgICBQbG90LnJ1bGVZKFtydWxlWVZhbHVlXSwge1xuICAgICAgICBzdHJva2U6IFwiIzMzM1wiLFxuICAgICAgICBzdHJva2VEYXNoYXJyYXk6IFszXSxcbiAgICAgIH0pLFxuXG4gICAgICAvLyBsaW5lXG4gICAgICBQbG90LmxpbmUoY29tcGxldGVQbG90RGF0YSwge1xuICAgICAgICB4OiBcInllYXJcIixcbiAgICAgICAgeTogc2VsZWN0b3IuY29sdW1uTmFtZSxcbiAgICAgICAgc3Ryb2tlOiBcIiM0NDRcIixcbiAgICAgICAgc3Ryb2tlT3BhY2l0eTogMC43LFxuICAgICAgICBzdHJva2VXaWR0aDogMixcbiAgICAgICAgdGlwOiB0cnVlLFxuICAgICAgfSksXG5cbiAgICAgIC8vIGRvdHNcbiAgICAgIFBsb3QuZG90KGNvbXBsZXRlUGxvdERhdGEsIHtcbiAgICAgICAgeDogXCJ5ZWFyXCIsXG4gICAgICAgIHk6IHNlbGVjdG9yLmNvbHVtbk5hbWUsXG4gICAgICAgIHI6IDMsXG4gICAgICAgIGZpbGw6IFwiIzQ0NFwiLFxuICAgICAgICBzdHJva2U6IFwiI2ZmZlwiLFxuICAgICAgICBzdHJva2VXaWR0aDogMC41LFxuICAgICAgICB0aXA6IHtcbiAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgIHg6IHRydWUsXG4gICAgICAgICAgICB5OiBzZWxlY3Rvci55Rm9ybWF0LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSxcblxuICAgICAgLy8gaGlnaGxpZ2h0IHNlbGVjdGVkIHllYXJcbiAgICAgIFBsb3QuZG90KFxuICAgICAgICBjb21wbGV0ZVBsb3REYXRhLmZpbHRlcigoZCkgPT4gZC55ZWFyID09PSBwcm9qZWN0WWVhckN1dG9mZiksXG4gICAgICAgIHtcbiAgICAgICAgICB4OiBcInllYXJcIixcbiAgICAgICAgICB5OiBzZWxlY3Rvci5jb2x1bW5OYW1lLFxuICAgICAgICAgIHI6IDcsXG4gICAgICAgICAgZmlsbDogXCIjZmZmXCIsXG4gICAgICAgICAgc3Ryb2tlOiAoZCkgPT4gKGRbc2VsZWN0b3IuY29sdW1uTmFtZV0gPj0gMCA/IFwiIzMzM1wiIDogXCIjRUM1QTQ3XCIpLFxuICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgICB9LFxuICAgICAgKSxcbiAgICBdLFxuICB9KTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWRtaW4wX25hbWVzID0ge1xuICBjb25zdCBpc29TZXQgPSBuZXcgU2V0KHNlbGVjdF9jb3VudHJ5KTtcbiAgcmV0dXJuIGNvdW50cmllc1xuICAuZmlsdGVyKChkKSA9PiBpc29TZXQuaGFzKGQuaXNvM2MpKVxuICAubWFwKChkKSA9PiBkLmFkbWluMF9uYW1lKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBNb2R1bGUgSW1wb3J0cyBmb3IgdGhlIGNhbGN1bGF0aW9uIG9mIFJPSSBkYXRhXG5pbXBvcnQge1xuICBhdmxvc3NDYWxjLFxuICBjYWxjTUlSUixcbiAgY2FsY0lSUixcbiAgbnB2RGlzY3JldGVDdW11bGF0aXZlLFxufSBmcm9tIFwiL25vdGVib29rcy9yb2kvcm9pX3Rvb2xzLmpzXCI7XG5cbmlycm5wdiA9IGltcG9ydChcImh0dHBzOi8vY2RuLnNreXBhY2suZGV2L2lyci1ucHZAMS4wLjE/bWluXCIpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im11dGFibGUgY3ZfcmVzdWx0ID0gW107XG5tdXRhYmxlIGN2X2NhY2hlX2tleSA9ICcnO1xuXG5jYWxjQ1YgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGNpc19pbXBhY3QgPSBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRDaXNJbXBhY3QudmFsdWU7XG5cbiAgY29uc3QgY2FjaGVfa2V5ID0gYCR7Wy4uLmFkbWluMF9uYW1lc10uc29ydCgpLmpvaW4oJywnKX18JHtbLi4uc2VsZWN0X2Nyb3BdLnNvcnQoKS5qb2luKCcsJyl9fCR7Y2lzX2ltcGFjdH1gO1xuXG4gIGlmIChjdl9jYWNoZV9rZXkgPT09IGNhY2hlX2tleSkge1xuICAgIGNvbnNvbGUubG9nKCdTa2lwcGVkIGN2IHJ1biBhcyBpbnB1dHMgdGhlIHNhbWUnKTtcbiAgICByZXR1cm4gY3ZfcmVzdWx0O1xuICB9XG4gIFxuICBjb25zb2xlLmxvZygnUnVubmluZyB0aGUgY3YgYW5hbHlzaXMgYXMgaW5wdXRzIGNoYW5nZWQnKVxuICBjb25zdCBjdl9kYXRhID0gYXdhaXQgZGIucXVlcnkoYFxuICAgIFNFTEVDVCAqXG4gICAgRlJPTSBjdlxuICAgIFdIRVJFIGNyb3AgaW4gKCcke3NlbGVjdF9jcm9wLmpvaW4oXCInLCAnXCIpfScpXG4gICAgQU5EIGFkbWluMF9uYW1lIGluICgnJHthZG1pbjBfbmFtZXMuam9pbihcIicsICdcIil9JykgLS0gVGhpcyBuZWVkcyB0aGUgYTBfbmFtZSByYXRoZXIgdGhhbiBpc28zXG5gKTtcbiAgXG4gIGNvbnN0IGN2X21vbnRlQ2FybG8gPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICBjdl9kYXRhLm1hcChhc3luYyAoeyBjcm9wLCBhZG1pbjBfbmFtZSwgY3YgfSkgPT4ge1xuICAgICAgY29uc3QgYXYgPSBhd2FpdCBhdmxvc3NDYWxjKGN2LCBjaXNfaW1wYWN0KTtcbiAgICAgIGNvbnN0IGF2bG9zcyA9IE1hdGguYWJzKE51bWJlcihhdi50b0ZpeGVkPy4oNCkgPz8gYXYpKTtcbiAgICAgIHJldHVybiB7IGFkbWluMF9uYW1lLCBjcm9wLCBjdiwgY2lzX2ltcGFjdCwgYXZsb3NzIH07XG4gICAgfSksXG4gICk7XG5cbiAgY29uc3QgY3ZfaW5kZXggPSBuZXcgTWFwKCk7XG4gIGZvciAoY29uc3QgeyBhZG1pbjBfbmFtZSwgY3JvcCwgYXZsb3NzIH0gb2YgY3ZfbW9udGVDYXJsbykge1xuICAgIGN2X2luZGV4LnNldChgJHthZG1pbjBfbmFtZX18JHtjcm9wfWAsIGF2bG9zcyk7XG4gIH1cblxuICBtdXRhYmxlIGN2X3Jlc3VsdCA9IGN2X2luZGV4XG4gIG11dGFibGUgY3ZfY2FjaGVfa2V5ID0gY2FjaGVfa2V5XG4gIHJldHVybiBjdl9pbmRleFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGdldEV4cG9zdXJlRGF0YSA9IGFzeW5jIChjcm9wcywgY291bnRyaWVzKSA9PiB7XG4vLyBOT1RFOiBNYWtpbmcgdGhpcyBhIGRhdGFzZXQgcmF0aGVyIHRoYW4gYSBmdW5jdGlvbiBzbyBpdCBvbmx5IHJlLXJ1bnMgd2hlbiBjcm9wIG9yIGNvdW50cnkgY2hhbmdlLlxuLy8gRGVmYXVsdGluZyB0byBhbGwgYWRtaW4gMSBkYXRhIGFzIGFsbCBhZG1pbiByZWdpb25zIGFyZSBzZWxlY3RlZCBieSBkZWZ1YWx0IGFuZCB0aGlzXG4vLyB3aWxsIHByZXZlbnQgaGF2aW5nIHRvIGhhdmUgdXNlcnMgcmUtcXVlcnkgdGhlIGRhdGFzZXRzIHdoZW4gY2hhbmdpbmcgcmVnaW9ucyBpbiBhIGNvdW50eS5cblxuZXhwb3N1cmVfZGF0YSA9IHtcbiAgbGV0IGNyb3BzID0gc2VsZWN0X2Nyb3A7XG4gIGxldCBjb3VudHJpZXMgPSBzZWxlY3RfY291bnRyeTtcbiAgbGV0IGRhdGEgPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgU0VMRUNUICpcbiAgICBGUk9NIGV4cG9zdXJlXG4gICAgV0hFUkUgY3JvcCBpbiAoJyR7Y3JvcHMuam9pbihcIicsICdcIil9JylcbiAgICBBTkQgaXNvMyBpbiAoJyR7Y291bnRyaWVzLmpvaW4oXCInLCAnXCIpfScpXG4gICAgLS0gUE9TU0lCTFkgYWRkIGFkbWluMSBuYW1lIGZpbHRlciwgYnV0IGRlZmF1bHRzIHRvIGZ1bGwgY291bnRyeSwgc28gbWF5YmUgYmlnZ2VyIHF1ZXJ5IGlzIGJldHRlci4gXG4gIGApO1xuICByZXR1cm4gZGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiY3JvcF9hZG9wdGlvbiA9IGFzeW5jICgpID0+IHtcbiAgLy8gR2xvYmFscyBmcm9tIHRoZSBub3RlYm9va1xuICBjb25zdCBhZG9wdGlvbiA9IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dEFkb3B0aW9uLnZhbHVlO1xuICBjb25zdCB5ZWFycyA9IHByb2plY3RZZWFycztcbiAgY29uc3QgcHJvZF9pbXBhY3QgPSBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRQcm9kSW1wYWN0LnZhbHVlO1xuICAvLyBsZXQgZGF0YSA9IGF3YWl0IGdldEV4cG9zdXJlRGF0YShzZWxlY3RfY3JvcCwgc2VsZWN0X2NvdW50cnkpO1xuICBjb25zdCBkYXRhID0gZXhwb3N1cmVfZGF0YTtcbiAgY29uc3QgcmVzdWx0ID0gW107XG5cbiAgZm9yIChjb25zdCByb3cgb2YgZGF0YSkge1xuICAgIGNvbnN0IHZhbHVlID0gcm93LnZhbHVlIHx8IDA7XG4gICAgbGV0IHhQcmV2ID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHllYXJzOyBpKyspIHtcbiAgICAgIC8vIGN1bXVsYXRpdmUgYWRvcHRpb25cbiAgICAgIGxldCB4O1xuICAgICAgaWYgKGkgPT09IDEpIHtcbiAgICAgICAgeCA9IE1hdGgucm91bmQodmFsdWUgKiBhZG9wdGlvbiAqIDEwKSAvIDEwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgeCA9IE1hdGgucm91bmQoKHZhbHVlIC0geFByZXYpICogYWRvcHRpb24gKiAxMCkgLyAxMCArIHhQcmV2O1xuICAgICAgfVxuXG4gICAgICB4UHJldiA9IHg7XG5cbiAgICAgIC8vIHB1c2ggYSBsb25nLWZvcm0gcm93XG4gICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgIGFkbWluMF9uYW1lOiByb3cuYWRtaW4wX25hbWUsXG4gICAgICAgIGFkbWluMV9uYW1lOiByb3cuYWRtaW4xX25hbWUsXG4gICAgICAgIGlzbzNjOiByb3cuaXNvMyxcbiAgICAgICAgY3JvcDogcm93LmNyb3AsXG4gICAgICAgIGV4cG9zdXJlOiByb3cuZXhwb3N1cmUsXG4gICAgICAgIHZhbHVlOiByb3cudmFsdWUsXG4gICAgICAgIGFkb3B0aW9uOiBhZG9wdGlvbixcbiAgICAgICAgcHJvZF9pbXBhY3Q6IHByb2RfaW1wYWN0LFxuICAgICAgICB5ZWFyX2NoYXI6IGB5JHtpfWAsXG4gICAgICAgIHllYXI6IGksXG4gICAgICAgIHJlc3VsdDogeCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQubWFwKChyb3cpID0+IHtcbiAgICBjb25zdCByZXN1bHRfd19pbXBhY3QgPVxuICAgICAgTWF0aC5yb3VuZChyb3cucmVzdWx0ICogKDEgKyAocm93LnByb2RfaW1wYWN0ID8/IDApKSAqIDEwKSAvIDEwO1xuICAgIGNvbnN0IG1hcmdpbmFsX2ltcGFjdCA9XG4gICAgICBNYXRoLnJvdW5kKChyZXN1bHRfd19pbXBhY3QgLSByb3cucmVzdWx0KSAqIDEwKSAvIDEwO1xuICAgIHJldHVybiB7IC4uLnJvdywgcmVzdWx0X3dfaW1wYWN0LCBtYXJnaW5hbF9pbXBhY3QgfTtcbiAgfSk7XG59O1xuXG4vL05PVEU6IFFBUUMgUkVTVUxUUzpcbi8vIDEgcmVnaW9uICYgY3JvcDogUEVSRkVDVCAtIFRoaXMgb3V0cHV0IG1hdGNoZXMgdGhlIFIgc2NyaXB0IG91dHB1dCBleGFjdGx5XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicm9pUmVzdWx0cyA9IGFzeW5jICgpID0+IHtcbiAgY29uc3QgaW5kZXggPSBhd2FpdCBjYWxjQ1YoKTtcbiAgY29uc3QgZGF0YSA9IGF3YWl0IGNyb3BfYWRvcHRpb24oKTtcblxuICBjb25zdCB3aXRoSW1wYWN0ID0gZGF0YS5tYXAoKHJvdykgPT4ge1xuICAgIGNvbnN0IGtleSA9IGAke3Jvdy5hZG1pbjBfbmFtZX18JHtyb3cuY3JvcH1gO1xuICAgIGNvbnN0IGF2bG9zcyA9IGluZGV4LmdldChrZXkpID8/IDA7IC8vIGRlZmF1bHQgdG8gMCBpZiBtaXNzaW5nXG5cbiAgICBjb25zdCByZXN1bHRfd19pbXBhY3RfY2lzID1cbiAgICAgIE1hdGgucm91bmQocm93LnJlc3VsdF93X2ltcGFjdCAqICgxICsgYXZsb3NzKSAqIDEwKSAvIDEwO1xuICAgIGNvbnN0IG1hcmdpbmFsX2NpcyA9XG4gICAgICBNYXRoLnJvdW5kKChyZXN1bHRfd19pbXBhY3RfY2lzIC0gcm93LnJlc3VsdF93X2ltcGFjdCkgKiAxMCkgLyAxMDtcbiAgICBjb25zdCBtYXJnaW5hbF9pbXBhY3RfY2lzID1cbiAgICAgIChtYXJnaW5hbF9jaXMgfHwgMCkgKyAocm93Lm1hcmdpbmFsX2ltcGFjdCB8fCAwKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5yb3csXG4gICAgICBhdmxvc3MsXG4gICAgICByZXN1bHRfd19pbXBhY3RfY2lzLFxuICAgICAgbWFyZ2luYWxfY2lzLFxuICAgICAgbWFyZ2luYWxfaW1wYWN0X2NpcyxcbiAgICB9O1xuICB9KTtcblxuICByZXR1cm4gd2l0aEltcGFjdC5tYXAoKGQpID0+IHtcbiAgICBjb25zdCBwcm9qZWN0X2JlbmVmaXQgPVxuICAgICAgTWF0aC5yb3VuZCgoZC5tYXJnaW5hbF9pbXBhY3RfY2lzIC0gZC5tYXJnaW5hbF9pbXBhY3RfY2lzIC8gYmNyKSAqIDEwKSAvXG4gICAgICAxMDtcbiAgICBjb25zdCBjaXNfaW1wYWN0ID0gb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0Q2lzSW1wYWN0LnZhbHVlO1xuICAgIHJldHVybiB7IC4uLmQsIGJjciwgY2lzX2ltcGFjdCwgcHJvamVjdF9iZW5lZml0IH07XG4gIH0pO1xufTtcblxuLy9OT1RFOiBRQVFDIFJFU1VMVFM6XG4vLyAxIHJlZ2lvbiAmIGNyb3A6IEdvb2QgLSBPdXRwdXQgaXMgY2xvc2UsIHRoZSBNQyBzaW11bGF0aW9uIGdpdmVzIGRpZmZlcmVudCByZXN1bHRzLCBidXQgdGhlIGRpZmZlcmVuY2UgaXMgZmV3ICQxMDAgZWFjaCB0aW1lXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVnaW9uU2V0ID0gbmV3IFNldChzZWxlY3RfcmVnaW9uKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZWNpcGVfZGF0YVN1bW1lZCA9IGFzeW5jICgpID0+IHtcbiAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSBcIndhaXRcIjtcbiAgY29uc3Qgcm9pX2RhdGEgPSBhd2FpdCByb2lSZXN1bHRzKCk7XG5cbiAgLy8gRmlsdGVyIGRvd24gb24gdGhpcyBzdGVwIHRvIHRoZSBzZWxlY3RlZCByZWdpb25zXG4gIGNvbnN0IHJvaV9kYXRhX2ZpbHRlcmVkID0gcm9pX2RhdGEuZmlsdGVyKChkKSA9PlxuICAgIHJlZ2lvblNldC5oYXMoYCR7ZC5pc28zY31fJHtkLmFkbWluMV9uYW1lfWApLFxuICApO1xuXG4gIGNvbnN0IGFnZ3JlZ2F0ZWQgPSBkM1xuICAgIC5mbGF0R3JvdXAoXG4gICAgICByb2lfZGF0YV9maWx0ZXJlZCxcbiAgICAgIChkKSA9PiBkLmFkb3B0aW9uLFxuICAgICAgKGQpID0+IGQucHJvZF9pbXBhY3QsXG4gICAgICAoZCkgPT4gZC5jaXNfaW1wYWN0LFxuICAgICAgKGQpID0+IGQuYmNyLFxuICAgICAgKGQpID0+IGQueWVhcixcbiAgICApXG4gICAgLm1hcCgoW2Fkb3B0aW9uLCBwcm9kX2ltcGFjdCwgY2lzX2ltcGFjdCwgYmNyLCB5ZWFyLCBncm91cF0pID0+ICh7XG4gICAgICBhZG9wdGlvbixcbiAgICAgIHByb2RfaW1wYWN0LFxuICAgICAgY2lzX2ltcGFjdCxcbiAgICAgIGJjcixcbiAgICAgIHllYXIsXG4gICAgICBwcm9qZWN0X2JlbmVmaXQ6IGQzLnN1bShncm91cCwgKGQpID0+IGQucHJvamVjdF9iZW5lZml0KSxcbiAgICB9KSk7XG5cbiAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIjtcbiAgcmV0dXJuIGFnZ3JlZ2F0ZWQ7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlY2lwZV9wYXltZW50U2NoZWR1bGUgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBwcm9qZWN0WWVhcnMgfSkubWFwKChfLCBpKSA9PiB7XG4gIHJldHVybiB7XG4gICAgeWVhcjogaSxcbiAgICBjb3N0OiAoMSAvIHByb2plY3RZZWFycykgKiByYW5nZVByb2plY3RDb3N0LFxuICAgIGNvc3RfY3VtOiAoKGkgKyAxKSAvIHByb2plY3RZZWFycykgKiByYW5nZVByb2plY3RDb3N0LFxuICB9O1xufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVjaXBlX2RhdGFDYXNoZmxvdyA9IHtcbiAgaWYgKCFyYW5nZVByb2plY3RDb3N0IHx8IHJhbmdlUHJvamVjdENvc3QgPT09IDApIHJldHVybiBbXTtcblxuICBjb25zdCBwYXlCeVllYXIgPSBuZXcgTWFwKHJlY2lwZV9wYXltZW50U2NoZWR1bGUubWFwKChkKSA9PiBbZC55ZWFyLCBkXSkpO1xuXG4gIGNvbnN0IGRhdGEgPSBhd2FpdCByZWNpcGVfZGF0YVN1bW1lZCgpO1xuXG4gIHJldHVybiBkM1xuICAgIC5mbGF0R3JvdXAoXG4gICAgICBkYXRhLFxuICAgICAgKGQpID0+IGQuYWRvcHRpb24sXG4gICAgICAoZCkgPT4gZC5wcm9kX2ltcGFjdCxcbiAgICAgIChkKSA9PiBkLmNpc19pbXBhY3QsXG4gICAgICAoZCkgPT4gZC5iY3IsXG4gICAgKVxuICAgIC5mbGF0TWFwKChbYWRvcHRpb24sIHByb2RfaW1wYWN0LCBjaXNfaW1wYWN0LCBiY3IsIHJvd3NdKSA9PiB7XG4gICAgICBjb25zdCBhbGxSb3dzID0gW1xuICAgICAgICAuLi5yb3dzLFxuICAgICAgICB7IGFkb3B0aW9uLCBwcm9kX2ltcGFjdCwgY2lzX2ltcGFjdCwgYmNyLCB5ZWFyOiAwLCBwcm9qZWN0X2JlbmVmaXQ6IDAgfSxcbiAgICAgIF0uc29ydCgoYSwgYikgPT4gYS55ZWFyIC0gYi55ZWFyKTtcblxuICAgICAgcmV0dXJuIGFsbFJvd3MubWFwKChyKSA9PiB7XG4gICAgICAgIGNvbnN0IHBheSA9IHBheUJ5WWVhci5nZXQoci55ZWFyKSB8fCB7fTtcbiAgICAgICAgY29uc3QgY29zdCA9IHBheS5jb3N0ID8/IDA7XG4gICAgICAgIGNvbnN0IGNvc3RfY3VtID0gcGF5LmNvc3RfY3VtID8/IHJhbmdlUHJvamVjdENvc3Q7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4ucixcbiAgICAgICAgICBjb3N0LFxuICAgICAgICAgIGNvc3RfY3VtLFxuICAgICAgICAgIGNhc2hmbG93OiAoci5wcm9qZWN0X2JlbmVmaXQgPz8gMCkgLSBjb3N0LFxuICAgICAgICAgIGRpc2NvdW50X3JhdGU6IGRpc2NvdW50UmF0ZSxcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0pO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ3YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycyA9IHtcbiAgY29uc3Qgc2VsZWN0aW9uID0gd2Fsa3Rocm91Z2hTZWxlY3Rpb25zO1xuXG4gIGNvbnN0IGRhdGEgPSByZWNpcGVfZGF0YUNhc2hmbG93XG5cbiAgY29uc3QgeWVhcnMgPSBkYXRhLm1hcChkID0+IGQueWVhcik7XG4gIGNvbnN0IGJlbmVmaXQgPSBkYXRhLm1hcChkID0+IGQucHJvamVjdF9iZW5lZml0KTtcbiAgY29uc3QgY29zdCA9IGRhdGEubWFwKGQgPT4gZC5jb3N0KTtcbiAgY29uc3QgY2FzaGZsb3cgPSBiZW5lZml0Lm1hcCgoYiwgaSkgPT4gYiAtIGNvc3RbaV0pO1xuICBjb25zdCBkaXNjb3VudFJhdGUgPSBzZWxlY3Rpb24uZGlzY291bnRfcmF0ZTtcblxuICBjb25zdCBucHYgPSBucHZEaXNjcmV0ZUN1bXVsYXRpdmUoY2FzaGZsb3csIGRpc2NvdW50UmF0ZSk7XG4gIGNvbnN0IG5wdl9iZW5lZml0ID0gbnB2RGlzY3JldGVDdW11bGF0aXZlKGJlbmVmaXQsIGRpc2NvdW50UmF0ZSk7XG4gIGNvbnN0IG5wdl9jb3N0ID0gbnB2RGlzY3JldGVDdW11bGF0aXZlKGNvc3QsIGRpc2NvdW50UmF0ZSk7XG4gIGNvbnN0IGRpc2NvdW50ZWRfYmNyID0gbnB2X2JlbmVmaXQubWFwKChiLCBpKSA9PiBucHZfY29zdFtpXSA9PT0gMCA/IG51bGwgOiBiIC8gbnB2X2Nvc3RbaV0pO1xuXG4gIGNvbnN0IHByb2pfaXJyID0gY2FsY0lSUihjYXNoZmxvdyk7XG4gIGNvbnN0IHByb2pfbWlyciA9IGNhbGNNSVJSKGNhc2hmbG93LCBkaXNjb3VudFJhdGUsIGRpc2NvdW50UmF0ZSk7XG4gIGNvbnN0IHByb2pfbnB2ID0gbnB2LmF0KC0xKTtcbiAgY29uc3QgcHJval9iY3IgPSBkaXNjb3VudGVkX2Jjci5hdCgtMSk7XG5cbiAgLy8gPT09IEVucmljaGVkIHRhYmxlXG4gIGNvbnN0IGVucmljaGVkRGF0YSA9IHllYXJzLm1hcCgoeWVhciwgaSkgPT4ge1xuICAgIGNvbnN0IGNhc2hmbG93VG9EYXRlID0gY2FzaGZsb3cuc2xpY2UoMCwgaSArIDEpO1xuICAgIHJldHVybiB7XG4gICAgICB5ZWFyLFxuICAgICAgcHJvamVjdF9iZW5lZml0OiBiZW5lZml0W2ldLFxuICAgICAgY29zdDogY29zdFtpXSxcbiAgICAgIGNhc2hmbG93OiBjYXNoZmxvd1tpXSxcbiAgICAgIGRpc2NvdW50ZWRfYmVuZWZpdF9jdW06IG5wdl9iZW5lZml0W2ldLFxuICAgICAgZGlzY291bnRlZF9jb3N0X2N1bTogbnB2X2Nvc3RbaV0sXG4gICAgICBkaXNjb3VudGVkX2JjcjogZGlzY291bnRlZF9iY3JbaV0sXG4gICAgICBpcnI6IGNhbGNJUlIoY2FzaGZsb3dUb0RhdGUpKjEwMCxcbiAgICAgIG1pcnI6IGNhbGNNSVJSKGNhc2hmbG93VG9EYXRlLCBkaXNjb3VudFJhdGUsIGRpc2NvdW50UmF0ZSkqMTAwLFxuICAgICAgbnB2OiBucHZbaV1cbiAgICB9O1xuICB9KTtcblxuICByZXR1cm4ge1xuICAgIHN1bW1hcnk6IHtcbiAgICAgIHByb2pfbnB2LFxuICAgICAgcHJval9pcnIsXG4gICAgICBwcm9qX21pcnIsXG4gICAgICBwcm9qX2JjclxuICAgIH0sXG4gICAgZW5yaWNoZWQ6IGVucmljaGVkRGF0YVxuICB9O1xufVxuXG53YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycztcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZWNpcGVfZGF0YUZpbmFuY2lhbFZhbHVlcyA9IHJlY2lwZV9kYXRhQ2FzaGZsb3cubWFwKChkLCBpLCBhcnIpID0+IHtcbiAgY29uc3QgY2FzaGZsb3dBcnJheSA9IGFyclxuICAgIC5maWx0ZXIoXG4gICAgICAoeCkgPT5cbiAgICAgICAgeC5hZG9wdGlvbiA9PT0gZC5hZG9wdGlvbiAmJlxuICAgICAgICB4LnByb2RfaW1wYWN0ID09PSBkLnByb2RfaW1wYWN0ICYmXG4gICAgICAgIHguY2lzX2ltcGFjdCA9PT0gZC5jaXNfaW1wYWN0ICYmXG4gICAgICAgIHguYmNyID09PSBkLmJjciAmJlxuICAgICAgICB4LmRpc2NvdW50X3JhdGUgPT09IGQuZGlzY291bnRfcmF0ZSAmJlxuICAgICAgICB4LnllYXIgPD0gZC55ZWFyLFxuICAgIClcbiAgICAubWFwKCh4KSA9PiB4LmNhc2hmbG93KTtcblxuICBjb25zdCBwcm9qX25wdiA9IGlycm5wdi5ucHYoY2FzaGZsb3dBcnJheSwgZC5kaXNjb3VudF9yYXRlKTtcblxuICByZXR1cm4ge1xuICAgIC4uLmQsXG4gICAgY2FzaGZsb3dBcnJheSxcbiAgICBwcm9qX2lycjogaXJybnB2LmlycihjYXNoZmxvd0FycmF5KSxcbiAgICBwcm9qX25wdixcbiAgICBwcm9qX2JjcjogcHJval9ucHYgLyBkLmNvc3RfY3VtLFxuICB9O1xufSk7XG5cbnJlY2lwZV9kYXRhRmluYW5jaWFsVmFsdWVzO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IndhbGt0aHJvdWdoU2VsZWN0aW9ucyA9IHtcbiAgcmV0dXJuIHtcbiAgICBjb3VudHJpZXM6IHNlbGVjdF9jb3VudHJ5LFxuICAgIHJlZ2lvbnM6IHNlbGVjdF9yZWdpb24sXG4gICAgY3JvcHM6IHNlbGVjdF9jcm9wLFxuICAgIHByb2plY3RfeWVhcnM6IHByb2plY3RZZWFycyxcbiAgICBwcm9qZWN0X2Nvc3Q6IHJhbmdlUHJvamVjdENvc3QsXG4gICAgcHJvZF9pbXBhY3Q6IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dFByb2RJbXBhY3QudmFsdWUsXG4gICAgYWRvcHRpb246IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dEFkb3B0aW9uLnZhbHVlLFxuICAgIGNpc19pbXBhY3Q6IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dENpc0ltcGFjdC52YWx1ZSxcbiAgICBkaXNjb3VudF9yYXRlOiBkaXNjb3VudFJhdGUsXG4gICAgYmNyOiBiY3IsXG4gICAgLy8gdGltZV9ob3Jpem9uOiBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRUaW1lLnZhbHVlLFxuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFByb2plY3RPcHRpb25zJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RfY291bnRyeScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RfcmVnaW9uJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdF9jcm9wJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2Rpc2NvdW50UmF0ZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdiY3InKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncGlja01ldHJpY1dhbGt0aHJvdWdoJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ21hc3Rlckxhbmd1YWdlJykifV19</script><script type="module">"file:"===window.location.protocol&&alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."),window._ojs.paths.runtimeToDoc="../../notebooks/roi",window._ojs.paths.runtimeToRoot="../..",window._ojs.paths.docToRoot="../..",window._ojs.selfContained=!1,window._ojs.runtime.interpretFromScriptTags()</script><script id="quarto-html-after-body" type="application/javascript">window.document.addEventListener("DOMContentLoaded",function(t){const e=t=>{for(const e of t.classList)if(e.startsWith("code-annotation-"))return!0;return!1},n=function(t){const e=t.trigger;e.blur(),e.classList.add("code-copy-button-checked");var n=e.getAttribute("title");let o;e.setAttribute("title","Copied!"),window.bootstrap&&(e.setAttribute("data-bs-toggle","tooltip"),e.setAttribute("data-bs-placement","left"),e.setAttribute("data-bs-title","Copied!"),o=new bootstrap.Tooltip(e,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),o.show()),setTimeout(function(){o&&(o.hide(),e.removeAttribute("data-bs-title"),e.removeAttribute("data-bs-toggle"),e.removeAttribute("data-bs-placement")),e.setAttribute("title",n),e.classList.remove("code-copy-button-checked")},1e3),t.clearSelection()},o=function(t){const n=t.parentElement.cloneNode(!0).querySelector("code");for(const t of n.children)e(t)&&t.remove();return n.innerText};new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:o}).on("success",n),window.document.getElementById("quarto-embedded-source-code-modal")&&new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:o,container:window.document.getElementById("quarto-embedded-source-code-modal")}).on("success",n);for(var i=new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//),a=new RegExp(/^mailto:/),l=new RegExp("https://adaptationatlas.github.io/atlas_notebooks/"),r=t=>l.test(t)||i.test(t)||a.test(t),d=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),c=0;c<d.length;c++){const t=d[c];r(t.href)||void 0!==t.dataset.originalHref&&(t.href=t.dataset.originalHref)}function s(t,e,n,o){const i={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(t){return t.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};e&&(i.content=e),n&&(i.onTrigger=n),o&&(i.onUntrigger=o),window.tippy(t,i)}const u=window.document.querySelectorAll('a[role="doc-noteref"]');for(c=0;c<u.length;c++){const t=u[c];s(t,function(){let e=t.getAttribute("data-footnote-href")||t.getAttribute("href");try{e=new URL(e).hash}catch{}const n=e.replace(/^#\/?/,""),o=window.document.getElementById(n);return o?o.innerHTML:""})}const h=window.document.querySelectorAll("a.quarto-xref"),m=(t,e)=>{const n=t=>{if(t.classList.remove("page-full","page-columns"),t.children)for(const e of t.children)n(e)};if(n(e),null===t||t.startsWith("sec-")){const t=document.createElement("div");if(e.children&&e.children.length>2){t.appendChild(e.children[0].cloneNode(!0));for(let n=1;n<e.children.length;n++){const o=e.children[n];if("P"!==o.tagName||""!==o.innerText){t.appendChild(o.cloneNode(!0));break}}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}{const t=e.querySelector("a.anchorjs-link");return t&&t.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.classList.contains("callout")?e.outerHTML:e.innerHTML}};for(c=0;c<h.length;c++){const t=h[c];s(t,void 0,function(e){e.disable();let n,o=t.getAttribute("href");if(o.startsWith("#"))n=o;else try{n=new URL(o).hash}catch{}if(n){const t=n.replace(/^#\/?/,""),i=window.document.getElementById(t);if(null!==i)try{const n=m(t,i.cloneNode(!0));e.setContent(n)}finally{e.enable(),e.show()}else fetch(o.split("#")[0]).then(t=>t.text()).then(n=>{const o=(new DOMParser).parseFromString(n,"text/html").getElementById(t);if(null!==o){const n=m(t,o);e.setContent(n)}}).finally(()=>{e.enable(),e.show()})}else fetch(o).then(t=>t.text()).then(t=>{const n=(new DOMParser).parseFromString(t,"text/html").querySelector("main.content");if(null!==n){n.children.length>0&&"HEADER"===n.children[0].tagName&&n.children[0].remove();const t=m(null,n);e.setContent(t)}}).finally(()=>{e.enable(),e.show()})},function(t){})}let w;const g=t=>{window.document;const e=t.getAttribute("data-target-cell"),n=t.getAttribute("data-target-annotation"),o=window.document.querySelector('span[data-code-cell="'+e+'"][data-code-annotation="'+n+'"]').getAttribute("data-code-lines").split(",").map(t=>e+"-"+t);let i=null,a=null,l=null;if(o.length>0){const n=window.document.getElementById(o[0]);if(i=n.offsetTop,a=n.offsetHeight,l=n.parentElement.parentElement,o.length>1){const t=window.document.getElementById(o[o.length-1]);a=t.offsetTop+t.offsetHeight-i}if(null!==i&&null!==a&&null!==l){let t=window.document.getElementById("code-annotation-line-highlight");null===t&&(t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight"),t.style.position="absolute",l.appendChild(t)),t.style.top=i-2+"px",t.style.height=a+4+"px",t.style.left=0;let n=window.document.getElementById("code-annotation-line-highlight-gutter");null===n&&(n=window.document.createElement("div"),n.setAttribute("id","code-annotation-line-highlight-gutter"),n.style.position="absolute",window.document.getElementById(e).querySelector(".code-annotation-gutter").appendChild(n)),n.style.top=i-2+"px",n.style.height=a+4+"px"}w=t}},p=()=>{["code-annotation-line-highlight","code-annotation-line-highlight-gutter"].forEach(t=>{const e=window.document.getElementById(t);e&&e.remove()}),w=void 0};window.addEventListener("resize",function(t){let e,n=!1;return(...o)=>{n?(e&&clearTimeout(e),e=setTimeout(()=>{t.apply(this,o),e=n=!1},10)):(t.apply(this,o),n=!0)}}(()=>{elRect=void 0,w&&g(w)}));const f=window.document.querySelectorAll("dt[data-target-cell]");for(const t of f)t.addEventListener("click",t=>{const e=t.target;if(e!==w){p();const t=window.document.querySelector("dt[data-target-cell].code-annotation-active");t&&t.classList.remove("code-annotation-active"),g(e),e.classList.add("code-annotation-active")}else p(),e.classList.remove("code-annotation-active")});const b=t=>{const e=t.parentElement;if(e){const n=e.dataset.cites;return n?{el:t,cites:n.split(" ")}:b(t.parentElement)}};var y=window.document.querySelectorAll('a[role="doc-biblioref"]');for(c=0;c<y.length;c++){const t=y[c],e=b(t);e&&s(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry");var o=window.document.getElementById("ref-"+e);o&&(n.innerHTML=o.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div></body></html>