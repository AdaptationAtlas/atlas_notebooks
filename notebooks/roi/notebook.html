<!doctype html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta charset="utf-8"><meta name="generator" content="quarto-1.8.27"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"><title>Econimic Returns on Investment</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}</style><script src="../../site_libs/quarto-nav/quarto-nav.js"></script><script src="../../site_libs/quarto-nav/headroom.min.js"></script><link href="../../images/atlas-icon.svg" rel="icon" type="image/svg+xml"><script src="../../site_libs/clipboard/clipboard.min.js"></script><script src="../../site_libs/quarto-html/quarto.js" type="module"></script><script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script><script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script><script src="../../site_libs/quarto-html/popper.min.js"></script><script src="../../site_libs/quarto-html/tippy.umd.min.js"></script><link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-4d9afe2b8d18ee9fa5d0d57b5ed4214d.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles"><script src="../../site_libs/bootstrap/bootstrap.min.js"></script><link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet"><link href="../../site_libs/bootstrap/bootstrap-ec9688a8e29083f2dc0d6bac6c46fae3.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light"><link href="../../site_libs/bootstrap/bootstrap-dark-ec9688a8e29083f2dc0d6bac6c46fae3.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light"><link href="../../site_libs/bootstrap/bootstrap-ec9688a8e29083f2dc0d6bac6c46fae3.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet"><link rel="stylesheet" href="../../styles/main.css"></head><body class="nav-fixed fullcontent quarto-light"><div id="quarto-search-results"></div><header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme="dark"><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a href="https://adaptationatlas.cgiar.org" class="navbar-brand navbar-brand-logo"><img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo light-content"> <img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo dark-content"></a></div><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="window.quartoToggleHeadroom&&window.quartoToggleHeadroom()"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item"><a class="nav-link" href="../../docs/doc_index.html"><i class="bi bi-info-circle" role="img" aria-label="More Information"></i> <span class="menu-text">Documentation</span></a></li><li class="nav-item"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks/issues/new"><span class="menu-text">Report an Issue</span></a></li><li class="nav-item compact"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks"><i class="bi bi-github" role="img" aria-label="GitHub"></i> <span class="menu-text"></span></a></li></ul></div><div class="quarto-navbar-tools"></div></div></nav></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="13" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 12"><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  dropdown_section<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  downloadButton<span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  makeTooltipLabel<span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/helpers/uiComponents.ojs"</span><span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { atlasTOC } <span class="im">from</span> <span class="st">"/helpers/toc.ojs"</span><span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { formatUSD<span class="op">,</span> inputTemplate } <span class="im">from</span> <span class="st">"/helpers/std.ojs"</span><span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { heroImage <span class="im">as</span> atlasHero } <span class="im">from</span> <span class="st">"/helpers/hero.js"</span><span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  filterableDataTable <span class="im">as</span> atlasTable<span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  sparkbar<span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/helpers/atlasTable.ojs"</span><span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { renderMarkdownWithSlots } <span class="im">from</span> <span class="st">"/helpers/mdTranslate.ojs"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-6" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="33" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 32"><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span><span class="sc">${</span><span class="fu">atlasHero</span>(nbTitle<span class="op">,</span> <span class="st">"./../../images/notebooks/roi.webp"</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="35" data-source-offset="-67"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 34"><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="fu">atlasTOC</span>({</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="dt">skip</span><span class="op">:</span> [<span class="st">"notebook-title"</span><span class="op">,</span> <span class="st">"appendix"</span><span class="op">,</span> <span class="st">"source-code"</span>]<span class="op">,</span> <span class="co">// These should be the section headings in the {# headings}</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">heading</span><span class="op">:</span> <span class="vs">`&lt;b&gt;</span><span class="sc">${</span>Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(<span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">toc</span>))<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">,</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-2" data-nodetype="expression"></div></div></div></div><section id="overview" class="level1"><h1><span><span id="ojs-element-id-1"></span></span></h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="46" data-source-offset="-29"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 45"><span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="48" data-source-offset="-75"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 47"><span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block2</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-2" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="50" data-source-offset="-121"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 49"><span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="fu">dropdown_section</span>(</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Definitions"</span><span class="op">,</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">false</span><span class="op">,</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-3" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="62" data-source-offset="-365"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 61"><span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block3</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-4" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="64" data-source-offset="-411"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 63"><span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block4</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-5" data-nodetype="expression"></div></div></div></div></section><section id="project-setup" class="level1"><h1><span><span id="ojs-element-id-2"></span></span></h1><p><span><span id="ojs-element-id-3"></span></span></p><p><span><span id="ojs-element-id-4"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="74" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 73"><span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div style="display: flex; gap: 3em; margin-bottom: 1.5em;"&gt;</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_country<span class="sc">}</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_region<span class="sc">}</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_crop<span class="sc">}</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-4-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="82" data-source-offset="-166"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 81"><span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>viewof productionView <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"plot"</span><span class="op">,</span> <span class="st">"table"</span>]<span class="op">,</span> {</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">"table"</span><span class="op">,</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">vizType</span><span class="op">.</span><span class="at">title</span>)<span class="op">,</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">vizType</span><span class="op">?.</span>[d])<span class="op">,</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-4-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="90" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 89"><span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (productionView <span class="op">==</span> <span class="st">"table"</span>) {</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a0_clean <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">country</span>)<span class="op">;</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a1_clean <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">region</span>)<span class="op">;</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> commodity_clean <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">commodity</span>)<span class="op">;</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxVal <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(exposure_data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">atlasTable</span>(exposure_data<span class="op">,</span> {</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columns</span><span class="op">:</span> [<span class="st">"admin0_name"</span><span class="op">,</span> <span class="st">"admin1_name"</span><span class="op">,</span> <span class="st">"crop"</span><span class="op">,</span> <span class="st">"value"</span>]<span class="op">,</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>      <span class="dt">header</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">"USD"</span><span class="op">,</span> <span class="dt">crop</span><span class="op">:</span> commodity_clean<span class="op">,</span> <span class="dt">admin0_name</span><span class="op">:</span> a0_clean<span class="op">,</span> <span class="dt">admin1_name</span><span class="op">:</span> a1_clean}<span class="op">,</span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sort</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>      <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">sparkbar</span>({</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>          <span class="dt">max</span><span class="op">:</span> maxVal<span class="op">,</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>          <span class="dt">align</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>          <span class="dt">background</span><span class="op">:</span> <span class="st">"#D9ECD9"</span><span class="op">,</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>          <span class="dt">color</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>          <span class="dt">formatter</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>()(d)<span class="op">,</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">renderProductionBars</span>()</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-5-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="116" data-source-offset="-792"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 115"><span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>renderProductionBars <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> exposure_data</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>    regionSet<span class="op">.</span><span class="fu">has</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">iso3</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totals <span class="op">=</span> d3<span class="op">.</span><span class="fu">rollup</span>(</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>    data<span class="op">,</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>    v <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">sum</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span><span class="op">,</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">crop</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> flatTotals <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(totals<span class="op">,</span> ([admin0_name<span class="op">,</span> crops]) <span class="kw">=&gt;</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(crops<span class="op">,</span> ([crop<span class="op">,</span> value]) <span class="kw">=&gt;</span> ({ admin0_name<span class="op">,</span> crop<span class="op">,</span> value }))</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>  )<span class="op">.</span><span class="fu">flat</span>()<span class="op">;</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _title <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>    <span class="dt">en</span><span class="op">:</span> <span class="st">"Total VoP for selected regions and crops in each country"</span><span class="op">,</span></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fr</span><span class="op">:</span> <span class="st">"Total VoP pour les régions et les cultures sélectionnées dans chaque pays"</span></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>    <span class="dt">subtitle</span><span class="op">:</span> _title<span class="op">,</span></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">tickFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">`</span> }<span class="op">,</span></span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">tickFormat</span><span class="op">:</span>(d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>()(d) }<span class="op">,</span></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>({<span class="dt">en</span><span class="op">:</span> <span class="st">"Commodity"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Culture"</span>})<span class="op">,</span></span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barY</span>(flatTotals<span class="op">,</span> {</span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-5-2" data-nodetype="declaration"></div></div></div></div><section id="langnbtext.projectsetup.blocks.costs.h2" class="level2"><h2 data-anchor-id="langnbtext.projectsetup.blocks.costs.h2"><span><span id="ojs-element-id-5"></span></span></h2><p><span><span id="ojs-element-id-6"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="165" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 164"><span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a>viewof inputProjectOptions <span class="op">=</span> {</span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProjectCost <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">text</span>({</span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pattern</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">pattern</span><span class="op">,</span></span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">placeholder</span><span class="op">,</span></span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">valueString</span></span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProjectYears <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(inputOptions_projectYears<span class="op">.</span><span class="at">data</span><span class="op">,</span> {</span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="dv">8</span>)</span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cost</span><span class="op">:</span> inputProjectCost<span class="op">,</span></span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a>      <span class="dt">years</span><span class="op">:</span>inputProjectYears</span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-6" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="197" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 196"><span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">calloutTemplate</span>)</span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> templateItems <span class="op">=</span> [</span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"money"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatUSD</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(rangeProjectCost)}<span class="op">,</span></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> inputProjectOptions<span class="op">.</span><span class="at">years</span><span class="op">.</span><span class="at">label</span>}<span class="op">,</span></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> templateItems)</span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>formatted<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-7" data-nodetype="expression"></div></div></div></section><section id="langnbtext.projectsetup.blocks.impacts.h2" class="level2"><h2 data-anchor-id="langnbtext.projectsetup.blocks.impacts.h2"><span><span id="ojs-element-id-7"></span></span></h2><p><span><span id="ojs-element-id-8"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="214" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 213"><span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a>viewof selections_econPerfWalkthrough <span class="op">=</span> {</span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_prodImpact <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_Adoption <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_CisImpact <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProdImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">55</span>]<span class="op">,</span></span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_prodImpact<span class="op">,</span></span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">30</span></span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputAdoption <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.25</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="fl">0.25</span><span class="op">,</span></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_Adoption<span class="op">,</span></span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputCisImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">55</span>]<span class="op">,</span></span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_CisImpact<span class="op">,</span></span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">25</span></span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a>      inputProdImpact<span class="op">,</span></span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a>      inputAdoption<span class="op">,</span></span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a>      inputCisImpact</span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a>options_econPerfWalkthrough <span class="op">=</span> {</span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> [key<span class="op">,</span> value] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(selections_econPerfWalkthrough)) {</span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a>    formatted[key] <span class="op">=</span> {</span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>value<span class="sc">}</span><span class="vs">%`</span><span class="op">,</span></span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> value <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> formatted<span class="op">;</span></span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-8-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-8-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="294" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 293"><span id="cb16-294"><a href="#cb16-294" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-295"><a href="#cb16-295" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> advancedControlsText <span class="op">=</span> nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">advancedControls</span><span class="op">;</span></span>
<span id="cb16-296"><a href="#cb16-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-297"><a href="#cb16-297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _benefitLowLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-298"><a href="#cb16-298" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleLow</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-299"><a href="#cb16-299" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleLow</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-300"><a href="#cb16-300" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-301"><a href="#cb16-301" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _benefitHighLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-302"><a href="#cb16-302" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleHigh</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-303"><a href="#cb16-303" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleHigh</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-304"><a href="#cb16-304" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-305"><a href="#cb16-305" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _costLowLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-306"><a href="#cb16-306" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleLow</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-307"><a href="#cb16-307" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleLow</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-308"><a href="#cb16-308" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-309"><a href="#cb16-309" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _costHighLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-310"><a href="#cb16-310" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleHigh</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-311"><a href="#cb16-311" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleHigh</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-312"><a href="#cb16-312" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-313"><a href="#cb16-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-314"><a href="#cb16-314" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formBenefitScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb16-315"><a href="#cb16-315" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-316"><a href="#cb16-316" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb16-317"><a href="#cb16-317" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-318"><a href="#cb16-318" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _benefitLowLabel<span class="op">,</span></span>
<span id="cb16-319"><a href="#cb16-319" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.85</span><span class="op">,</span></span>
<span id="cb16-320"><a href="#cb16-320" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-321"><a href="#cb16-321" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.6</span>]<span class="op">,</span> {</span>
<span id="cb16-322"><a href="#cb16-322" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-323"><a href="#cb16-323" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _benefitHighLabel<span class="op">,</span></span>
<span id="cb16-324"><a href="#cb16-324" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.15</span><span class="op">,</span></span>
<span id="cb16-325"><a href="#cb16-325" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-326"><a href="#cb16-326" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-327"><a href="#cb16-327" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-328"><a href="#cb16-328" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb16-329"><a href="#cb16-329" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-330"><a href="#cb16-330" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb16-331"><a href="#cb16-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-332"><a href="#cb16-332" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formCostScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb16-333"><a href="#cb16-333" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-334"><a href="#cb16-334" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb16-335"><a href="#cb16-335" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-336"><a href="#cb16-336" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _costLowLabel<span class="op">,</span></span>
<span id="cb16-337"><a href="#cb16-337" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.9</span><span class="op">,</span></span>
<span id="cb16-338"><a href="#cb16-338" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-339"><a href="#cb16-339" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.8</span>]<span class="op">,</span> {</span>
<span id="cb16-340"><a href="#cb16-340" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-341"><a href="#cb16-341" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _costHighLabel<span class="op">,</span></span>
<span id="cb16-342"><a href="#cb16-342" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.2</span><span class="op">,</span></span>
<span id="cb16-343"><a href="#cb16-343" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-344"><a href="#cb16-344" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-345"><a href="#cb16-345" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-346"><a href="#cb16-346" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb16-347"><a href="#cb16-347" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-348"><a href="#cb16-348" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb16-349"><a href="#cb16-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-350"><a href="#cb16-350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _discountLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-351"><a href="#cb16-351" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">discountRate</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-352"><a href="#cb16-352" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">discountRate</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-353"><a href="#cb16-353" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-354"><a href="#cb16-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-355"><a href="#cb16-355" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _roiLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-356"><a href="#cb16-356" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">roi</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-357"><a href="#cb16-357" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">roi</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-358"><a href="#cb16-358" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-359"><a href="#cb16-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-360"><a href="#cb16-360" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formFinancialControls <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb16-361"><a href="#cb16-361" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-362"><a href="#cb16-362" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discountRate</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb16-363"><a href="#cb16-363" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb16-364"><a href="#cb16-364" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb16-365"><a href="#cb16-365" aria-hidden="true" tabindex="-1"></a>          {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> (x <span class="op">*</span> <span class="dv">100</span>)<span class="op">,</span> <span class="dt">label</span> <span class="op">:</span> _discountLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.12</span>}</span>
<span id="cb16-366"><a href="#cb16-366" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb16-367"><a href="#cb16-367" aria-hidden="true" tabindex="-1"></a>        viewof discountRate</span>
<span id="cb16-368"><a href="#cb16-368" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb16-369"><a href="#cb16-369" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bcr</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb16-370"><a href="#cb16-370" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb16-371"><a href="#cb16-371" aria-hidden="true" tabindex="-1"></a>          [<span class="fl">0.5</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb16-372"><a href="#cb16-372" aria-hidden="true" tabindex="-1"></a>          {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> _roiLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.62</span>}</span>
<span id="cb16-373"><a href="#cb16-373" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb16-374"><a href="#cb16-374" aria-hidden="true" tabindex="-1"></a>        viewof bcr</span>
<span id="cb16-375"><a href="#cb16-375" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-376"><a href="#cb16-376" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-377"><a href="#cb16-377" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-378"><a href="#cb16-378" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb16-379"><a href="#cb16-379" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-380"><a href="#cb16-380" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb16-381"><a href="#cb16-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-382"><a href="#cb16-382" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">dropdown_section</span>(</span>
<span id="cb16-383"><a href="#cb16-383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">advancedControls</span>)<span class="op">,</span></span>
<span id="cb16-384"><a href="#cb16-384" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span><span class="op">,</span></span>
<span id="cb16-385"><a href="#cb16-385" aria-hidden="true" tabindex="-1"></a>    formFinancialControls<span class="op">,</span></span>
<span id="cb16-386"><a href="#cb16-386" aria-hidden="true" tabindex="-1"></a>    <span class="vs">`&lt;b&gt;</span><span class="sc">${</span><span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">modelUncertainty</span>)<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">,</span></span>
<span id="cb16-387"><a href="#cb16-387" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(formBenefitScale<span class="op">,</span> viewof uncertaintyBenefitScale)<span class="op">,</span></span>
<span id="cb16-388"><a href="#cb16-388" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(formCostScale<span class="op">,</span> viewof uncertaintyCostScale)</span>
<span id="cb16-389"><a href="#cb16-389" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-390"><a href="#cb16-390" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-9" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="394" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 393"><span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a>uncertainty <span class="op">=</span> <span class="fu">runSimulationFromCashflowRows</span>(recipe_dataCashflow<span class="op">,</span> {</span>
<span id="cb17-395"><a href="#cb17-395" aria-hidden="true" tabindex="-1"></a>  <span class="dt">simulations</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span></span>
<span id="cb17-396"><a href="#cb17-396" aria-hidden="true" tabindex="-1"></a>  <span class="dt">discountRate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb17-397"><a href="#cb17-397" aria-hidden="true" tabindex="-1"></a>  <span class="dt">benefitScale</span><span class="op">:</span> {</span>
<span id="cb17-398"><a href="#cb17-398" aria-hidden="true" tabindex="-1"></a>    <span class="dt">low</span><span class="op">:</span> uncertaintyBenefitScale<span class="op">.</span><span class="at">low</span><span class="op">,</span></span>
<span id="cb17-399"><a href="#cb17-399" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mode</span><span class="op">:</span> <span class="fl">1.0</span><span class="op">,</span></span>
<span id="cb17-400"><a href="#cb17-400" aria-hidden="true" tabindex="-1"></a>    <span class="dt">high</span><span class="op">:</span> uncertaintyBenefitScale<span class="op">.</span><span class="at">high</span><span class="op">,</span></span>
<span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a>  <span class="dt">costScale</span><span class="op">:</span> {</span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a>    <span class="dt">low</span><span class="op">:</span> uncertaintyCostScale<span class="op">.</span><span class="at">low</span><span class="op">,</span></span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mode</span><span class="op">:</span> <span class="fl">1.0</span><span class="op">,</span></span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a>    <span class="dt">high</span><span class="op">:</span> uncertaintyCostScale<span class="op">.</span><span class="at">high</span><span class="op">,</span></span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-10" data-nodetype="declaration"></div></div></div></section></section><section id="investment-returns" class="level1"><h1><span><span id="ojs-element-id-9"></span></span></h1><p><span><span id="ojs-element-id-10"></span></span></p><p><span><span id="ojs-element-id-11"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="417" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 416"><span id="cb18-417"><a href="#cb18-417" aria-hidden="true" tabindex="-1"></a><span class="fu">bigNumbersResults</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-11" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="422" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 421"><span id="cb19-422"><a href="#cb19-422" aria-hidden="true" tabindex="-1"></a><span class="fu">resultTable</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-12-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="423" data-source-offset="-15"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 422"><span id="cb20-423"><a href="#cb20-423" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadButton</span>(</span>
<span id="cb20-424"><a href="#cb20-424" aria-hidden="true" tabindex="-1"></a>  walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span><span class="op">,</span></span>
<span id="cb20-425"><a href="#cb20-425" aria-hidden="true" tabindex="-1"></a>  <span class="st">"roi_data.csv"</span><span class="op">,</span></span>
<span id="cb20-426"><a href="#cb20-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Download"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Télécharger"</span> })<span class="op">,</span></span>
<span id="cb20-427"><a href="#cb20-427" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-12-2" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="430" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 429"><span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a><span class="fu">resultPlot</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-13" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="434" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 433"><span id="cb22-434"><a href="#cb22-434" aria-hidden="true" tabindex="-1"></a>indicatorSelector <span class="op">=</span> {</span>
<span id="cb22-435"><a href="#cb22-435" aria-hidden="true" tabindex="-1"></a>  <span class="co">// bind input so tooltip can be dynamic</span></span>
<span id="cb22-436"><a href="#cb22-436" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb22-437"><a href="#cb22-437" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">select</span>(dataPickMetric<span class="op">,</span> {</span>
<span id="cb22-438"><a href="#cb22-438" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb22-439"><a href="#cb22-439" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">indicator</span>)<span class="op">,</span></span>
<span id="cb22-440"><a href="#cb22-440" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> pickMetricWalkthrough<span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb22-441"><a href="#cb22-441" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb22-442"><a href="#cb22-442" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">labelFull</span><span class="op">,</span></span>
<span id="cb22-443"><a href="#cb22-443" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span> viewof pickMetricWalkthrough</span>
<span id="cb22-444"><a href="#cb22-444" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-445"><a href="#cb22-445" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-14" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="449" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 448"><span id="cb23-449"><a href="#cb23-449" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-450"><a href="#cb23-450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listWhat <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">what</span>)</span>
<span id="cb23-451"><a href="#cb23-451" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listInterpret <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">interpret</span>)</span>
<span id="cb23-452"><a href="#cb23-452" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listTell <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb23-453"><a href="#cb23-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-454"><a href="#cb23-454" aria-hidden="true" tabindex="-1"></a>  <span class="co">// indicator info</span></span>
<span id="cb23-455"><a href="#cb23-455" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">labelFull</span><span class="sc">}</span></span>
<span id="cb23-456"><a href="#cb23-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-457"><a href="#cb23-457" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listWhat<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span><span class="sc">}</span></span>
<span id="cb23-458"><a href="#cb23-458" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listInterpret<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span><span class="sc">}</span></span>
<span id="cb23-459"><a href="#cb23-459" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listTell<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span><span class="sc">}</span></span>
<span id="cb23-460"><a href="#cb23-460" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb23-461"><a href="#cb23-461" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-15" data-nodetype="expression"></div></div></div><p><span><span id="ojs-element-id-12"></span></span></p></section><section id="summary" class="level1"><h1><span><span id="ojs-element-id-13"></span></span></h1><p><span><span id="ojs-element-id-14"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="471" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 470"><span id="cb24-471"><a href="#cb24-471" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb24-472"><a href="#cb24-472" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_rate <span class="op">=</span> (discountRate <span class="op">*</span> <span class="dv">100</span>) <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb24-473"><a href="#cb24-473" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> farm_bcr <span class="op">=</span> bcr<span class="op">;</span></span>
<span id="cb24-474"><a href="#cb24-474" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> methods_title <span class="op">=</span> nbMethods<span class="op">;</span></span>
<span id="cb24-475"><a href="#cb24-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-476"><a href="#cb24-476" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block2</span>)</span>
<span id="cb24-477"><a href="#cb24-477" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> templateItems <span class="op">=</span> [</span>
<span id="cb24-478"><a href="#cb24-478" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"npvDisountRate"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> npv_rate}<span class="op">,</span></span>
<span id="cb24-479"><a href="#cb24-479" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"farmBcr"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> farm_bcr}<span class="op">,</span></span>
<span id="cb24-480"><a href="#cb24-480" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"methodsSourcesTitle"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> methods_title}<span class="op">,</span></span>
<span id="cb24-481"><a href="#cb24-481" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb24-482"><a href="#cb24-482" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> templateItems)</span>
<span id="cb24-483"><a href="#cb24-483" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>formatted<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb24-484"><a href="#cb24-484" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-16" data-nodetype="expression"></div></div></div></section><section id="methods" class="level1"><h1><span><span id="ojs-element-id-15"></span></span></h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="491" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 490"><span id="cb25-491"><a href="#cb25-491" aria-hidden="true" tabindex="-1"></a>methodFiles <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb25-492"><a href="#cb25-492" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en"</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/translations/methods-en.md"</span>)<span class="op">,</span></span>
<span id="cb25-493"><a href="#cb25-493" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fr"</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/translations/methods-fr.md"</span>)</span>
<span id="cb25-494"><a href="#cb25-494" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-495"><a href="#cb25-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-496"><a href="#cb25-496" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-497"><a href="#cb25-497" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> key <span class="op">=</span> masterLanguage<span class="op">.</span><span class="at">key</span></span>
<span id="cb25-498"><a href="#cb25-498" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> md_content <span class="op">=</span> <span class="cf">await</span> methodFiles[key]<span class="op">.</span><span class="fu">text</span>()</span>
<span id="cb25-499"><a href="#cb25-499" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">renderMarkdownWithSlots</span>(</span>
<span id="cb25-500"><a href="#cb25-500" aria-hidden="true" tabindex="-1"></a>    md_content<span class="op">,</span></span>
<span id="cb25-501"><a href="#cb25-501" aria-hidden="true" tabindex="-1"></a>    {}<span class="op">,</span></span>
<span id="cb25-502"><a href="#cb25-502" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb25-503"><a href="#cb25-503" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-17-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-17-2" data-nodetype="expression"></div></div></div></div></section><section id="appendix" class="level1 hidden"><h1 class="hidden"><span><span id="ojs-element-id-16"></span></span></h1><section id="source-code" class="level2"><h2 data-anchor-id="source-code">Source code</h2></section><section id="data-import-and-cleaning" class="level2"><h2 data-anchor-id="data-import-and-cleaning">Data import and cleaning</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="514" data-source-offset="-20"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 513"><span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> {</span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> db <span class="op">=</span> <span class="cf">await</span> DuckDBClient<span class="op">.</span><span class="fu">of</span>({</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cv_raw</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/faostat_prod_cv.parquet"</span>)</span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a><span class="vs">    CREATE TABLE exposure AS  -- data is ~ 1 mb so table possibly more performant</span></span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT</span></span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a><span class="vs">        iso3,</span></span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin1_name,</span></span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a><span class="vs">        REGEXP_REPLACE(crop, '-tropical|-highland', '') AS crop,</span></span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a><span class="vs">        CONCAT(exposure, '_', unit) AS exposure,</span></span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a><span class="vs">        SUM(value) AS value</span></span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM read_parquet("s3://digital-atlas/domain=exposure/type=combined/source=glw4-2020_spam2020AA/region=ssa/processing=atlas-harmonized/variable=vop_nominal-usd-2021.parquet")</span></span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE</span></span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin2_name IS NULL AND admin1_name IS NOT NULL</span></span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND (tech = 'all' OR tech IS NULL)</span></span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND isfinite(value)</span></span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND crop !~ '(^other-|rest-of|temperate-fruit|tropical-fruit|vegetables)'</span></span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a><span class="vs">      GROUP BY</span></span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a><span class="vs">        iso3,</span></span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin1_name,</span></span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a><span class="vs">        crop,</span></span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a><span class="vs">        CONCAT(exposure, '_', unit)</span></span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)</span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a><span class="vs">    CREATE VIEW cv AS</span></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT</span></span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a><span class="vs">        -- clean and standardize crop names</span></span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a><span class="vs">        REGEXP_REPLACE(</span></span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a><span class="vs">          REGEXP_REPLACE(</span></span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a><span class="vs">            REPLACE(REPLACE(crop, '_meat', ''), ' ', '-'),</span></span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a><span class="vs">            'goat$', 'goats'</span></span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a><span class="vs">          ),</span></span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a><span class="vs">          'pig$', 'pigs'</span></span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a><span class="vs">        ) AS crop,</span></span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a><span class="vs">        value_filled AS cv</span></span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE NOT (crop ILIKE '%milk%' OR crop ILIKE '%eggs%' OR LOWER(crop) = 'total')</span></span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a><span class="vs">      -- add robusta-coffee and small-millet substitutes</span></span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT admin0_name, 'robusta-coffee', value_filled AS cv</span></span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE crop = 'arabica-coffee'</span></span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT admin0_name, 'small-millet', value_filled AS cv</span></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE crop = 'pearl-millet';</span></span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db<span class="op">;</span></span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> {</span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> country_list <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/shared/atlas_countries.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filteredCountries <span class="op">=</span> country_list</span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((c) <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">include</span> <span class="op">&amp;&amp;</span> c<span class="op">.</span><span class="at">iso3c</span> <span class="op">!==</span> <span class="st">"SDN"</span>)</span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(({ include<span class="op">,</span> <span class="op">...</span>rest }) <span class="kw">=&gt;</span> rest)<span class="op">;</span></span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> filteredCountries<span class="op">;</span></span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-18-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-18-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="582" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 581"><span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a>dataAdminRegions <span class="op">=</span> {</span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> regions <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT DISTINCT admin0_name, admin1_name, iso3</span></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM exposure</span></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE admin1_name IS NOT null</span></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND iso3 in ('</span><span class="sc">${</span>select_country<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)</span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> regions<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> ({</span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>row<span class="op">,</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>row<span class="op">.</span><span class="at">iso3</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>row<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">TODO</span><span class="co">: Need to add translations and label cleaning to items</span></span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a>dataCrops <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT DISTINCT crop AS item</span></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a><span class="vs">  FROM exposure</span></span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a><span class="vs">  ORDER BY item</span></span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-19-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-19-2" data-nodetype="declaration"></div></div></div></div></section><section id="inputs" class="level2"><h2 data-anchor-id="inputs">Inputs</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="608" data-source-offset="-43"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 607"><span id="cb28-608"><a href="#cb28-608" aria-hidden="true" tabindex="-1"></a>inputOptions_projectCost <span class="op">=</span> {</span>
<span id="cb28-609"><a href="#cb28-609" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb28-610"><a href="#cb28-610" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="fl">1e6</span><span class="op">,</span> <span class="fl">5e8</span>]<span class="op">,</span></span>
<span id="cb28-611"><a href="#cb28-611" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costInput</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb28-612"><a href="#cb28-612" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costInput</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb28-613"><a href="#cb28-613" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e5</span><span class="op">,</span></span>
<span id="cb28-614"><a href="#cb28-614" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">50_000_000</span><span class="op">,</span></span>
<span id="cb28-615"><a href="#cb28-615" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'$.3s'</span>)<span class="op">,</span></span>
<span id="cb28-616"><a href="#cb28-616" aria-hidden="true" tabindex="-1"></a>    <span class="dt">outputWidth</span><span class="op">:</span> <span class="dv">90</span><span class="op">,</span></span>
<span id="cb28-617"><a href="#cb28-617" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Ex. $5,000,000"</span><span class="op">,</span></span>
<span id="cb28-618"><a href="#cb28-618" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pattern</span><span class="op">:</span> <span class="st">"^[$]?[1-9]+[0-9,$]*$"</span><span class="op">,</span></span>
<span id="cb28-619"><a href="#cb28-619" aria-hidden="true" tabindex="-1"></a>    <span class="dt">valueString</span><span class="op">:</span> <span class="st">"$50,000,000"</span></span>
<span id="cb28-620"><a href="#cb28-620" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-621"><a href="#cb28-621" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-622"><a href="#cb28-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-623"><a href="#cb28-623" aria-hidden="true" tabindex="-1"></a>inputOptions_projectYears <span class="op">=</span> {</span>
<span id="cb28-624"><a href="#cb28-624" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb28-625"><a href="#cb28-625" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">year</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span></span>
<span id="cb28-626"><a href="#cb28-626" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb28-627"><a href="#cb28-627" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb28-628"><a href="#cb28-628" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">16</span>]<span class="op">,</span></span>
<span id="cb28-629"><a href="#cb28-629" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> d3</span>
<span id="cb28-630"><a href="#cb28-630" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">range</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">16</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb28-631"><a href="#cb28-631" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>years<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d }))<span class="op">,</span></span>
<span id="cb28-632"><a href="#cb28-632" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb28-633"><a href="#cb28-633" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb28-635"><a href="#cb28-635" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb28-636"><a href="#cb28-636" aria-hidden="true" tabindex="-1"></a>    <span class="dt">outputWidth</span><span class="op">:</span> <span class="dv">90</span></span>
<span id="cb28-637"><a href="#cb28-637" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb28-638"><a href="#cb28-638" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-20-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-20-2" data-nodetype="declaration"></div></div></div></div><section id="scope-selectors---country-region-crop" class="level3"><h3 data-anchor-id="scope-selectors---country-region-crop">Scope Selectors - country, region, crop</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="643" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 642"><span id="cb29-643"><a href="#cb29-643" aria-hidden="true" tabindex="-1"></a>viewof select_country <span class="op">=</span> {</span>
<span id="cb29-644"><a href="#cb29-644" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> countries</span>
<span id="cb29-645"><a href="#cb29-645" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb29-646"><a href="#cb29-646" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">iso3c</span><span class="op">,</span> <span class="co">//Migrating to iso codes for future flexability</span></span>
<span id="cb29-647"><a href="#cb29-647" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(d<span class="op">.</span><span class="at">translation</span>)</span>
<span id="cb29-648"><a href="#cb29-648" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb29-649"><a href="#cb29-649" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb29-650"><a href="#cb29-650" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb29-651"><a href="#cb29-651" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb29-652"><a href="#cb29-652" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb29-653"><a href="#cb29-653" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">countryDropdown</span><span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb29-654"><a href="#cb29-654" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb29-655"><a href="#cb29-655" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-656"><a href="#cb29-656" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb29-657"><a href="#cb29-657" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select Countries..."</span><span class="op">,</span></span>
<span id="cb29-658"><a href="#cb29-658" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb29-659"><a href="#cb29-659" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> [<span class="st">"KEN"</span><span class="op">,</span> <span class="st">"TZA"</span>]<span class="op">,</span></span>
<span id="cb29-660"><a href="#cb29-660" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb29-661"><a href="#cb29-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-662"><a href="#cb29-662" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span> <span class="co">// Noisy input, so delay it a bit.</span></span>
<span id="cb29-663"><a href="#cb29-663" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-21" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="667" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 666"><span id="cb30-667"><a href="#cb30-667" aria-hidden="true" tabindex="-1"></a><span class="co">// admin multi-select: regions</span></span>
<span id="cb30-668"><a href="#cb30-668" aria-hidden="true" tabindex="-1"></a>viewof select_region <span class="op">=</span> {</span>
<span id="cb30-669"><a href="#cb30-669" aria-hidden="true" tabindex="-1"></a>  <span class="co">// filter regions based on country id's</span></span>
<span id="cb30-670"><a href="#cb30-670" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filteredRegions <span class="op">=</span> dataAdminRegions</span>
<span id="cb30-671"><a href="#cb30-671" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const translateCountry = (d) =&gt; _lang(td.admin0_name.values?.[d]);</span></span>
<span id="cb30-672"><a href="#cb30-672" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> translateCountry <span class="op">=</span> (iso) <span class="kw">=&gt;</span> <span class="fu">_lang</span>(countries<span class="op">.</span><span class="fu">find</span>((c) <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">iso3c</span> <span class="op">===</span> iso)<span class="op">.</span><span class="at">translation</span>)<span class="op">;</span></span>
<span id="cb30-673"><a href="#cb30-673" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> filteredRegions<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb30-674"><a href="#cb30-674" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb30-675"><a href="#cb30-675" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">translateCountry</span>(d<span class="op">.</span><span class="at">iso3</span>)<span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb30-676"><a href="#cb30-676" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb30-677"><a href="#cb30-677" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedIds <span class="op">=</span> filteredRegions<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb30-678"><a href="#cb30-678" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> {</span>
<span id="cb30-679"><a href="#cb30-679" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb30-680"><a href="#cb30-680" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">regionDropdown</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb30-681"><a href="#cb30-681" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-682"><a href="#cb30-682" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb30-683"><a href="#cb30-683" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({<span class="dt">labelText</span><span class="op">:</span> text<span class="op">.</span><span class="at">label</span><span class="op">,</span> <span class="dt">tooltipText</span><span class="op">:</span> text<span class="op">.</span><span class="at">tooltip</span>})<span class="op">,</span></span>
<span id="cb30-684"><a href="#cb30-684" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb30-685"><a href="#cb30-685" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select regions..."</span><span class="op">,</span></span>
<span id="cb30-686"><a href="#cb30-686" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb30-687"><a href="#cb30-687" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> selectedIds</span>
<span id="cb30-688"><a href="#cb30-688" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb30-689"><a href="#cb30-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-690"><a href="#cb30-690" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb30-691"><a href="#cb30-691" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-22" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="695" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 694"><span id="cb31-695"><a href="#cb31-695" aria-hidden="true" tabindex="-1"></a><span class="co">// admin multi-select: countries</span></span>
<span id="cb31-696"><a href="#cb31-696" aria-hidden="true" tabindex="-1"></a>viewof select_crop <span class="op">=</span> {</span>
<span id="cb31-697"><a href="#cb31-697" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataCrops</span>
<span id="cb31-698"><a href="#cb31-698" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb31-699"><a href="#cb31-699" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">item</span><span class="op">,</span></span>
<span id="cb31-700"><a href="#cb31-700" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(d<span class="op">.</span><span class="at">item</span>) <span class="co">//</span><span class="al">TODO</span><span class="co">: Add translations</span></span>
<span id="cb31-701"><a href="#cb31-701" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb31-702"><a href="#cb31-702" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span>b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">label</span> <span class="op">&gt;</span> b<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb31-703"><a href="#cb31-703" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedId <span class="op">=</span> dataCrops</span>
<span id="cb31-704"><a href="#cb31-704" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> [<span class="st">"bean"</span><span class="op">,</span> <span class="st">"goats"</span><span class="op">,</span> <span class="st">"maize"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">item</span>))</span>
<span id="cb31-705"><a href="#cb31-705" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">item</span>)<span class="op">;</span></span>
<span id="cb31-706"><a href="#cb31-706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> {</span>
<span id="cb31-707"><a href="#cb31-707" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">commodity</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb31-708"><a href="#cb31-708" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb31-709"><a href="#cb31-709" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">commodityDropdown</span><span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb31-710"><a href="#cb31-710" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-711"><a href="#cb31-711" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb31-712"><a href="#cb31-712" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb31-713"><a href="#cb31-713" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb31-714"><a href="#cb31-714" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> text<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb31-715"><a href="#cb31-715" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> text<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb31-716"><a href="#cb31-716" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb31-717"><a href="#cb31-717" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb31-718"><a href="#cb31-718" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select crops..."</span><span class="op">,</span></span>
<span id="cb31-719"><a href="#cb31-719" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb31-720"><a href="#cb31-720" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> selectedId</span>
<span id="cb31-721"><a href="#cb31-721" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb31-722"><a href="#cb31-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-723"><a href="#cb31-723" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb31-724"><a href="#cb31-724" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-23" data-nodetype="declaration"></div></div></div></section></section><section id="economic-input-variables" class="level2"><h2 data-anchor-id="economic-input-variables">Economic Input Variables</h2><section id="main-control-variables" class="level3"><h3 data-anchor-id="main-control-variables">Main Control Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="733" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 732"><span id="cb32-733"><a href="#cb32-733" aria-hidden="true" tabindex="-1"></a>rangeProjectCost <span class="op">=</span> {</span>
<span id="cb32-734"><a href="#cb32-734" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unpack <span class="op">=</span> <span class="bu">Number</span>(inputProjectOptions<span class="op">.</span><span class="at">cost</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">[,|$]</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>))</span>
<span id="cb32-735"><a href="#cb32-735" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> number <span class="op">=</span> <span class="bu">Number</span>(unpack)</span>
<span id="cb32-736"><a href="#cb32-736" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> number</span>
<span id="cb32-737"><a href="#cb32-737" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-738"><a href="#cb32-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-739"><a href="#cb32-739" aria-hidden="true" tabindex="-1"></a>projectYears <span class="op">=</span> inputProjectOptions<span class="op">.</span><span class="at">years</span><span class="op">.</span><span class="at">value</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-24-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-24-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="742" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 741"><span id="cb33-742"><a href="#cb33-742" aria-hidden="true" tabindex="-1"></a>render_econPerfWalkthrough <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb33-743"><a href="#cb33-743" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> terms <span class="op">=</span> {</span>
<span id="cb33-744"><a href="#cb33-744" aria-hidden="true" tabindex="-1"></a>    <span class="dt">none</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">none</span><span class="op">,</span> {</span>
<span id="cb33-745"><a href="#cb33-745" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb33-746"><a href="#cb33-746" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb33-747"><a href="#cb33-747" aria-hidden="true" tabindex="-1"></a>    <span class="dt">low</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">low</span><span class="op">,</span> {</span>
<span id="cb33-748"><a href="#cb33-748" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb33-749"><a href="#cb33-749" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb33-750"><a href="#cb33-750" aria-hidden="true" tabindex="-1"></a>    <span class="dt">moderate</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">moderate</span><span class="op">,</span> {</span>
<span id="cb33-751"><a href="#cb33-751" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb33-752"><a href="#cb33-752" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb33-753"><a href="#cb33-753" aria-hidden="true" tabindex="-1"></a>    <span class="dt">high</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">high</span><span class="op">,</span> {</span>
<span id="cb33-754"><a href="#cb33-754" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb33-755"><a href="#cb33-755" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb33-756"><a href="#cb33-756" aria-hidden="true" tabindex="-1"></a>    <span class="dt">incremental</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">incremental</span>)<span class="op">,</span></span>
<span id="cb33-757"><a href="#cb33-757" aria-hidden="true" tabindex="-1"></a>    <span class="dt">transformative</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb33-758"><a href="#cb33-758" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">transformative</span><span class="op">,</span></span>
<span id="cb33-759"><a href="#cb33-759" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb33-760"><a href="#cb33-760" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb33-761"><a href="#cb33-761" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataProdImpact <span class="op">=</span> [</span>
<span id="cb33-762"><a href="#cb33-762" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`10% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">incremental</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span> }<span class="op">,</span></span>
<span id="cb33-763"><a href="#cb33-763" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`20%`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.2</span> }<span class="op">,</span></span>
<span id="cb33-764"><a href="#cb33-764" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`30% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.3</span> }<span class="op">,</span></span>
<span id="cb33-765"><a href="#cb33-765" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`40%`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.4</span> }<span class="op">,</span></span>
<span id="cb33-766"><a href="#cb33-766" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`50% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">transformative</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span> }<span class="op">,</span></span>
<span id="cb33-767"><a href="#cb33-767" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb33-768"><a href="#cb33-768" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProdImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataProdImpact<span class="op">,</span> {</span>
<span id="cb33-769"><a href="#cb33-769" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb33-770"><a href="#cb33-770" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb33-771"><a href="#cb33-771" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb33-772"><a href="#cb33-772" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb33-773"><a href="#cb33-773" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb33-774"><a href="#cb33-774" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb33-775"><a href="#cb33-775" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb33-776"><a href="#cb33-776" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb33-777"><a href="#cb33-777" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb33-778"><a href="#cb33-778" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataProdImpact<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.3</span>)<span class="op">,</span></span>
<span id="cb33-779"><a href="#cb33-779" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-780"><a href="#cb33-780" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataAdoption <span class="op">=</span> [</span>
<span id="cb33-781"><a href="#cb33-781" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`0.5% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">low</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.005</span> }<span class="op">,</span></span>
<span id="cb33-782"><a href="#cb33-782" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`1% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.01</span> }<span class="op">,</span></span>
<span id="cb33-783"><a href="#cb33-783" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`2% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">high</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.02</span> }<span class="op">,</span></span>
<span id="cb33-784"><a href="#cb33-784" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb33-785"><a href="#cb33-785" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputAdoption <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdoption<span class="op">,</span> {</span>
<span id="cb33-786"><a href="#cb33-786" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb33-787"><a href="#cb33-787" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb33-788"><a href="#cb33-788" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb33-789"><a href="#cb33-789" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb33-790"><a href="#cb33-790" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb33-791"><a href="#cb33-791" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb33-792"><a href="#cb33-792" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb33-793"><a href="#cb33-793" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb33-794"><a href="#cb33-794" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb33-795"><a href="#cb33-795" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataAdoption<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.01</span>)<span class="op">,</span></span>
<span id="cb33-796"><a href="#cb33-796" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-797"><a href="#cb33-797" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataCisImpact <span class="op">=</span> [</span>
<span id="cb33-798"><a href="#cb33-798" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`0% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">none</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb33-799"><a href="#cb33-799" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`10% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">low</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span> }<span class="op">,</span></span>
<span id="cb33-800"><a href="#cb33-800" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`25% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.25</span> }<span class="op">,</span></span>
<span id="cb33-801"><a href="#cb33-801" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`50% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">high</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span> }<span class="op">,</span></span>
<span id="cb33-802"><a href="#cb33-802" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb33-803"><a href="#cb33-803" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputCisImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataCisImpact<span class="op">,</span> {</span>
<span id="cb33-804"><a href="#cb33-804" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb33-805"><a href="#cb33-805" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb33-806"><a href="#cb33-806" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb33-807"><a href="#cb33-807" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb33-808"><a href="#cb33-808" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb33-809"><a href="#cb33-809" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb33-810"><a href="#cb33-810" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb33-811"><a href="#cb33-811" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb33-812"><a href="#cb33-812" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb33-813"><a href="#cb33-813" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataCisImpact<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.25</span>)<span class="op">,</span></span>
<span id="cb33-814"><a href="#cb33-814" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-815"><a href="#cb33-815" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb33-816"><a href="#cb33-816" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-817"><a href="#cb33-817" aria-hidden="true" tabindex="-1"></a>      inputProdImpact<span class="op">,</span></span>
<span id="cb33-818"><a href="#cb33-818" aria-hidden="true" tabindex="-1"></a>      inputAdoption<span class="op">,</span></span>
<span id="cb33-819"><a href="#cb33-819" aria-hidden="true" tabindex="-1"></a>      inputCisImpact<span class="op">,</span></span>
<span id="cb33-820"><a href="#cb33-820" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-821"><a href="#cb33-821" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-822"><a href="#cb33-822" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb33-823"><a href="#cb33-823" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-824"><a href="#cb33-824" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb33-825"><a href="#cb33-825" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-25" data-nodetype="declaration"></div></div></div></section><section id="advanced-control-variables" class="level3"><h3 data-anchor-id="advanced-control-variables">Advanced Control Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="832" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 831"><span id="cb34-832"><a href="#cb34-832" aria-hidden="true" tabindex="-1"></a>viewof discountRate <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span>{<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> (x <span class="op">*</span> <span class="dv">100</span>)<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.12</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount Rate"</span>} ) <span class="co">// 0-1 as a pct</span></span>
<span id="cb34-833"><a href="#cb34-833" aria-hidden="true" tabindex="-1"></a>viewof bcr <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"BCR"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.62</span>} )</span>
<span id="cb34-834"><a href="#cb34-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-835"><a href="#cb34-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-836"><a href="#cb34-836" aria-hidden="true" tabindex="-1"></a>viewof uncertaintyBenefitScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb34-837"><a href="#cb34-837" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-838"><a href="#cb34-838" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb34-839"><a href="#cb34-839" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb34-840"><a href="#cb34-840" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.9</span><span class="op">,</span></span>
<span id="cb34-841"><a href="#cb34-841" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb34-842"><a href="#cb34-842" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.8</span>]<span class="op">,</span> {</span>
<span id="cb34-843"><a href="#cb34-843" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb34-844"><a href="#cb34-844" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.2</span><span class="op">,</span></span>
<span id="cb34-845"><a href="#cb34-845" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb34-846"><a href="#cb34-846" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-847"><a href="#cb34-847" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-848"><a href="#cb34-848" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb34-849"><a href="#cb34-849" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-850"><a href="#cb34-850" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb34-851"><a href="#cb34-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-852"><a href="#cb34-852" aria-hidden="true" tabindex="-1"></a>viewof uncertaintyCostScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb34-853"><a href="#cb34-853" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-854"><a href="#cb34-854" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb34-855"><a href="#cb34-855" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb34-856"><a href="#cb34-856" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.9</span><span class="op">,</span></span>
<span id="cb34-857"><a href="#cb34-857" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb34-858"><a href="#cb34-858" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.8</span>]<span class="op">,</span> {</span>
<span id="cb34-859"><a href="#cb34-859" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb34-860"><a href="#cb34-860" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.2</span><span class="op">,</span></span>
<span id="cb34-861"><a href="#cb34-861" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb34-862"><a href="#cb34-862" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-863"><a href="#cb34-863" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-864"><a href="#cb34-864" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb34-865"><a href="#cb34-865" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-866"><a href="#cb34-866" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-26-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-26-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-26-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-26-4" data-nodetype="declaration"></div></div></div></div></section><section id="other-selections" class="level3"><h3 data-anchor-id="other-selections">Other Selections</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="871" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 870"><span id="cb35-871"><a href="#cb35-871" aria-hidden="true" tabindex="-1"></a><span class="co">// Plot Variable</span></span>
<span id="cb35-872"><a href="#cb35-872" aria-hidden="true" tabindex="-1"></a><span class="co">// base selector for metric type</span></span>
<span id="cb35-873"><a href="#cb35-873" aria-hidden="true" tabindex="-1"></a>viewof pickMetricWalkthrough <span class="op">=</span> {</span>
<span id="cb35-874"><a href="#cb35-874" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataPickMetric<span class="op">,</span> {</span>
<span id="cb35-875"><a href="#cb35-875" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">indicator</span>)<span class="op">,</span></span>
<span id="cb35-876"><a href="#cb35-876" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">labelFull</span><span class="op">,</span></span>
<span id="cb35-877"><a href="#cb35-877" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataPickMetric<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"irr"</span>)</span>
<span id="cb35-878"><a href="#cb35-878" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb35-879"><a href="#cb35-879" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-27" data-nodetype="declaration"></div></div></div></section></section><section id="elements" class="level2"><h2 data-anchor-id="elements">Elements</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="886" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 885"><span id="cb36-886"><a href="#cb36-886" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { dropdownInput<span class="op">,</span> dropdownCSS } <span class="im">from</span> <span class="st">"/helpers/multiSelect.ojs"</span><span class="op">;</span></span>
<span id="cb36-887"><a href="#cb36-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-888"><a href="#cb36-888" aria-hidden="true" tabindex="-1"></a>dropdownCSS<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-28-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-28-2" data-nodetype="expression"></div></div></div></div></section><section id="helper-functions" class="level2"><h2 data-anchor-id="helper-functions">Helper Functions</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="893" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 892"><span id="cb37-893"><a href="#cb37-893" aria-hidden="true" tabindex="-1"></a>debounce <span class="op">=</span> (input<span class="op">,</span> delay <span class="op">=</span> <span class="dv">500</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb37-894"><a href="#cb37-894" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> DelayedEvent <span class="kw">extends</span> <span class="bu">Event</span> {}</span>
<span id="cb37-895"><a href="#cb37-895" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> id<span class="op">;</span></span>
<span id="cb37-896"><a href="#cb37-896" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb37-897"><a href="#cb37-897" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (e <span class="kw">instanceof</span> DelayedEvent) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb37-898"><a href="#cb37-898" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">stopImmediatePropagation</span>()<span class="op">;</span></span>
<span id="cb37-899"><a href="#cb37-899" aria-hidden="true" tabindex="-1"></a>    <span class="pp">clearTimeout</span>(id)<span class="op">;</span></span>
<span id="cb37-900"><a href="#cb37-900" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="pp">setTimeout</span>(</span>
<span id="cb37-901"><a href="#cb37-901" aria-hidden="true" tabindex="-1"></a>      () <span class="kw">=&gt;</span> input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="fu">DelayedEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">,</span></span>
<span id="cb37-902"><a href="#cb37-902" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">,</span></span>
<span id="cb37-903"><a href="#cb37-903" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb37-904"><a href="#cb37-904" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb37-905"><a href="#cb37-905" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input<span class="op">;</span></span>
<span id="cb37-906"><a href="#cb37-906" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-29" data-nodetype="declaration"></div></div></div></section><section id="language" class="level2"><h2 data-anchor-id="language">Language</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="916" data-source-offset="-67"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 915"><span id="cb38-916"><a href="#cb38-916" aria-hidden="true" tabindex="-1"></a>nbTitle <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb38-917"><a href="#cb38-917" aria-hidden="true" tabindex="-1"></a>  <span class="dt">en</span><span class="op">:</span> <span class="st">"Estimate Economic Returns on Adaptation"</span><span class="op">,</span></span>
<span id="cb38-918"><a href="#cb38-918" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Estimer les retours sur économiques l'adaptation"</span><span class="op">,</span></span>
<span id="cb38-919"><a href="#cb38-919" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb38-920"><a href="#cb38-920" aria-hidden="true" tabindex="-1"></a><span class="co">// key_insights = _lang({en: "Key Insights", fr: "Résumé"})</span></span>
<span id="cb38-921"><a href="#cb38-921" aria-hidden="true" tabindex="-1"></a>nbOverview <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Overview"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Vue d’Ensemble"</span> })<span class="op">;</span></span>
<span id="cb38-922"><a href="#cb38-922" aria-hidden="true" tabindex="-1"></a>heading1 <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Project Set-Up"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Configuration de Project"</span> })<span class="op">;</span></span>
<span id="cb38-923"><a href="#cb38-923" aria-hidden="true" tabindex="-1"></a>heading2 <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Investment Returns"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Retours d'Investissements"</span> })<span class="op">;</span></span>
<span id="cb38-924"><a href="#cb38-924" aria-hidden="true" tabindex="-1"></a>nbSummary <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Summary"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Résumé"</span> })<span class="op">;</span></span>
<span id="cb38-925"><a href="#cb38-925" aria-hidden="true" tabindex="-1"></a>nbMethods <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Methods &amp; Sources"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Méthodes &amp; Sources"</span> })<span class="op">;</span></span>
<span id="cb38-926"><a href="#cb38-926" aria-hidden="true" tabindex="-1"></a>appendix <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">appendix</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-6" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-30-7" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="930" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 929"><span id="cb39-930"><a href="#cb39-930" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { lang <span class="im">as</span> Lang } <span class="im">from</span> <span class="st">"/helpers/lang.js"</span></span>
<span id="cb39-931"><a href="#cb39-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-932"><a href="#cb39-932" aria-hidden="true" tabindex="-1"></a>general_translations <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/shared/generalTranslations.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb39-933"><a href="#cb39-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-934"><a href="#cb39-934" aria-hidden="true" tabindex="-1"></a>nbText <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/translations.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb39-935"><a href="#cb39-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-936"><a href="#cb39-936" aria-hidden="true" tabindex="-1"></a>languages <span class="op">=</span> [</span>
<span id="cb39-937"><a href="#cb39-937" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"en"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"English"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">'en-US'</span> }<span class="op">,</span></span>
<span id="cb39-938"><a href="#cb39-938" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"fr"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Français"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">'fr-FR'</span> }</span>
<span id="cb39-939"><a href="#cb39-939" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb39-940"><a href="#cb39-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-941"><a href="#cb39-941" aria-hidden="true" tabindex="-1"></a>defaultLangKey <span class="op">=</span> {</span>
<span id="cb39-942"><a href="#cb39-942" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> name <span class="op">=</span> <span class="st">"lang"</span><span class="op">;</span></span>
<span id="cb39-943"><a href="#cb39-943" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> list <span class="op">=</span> languages<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb39-944"><a href="#cb39-944" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defaultKey <span class="op">=</span> <span class="st">"en"</span><span class="op">;</span></span>
<span id="cb39-945"><a href="#cb39-945" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> queryParam <span class="op">=</span> <span class="cf">await</span> Lang<span class="op">.</span><span class="fu">getParamFromList</span>({ name<span class="op">,</span> list })<span class="op">;</span></span>
<span id="cb39-946"><a href="#cb39-946" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> queryParam <span class="op">??</span> defaultKey<span class="op">;</span></span>
<span id="cb39-947"><a href="#cb39-947" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-948"><a href="#cb39-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-949"><a href="#cb39-949" aria-hidden="true" tabindex="-1"></a>_lang <span class="op">=</span> Lang<span class="op">.</span><span class="fu">lg</span>(masterLanguage<span class="op">.</span><span class="at">key</span>)</span>
<span id="cb39-950"><a href="#cb39-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-951"><a href="#cb39-951" aria-hidden="true" tabindex="-1"></a>viewof masterLanguage <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb39-952"><a href="#cb39-952" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Main language toggle"</span><span class="op">,</span></span>
<span id="cb39-953"><a href="#cb39-953" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-954"><a href="#cb39-954" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> languages<span class="op">.</span><span class="fu">find</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">key</span> <span class="op">===</span> defaultLangKey)<span class="op">,</span></span>
<span id="cb39-955"><a href="#cb39-955" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-6" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-7" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="959" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 958"><span id="cb40-959"><a href="#cb40-959" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">NavbarLangSelector</span>(language_obj<span class="op">,</span> masterLanguage) {</span>
<span id="cb40-960"><a href="#cb40-960" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> navEnd <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">".navbar-nav.ms-auto .nav-item.compact"</span>)<span class="op">;</span></span>
<span id="cb40-961"><a href="#cb40-961" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (navEnd) {</span>
<span id="cb40-962"><a href="#cb40-962" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> existingLangSelector <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"nav-lang-selector"</span>)<span class="op">;</span></span>
<span id="cb40-963"><a href="#cb40-963" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>existingLangSelector) {</span>
<span id="cb40-964"><a href="#cb40-964" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lang_sel <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb40-965"><a href="#cb40-965" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">radio</span>(language_obj<span class="op">,</span> {</span>
<span id="cb40-966"><a href="#cb40-966" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> <span class="st">""</span><span class="op">,</span></span>
<span id="cb40-967"><a href="#cb40-967" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span></span>
<span id="cb40-968"><a href="#cb40-968" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb40-969"><a href="#cb40-969" aria-hidden="true" tabindex="-1"></a>        viewof masterLanguage</span>
<span id="cb40-970"><a href="#cb40-970" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb40-971"><a href="#cb40-971" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">id</span> <span class="op">=</span> <span class="st">"nav-lang-selector"</span><span class="op">;</span></span>
<span id="cb40-972"><a href="#cb40-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-973"><a href="#cb40-973" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Hack the css together for the observable inputs</span></span>
<span id="cb40-974"><a href="#cb40-974" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"flex"</span><span class="op">;</span></span>
<span id="cb40-975"><a href="#cb40-975" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">alignItems</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb40-976"><a href="#cb40-976" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">marginLeft</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb40-977"><a href="#cb40-977" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lang_div <span class="op">=</span> lang_sel<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb40-978"><a href="#cb40-978" aria-hidden="true" tabindex="-1"></a>      lang_div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"flex"</span><span class="op">;</span></span>
<span id="cb40-979"><a href="#cb40-979" aria-hidden="true" tabindex="-1"></a>      lang_div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">flexDirection</span> <span class="op">=</span> <span class="st">"column"</span><span class="op">;</span></span>
<span id="cb40-980"><a href="#cb40-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-981"><a href="#cb40-981" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Insert the new item after the GitHub icon and other elements</span></span>
<span id="cb40-982"><a href="#cb40-982" aria-hidden="true" tabindex="-1"></a>      navEnd<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="fu">appendChild</span>(lang_sel)<span class="op">;</span></span>
<span id="cb40-983"><a href="#cb40-983" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-984"><a href="#cb40-984" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-985"><a href="#cb40-985" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-986"><a href="#cb40-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-987"><a href="#cb40-987" aria-hidden="true" tabindex="-1"></a><span class="fu">NavbarLangSelector</span>(languages<span class="op">,</span> masterLanguage)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-2" data-nodetype="expression"></div></div></div></div><section id="markdown-notebook-text" class="level3"><h3 data-anchor-id="markdown-notebook-text">Markdown notebook text</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="992" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 991"><span id="cb41-992"><a href="#cb41-992" aria-hidden="true" tabindex="-1"></a>dataPickMetric <span class="op">=</span> {</span>
<span id="cb41-993"><a href="#cb41-993" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb41-994"><a href="#cb41-994" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb41-995"><a href="#cb41-995" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"irr"</span><span class="op">,</span></span>
<span id="cb41-996"><a href="#cb41-996" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"irr"</span><span class="op">,</span></span>
<span id="cb41-997"><a href="#cb41-997" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb41-998"><a href="#cb41-998" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb41-999"><a href="#cb41-999" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb41-1000"><a href="#cb41-1000" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb41-1001"><a href="#cb41-1001" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb41-1002"><a href="#cb41-1002" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb41-1003"><a href="#cb41-1003" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb41-1004"><a href="#cb41-1004" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb41-1005"><a href="#cb41-1005" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb41-1006"><a href="#cb41-1006" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb41-1007"><a href="#cb41-1007" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb41-1008"><a href="#cb41-1008" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb41-1009"><a href="#cb41-1009" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"mirr"</span><span class="op">,</span></span>
<span id="cb41-1010"><a href="#cb41-1010" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"mirr"</span><span class="op">,</span></span>
<span id="cb41-1011"><a href="#cb41-1011" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb41-1012"><a href="#cb41-1012" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb41-1013"><a href="#cb41-1013" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb41-1014"><a href="#cb41-1014" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb41-1015"><a href="#cb41-1015" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb41-1016"><a href="#cb41-1016" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb41-1017"><a href="#cb41-1017" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb41-1018"><a href="#cb41-1018" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb41-1019"><a href="#cb41-1019" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb41-1020"><a href="#cb41-1020" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb41-1021"><a href="#cb41-1021" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb41-1022"><a href="#cb41-1022" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb41-1023"><a href="#cb41-1023" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"npv"</span><span class="op">,</span></span>
<span id="cb41-1024"><a href="#cb41-1024" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"npv"</span><span class="op">,</span></span>
<span id="cb41-1025"><a href="#cb41-1025" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb41-1026"><a href="#cb41-1026" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb41-1027"><a href="#cb41-1027" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb41-1028"><a href="#cb41-1028" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb41-1029"><a href="#cb41-1029" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb41-1030"><a href="#cb41-1030" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb41-1031"><a href="#cb41-1031" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb41-1032"><a href="#cb41-1032" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb41-1033"><a href="#cb41-1033" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb41-1034"><a href="#cb41-1034" aria-hidden="true" tabindex="-1"></a>       <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>()(d)</span>
<span id="cb41-1035"><a href="#cb41-1035" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb41-1036"><a href="#cb41-1036" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb41-1037"><a href="#cb41-1037" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"bcr"</span><span class="op">,</span></span>
<span id="cb41-1038"><a href="#cb41-1038" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"discounted_bcr"</span><span class="op">,</span></span>
<span id="cb41-1039"><a href="#cb41-1039" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb41-1040"><a href="#cb41-1040" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb41-1041"><a href="#cb41-1041" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb41-1042"><a href="#cb41-1042" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb41-1043"><a href="#cb41-1043" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb41-1044"><a href="#cb41-1044" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb41-1045"><a href="#cb41-1045" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb41-1046"><a href="#cb41-1046" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb41-1047"><a href="#cb41-1047" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb41-1048"><a href="#cb41-1048" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".2f"</span>)</span>
<span id="cb41-1049"><a href="#cb41-1049" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-1050"><a href="#cb41-1050" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb41-1051"><a href="#cb41-1051" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-33" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1055" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1054"><span id="cb42-1055"><a href="#cb42-1055" aria-hidden="true" tabindex="-1"></a>renderReview1 <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb42-1056"><a href="#cb42-1056" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langBasePath <span class="op">=</span> nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">insightReview</span><span class="op">.</span><span class="at">setupBlock</span><span class="op">;</span></span>
<span id="cb42-1057"><a href="#cb42-1057" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langMissingTemplate <span class="op">=</span> <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">missingMessage</span><span class="op">,</span> {</span>
<span id="cb42-1058"><a href="#cb42-1058" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1059"><a href="#cb42-1059" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb42-1060"><a href="#cb42-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1061"><a href="#cb42-1061" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isoSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_country)<span class="op">;</span></span>
<span id="cb42-1062"><a href="#cb42-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1063"><a href="#cb42-1063" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0List <span class="op">=</span> countries</span>
<span id="cb42-1064"><a href="#cb42-1064" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> isoSet<span class="op">.</span><span class="fu">has</span>(d<span class="op">.</span><span class="at">iso3c</span>))</span>
<span id="cb42-1065"><a href="#cb42-1065" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span>)<span class="op">;</span></span>
<span id="cb42-1066"><a href="#cb42-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1067"><a href="#cb42-1067" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cropList <span class="op">=</span> select_crop<span class="op">;</span></span>
<span id="cb42-1068"><a href="#cb42-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1069"><a href="#cb42-1069" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const cropList = adminCropChoices.crops.sort((a,b) =&gt; _lang(a.translation) &gt; _lang(b.translation));</span></span>
<span id="cb42-1070"><a href="#cb42-1070" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> truncateSize <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb42-1071"><a href="#cb42-1071" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0ListTruncated <span class="op">=</span> admin0List<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> truncateSize)<span class="op">;</span></span>
<span id="cb42-1072"><a href="#cb42-1072" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cropListTruncated <span class="op">=</span> cropList<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> truncateSize)<span class="op">;</span> <span class="co">// .map((d) =&gt; _lang(d.translation));</span></span>
<span id="cb42-1073"><a href="#cb42-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1074"><a href="#cb42-1074" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (admin0List<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">||</span> cropList<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb42-1075"><a href="#cb42-1075" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>langMissingTemplate<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb42-1076"><a href="#cb42-1076" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-1077"><a href="#cb42-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1078"><a href="#cb42-1078" aria-hidden="true" tabindex="-1"></a>  <span class="co">// new code</span></span>
<span id="cb42-1079"><a href="#cb42-1079" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropCount <span class="op">=</span> cropList<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb42-1080"><a href="#cb42-1080" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropWord <span class="op">=</span></span>
<span id="cb42-1081"><a href="#cb42-1081" aria-hidden="true" tabindex="-1"></a>    cropList<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb42-1082"><a href="#cb42-1082" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb42-1083"><a href="#cb42-1083" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1084"><a href="#cb42-1084" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb42-1085"><a href="#cb42-1085" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb42-1086"><a href="#cb42-1086" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1087"><a href="#cb42-1087" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb42-1088"><a href="#cb42-1088" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropList <span class="op">=</span> <span class="vs">`(**</span><span class="sc">${</span>cropListTruncated<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>)<span class="sc">}${</span></span>
<span id="cb42-1089"><a href="#cb42-1089" aria-hidden="true" tabindex="-1"></a>    cropList<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> truncateSize <span class="op">?</span> <span class="st">"..."</span> <span class="op">:</span> <span class="st">""</span></span>
<span id="cb42-1090"><a href="#cb42-1090" aria-hidden="true" tabindex="-1"></a>  <span class="sc">}</span><span class="vs">**)`</span><span class="op">;</span></span>
<span id="cb42-1091"><a href="#cb42-1091" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCrop <span class="op">=</span> <span class="vs">`**</span><span class="sc">${</span>insertCropCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertCropWord<span class="sc">}</span><span class="vs">** </span><span class="sc">${</span>insertCropList<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb42-1092"><a href="#cb42-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1093"><a href="#cb42-1093" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegionCount <span class="op">=</span> select_region<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb42-1094"><a href="#cb42-1094" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegionWord <span class="op">=</span></span>
<span id="cb42-1095"><a href="#cb42-1095" aria-hidden="true" tabindex="-1"></a>    insertRegionCount <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb42-1096"><a href="#cb42-1096" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb42-1097"><a href="#cb42-1097" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1098"><a href="#cb42-1098" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb42-1099"><a href="#cb42-1099" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb42-1100"><a href="#cb42-1100" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1101"><a href="#cb42-1101" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb42-1102"><a href="#cb42-1102" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegion <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>insertRegionCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertRegionWord<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb42-1103"><a href="#cb42-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1104"><a href="#cb42-1104" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryCount <span class="op">=</span> admin0List<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb42-1105"><a href="#cb42-1105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryWord <span class="op">=</span></span>
<span id="cb42-1106"><a href="#cb42-1106" aria-hidden="true" tabindex="-1"></a>    insertCountryCount <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb42-1107"><a href="#cb42-1107" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb42-1108"><a href="#cb42-1108" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1109"><a href="#cb42-1109" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb42-1110"><a href="#cb42-1110" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb42-1111"><a href="#cb42-1111" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1112"><a href="#cb42-1112" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb42-1113"><a href="#cb42-1113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryList <span class="op">=</span> <span class="vs">`(**</span><span class="sc">${</span>admin0ListTruncated<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>)<span class="sc">}${</span></span>
<span id="cb42-1114"><a href="#cb42-1114" aria-hidden="true" tabindex="-1"></a>    insertCountryCount <span class="op">&gt;</span> truncateSize <span class="op">?</span> <span class="st">"..."</span> <span class="op">:</span> <span class="st">""</span></span>
<span id="cb42-1115"><a href="#cb42-1115" aria-hidden="true" tabindex="-1"></a>  <span class="sc">}</span><span class="vs">**)`</span><span class="op">;</span></span>
<span id="cb42-1116"><a href="#cb42-1116" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountry <span class="op">=</span> <span class="vs">`**</span><span class="sc">${</span>insertCountryCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertCountryWord<span class="sc">}</span><span class="vs">** </span><span class="sc">${</span>insertCountryList<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb42-1117"><a href="#cb42-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1118"><a href="#cb42-1118" aria-hidden="true" tabindex="-1"></a>  <span class="co">// insert to template</span></span>
<span id="cb42-1119"><a href="#cb42-1119" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTemplate <span class="op">=</span> <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">template</span><span class="op">,</span> {</span>
<span id="cb42-1120"><a href="#cb42-1120" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb42-1121"><a href="#cb42-1121" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb42-1122"><a href="#cb42-1122" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTemplateItems <span class="op">=</span> [</span>
<span id="cb42-1123"><a href="#cb42-1123" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"crop_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertCrop }<span class="op">,</span></span>
<span id="cb42-1124"><a href="#cb42-1124" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"region_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertRegion }<span class="op">,</span></span>
<span id="cb42-1125"><a href="#cb42-1125" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"country_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertCountry }<span class="op">,</span></span>
<span id="cb42-1126"><a href="#cb42-1126" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-1127"><a href="#cb42-1127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"cost_string"</span><span class="op">,</span></span>
<span id="cb42-1128"><a href="#cb42-1128" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="fu">formatUSD</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })(rangeProjectCost)<span class="op">,</span></span>
<span id="cb42-1129"><a href="#cb42-1129" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb42-1130"><a href="#cb42-1130" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"year_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projectYears <span class="op">+</span> <span class="st">" years"</span> }<span class="op">,</span> <span class="co">//</span><span class="al">TODO</span><span class="co">: add correct "years" string at end of this</span></span>
<span id="cb42-1131"><a href="#cb42-1131" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb42-1132"><a href="#cb42-1132" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectionFormattedTemplate <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb42-1133"><a href="#cb42-1133" aria-hidden="true" tabindex="-1"></a>    langTemplate<span class="op">,</span></span>
<span id="cb42-1134"><a href="#cb42-1134" aria-hidden="true" tabindex="-1"></a>    langTemplateItems<span class="op">,</span></span>
<span id="cb42-1135"><a href="#cb42-1135" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb42-1136"><a href="#cb42-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1137"><a href="#cb42-1137" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>selectionFormattedTemplate<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb42-1138"><a href="#cb42-1138" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-34" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1142" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1141"><span id="cb43-1142"><a href="#cb43-1142" aria-hidden="true" tabindex="-1"></a>renderReview2 <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb43-1143"><a href="#cb43-1143" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> investmentTemplate <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb43-1144"><a href="#cb43-1144" aria-hidden="true" tabindex="-1"></a>    nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">insightReview</span><span class="op">.</span><span class="at">indicatorBlock</span><span class="op">,</span></span>
<span id="cb43-1145"><a href="#cb43-1145" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb43-1146"><a href="#cb43-1146" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> investmentTemplateItems <span class="op">=</span> [</span>
<span id="cb43-1147"><a href="#cb43-1147" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb43-1148"><a href="#cb43-1148" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"prod_impact_label"</span><span class="op">,</span></span>
<span id="cb43-1149"><a href="#cb43-1149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb43-1150"><a href="#cb43-1150" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1151"><a href="#cb43-1151" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb43-1152"><a href="#cb43-1152" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"adoption_rate_label"</span><span class="op">,</span></span>
<span id="cb43-1153"><a href="#cb43-1153" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb43-1154"><a href="#cb43-1154" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1155"><a href="#cb43-1155" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb43-1156"><a href="#cb43-1156" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"cis_impact_label"</span><span class="op">,</span></span>
<span id="cb43-1157"><a href="#cb43-1157" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb43-1158"><a href="#cb43-1158" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1159"><a href="#cb43-1159" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"year_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projectYears <span class="op">+</span> <span class="st">" years"</span> }<span class="op">,</span></span>
<span id="cb43-1160"><a href="#cb43-1160" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb43-1161"><a href="#cb43-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1162"><a href="#cb43-1162" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(investmentTemplate<span class="op">,</span> investmentTemplateItems)<span class="sc">}</span><span class="vs">:`</span><span class="op">;</span></span>
<span id="cb43-1163"><a href="#cb43-1163" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-35" data-nodetype="declaration"></div></div></div></section><section id="result-elements" class="level3"><h3 data-anchor-id="result-elements">Result Elements</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1169" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1168"><span id="cb44-1169"><a href="#cb44-1169" aria-hidden="true" tabindex="-1"></a>bigNumbersResults <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb44-1170"><a href="#cb44-1170" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb44-1171"><a href="#cb44-1171" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> e <span class="op">=</span> walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span><span class="op">?.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> y)<span class="op">;</span></span>
<span id="cb44-1172"><a href="#cb44-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1173"><a href="#cb44-1173" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataPickMetric<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb44-1174"><a href="#cb44-1174" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> value<span class="op">;</span></span>
<span id="cb44-1175"><a href="#cb44-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1176"><a href="#cb44-1176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"irr"</span> <span class="op">&amp;&amp;</span> e<span class="op">?.</span><span class="at">irr</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb44-1177"><a href="#cb44-1177" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">.</span><span class="at">irr</span><span class="op">;</span> <span class="co">// IRR as percentage</span></span>
<span id="cb44-1178"><a href="#cb44-1178" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"mirr"</span> <span class="op">&amp;&amp;</span> e<span class="op">?.</span><span class="at">mirr</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb44-1179"><a href="#cb44-1179" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">.</span><span class="at">mirr</span><span class="op">;</span> <span class="co">// MIRR as percentage</span></span>
<span id="cb44-1180"><a href="#cb44-1180" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (</span>
<span id="cb44-1181"><a href="#cb44-1181" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"npv"</span> <span class="op">&amp;&amp;</span></span>
<span id="cb44-1182"><a href="#cb44-1182" aria-hidden="true" tabindex="-1"></a>      e<span class="op">?.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span></span>
<span id="cb44-1183"><a href="#cb44-1183" aria-hidden="true" tabindex="-1"></a>      e<span class="op">?.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span></span>
<span id="cb44-1184"><a href="#cb44-1184" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb44-1185"><a href="#cb44-1185" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> <span class="op">+</span>(e<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">-</span> e<span class="op">.</span><span class="at">discounted_cost_cum</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="co">// NPV, 1 dp</span></span>
<span id="cb44-1186"><a href="#cb44-1186" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"bcr"</span>) {</span>
<span id="cb44-1187"><a href="#cb44-1187" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">?.</span><span class="at">discounted_bcr</span><span class="op">;</span></span>
<span id="cb44-1188"><a href="#cb44-1188" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-1189"><a href="#cb44-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1190"><a href="#cb44-1190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>d<span class="op">,</span> value }<span class="op">;</span></span>
<span id="cb44-1191"><a href="#cb44-1191" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb44-1192"><a href="#cb44-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1193"><a href="#cb44-1193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb44-1194"><a href="#cb44-1194" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;style&gt;</span></span>
<span id="cb44-1195"><a href="#cb44-1195" aria-hidden="true" tabindex="-1"></a><span class="vs">    .outer-div {</span></span>
<span id="cb44-1196"><a href="#cb44-1196" aria-hidden="true" tabindex="-1"></a><span class="vs">      display: flex;</span></span>
<span id="cb44-1197"><a href="#cb44-1197" aria-hidden="true" tabindex="-1"></a><span class="vs">      gap: 2em;</span></span>
<span id="cb44-1198"><a href="#cb44-1198" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1199"><a href="#cb44-1199" aria-hidden="true" tabindex="-1"></a><span class="vs">    .inner-div {</span></span>
<span id="cb44-1200"><a href="#cb44-1200" aria-hidden="true" tabindex="-1"></a><span class="vs">      width: 30%;</span></span>
<span id="cb44-1201"><a href="#cb44-1201" aria-hidden="true" tabindex="-1"></a><span class="vs">      padding: 80px 30px;</span></span>
<span id="cb44-1202"><a href="#cb44-1202" aria-hidden="true" tabindex="-1"></a><span class="vs">      border: 1px solid #efefef;</span></span>
<span id="cb44-1203"><a href="#cb44-1203" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1204"><a href="#cb44-1204" aria-hidden="true" tabindex="-1"></a><span class="vs">    .label {</span></span>
<span id="cb44-1205"><a href="#cb44-1205" aria-hidden="true" tabindex="-1"></a><span class="vs">      display: block;</span></span>
<span id="cb44-1206"><a href="#cb44-1206" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-weight: 400;</span></span>
<span id="cb44-1207"><a href="#cb44-1207" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-size: 14px;</span></span>
<span id="cb44-1208"><a href="#cb44-1208" aria-hidden="true" tabindex="-1"></a><span class="vs">      text-transform: uppercase;</span></span>
<span id="cb44-1209"><a href="#cb44-1209" aria-hidden="true" tabindex="-1"></a><span class="vs">      color: #666;</span></span>
<span id="cb44-1210"><a href="#cb44-1210" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1211"><a href="#cb44-1211" aria-hidden="true" tabindex="-1"></a><span class="vs">    .value {</span></span>
<span id="cb44-1212"><a href="#cb44-1212" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-weight: bold;</span></span>
<span id="cb44-1213"><a href="#cb44-1213" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-size: 42px;</span></span>
<span id="cb44-1214"><a href="#cb44-1214" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1215"><a href="#cb44-1215" aria-hidden="true" tabindex="-1"></a><span class="vs">    .negative {</span></span>
<span id="cb44-1216"><a href="#cb44-1216" aria-hidden="true" tabindex="-1"></a><span class="vs">      color: #EC5A47;</span></span>
<span id="cb44-1217"><a href="#cb44-1217" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1218"><a href="#cb44-1218" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card {</span></span>
<span id="cb44-1219"><a href="#cb44-1219" aria-hidden="true" tabindex="-1"></a><span class="vs">        position: relative;</span></span>
<span id="cb44-1220"><a href="#cb44-1220" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: inline-block;</span></span>
<span id="cb44-1221"><a href="#cb44-1221" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb44-1222"><a href="#cb44-1222" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 100%;</span></span>
<span id="cb44-1223"><a href="#cb44-1223" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1224"><a href="#cb44-1224" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card .tooltiptext-card {</span></span>
<span id="cb44-1225"><a href="#cb44-1225" aria-hidden="true" tabindex="-1"></a><span class="vs">        position: absolute;</span></span>
<span id="cb44-1226"><a href="#cb44-1226" aria-hidden="true" tabindex="-1"></a><span class="vs">        z-index: 1;</span></span>
<span id="cb44-1227"><a href="#cb44-1227" aria-hidden="true" tabindex="-1"></a><span class="vs">        visibility: hidden;</span></span>
<span id="cb44-1228"><a href="#cb44-1228" aria-hidden="true" tabindex="-1"></a><span class="vs">        left: 0;</span></span>
<span id="cb44-1229"><a href="#cb44-1229" aria-hidden="true" tabindex="-1"></a><span class="vs">        bottom: 90%;</span></span>
<span id="cb44-1230"><a href="#cb44-1230" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #efefef;</span></span>
<span id="cb44-1231"><a href="#cb44-1231" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #333;</span></span>
<span id="cb44-1232"><a href="#cb44-1232" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 14px 20px;</span></span>
<span id="cb44-1233"><a href="#cb44-1233" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb44-1234"><a href="#cb44-1234" aria-hidden="true" tabindex="-1"></a><span class="vs">        line-height: 1.6;</span></span>
<span id="cb44-1235"><a href="#cb44-1235" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: left;</span></span>
<span id="cb44-1236"><a href="#cb44-1236" aria-hidden="true" tabindex="-1"></a><span class="vs">        opacity: 0;</span></span>
<span id="cb44-1237"><a href="#cb44-1237" aria-hidden="true" tabindex="-1"></a><span class="vs">        transition: opacity 0.3s;</span></span>
<span id="cb44-1238"><a href="#cb44-1238" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1239"><a href="#cb44-1239" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card:hover .tooltiptext-card {</span></span>
<span id="cb44-1240"><a href="#cb44-1240" aria-hidden="true" tabindex="-1"></a><span class="vs">        visibility: visible;</span></span>
<span id="cb44-1241"><a href="#cb44-1241" aria-hidden="true" tabindex="-1"></a><span class="vs">        opacity: 1;</span></span>
<span id="cb44-1242"><a href="#cb44-1242" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: default;</span></span>
<span id="cb44-1243"><a href="#cb44-1243" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb44-1244"><a href="#cb44-1244" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/style&gt;</span></span>
<span id="cb44-1245"><a href="#cb44-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1246"><a href="#cb44-1246" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;body&gt;</span></span>
<span id="cb44-1247"><a href="#cb44-1247" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="outer-div"&gt;</span></span>
<span id="cb44-1248"><a href="#cb44-1248" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>data<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb44-1249"><a href="#cb44-1249" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div class="inner-div"&gt;</span></span>
<span id="cb44-1250"><a href="#cb44-1250" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;span class="tooltip-card"&gt;</span></span>
<span id="cb44-1251"><a href="#cb44-1251" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="tooltiptext-card"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">tooltip</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb44-1252"><a href="#cb44-1252" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="value </span><span class="sc">${</span>d<span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"negative"</span> <span class="op">:</span> <span class="st">""</span><span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span></span>
<span id="cb44-1253"><a href="#cb44-1253" aria-hidden="true" tabindex="-1"></a>              d<span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> d<span class="op">.</span><span class="fu">yFormat</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">:</span> <span class="st">"---"</span></span>
<span id="cb44-1254"><a href="#cb44-1254" aria-hidden="true" tabindex="-1"></a>            <span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb44-1255"><a href="#cb44-1255" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="label"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">labelFull</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb44-1256"><a href="#cb44-1256" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/span&gt;</span></span>
<span id="cb44-1257"><a href="#cb44-1257" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb44-1258"><a href="#cb44-1258" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">}</span></span>
<span id="cb44-1259"><a href="#cb44-1259" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb44-1260"><a href="#cb44-1260" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/body&gt;`</span><span class="op">;</span></span>
<span id="cb44-1261"><a href="#cb44-1261" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-36" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1265" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1264"><span id="cb45-1265"><a href="#cb45-1265" aria-hidden="true" tabindex="-1"></a>resultTable <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb45-1266"><a href="#cb45-1266" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fmtUSD <span class="op">=</span> <span class="fu">formatUSD</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })<span class="op">;</span></span>
<span id="cb45-1267"><a href="#cb45-1267" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedYear <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb45-1268"><a href="#cb45-1268" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> enriched <span class="op">=</span> (walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span> <span class="op">??</span> [])<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb45-1269"><a href="#cb45-1269" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">&lt;=</span> selectedYear<span class="op">,</span></span>
<span id="cb45-1270"><a href="#cb45-1270" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb45-1271"><a href="#cb45-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1272"><a href="#cb45-1272" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tableHeaders <span class="op">=</span></span>
<span id="cb45-1273"><a href="#cb45-1273" aria-hidden="true" tabindex="-1"></a>    nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">exploreIndicators</span><span class="op">.</span><span class="at">tableHeaders</span><span class="op">;</span></span>
<span id="cb45-1274"><a href="#cb45-1274" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> headerNames <span class="op">=</span> [</span>
<span id="cb45-1275"><a href="#cb45-1275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">year</span>)<span class="op">,</span></span>
<span id="cb45-1276"><a href="#cb45-1276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">benefit</span>)<span class="op">,</span></span>
<span id="cb45-1277"><a href="#cb45-1277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">cost</span>)<span class="op">,</span></span>
<span id="cb45-1278"><a href="#cb45-1278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">cashflow</span>)<span class="op">,</span></span>
<span id="cb45-1279"><a href="#cb45-1279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedBenefitCum</span>)<span class="op">,</span></span>
<span id="cb45-1280"><a href="#cb45-1280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedCostCum</span>)<span class="op">,</span></span>
<span id="cb45-1281"><a href="#cb45-1281" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedNpvCum</span>)<span class="op">,</span></span>
<span id="cb45-1282"><a href="#cb45-1282" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedBcr</span>)<span class="op">,</span></span>
<span id="cb45-1283"><a href="#cb45-1283" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">irr</span>)<span class="op">,</span></span>
<span id="cb45-1284"><a href="#cb45-1284" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">mirr</span>)<span class="op">,</span></span>
<span id="cb45-1285"><a href="#cb45-1285" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb45-1286"><a href="#cb45-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1287"><a href="#cb45-1287" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb45-1288"><a href="#cb45-1288" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;style&gt;</span></span>
<span id="cb45-1289"><a href="#cb45-1289" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table {</span></span>
<span id="cb45-1290"><a href="#cb45-1290" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-family: sans-serif;</span></span>
<span id="cb45-1291"><a href="#cb45-1291" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-collapse: collapse;</span></span>
<span id="cb45-1292"><a href="#cb45-1292" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 13.75px;</span></span>
<span id="cb45-1293"><a href="#cb45-1293" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-top: 1em;</span></span>
<span id="cb45-1294"><a href="#cb45-1294" aria-hidden="true" tabindex="-1"></a><span class="vs">        min-width: 100%;</span></span>
<span id="cb45-1295"><a href="#cb45-1295" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb45-1296"><a href="#cb45-1296" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table th, .econ-table td {</span></span>
<span id="cb45-1297"><a href="#cb45-1297" aria-hidden="true" tabindex="-1"></a><span class="vs">        border: 1px solid #ddd;</span></span>
<span id="cb45-1298"><a href="#cb45-1298" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 6px 10px;</span></span>
<span id="cb45-1299"><a href="#cb45-1299" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: right;</span></span>
<span id="cb45-1300"><a href="#cb45-1300" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb45-1301"><a href="#cb45-1301" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table th {</span></span>
<span id="cb45-1302"><a href="#cb45-1302" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #f4f4f4;</span></span>
<span id="cb45-1303"><a href="#cb45-1303" aria-hidden="true" tabindex="-1"></a><span class="vs">        white-space: normal;</span></span>
<span id="cb45-1304"><a href="#cb45-1304" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb45-1305"><a href="#cb45-1305" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb45-1306"><a href="#cb45-1306" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table td.year-col {</span></span>
<span id="cb45-1307"><a href="#cb45-1307" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb45-1308"><a href="#cb45-1308" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: bold;</span></span>
<span id="cb45-1309"><a href="#cb45-1309" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb45-1310"><a href="#cb45-1310" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table tr.final-row td {</span></span>
<span id="cb45-1311"><a href="#cb45-1311" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: bold;</span></span>
<span id="cb45-1312"><a href="#cb45-1312" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #f1f1f1;</span></span>
<span id="cb45-1313"><a href="#cb45-1313" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb45-1314"><a href="#cb45-1314" aria-hidden="true" tabindex="-1"></a><span class="vs">      .table-container {</span></span>
<span id="cb45-1315"><a href="#cb45-1315" aria-hidden="true" tabindex="-1"></a><span class="vs">        overflow-x: auto;</span></span>
<span id="cb45-1316"><a href="#cb45-1316" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: block;</span></span>
<span id="cb45-1317"><a href="#cb45-1317" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding-bottom: 4px;</span></span>
<span id="cb45-1318"><a href="#cb45-1318" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb45-1319"><a href="#cb45-1319" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/style&gt;</span></span>
<span id="cb45-1320"><a href="#cb45-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1321"><a href="#cb45-1321" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="table-container"&gt;</span></span>
<span id="cb45-1322"><a href="#cb45-1322" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;table class="econ-table"&gt;</span></span>
<span id="cb45-1323"><a href="#cb45-1323" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;thead&gt;</span></span>
<span id="cb45-1324"><a href="#cb45-1324" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;tr&gt;</span></span>
<span id="cb45-1325"><a href="#cb45-1325" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">${</span>headerNames<span class="op">.</span><span class="fu">map</span>((h) <span class="kw">=&gt;</span> <span class="fu">html</span><span class="vs">`&lt;th title="</span><span class="sc">${</span>h<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>h<span class="sc">}</span><span class="vs">&lt;/th&gt;`</span>)<span class="sc">}</span></span>
<span id="cb45-1326"><a href="#cb45-1326" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/tr&gt;</span></span>
<span id="cb45-1327"><a href="#cb45-1327" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/thead&gt;</span></span>
<span id="cb45-1328"><a href="#cb45-1328" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;tbody&gt;</span></span>
<span id="cb45-1329"><a href="#cb45-1329" aria-hidden="true" tabindex="-1"></a><span class="vs">          </span><span class="sc">${</span>enriched<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb45-1330"><a href="#cb45-1330" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> isFinal <span class="op">=</span> i <span class="op">===</span> enriched<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb45-1331"><a href="#cb45-1331" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> npv_i <span class="op">=</span></span>
<span id="cb45-1332"><a href="#cb45-1332" aria-hidden="true" tabindex="-1"></a>              d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span></span>
<span id="cb45-1333"><a href="#cb45-1333" aria-hidden="true" tabindex="-1"></a>                <span class="op">?</span> d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">-</span> d<span class="op">.</span><span class="at">discounted_cost_cum</span></span>
<span id="cb45-1334"><a href="#cb45-1334" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb45-1335"><a href="#cb45-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1336"><a href="#cb45-1336" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;tr class=</span><span class="sc">${</span>isFinal <span class="op">?</span> <span class="st">"final-row"</span> <span class="op">:</span> <span class="st">""</span><span class="sc">}</span><span class="vs">&gt;</span></span>
<span id="cb45-1337"><a href="#cb45-1337" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td class="year-col"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">year</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1338"><a href="#cb45-1338" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">project_benefit</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">project_benefit</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1339"><a href="#cb45-1339" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">cost</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">cost</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1340"><a href="#cb45-1340" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">cashflow</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">cashflow</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1341"><a href="#cb45-1341" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">discounted_benefit_cum</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1342"><a href="#cb45-1342" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">discounted_cost_cum</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1343"><a href="#cb45-1343" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>npv_i <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(npv_i) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1344"><a href="#cb45-1344" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_bcr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> d<span class="op">.</span><span class="at">discounted_bcr</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1345"><a href="#cb45-1345" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">irr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>(d<span class="op">.</span><span class="at">irr</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">%`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1346"><a href="#cb45-1346" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">mirr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>(d<span class="op">.</span><span class="at">mirr</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">%`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb45-1347"><a href="#cb45-1347" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/tr&gt;`</span><span class="op">;</span></span>
<span id="cb45-1348"><a href="#cb45-1348" aria-hidden="true" tabindex="-1"></a>          })<span class="sc">}</span></span>
<span id="cb45-1349"><a href="#cb45-1349" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/tbody&gt;</span></span>
<span id="cb45-1350"><a href="#cb45-1350" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/table&gt;</span></span>
<span id="cb45-1351"><a href="#cb45-1351" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb45-1352"><a href="#cb45-1352" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb45-1353"><a href="#cb45-1353" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-37" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1357" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1356"><span id="cb46-1357"><a href="#cb46-1357" aria-hidden="true" tabindex="-1"></a>resultPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb46-1358"><a href="#cb46-1358" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectYearCutoff <span class="op">=</span> walkthroughSelections<span class="op">.</span><span class="at">project_years</span><span class="op">;</span></span>
<span id="cb46-1359"><a href="#cb46-1359" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selector <span class="op">=</span> pickMetricWalkthrough<span class="op">;</span></span>
<span id="cb46-1360"><a href="#cb46-1360" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotData <span class="op">=</span> walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span> <span class="op">??</span> []<span class="op">;</span></span>
<span id="cb46-1361"><a href="#cb46-1361" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uncertaintyYearly <span class="op">=</span> uncertainty<span class="op">?.</span><span class="at">yearly</span> <span class="op">??</span> []<span class="op">;</span></span>
<span id="cb46-1362"><a href="#cb46-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1363"><a href="#cb46-1363" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Always include all years for consistent x-axis</span></span>
<span id="cb46-1364"><a href="#cb46-1364" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fullYears <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> projectYears <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// 0 to 8 inclusive</span></span>
<span id="cb46-1365"><a href="#cb46-1365" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> completePlotData <span class="op">=</span> fullYears<span class="op">.</span><span class="fu">map</span>((y) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1366"><a href="#cb46-1366" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> row <span class="op">=</span> plotData<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> y)<span class="op">;</span></span>
<span id="cb46-1367"><a href="#cb46-1367" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> row <span class="op">??</span> { <span class="dt">year</span><span class="op">:</span> y }<span class="op">;</span></span>
<span id="cb46-1368"><a href="#cb46-1368" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb46-1369"><a href="#cb46-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1370"><a href="#cb46-1370" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bandData <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb46-1371"><a href="#cb46-1371" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> metricKey <span class="op">=</span> selector<span class="op">.</span><span class="at">key</span><span class="op">;</span></span>
<span id="cb46-1372"><a href="#cb46-1372" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fullYears</span>
<span id="cb46-1373"><a href="#cb46-1373" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span>((year) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1374"><a href="#cb46-1374" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> row <span class="op">=</span> uncertaintyYearly<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> year)<span class="op">;</span></span>
<span id="cb46-1375"><a href="#cb46-1375" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> low <span class="op">=</span> row<span class="op">?.</span>[metricKey]<span class="op">?.</span><span class="at">p10</span><span class="op">;</span></span>
<span id="cb46-1376"><a href="#cb46-1376" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> high <span class="op">=</span> row<span class="op">?.</span>[metricKey]<span class="op">?.</span><span class="at">p90</span><span class="op">;</span></span>
<span id="cb46-1377"><a href="#cb46-1377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(low) <span class="op">||</span> <span class="op">!</span><span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(high)) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb46-1378"><a href="#cb46-1378" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> { year<span class="op">,</span> low<span class="op">,</span> high }<span class="op">;</span></span>
<span id="cb46-1379"><a href="#cb46-1379" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb46-1380"><a href="#cb46-1380" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d <span class="op">!=</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb46-1381"><a href="#cb46-1381" aria-hidden="true" tabindex="-1"></a>  })()<span class="op">;</span></span>
<span id="cb46-1382"><a href="#cb46-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1383"><a href="#cb46-1383" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ruleYValue <span class="op">=</span> selector<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"bcr"</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb46-1384"><a href="#cb46-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1385"><a href="#cb46-1385" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb46-1386"><a href="#cb46-1386" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb46-1387"><a href="#cb46-1387" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb46-1388"><a href="#cb46-1388" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inset</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb46-1389"><a href="#cb46-1389" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb46-1390"><a href="#cb46-1390" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb46-1391"><a href="#cb46-1391" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">exploreIndicators</span><span class="op">.</span><span class="at">projectYear</span><span class="op">,</span></span>
<span id="cb46-1392"><a href="#cb46-1392" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb46-1393"><a href="#cb46-1393" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> fullYears<span class="op">,</span></span>
<span id="cb46-1394"><a href="#cb46-1394" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> <span class="st">"d"</span><span class="op">,</span></span>
<span id="cb46-1395"><a href="#cb46-1395" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb46-1396"><a href="#cb46-1396" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelArrow</span><span class="op">:</span> <span class="st">"none"</span><span class="op">,</span></span>
<span id="cb46-1397"><a href="#cb46-1397" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb46-1398"><a href="#cb46-1398" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb46-1399"><a href="#cb46-1399" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb46-1400"><a href="#cb46-1400" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb46-1401"><a href="#cb46-1401" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb46-1402"><a href="#cb46-1402" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb46-1403"><a href="#cb46-1403" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>({</span>
<span id="cb46-1404"><a href="#cb46-1404" aria-hidden="true" tabindex="-1"></a>        <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb46-1405"><a href="#cb46-1405" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb46-1406"><a href="#cb46-1406" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickFormat</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb46-1407"><a href="#cb46-1407" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb46-1408"><a href="#cb46-1408" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1409"><a href="#cb46-1409" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> d <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"#EC5A47"</span><span class="op">;</span></span>
<span id="cb46-1410"><a href="#cb46-1410" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb46-1411"><a href="#cb46-1411" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb46-1412"><a href="#cb46-1412" aria-hidden="true" tabindex="-1"></a>      <span class="co">// horizontal reference line</span></span>
<span id="cb46-1413"><a href="#cb46-1413" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([ruleYValue]<span class="op">,</span> {</span>
<span id="cb46-1414"><a href="#cb46-1414" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb46-1415"><a href="#cb46-1415" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeDasharray</span><span class="op">:</span> [<span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb46-1416"><a href="#cb46-1416" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb46-1417"><a href="#cb46-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1418"><a href="#cb46-1418" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">areaY</span>(bandData<span class="op">,</span> {</span>
<span id="cb46-1419"><a href="#cb46-1419" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb46-1420"><a href="#cb46-1420" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> <span class="st">"low"</span><span class="op">,</span></span>
<span id="cb46-1421"><a href="#cb46-1421" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> <span class="st">"high"</span><span class="op">,</span></span>
<span id="cb46-1422"><a href="#cb46-1422" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"#2c7fb8"</span><span class="op">,</span></span>
<span id="cb46-1423"><a href="#cb46-1423" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.16</span><span class="op">,</span></span>
<span id="cb46-1424"><a href="#cb46-1424" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb46-1425"><a href="#cb46-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1426"><a href="#cb46-1426" aria-hidden="true" tabindex="-1"></a>      <span class="co">// line</span></span>
<span id="cb46-1427"><a href="#cb46-1427" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">line</span>(completePlotData<span class="op">,</span> {</span>
<span id="cb46-1428"><a href="#cb46-1428" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb46-1429"><a href="#cb46-1429" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb46-1430"><a href="#cb46-1430" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb46-1431"><a href="#cb46-1431" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb46-1432"><a href="#cb46-1432" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb46-1433"><a href="#cb46-1433" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb46-1434"><a href="#cb46-1434" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb46-1435"><a href="#cb46-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1436"><a href="#cb46-1436" aria-hidden="true" tabindex="-1"></a>      <span class="co">// dots</span></span>
<span id="cb46-1437"><a href="#cb46-1437" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(completePlotData<span class="op">,</span> {</span>
<span id="cb46-1438"><a href="#cb46-1438" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb46-1439"><a href="#cb46-1439" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb46-1440"><a href="#cb46-1440" aria-hidden="true" tabindex="-1"></a>        <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb46-1441"><a href="#cb46-1441" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb46-1442"><a href="#cb46-1442" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb46-1443"><a href="#cb46-1443" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb46-1444"><a href="#cb46-1444" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> {</span>
<span id="cb46-1445"><a href="#cb46-1445" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb46-1446"><a href="#cb46-1446" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb46-1447"><a href="#cb46-1447" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb46-1448"><a href="#cb46-1448" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb46-1449"><a href="#cb46-1449" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb46-1450"><a href="#cb46-1450" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb46-1451"><a href="#cb46-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1452"><a href="#cb46-1452" aria-hidden="true" tabindex="-1"></a>      <span class="co">// highlight selected year</span></span>
<span id="cb46-1453"><a href="#cb46-1453" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb46-1454"><a href="#cb46-1454" aria-hidden="true" tabindex="-1"></a>        completePlotData<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> projectYearCutoff)<span class="op">,</span></span>
<span id="cb46-1455"><a href="#cb46-1455" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb46-1456"><a href="#cb46-1456" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb46-1457"><a href="#cb46-1457" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb46-1458"><a href="#cb46-1458" aria-hidden="true" tabindex="-1"></a>          <span class="dt">r</span><span class="op">:</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb46-1459"><a href="#cb46-1459" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb46-1460"><a href="#cb46-1460" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d[selector<span class="op">.</span><span class="at">columnName</span>] <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"#333"</span> <span class="op">:</span> <span class="st">"#EC5A47"</span>)<span class="op">,</span></span>
<span id="cb46-1461"><a href="#cb46-1461" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb46-1462"><a href="#cb46-1462" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb46-1463"><a href="#cb46-1463" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb46-1464"><a href="#cb46-1464" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb46-1465"><a href="#cb46-1465" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb46-1466"><a href="#cb46-1466" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-38" data-nodetype="declaration"></div></div></div></section></section><section id="data-analysis-and-processing" class="level2"><h2 data-anchor-id="data-analysis-and-processing">Data Analysis and Processing</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1472" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1471"><span id="cb47-1472"><a href="#cb47-1472" aria-hidden="true" tabindex="-1"></a>admin0_names <span class="op">=</span> {</span>
<span id="cb47-1473"><a href="#cb47-1473" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isoSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_country)<span class="op">;</span></span>
<span id="cb47-1474"><a href="#cb47-1474" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> countries</span>
<span id="cb47-1475"><a href="#cb47-1475" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> isoSet<span class="op">.</span><span class="fu">has</span>(d<span class="op">.</span><span class="at">iso3c</span>))</span>
<span id="cb47-1476"><a href="#cb47-1476" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span>)<span class="op">;</span></span>
<span id="cb47-1477"><a href="#cb47-1477" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-39" data-nodetype="declaration"></div></div></div><section id="cv-data" class="level3"><h3 data-anchor-id="cv-data">CV Data</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1483" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1482"><span id="cb48-1483"><a href="#cb48-1483" aria-hidden="true" tabindex="-1"></a><span class="co">// Module Imports for the calculation of ROI data</span></span>
<span id="cb48-1484"><a href="#cb48-1484" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb48-1485"><a href="#cb48-1485" aria-hidden="true" tabindex="-1"></a>  avlossCalc<span class="op">,</span></span>
<span id="cb48-1486"><a href="#cb48-1486" aria-hidden="true" tabindex="-1"></a>  avlossCalcUncertainty<span class="op">,</span></span>
<span id="cb48-1487"><a href="#cb48-1487" aria-hidden="true" tabindex="-1"></a>  calcMIRR<span class="op">,</span></span>
<span id="cb48-1488"><a href="#cb48-1488" aria-hidden="true" tabindex="-1"></a>  calcIRR<span class="op">,</span></span>
<span id="cb48-1489"><a href="#cb48-1489" aria-hidden="true" tabindex="-1"></a>  npvDiscreteCumulative<span class="op">,</span></span>
<span id="cb48-1490"><a href="#cb48-1490" aria-hidden="true" tabindex="-1"></a>  runSimulationFromCashflowRows<span class="op">,</span></span>
<span id="cb48-1491"><a href="#cb48-1491" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/notebooks/roi/roi_tools.js"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-40" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1496" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1495"><span id="cb49-1496"><a href="#cb49-1496" aria-hidden="true" tabindex="-1"></a>mutable cv_result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb49-1497"><a href="#cb49-1497" aria-hidden="true" tabindex="-1"></a>mutable cv_cache_key <span class="op">=</span> <span class="st">''</span><span class="op">;</span></span>
<span id="cb49-1498"><a href="#cb49-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1499"><a href="#cb49-1499" aria-hidden="true" tabindex="-1"></a>calcCV <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb49-1500"><a href="#cb49-1500" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cis_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb49-1501"><a href="#cb49-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1502"><a href="#cb49-1502" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cache_key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>[<span class="op">...</span>admin0_names]<span class="op">.</span><span class="fu">sort</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>[<span class="op">...</span>select_crop]<span class="op">.</span><span class="fu">sort</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>cis_impact<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb49-1503"><a href="#cb49-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1504"><a href="#cb49-1504" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cv_cache_key <span class="op">===</span> cache_key) {</span>
<span id="cb49-1505"><a href="#cb49-1505" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Skipped cv run as inputs the same'</span>)<span class="op">;</span></span>
<span id="cb49-1506"><a href="#cb49-1506" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cv_result<span class="op">;</span></span>
<span id="cb49-1507"><a href="#cb49-1507" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-1508"><a href="#cb49-1508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1509"><a href="#cb49-1509" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Running the cv analysis as inputs changed'</span>)</span>
<span id="cb49-1510"><a href="#cb49-1510" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb49-1511"><a href="#cb49-1511" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb49-1512"><a href="#cb49-1512" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM cv</span></span>
<span id="cb49-1513"><a href="#cb49-1513" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE crop in ('</span><span class="sc">${</span>select_crop<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb49-1514"><a href="#cb49-1514" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND admin0_name in ('</span><span class="sc">${</span>admin0_names<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">') -- This needs the a0_name rather than iso3</span></span>
<span id="cb49-1515"><a href="#cb49-1515" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb49-1516"><a href="#cb49-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1517"><a href="#cb49-1517" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_monteCarlo <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>(</span>
<span id="cb49-1518"><a href="#cb49-1518" aria-hidden="true" tabindex="-1"></a>    cv_data<span class="op">.</span><span class="fu">map</span>(<span class="kw">async</span> ({ crop<span class="op">,</span> admin0_name<span class="op">,</span> cv }) <span class="kw">=&gt;</span> {</span>
<span id="cb49-1519"><a href="#cb49-1519" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> av <span class="op">=</span> <span class="cf">await</span> <span class="fu">avlossCalc</span>(cv<span class="op">,</span> cis_impact)<span class="op">;</span></span>
<span id="cb49-1520"><a href="#cb49-1520" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> avloss <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="bu">Number</span>(av<span class="op">.</span><span class="at">toFixed</span><span class="op">?.</span>(<span class="dv">4</span>) <span class="op">??</span> av))<span class="op">;</span></span>
<span id="cb49-1521"><a href="#cb49-1521" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { admin0_name<span class="op">,</span> crop<span class="op">,</span> cv<span class="op">,</span> cis_impact<span class="op">,</span> avloss }<span class="op">;</span></span>
<span id="cb49-1522"><a href="#cb49-1522" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb49-1523"><a href="#cb49-1523" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb49-1524"><a href="#cb49-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1525"><a href="#cb49-1525" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_index <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb49-1526"><a href="#cb49-1526" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> { admin0_name<span class="op">,</span> crop<span class="op">,</span> avloss } <span class="kw">of</span> cv_monteCarlo) {</span>
<span id="cb49-1527"><a href="#cb49-1527" aria-hidden="true" tabindex="-1"></a>    cv_index<span class="op">.</span><span class="fu">set</span>(<span class="vs">`</span><span class="sc">${</span>admin0_name<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>crop<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> avloss)<span class="op">;</span></span>
<span id="cb49-1528"><a href="#cb49-1528" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-1529"><a href="#cb49-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1530"><a href="#cb49-1530" aria-hidden="true" tabindex="-1"></a>  mutable cv_result <span class="op">=</span> cv_index</span>
<span id="cb49-1531"><a href="#cb49-1531" aria-hidden="true" tabindex="-1"></a>  mutable cv_cache_key <span class="op">=</span> cache_key</span>
<span id="cb49-1532"><a href="#cb49-1532" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> cv_index</span>
<span id="cb49-1533"><a href="#cb49-1533" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-41-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-41-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-41-3" data-nodetype="declaration"></div></div></div></div></section><section id="other-roi-x-exposure-variables" class="level3"><h3 data-anchor-id="other-roi-x-exposure-variables">Other ROI X Exposure Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1538" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1537"><span id="cb50-1538"><a href="#cb50-1538" aria-hidden="true" tabindex="-1"></a><span class="co">// getExposureData = async (crops, countries) =&gt; {</span></span>
<span id="cb50-1539"><a href="#cb50-1539" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">NOTE</span><span class="co">: Making this a dataset rather than a function so it only re-runs when crop or country change.</span></span>
<span id="cb50-1540"><a href="#cb50-1540" aria-hidden="true" tabindex="-1"></a><span class="co">// Defaulting to all admin 1 data as all admin regions are selected by defualt and this</span></span>
<span id="cb50-1541"><a href="#cb50-1541" aria-hidden="true" tabindex="-1"></a><span class="co">// will prevent having to have users re-query the datasets when changing regions in a county.</span></span>
<span id="cb50-1542"><a href="#cb50-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1543"><a href="#cb50-1543" aria-hidden="true" tabindex="-1"></a>exposure_data <span class="op">=</span> {</span>
<span id="cb50-1544"><a href="#cb50-1544" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> crops <span class="op">=</span> select_crop<span class="op">;</span></span>
<span id="cb50-1545"><a href="#cb50-1545" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> countries <span class="op">=</span> select_country<span class="op">;</span></span>
<span id="cb50-1546"><a href="#cb50-1546" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb50-1547"><a href="#cb50-1547" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb50-1548"><a href="#cb50-1548" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM exposure</span></span>
<span id="cb50-1549"><a href="#cb50-1549" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE crop in ('</span><span class="sc">${</span>crops<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb50-1550"><a href="#cb50-1550" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND iso3 in ('</span><span class="sc">${</span>countries<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb50-1551"><a href="#cb50-1551" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- POSSIBLY add admin1 name filter, but defaults to full country, so maybe bigger query is better.</span></span>
<span id="cb50-1552"><a href="#cb50-1552" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)<span class="op">;</span></span>
<span id="cb50-1553"><a href="#cb50-1553" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb50-1554"><a href="#cb50-1554" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-42" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1558" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1557"><span id="cb51-1558"><a href="#cb51-1558" aria-hidden="true" tabindex="-1"></a>crop_adoption <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb51-1559"><a href="#cb51-1559" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Globals from the notebook</span></span>
<span id="cb51-1560"><a href="#cb51-1560" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adoption <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb51-1561"><a href="#cb51-1561" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb51-1562"><a href="#cb51-1562" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> prod_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb51-1563"><a href="#cb51-1563" aria-hidden="true" tabindex="-1"></a>  <span class="co">// let data = await getExposureData(select_crop, select_country);</span></span>
<span id="cb51-1564"><a href="#cb51-1564" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> exposure_data<span class="op">;</span></span>
<span id="cb51-1565"><a href="#cb51-1565" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb51-1566"><a href="#cb51-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1567"><a href="#cb51-1567" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> row <span class="kw">of</span> data) {</span>
<span id="cb51-1568"><a href="#cb51-1568" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> value <span class="op">=</span> row<span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb51-1569"><a href="#cb51-1569" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xPrev <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb51-1570"><a href="#cb51-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1571"><a href="#cb51-1571" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> years<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb51-1572"><a href="#cb51-1572" aria-hidden="true" tabindex="-1"></a>      <span class="co">// cumulative adoption</span></span>
<span id="cb51-1573"><a href="#cb51-1573" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> x<span class="op">;</span></span>
<span id="cb51-1574"><a href="#cb51-1574" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb51-1575"><a href="#cb51-1575" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(value <span class="op">*</span> adoption <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb51-1576"><a href="#cb51-1576" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb51-1577"><a href="#cb51-1577" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((value <span class="op">-</span> xPrev) <span class="op">*</span> adoption <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> xPrev<span class="op">;</span></span>
<span id="cb51-1578"><a href="#cb51-1578" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb51-1579"><a href="#cb51-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1580"><a href="#cb51-1580" aria-hidden="true" tabindex="-1"></a>      xPrev <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb51-1581"><a href="#cb51-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1582"><a href="#cb51-1582" aria-hidden="true" tabindex="-1"></a>      <span class="co">// push a long-form row</span></span>
<span id="cb51-1583"><a href="#cb51-1583" aria-hidden="true" tabindex="-1"></a>      result<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1584"><a href="#cb51-1584" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin0_name</span><span class="op">:</span> row<span class="op">.</span><span class="at">admin0_name</span><span class="op">,</span></span>
<span id="cb51-1585"><a href="#cb51-1585" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin1_name</span><span class="op">:</span> row<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span></span>
<span id="cb51-1586"><a href="#cb51-1586" aria-hidden="true" tabindex="-1"></a>        <span class="dt">iso3c</span><span class="op">:</span> row<span class="op">.</span><span class="at">iso3</span><span class="op">,</span></span>
<span id="cb51-1587"><a href="#cb51-1587" aria-hidden="true" tabindex="-1"></a>        <span class="dt">crop</span><span class="op">:</span> row<span class="op">.</span><span class="at">crop</span><span class="op">,</span></span>
<span id="cb51-1588"><a href="#cb51-1588" aria-hidden="true" tabindex="-1"></a>        <span class="dt">exposure</span><span class="op">:</span> row<span class="op">.</span><span class="at">exposure</span><span class="op">,</span></span>
<span id="cb51-1589"><a href="#cb51-1589" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> row<span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb51-1590"><a href="#cb51-1590" aria-hidden="true" tabindex="-1"></a>        <span class="dt">adoption</span><span class="op">:</span> adoption<span class="op">,</span></span>
<span id="cb51-1591"><a href="#cb51-1591" aria-hidden="true" tabindex="-1"></a>        <span class="dt">prod_impact</span><span class="op">:</span> prod_impact<span class="op">,</span></span>
<span id="cb51-1592"><a href="#cb51-1592" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year_char</span><span class="op">:</span> <span class="vs">`y</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb51-1593"><a href="#cb51-1593" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> i<span class="op">,</span></span>
<span id="cb51-1594"><a href="#cb51-1594" aria-hidden="true" tabindex="-1"></a>        <span class="dt">result</span><span class="op">:</span> x<span class="op">,</span></span>
<span id="cb51-1595"><a href="#cb51-1595" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-1596"><a href="#cb51-1596" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1597"><a href="#cb51-1597" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1598"><a href="#cb51-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1599"><a href="#cb51-1599" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">.</span><span class="fu">map</span>((row) <span class="kw">=&gt;</span> {</span>
<span id="cb51-1600"><a href="#cb51-1600" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result_w_impact <span class="op">=</span></span>
<span id="cb51-1601"><a href="#cb51-1601" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(row<span class="op">.</span><span class="at">result</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> (row<span class="op">.</span><span class="at">prod_impact</span> <span class="op">??</span> <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb51-1602"><a href="#cb51-1602" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_impact <span class="op">=</span></span>
<span id="cb51-1603"><a href="#cb51-1603" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((result_w_impact <span class="op">-</span> row<span class="op">.</span><span class="at">result</span>) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb51-1604"><a href="#cb51-1604" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>row<span class="op">,</span> result_w_impact<span class="op">,</span> marginal_impact }<span class="op">;</span></span>
<span id="cb51-1605"><a href="#cb51-1605" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb51-1606"><a href="#cb51-1606" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb51-1607"><a href="#cb51-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1608"><a href="#cb51-1608" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">NOTE</span><span class="co">: QAQC RESULTS:</span></span>
<span id="cb51-1609"><a href="#cb51-1609" aria-hidden="true" tabindex="-1"></a><span class="co">// 1 region &amp; crop: PERFECT - This output matches the R script output exactly</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-43" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1613" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1612"><span id="cb52-1613"><a href="#cb52-1613" aria-hidden="true" tabindex="-1"></a>roiResults <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb52-1614"><a href="#cb52-1614" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> index <span class="op">=</span> <span class="cf">await</span> <span class="fu">calcCV</span>()<span class="op">;</span></span>
<span id="cb52-1615"><a href="#cb52-1615" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">crop_adoption</span>()<span class="op">;</span></span>
<span id="cb52-1616"><a href="#cb52-1616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1617"><a href="#cb52-1617" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> withImpact <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>((row) <span class="kw">=&gt;</span> {</span>
<span id="cb52-1618"><a href="#cb52-1618" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>row<span class="op">.</span><span class="at">admin0_name</span><span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>row<span class="op">.</span><span class="at">crop</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb52-1619"><a href="#cb52-1619" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> avloss <span class="op">=</span> index<span class="op">.</span><span class="fu">get</span>(key) <span class="op">??</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// default to 0 if missing</span></span>
<span id="cb52-1620"><a href="#cb52-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1621"><a href="#cb52-1621" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result_w_impact_cis <span class="op">=</span></span>
<span id="cb52-1622"><a href="#cb52-1622" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(row<span class="op">.</span><span class="at">result_w_impact</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> avloss) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb52-1623"><a href="#cb52-1623" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_cis <span class="op">=</span></span>
<span id="cb52-1624"><a href="#cb52-1624" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((result_w_impact_cis <span class="op">-</span> row<span class="op">.</span><span class="at">result_w_impact</span>) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb52-1625"><a href="#cb52-1625" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_impact_cis <span class="op">=</span></span>
<span id="cb52-1626"><a href="#cb52-1626" aria-hidden="true" tabindex="-1"></a>      (marginal_cis <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> (row<span class="op">.</span><span class="at">marginal_impact</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb52-1627"><a href="#cb52-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1628"><a href="#cb52-1628" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb52-1629"><a href="#cb52-1629" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>row<span class="op">,</span></span>
<span id="cb52-1630"><a href="#cb52-1630" aria-hidden="true" tabindex="-1"></a>      avloss<span class="op">,</span></span>
<span id="cb52-1631"><a href="#cb52-1631" aria-hidden="true" tabindex="-1"></a>      result_w_impact_cis<span class="op">,</span></span>
<span id="cb52-1632"><a href="#cb52-1632" aria-hidden="true" tabindex="-1"></a>      marginal_cis<span class="op">,</span></span>
<span id="cb52-1633"><a href="#cb52-1633" aria-hidden="true" tabindex="-1"></a>      marginal_impact_cis<span class="op">,</span></span>
<span id="cb52-1634"><a href="#cb52-1634" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb52-1635"><a href="#cb52-1635" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb52-1636"><a href="#cb52-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1637"><a href="#cb52-1637" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> withImpact<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb52-1638"><a href="#cb52-1638" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> project_benefit <span class="op">=</span></span>
<span id="cb52-1639"><a href="#cb52-1639" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((d<span class="op">.</span><span class="at">marginal_impact_cis</span> <span class="op">-</span> d<span class="op">.</span><span class="at">marginal_impact_cis</span> <span class="op">/</span> bcr) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span></span>
<span id="cb52-1640"><a href="#cb52-1640" aria-hidden="true" tabindex="-1"></a>      <span class="dv">10</span><span class="op">;</span></span>
<span id="cb52-1641"><a href="#cb52-1641" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cis_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb52-1642"><a href="#cb52-1642" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>d<span class="op">,</span> bcr<span class="op">,</span> cis_impact<span class="op">,</span> project_benefit }<span class="op">;</span></span>
<span id="cb52-1643"><a href="#cb52-1643" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb52-1644"><a href="#cb52-1644" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb52-1645"><a href="#cb52-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1646"><a href="#cb52-1646" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">NOTE</span><span class="co">: QAQC RESULTS:</span></span>
<span id="cb52-1647"><a href="#cb52-1647" aria-hidden="true" tabindex="-1"></a><span class="co">// 1 region &amp; crop: Good - Output is close, the MC simulation gives different results, but the difference is few $100 each time</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-44" data-nodetype="declaration"></div></div></div></section><section id="roi-x-inputs-calculations" class="level3"><h3 data-anchor-id="roi-x-inputs-calculations">ROI X inputs Calculations</h3><section id="sum-across-admins-and-crops" class="level4"><h4 data-anchor-id="sum-across-admins-and-crops">Sum across admins and crops</h4><p>We select all the data for admin regions and crops, and sum up to get the benefit across all parameter combos.</p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="1658" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1657"><span id="cb53-1658"><a href="#cb53-1658" aria-hidden="true" tabindex="-1"></a>regionSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_region)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-45" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="1662" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1661"><span id="cb54-1662"><a href="#cb54-1662" aria-hidden="true" tabindex="-1"></a>recipe_dataSummed <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb54-1663"><a href="#cb54-1663" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"wait"</span><span class="op">;</span></span>
<span id="cb54-1664"><a href="#cb54-1664" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> roi_data <span class="op">=</span> <span class="cf">await</span> <span class="fu">roiResults</span>()<span class="op">;</span></span>
<span id="cb54-1665"><a href="#cb54-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1666"><a href="#cb54-1666" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filter down on this step to the selected regions</span></span>
<span id="cb54-1667"><a href="#cb54-1667" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> roi_data_filtered <span class="op">=</span> roi_data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb54-1668"><a href="#cb54-1668" aria-hidden="true" tabindex="-1"></a>    regionSet<span class="op">.</span><span class="fu">has</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">iso3c</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb54-1669"><a href="#cb54-1669" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb54-1670"><a href="#cb54-1670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1671"><a href="#cb54-1671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> aggregated <span class="op">=</span> d3</span>
<span id="cb54-1672"><a href="#cb54-1672" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatGroup</span>(</span>
<span id="cb54-1673"><a href="#cb54-1673" aria-hidden="true" tabindex="-1"></a>      roi_data_filtered<span class="op">,</span></span>
<span id="cb54-1674"><a href="#cb54-1674" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">adoption</span><span class="op">,</span></span>
<span id="cb54-1675"><a href="#cb54-1675" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prod_impact</span><span class="op">,</span></span>
<span id="cb54-1676"><a href="#cb54-1676" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cis_impact</span><span class="op">,</span></span>
<span id="cb54-1677"><a href="#cb54-1677" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bcr</span><span class="op">,</span></span>
<span id="cb54-1678"><a href="#cb54-1678" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span><span class="op">,</span></span>
<span id="cb54-1679"><a href="#cb54-1679" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-1680"><a href="#cb54-1680" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(([adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> year<span class="op">,</span> group]) <span class="kw">=&gt;</span> ({</span>
<span id="cb54-1681"><a href="#cb54-1681" aria-hidden="true" tabindex="-1"></a>      adoption<span class="op">,</span></span>
<span id="cb54-1682"><a href="#cb54-1682" aria-hidden="true" tabindex="-1"></a>      prod_impact<span class="op">,</span></span>
<span id="cb54-1683"><a href="#cb54-1683" aria-hidden="true" tabindex="-1"></a>      cis_impact<span class="op">,</span></span>
<span id="cb54-1684"><a href="#cb54-1684" aria-hidden="true" tabindex="-1"></a>      bcr<span class="op">,</span></span>
<span id="cb54-1685"><a href="#cb54-1685" aria-hidden="true" tabindex="-1"></a>      year<span class="op">,</span></span>
<span id="cb54-1686"><a href="#cb54-1686" aria-hidden="true" tabindex="-1"></a>      <span class="dt">project_benefit</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">sum</span>(group<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">project_benefit</span>)<span class="op">,</span></span>
<span id="cb54-1687"><a href="#cb54-1687" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb54-1688"><a href="#cb54-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1689"><a href="#cb54-1689" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"default"</span><span class="op">;</span></span>
<span id="cb54-1690"><a href="#cb54-1690" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> aggregated<span class="op">;</span></span>
<span id="cb54-1691"><a href="#cb54-1691" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-46" data-nodetype="declaration"></div></div></div></section><section id="define-project-payment-schedule" class="level4"><h4 data-anchor-id="define-project-payment-schedule">Define project payment schedule</h4><p>Below we define the project cost schedule</p><ul><li>Cost is evenly distributed across years (<ul><li>Ex. 1M over 5 years is 200K, 400K, 600K, 800K, 1M; the first year has no project benefit ($200K, 0 benefit)</li></ul></li></ul><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="1703" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1702"><span id="cb55-1703"><a href="#cb55-1703" aria-hidden="true" tabindex="-1"></a>recipe_paymentSchedule <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> projectYears })<span class="op">.</span><span class="fu">map</span>((_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb55-1704"><a href="#cb55-1704" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb55-1705"><a href="#cb55-1705" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> i<span class="op">,</span></span>
<span id="cb55-1706"><a href="#cb55-1706" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cost</span><span class="op">:</span> (<span class="dv">1</span> <span class="op">/</span> projectYears) <span class="op">*</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb55-1707"><a href="#cb55-1707" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cost_cum</span><span class="op">:</span> ((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> projectYears) <span class="op">*</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb55-1708"><a href="#cb55-1708" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb55-1709"><a href="#cb55-1709" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-47" data-nodetype="declaration"></div></div></div></section><section id="add-project-scope-to-data" class="level4"><h4 data-anchor-id="add-project-scope-to-data">Add project scope to data</h4><ul><li>Add a zero year at the start (the return rate is hardcoded to one year)</li><li>Also if the project cost is zero, return an empty array</li></ul><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="1718" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1717"><span id="cb56-1718"><a href="#cb56-1718" aria-hidden="true" tabindex="-1"></a>recipe_dataCashflow <span class="op">=</span> {</span>
<span id="cb56-1719"><a href="#cb56-1719" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>rangeProjectCost <span class="op">||</span> rangeProjectCost <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb56-1720"><a href="#cb56-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-1721"><a href="#cb56-1721" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payByYear <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(recipe_paymentSchedule<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">year</span><span class="op">,</span> d]))<span class="op">;</span></span>
<span id="cb56-1722"><a href="#cb56-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-1723"><a href="#cb56-1723" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">recipe_dataSummed</span>()<span class="op">;</span></span>
<span id="cb56-1724"><a href="#cb56-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-1725"><a href="#cb56-1725" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3</span>
<span id="cb56-1726"><a href="#cb56-1726" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatGroup</span>(</span>
<span id="cb56-1727"><a href="#cb56-1727" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb56-1728"><a href="#cb56-1728" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">adoption</span><span class="op">,</span></span>
<span id="cb56-1729"><a href="#cb56-1729" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prod_impact</span><span class="op">,</span></span>
<span id="cb56-1730"><a href="#cb56-1730" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cis_impact</span><span class="op">,</span></span>
<span id="cb56-1731"><a href="#cb56-1731" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bcr</span><span class="op">,</span></span>
<span id="cb56-1732"><a href="#cb56-1732" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-1733"><a href="#cb56-1733" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatMap</span>(([adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> rows]) <span class="kw">=&gt;</span> {</span>
<span id="cb56-1734"><a href="#cb56-1734" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> allRows <span class="op">=</span> [</span>
<span id="cb56-1735"><a href="#cb56-1735" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>rows<span class="op">,</span></span>
<span id="cb56-1736"><a href="#cb56-1736" aria-hidden="true" tabindex="-1"></a>        { adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">project_benefit</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb56-1737"><a href="#cb56-1737" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb56-1738"><a href="#cb56-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-1739"><a href="#cb56-1739" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> allRows<span class="op">.</span><span class="fu">map</span>((r) <span class="kw">=&gt;</span> {</span>
<span id="cb56-1740"><a href="#cb56-1740" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> pay <span class="op">=</span> payByYear<span class="op">.</span><span class="fu">get</span>(r<span class="op">.</span><span class="at">year</span>) <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb56-1741"><a href="#cb56-1741" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cost <span class="op">=</span> pay<span class="op">.</span><span class="at">cost</span> <span class="op">??</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb56-1742"><a href="#cb56-1742" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cost_cum <span class="op">=</span> pay<span class="op">.</span><span class="at">cost_cum</span> <span class="op">??</span> rangeProjectCost<span class="op">;</span></span>
<span id="cb56-1743"><a href="#cb56-1743" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb56-1744"><a href="#cb56-1744" aria-hidden="true" tabindex="-1"></a>          <span class="op">...</span>r<span class="op">,</span></span>
<span id="cb56-1745"><a href="#cb56-1745" aria-hidden="true" tabindex="-1"></a>          cost<span class="op">,</span></span>
<span id="cb56-1746"><a href="#cb56-1746" aria-hidden="true" tabindex="-1"></a>          cost_cum<span class="op">,</span></span>
<span id="cb56-1747"><a href="#cb56-1747" aria-hidden="true" tabindex="-1"></a>          <span class="dt">cashflow</span><span class="op">:</span> (r<span class="op">.</span><span class="at">project_benefit</span> <span class="op">??</span> <span class="dv">0</span>) <span class="op">-</span> cost<span class="op">,</span></span>
<span id="cb56-1748"><a href="#cb56-1748" aria-hidden="true" tabindex="-1"></a>          <span class="dt">discount_rate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb56-1749"><a href="#cb56-1749" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb56-1750"><a href="#cb56-1750" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb56-1751"><a href="#cb56-1751" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb56-1752"><a href="#cb56-1752" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-48" data-nodetype="declaration"></div></div></div></section><section id="format-that-into-final-indicators" class="level4"><h4 data-anchor-id="format-that-into-final-indicators">Format that into final indicators</h4><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="1758" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1757"><span id="cb57-1758"><a href="#cb57-1758" aria-hidden="true" tabindex="-1"></a>walkthroughEconomicIndicators <span class="op">=</span> {</span>
<span id="cb57-1759"><a href="#cb57-1759" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selection <span class="op">=</span> walkthroughSelections<span class="op">;</span></span>
<span id="cb57-1760"><a href="#cb57-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1761"><a href="#cb57-1761" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> recipe_dataCashflow</span>
<span id="cb57-1762"><a href="#cb57-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1763"><a href="#cb57-1763" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb57-1764"><a href="#cb57-1764" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> benefit <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">project_benefit</span>)<span class="op">;</span></span>
<span id="cb57-1765"><a href="#cb57-1765" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cost <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cost</span>)<span class="op">;</span></span>
<span id="cb57-1766"><a href="#cb57-1766" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cashflow <span class="op">=</span> benefit<span class="op">.</span><span class="fu">map</span>((b<span class="op">,</span> i) <span class="kw">=&gt;</span> b <span class="op">-</span> cost[i])<span class="op">;</span></span>
<span id="cb57-1767"><a href="#cb57-1767" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> discountRate <span class="op">=</span> selection<span class="op">.</span><span class="at">discount_rate</span><span class="op">;</span></span>
<span id="cb57-1768"><a href="#cb57-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1769"><a href="#cb57-1769" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(cashflow<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb57-1770"><a href="#cb57-1770" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_benefit <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(benefit<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb57-1771"><a href="#cb57-1771" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_cost <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(cost<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb57-1772"><a href="#cb57-1772" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> discounted_bcr <span class="op">=</span> npv_benefit<span class="op">.</span><span class="fu">map</span>((b<span class="op">,</span> i) <span class="kw">=&gt;</span> npv_cost[i] <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> b <span class="op">/</span> npv_cost[i])<span class="op">;</span></span>
<span id="cb57-1773"><a href="#cb57-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1774"><a href="#cb57-1774" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_irr <span class="op">=</span> <span class="fu">calcIRR</span>(cashflow)<span class="op">;</span></span>
<span id="cb57-1775"><a href="#cb57-1775" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_mirr <span class="op">=</span> <span class="fu">calcMIRR</span>(cashflow<span class="op">,</span> discountRate<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb57-1776"><a href="#cb57-1776" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_npv <span class="op">=</span> npv<span class="op">.</span><span class="fu">at</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb57-1777"><a href="#cb57-1777" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_bcr <span class="op">=</span> discounted_bcr<span class="op">.</span><span class="fu">at</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb57-1778"><a href="#cb57-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1779"><a href="#cb57-1779" aria-hidden="true" tabindex="-1"></a>  <span class="co">// === Enriched table</span></span>
<span id="cb57-1780"><a href="#cb57-1780" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> enrichedData <span class="op">=</span> years<span class="op">.</span><span class="fu">map</span>((year<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb57-1781"><a href="#cb57-1781" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cashflowToDate <span class="op">=</span> cashflow<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb57-1782"><a href="#cb57-1782" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb57-1783"><a href="#cb57-1783" aria-hidden="true" tabindex="-1"></a>      year<span class="op">,</span></span>
<span id="cb57-1784"><a href="#cb57-1784" aria-hidden="true" tabindex="-1"></a>      <span class="dt">project_benefit</span><span class="op">:</span> benefit[i]<span class="op">,</span></span>
<span id="cb57-1785"><a href="#cb57-1785" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cost</span><span class="op">:</span> cost[i]<span class="op">,</span></span>
<span id="cb57-1786"><a href="#cb57-1786" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cashflow</span><span class="op">:</span> cashflow[i]<span class="op">,</span></span>
<span id="cb57-1787"><a href="#cb57-1787" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_benefit_cum</span><span class="op">:</span> npv_benefit[i]<span class="op">,</span></span>
<span id="cb57-1788"><a href="#cb57-1788" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_cost_cum</span><span class="op">:</span> npv_cost[i]<span class="op">,</span></span>
<span id="cb57-1789"><a href="#cb57-1789" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_bcr</span><span class="op">:</span> discounted_bcr[i]<span class="op">,</span></span>
<span id="cb57-1790"><a href="#cb57-1790" aria-hidden="true" tabindex="-1"></a>      <span class="dt">irr</span><span class="op">:</span> <span class="fu">calcIRR</span>(cashflowToDate)<span class="op">*</span><span class="dv">100</span><span class="op">,</span></span>
<span id="cb57-1791"><a href="#cb57-1791" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mirr</span><span class="op">:</span> <span class="fu">calcMIRR</span>(cashflowToDate<span class="op">,</span> discountRate<span class="op">,</span> discountRate)<span class="op">*</span><span class="dv">100</span><span class="op">,</span></span>
<span id="cb57-1792"><a href="#cb57-1792" aria-hidden="true" tabindex="-1"></a>      <span class="dt">npv</span><span class="op">:</span> npv[i]</span>
<span id="cb57-1793"><a href="#cb57-1793" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb57-1794"><a href="#cb57-1794" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb57-1795"><a href="#cb57-1795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1796"><a href="#cb57-1796" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb57-1797"><a href="#cb57-1797" aria-hidden="true" tabindex="-1"></a>    <span class="dt">summary</span><span class="op">:</span> {</span>
<span id="cb57-1798"><a href="#cb57-1798" aria-hidden="true" tabindex="-1"></a>      proj_npv<span class="op">,</span></span>
<span id="cb57-1799"><a href="#cb57-1799" aria-hidden="true" tabindex="-1"></a>      proj_irr<span class="op">,</span></span>
<span id="cb57-1800"><a href="#cb57-1800" aria-hidden="true" tabindex="-1"></a>      proj_mirr<span class="op">,</span></span>
<span id="cb57-1801"><a href="#cb57-1801" aria-hidden="true" tabindex="-1"></a>      proj_bcr</span>
<span id="cb57-1802"><a href="#cb57-1802" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb57-1803"><a href="#cb57-1803" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enriched</span><span class="op">:</span> enrichedData</span>
<span id="cb57-1804"><a href="#cb57-1804" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb57-1805"><a href="#cb57-1805" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-49" data-nodetype="declaration"></div></div></div></section><section id="calculate-final-values" class="level4"><h4 data-anchor-id="calculate-final-values">Calculate final values</h4><p>At this point, following the recipe, we have the timeseries for the selected parameters, with financial values calculated. Specifically:</p><ul><li>adoption</li><li>prod_impact</li><li>cis_impact</li><li>bcr</li><li>discount_rate</li></ul><p>Across:</p><ul><li>year</li></ul><p>Data:</p><ul><li>project_benifit</li><li>cost and cashflow</li><li>Project IRR</li><li>Project NPV</li><li>Project BCR</li></ul></section></section></section><section id="selections" class="level2"><h2 data-anchor-id="selections">Selections</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="1834" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1833"><span id="cb58-1834"><a href="#cb58-1834" aria-hidden="true" tabindex="-1"></a>walkthroughSelections <span class="op">=</span> {</span>
<span id="cb58-1835"><a href="#cb58-1835" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb58-1836"><a href="#cb58-1836" aria-hidden="true" tabindex="-1"></a>    <span class="dt">countries</span><span class="op">:</span> select_country<span class="op">,</span></span>
<span id="cb58-1837"><a href="#cb58-1837" aria-hidden="true" tabindex="-1"></a>    <span class="dt">regions</span><span class="op">:</span> select_region<span class="op">,</span></span>
<span id="cb58-1838"><a href="#cb58-1838" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crops</span><span class="op">:</span> select_crop<span class="op">,</span></span>
<span id="cb58-1839"><a href="#cb58-1839" aria-hidden="true" tabindex="-1"></a>    <span class="dt">project_years</span><span class="op">:</span> projectYears<span class="op">,</span></span>
<span id="cb58-1840"><a href="#cb58-1840" aria-hidden="true" tabindex="-1"></a>    <span class="dt">project_cost</span><span class="op">:</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb58-1841"><a href="#cb58-1841" aria-hidden="true" tabindex="-1"></a>    <span class="dt">prod_impact</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb58-1842"><a href="#cb58-1842" aria-hidden="true" tabindex="-1"></a>    <span class="dt">adoption</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb58-1843"><a href="#cb58-1843" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cis_impact</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb58-1844"><a href="#cb58-1844" aria-hidden="true" tabindex="-1"></a>    <span class="dt">discount_rate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb58-1845"><a href="#cb58-1845" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bcr</span><span class="op">:</span> bcr<span class="op">,</span></span>
<span id="cb58-1846"><a href="#cb58-1846" aria-hidden="true" tabindex="-1"></a>    <span class="co">// time_horizon: options_econPerfWalkthrough.inputTime.value,</span></span>
<span id="cb58-1847"><a href="#cb58-1847" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb58-1848"><a href="#cb58-1848" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-50" data-nodetype="declaration"></div></div></div><div class="ojs-auto-generated hidden"><script type="ojs-module-contents">eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7bmJPdmVydmlld308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2hlYWRpbmcxfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7X2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3Mub3BlbmVyMSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0zIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5vcGVuZXIyKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmgyKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTUifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLnRleHQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7X2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5oMil9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRleHQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7aGVhZGluZzJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC05In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtyZW5kZXJSZXZpZXcxKCl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7cmVuZGVyUmV2aWV3MigpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuY2xvc2VyMSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7bmJTdW1tYXJ5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTMifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5zdW1tYXJ5LmJsb2Nrcy5ibG9jazEpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke25iTWV0aG9kc308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE1In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHthcHBlbmRpeH08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE2In1dfQ==</script></div></section></section></main><script type="ojs-module-contents">eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7XG4gIGRyb3Bkb3duX3NlY3Rpb24sXG4gIGRvd25sb2FkQnV0dG9uLFxuICBtYWtlVG9vbHRpcExhYmVsLFxufSBmcm9tIFwiL2hlbHBlcnMvdWlDb21wb25lbnRzLm9qc1wiO1xuXG5pbXBvcnQgeyBhdGxhc1RPQyB9IGZyb20gXCIvaGVscGVycy90b2Mub2pzXCI7XG5pbXBvcnQgeyBmb3JtYXRVU0QsIGlucHV0VGVtcGxhdGUgfSBmcm9tIFwiL2hlbHBlcnMvc3RkLm9qc1wiO1xuXG5pbXBvcnQgeyBoZXJvSW1hZ2UgYXMgYXRsYXNIZXJvIH0gZnJvbSBcIi9oZWxwZXJzL2hlcm8uanNcIjtcblxuaW1wb3J0IHtcbiAgZmlsdGVyYWJsZURhdGFUYWJsZSBhcyBhdGxhc1RhYmxlLFxuICBzcGFya2Jhcixcbn0gZnJvbSBcIi9oZWxwZXJzL2F0bGFzVGFibGUub2pzXCI7XG5cbmltcG9ydCB7IHJlbmRlck1hcmtkb3duV2l0aFNsb3RzIH0gZnJvbSBcIi9oZWxwZXJzL21kVHJhbnNsYXRlLm9qc1wiO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaHRtbGAke2F0bGFzSGVybyhuYlRpdGxlLCBcIi4vLi4vLi4vaW1hZ2VzL25vdGVib29rcy9yb2kud2VicFwiKX1gO1xuXG5hdGxhc1RPQyh7XG4gIHNraXA6IFtcIm5vdGVib29rLXRpdGxlXCIsIFwiYXBwZW5kaXhcIiwgXCJzb3VyY2UtY29kZVwiXSwgLy8gVGhlc2Ugc2hvdWxkIGJlIHRoZSBzZWN0aW9uIGhlYWRpbmdzIGluIHRoZSB7IyBoZWFkaW5nc31cbiAgaGVhZGluZzogYDxiPiR7TGFuZy50b1NlbnRlbmNlQ2FzZShfbGFuZyhnZW5lcmFsX3RyYW5zbGF0aW9ucy50b2MpKX08L2I+YCxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gVGV4dCBmb3Igb3ZlcnZpZXcgc2VjdGlvblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrMSl9YDtcblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrMil9YDtcblxuZHJvcGRvd25fc2VjdGlvbihcbiAgXCJEZWZpbml0aW9uc1wiLFxuICBmYWxzZSxcbiAgbWRgJHtfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIub3ZlcnZpZXcpfWAsXG5cbiAgbWRgJHtfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLm92ZXJ2aWV3KX1gLFxuXG4gIG1kYCR7X2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2Lm92ZXJ2aWV3KX1gLFxuXG4gIG1kYCR7X2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLm92ZXJ2aWV3KX1gLFxuKTtcblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrMyl9YDtcblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrNCl9YDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imh0bC5odG1sYFxuPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGdhcDogM2VtOyBtYXJnaW4tYm90dG9tOiAxLjVlbTtcIj5cbiAgICAke3ZpZXdvZiBzZWxlY3RfY291bnRyeX1cbiAgICAke3ZpZXdvZiBzZWxlY3RfcmVnaW9ufVxuICAgICR7dmlld29mIHNlbGVjdF9jcm9wfVxuICA8L2Rpdj5cbmBcblxudmlld29mIHByb2R1Y3Rpb25WaWV3ID0gSW5wdXRzLnJhZGlvKFtcInBsb3RcIiwgXCJ0YWJsZVwiXSwge1xuICB2YWx1ZTogXCJ0YWJsZVwiLFxuICBsYWJlbDogX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMudml6VHlwZS50aXRsZSksXG4gIGZvcm1hdDogKGQpID0+IF9sYW5nKGdlbmVyYWxfdHJhbnNsYXRpb25zLnZpelR5cGU/LltkXSksXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBpZiAocHJvZHVjdGlvblZpZXcgPT0gXCJ0YWJsZVwiKSB7XG4gICAgY29uc3QgYTBfY2xlYW4gPSBfbGFuZyhnZW5lcmFsX3RyYW5zbGF0aW9ucy5jb3VudHJ5KTtcbiAgICBjb25zdCBhMV9jbGVhbiA9IF9sYW5nKGdlbmVyYWxfdHJhbnNsYXRpb25zLnJlZ2lvbik7XG4gICAgY29uc3QgY29tbW9kaXR5X2NsZWFuID0gX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMuY29tbW9kaXR5KTtcbiAgICBjb25zdCBtYXhWYWwgPSBkMy5tYXgoZXhwb3N1cmVfZGF0YSwgZCA9PiBkLnZhbHVlKTtcbiAgICByZXR1cm4gYXRsYXNUYWJsZShleHBvc3VyZV9kYXRhLCB7XG4gICAgICBjb2x1bW5zOiBbXCJhZG1pbjBfbmFtZVwiLCBcImFkbWluMV9uYW1lXCIsIFwiY3JvcFwiLCBcInZhbHVlXCJdLFxuICAgICAgaGVhZGVyOiB7dmFsdWU6IFwiVVNEXCIsIGNyb3A6IGNvbW1vZGl0eV9jbGVhbiwgYWRtaW4wX25hbWU6IGEwX2NsZWFuLCBhZG1pbjFfbmFtZTogYTFfY2xlYW59LFxuICAgICAgc29ydDogXCJ2YWx1ZVwiLFxuICAgICAgcmV2ZXJzZTogdHJ1ZSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICB2YWx1ZTogc3BhcmtiYXIoe1xuICAgICAgICAgIG1heDogbWF4VmFsLFxuICAgICAgICAgIGFsaWduOiBcInJpZ2h0XCIsXG4gICAgICAgICAgYmFja2dyb3VuZDogXCIjRDlFQ0Q5XCIsXG4gICAgICAgICAgY29sb3I6IFwiYmxhY2tcIixcbiAgICAgICAgICBmb3JtYXR0ZXI6IChkKSA9PiBmb3JtYXRVU0QoKShkKSxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVuZGVyUHJvZHVjdGlvbkJhcnMoKVxuICB9XG59XG5cbnJlbmRlclByb2R1Y3Rpb25CYXJzID0gKCkgPT4ge1xuICBjb25zdCBkYXRhID0gZXhwb3N1cmVfZGF0YVxuICAgIC5maWx0ZXIoKGQpID0+XG4gICAgcmVnaW9uU2V0LmhhcyhgJHtkLmlzbzN9XyR7ZC5hZG1pbjFfbmFtZX1gKSxcbiAgKTtcblxuICBjb25zdCB0b3RhbHMgPSBkMy5yb2xsdXAoXG4gICAgZGF0YSxcbiAgICB2ID0+IGQzLnN1bSh2LCBkID0+IGQudmFsdWUpLFxuICAgIGQgPT4gZC5hZG1pbjBfbmFtZSxcbiAgICBkID0+IGQuY3JvcFxuICApO1xuXG4gIGNvbnN0IGZsYXRUb3RhbHMgPSBBcnJheS5mcm9tKHRvdGFscywgKFthZG1pbjBfbmFtZSwgY3JvcHNdKSA9PlxuICAgIEFycmF5LmZyb20oY3JvcHMsIChbY3JvcCwgdmFsdWVdKSA9PiAoeyBhZG1pbjBfbmFtZSwgY3JvcCwgdmFsdWUgfSkpXG4gICkuZmxhdCgpO1xuXG4gIGNvbnN0IF90aXRsZSA9IF9sYW5nKHtcbiAgICBlbjogXCJUb3RhbCBWb1AgZm9yIHNlbGVjdGVkIHJlZ2lvbnMgYW5kIGNyb3BzIGluIGVhY2ggY291bnRyeVwiLFxuICAgIGZyOiBcIlRvdGFsIFZvUCBwb3VyIGxlcyByZcyBZ2lvbnMgZXQgbGVzIGN1bHR1cmVzIHNlzIFsZWN0aW9ubmXMgWVzIGRhbnMgY2hhcXVlIHBheXNcIlxuICB9KVxuXG4gIHJldHVybiBQbG90LnBsb3Qoe1xuICAgIHN1YnRpdGxlOiBfdGl0bGUsXG4gICAgbWFyZ2luTGVmdDogNTAsXG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0OiA1MDAsXG4gICAgeDogeyBsYWJlbDogbnVsbCwgdGlja0Zvcm1hdDogKGQpID0+IGAke2R9YCB9LFxuICAgIHk6IHsgdGlja0Zvcm1hdDooZCkgPT4gZm9ybWF0VVNEKCkoZCkgfSxcbiAgICBjb2xvcjoge1xuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgbGFiZWw6IF9sYW5nKHtlbjogXCJDb21tb2RpdHlcIiwgZnI6IFwiQ3VsdHVyZVwifSksXG4gICAgfSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5iYXJZKGZsYXRUb3RhbHMsIHtcbiAgICAgICAgeDogXCJhZG1pbjBfbmFtZVwiLFxuICAgICAgICB5OiBcInZhbHVlXCIsXG4gICAgICAgIGZpbGw6IFwiY3JvcFwiLFxuICAgICAgICB0aXA6IHRydWVcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0UHJvamVjdE9wdGlvbnMgPSB7XG4gIGNvbnN0IGlucHV0UHJvamVjdENvc3QgPSBJbnB1dHMudGV4dCh7XG4gICAgbGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBpbnB1dE9wdGlvbnNfcHJvamVjdENvc3QubGFiZWwsXG4gICAgICB0b29sdGlwVGV4dDogaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0LnRvb2x0aXBcbiAgICB9KSxcbiAgICBwYXR0ZXJuOiBpbnB1dE9wdGlvbnNfcHJvamVjdENvc3QucGF0dGVybixcbiAgICBwbGFjZWhvbGRlcjogaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0LnBsYWNlaG9sZGVyLFxuICAgIHZhbHVlOiBpbnB1dE9wdGlvbnNfcHJvamVjdENvc3QudmFsdWVTdHJpbmdcbiAgfSk7XG4gIGNvbnN0IGlucHV0UHJvamVjdFllYXJzID0gSW5wdXRzLnNlbGVjdChpbnB1dE9wdGlvbnNfcHJvamVjdFllYXJzLmRhdGEsIHtcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsLFxuICAgIGxhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogaW5wdXRPcHRpb25zX3Byb2plY3RZZWFycy5sYWJlbCxcbiAgICAgIHRvb2x0aXBUZXh0OiBpbnB1dE9wdGlvbnNfcHJvamVjdFllYXJzLnRvb2x0aXBcbiAgICB9KSxcbiAgICB2YWx1ZTogaW5wdXRPcHRpb25zX3Byb2plY3RZZWFycy5kYXRhLmZpbmQoKGQpID0+IGQudmFsdWUgPT0gOClcbiAgICB9KTtcblxuICByZXR1cm4gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgY29zdDogaW5wdXRQcm9qZWN0Q29zdCxcbiAgICAgIHllYXJzOmlucHV0UHJvamVjdFllYXJzXG4gICAgfSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogaW5wdXRUZW1wbGF0ZSh7IGdhcDogXCIzZW1cIiB9KSxcbiAgICB9XG4gICk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRlbXBsYXRlID0gX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuY29zdHMuY2FsbG91dFRlbXBsYXRlKVxuICBjb25zdCB0ZW1wbGF0ZUl0ZW1zID0gW1xuICAgIHtuYW1lOiBcIm1vbmV5XCIsIHZhbHVlOiBmb3JtYXRVU0Qoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSkocmFuZ2VQcm9qZWN0Q29zdCl9LFxuICAgIHtuYW1lOiBcInRpbWVcIiwgdmFsdWU6IGlucHV0UHJvamVjdE9wdGlvbnMueWVhcnMubGFiZWx9LFxuICBdXG4gIGNvbnN0IGZvcm1hdHRlZCA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXModGVtcGxhdGUsIHRlbXBsYXRlSXRlbXMpXG4gIHJldHVybiBtZGAke2Zvcm1hdHRlZH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygc2VsZWN0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoID0ge1xuICBjb25zdCBfbGFiZWxfcHJvZEltcGFjdCA9IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMucHJvZEltcGFjdERyb3Bkb3duLmxhYmVsLFxuICAgICAgKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMucHJvZEltcGFjdERyb3Bkb3duLnRvb2x0aXAsXG4gICAgICApLFxuICAgIH0pXG5cbiAgY29uc3QgX2xhYmVsX0Fkb3B0aW9uID0gbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5hZG9wdGlvblJhdGVEcm9wZG93bi5sYWJlbCxcbiAgICAgICksXG4gICAgICB0b29sdGlwVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLmFkb3B0aW9uUmF0ZURyb3Bkb3duLnRvb2x0aXAsXG4gICAgICApLFxuICAgIH0pXG5cbiAgY29uc3QgX2xhYmVsX0Npc0ltcGFjdCA9IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuY2lzSW1wYWN0RHJvcGRvd24ubGFiZWwsXG4gICAgICApLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5jaXNJbXBhY3REcm9wZG93bi50b29sdGlwLFxuICAgICAgKSxcbiAgICB9KVxuXG4gIGNvbnN0IGlucHV0UHJvZEltcGFjdCA9IElucHV0cy5yYW5nZShcbiAgICBbMCwgNTVdLFxuICAgIHtcbiAgICAgIHN0ZXA6IDUsXG4gICAgICBsYWJlbCA6IF9sYWJlbF9wcm9kSW1wYWN0LFxuICAgICAgdmFsdWU6IDMwXG4gICAgfSxcbiAgKVxuXG4gIGNvbnN0IGlucHV0QWRvcHRpb24gPSBJbnB1dHMucmFuZ2UoXG4gICAgWzAuMjUsIDJdLFxuICAgIHtcbiAgICAgIHN0ZXA6IDAuMjUsXG4gICAgICBsYWJlbCA6IF9sYWJlbF9BZG9wdGlvbixcbiAgICAgIHZhbHVlOiAxXG4gICAgfSxcbiAgKVxuXG4gIGNvbnN0IGlucHV0Q2lzSW1wYWN0ID0gSW5wdXRzLnJhbmdlKFxuICAgIFswLCA1NV0sXG4gICAge1xuICAgICAgc3RlcDogNSxcbiAgICAgIGxhYmVsIDogX2xhYmVsX0Npc0ltcGFjdCxcbiAgICAgIHZhbHVlOiAyNVxuICAgIH0sXG5cbiAgKVxuXG4gIHJldHVybiBJbnB1dHMuZm9ybShcbiAgICB7XG4gICAgICBpbnB1dFByb2RJbXBhY3QsXG4gICAgICBpbnB1dEFkb3B0aW9uLFxuICAgICAgaW5wdXRDaXNJbXBhY3Rcbn0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IGlucHV0VGVtcGxhdGUoeyBnYXA6IFwiM2VtXCIgfSksXG4gICAgfVxuICApXG59XG5cbm9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCA9IHtcbiAgY29uc3QgZm9ybWF0dGVkID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHNlbGVjdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCkpIHtcbiAgICBmb3JtYXR0ZWRba2V5XSA9IHtcbiAgICAgIGxhYmVsOiBgJHt2YWx1ZX0lYCxcbiAgICAgIHZhbHVlOiB2YWx1ZSAvIDEwMFxuICAgIH07XG4gIH1cbiAgcmV0dXJuIGZvcm1hdHRlZDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgYWR2YW5jZWRDb250cm9sc1RleHQgPSBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5jb3N0cy5hZHZhbmNlZENvbnRyb2xzO1xuXG4gIGNvbnN0IF9iZW5lZml0TG93TGFiZWwgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICBsYWJlbFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5iZW5lZml0U2NhbGVMb3cubGFiZWwpLFxuICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuYmVuZWZpdFNjYWxlTG93LnRvb2x0aXApLFxuICB9KTtcbiAgY29uc3QgX2JlbmVmaXRIaWdoTGFiZWwgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICBsYWJlbFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5iZW5lZml0U2NhbGVIaWdoLmxhYmVsKSxcbiAgICB0b29sdGlwVGV4dDogX2xhbmcoYWR2YW5jZWRDb250cm9sc1RleHQuaW5wdXRzLmJlbmVmaXRTY2FsZUhpZ2gudG9vbHRpcCksXG4gIH0pO1xuICBjb25zdCBfY29zdExvd0xhYmVsID0gbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgbGFiZWxUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuY29zdFNjYWxlTG93LmxhYmVsKSxcbiAgICB0b29sdGlwVGV4dDogX2xhbmcoYWR2YW5jZWRDb250cm9sc1RleHQuaW5wdXRzLmNvc3RTY2FsZUxvdy50b29sdGlwKSxcbiAgfSk7XG4gIGNvbnN0IF9jb3N0SGlnaExhYmVsID0gbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgbGFiZWxUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuY29zdFNjYWxlSGlnaC5sYWJlbCksXG4gICAgdG9vbHRpcFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5jb3N0U2NhbGVIaWdoLnRvb2x0aXApLFxuICB9KTtcblxuICBjb25zdCBmb3JtQmVuZWZpdFNjYWxlID0gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgbG93OiBJbnB1dHMucmFuZ2UoWzAuNSwgMV0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgbGFiZWw6IF9iZW5lZml0TG93TGFiZWwsXG4gICAgICAgIHZhbHVlOiAwLjg1LFxuICAgICAgfSksXG4gICAgICBoaWdoOiBJbnB1dHMucmFuZ2UoWzEsIDEuNl0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgbGFiZWw6IF9iZW5lZml0SGlnaExhYmVsLFxuICAgICAgICB2YWx1ZTogMS4xNSxcbiAgICAgIH0pLFxuICAgIH0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IGlucHV0VGVtcGxhdGUoeyBnYXA6IFwiM2VtXCIgfSksXG4gICAgfSxcbiAgKTtcblxuICBjb25zdCBmb3JtQ29zdFNjYWxlID0gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgbG93OiBJbnB1dHMucmFuZ2UoWzAuNSwgMV0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgbGFiZWw6IF9jb3N0TG93TGFiZWwsXG4gICAgICAgIHZhbHVlOiAwLjksXG4gICAgICB9KSxcbiAgICAgIGhpZ2g6IElucHV0cy5yYW5nZShbMSwgMS44XSwge1xuICAgICAgICBzdGVwOiAwLjAxLFxuICAgICAgICBsYWJlbDogX2Nvc3RIaWdoTGFiZWwsXG4gICAgICAgIHZhbHVlOiAxLjIsXG4gICAgICB9KSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHRlbXBsYXRlOiBpbnB1dFRlbXBsYXRlKHsgZ2FwOiBcIjNlbVwiIH0pLFxuICAgIH0sXG4gICk7XG5cbiAgY29uc3QgX2Rpc2NvdW50TGFiZWwgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICBsYWJlbFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5kaXNjb3VudFJhdGUubGFiZWwpLFxuICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuZGlzY291bnRSYXRlLnRvb2x0aXApLFxuICB9KVxuXG4gIGNvbnN0IF9yb2lMYWJlbCA9IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgIGxhYmVsVGV4dDogX2xhbmcoYWR2YW5jZWRDb250cm9sc1RleHQuaW5wdXRzLnJvaS5sYWJlbCksXG4gICAgdG9vbHRpcFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5yb2kudG9vbHRpcCksXG4gIH0pXG5cbiAgY29uc3QgZm9ybUZpbmFuY2lhbENvbnRyb2xzID0gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgZGlzY291bnRSYXRlOiBJbnB1dHMuYmluZChcbiAgICAgICAgSW5wdXRzLnJhbmdlKFxuICAgICAgICAgIFswLCAxXSxcbiAgICAgICAgICB7c3RlcDogMC4wMSwgZm9ybWF0OiB4ID0+ICh4ICogMTAwKSwgbGFiZWwgOiBfZGlzY291bnRMYWJlbCwgdmFsdWU6IDAuMTJ9XG4gICAgICAgICksXG4gICAgICAgIHZpZXdvZiBkaXNjb3VudFJhdGVcbiAgICAgICksXG4gICAgICBiY3I6IElucHV0cy5iaW5kKFxuICAgICAgICBJbnB1dHMucmFuZ2UoXG4gICAgICAgICAgWzAuNSwgMl0sXG4gICAgICAgICAge3N0ZXA6IDAuMDEsIGxhYmVsOiBfcm9pTGFiZWwsIHZhbHVlOiAxLjYyfVxuICAgICAgICApLFxuICAgICAgICB2aWV3b2YgYmNyXG4gICAgICApXG4gICAgfSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogaW5wdXRUZW1wbGF0ZSh7IGdhcDogXCIzZW1cIiB9KSxcbiAgICB9XG4gICk7XG5cbiAgcmV0dXJuIGRyb3Bkb3duX3NlY3Rpb24oXG4gICAgX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMuYWR2YW5jZWRDb250cm9scyksXG4gICAgZmFsc2UsXG4gICAgZm9ybUZpbmFuY2lhbENvbnRyb2xzLFxuICAgIGA8Yj4ke19sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0Lm1vZGVsVW5jZXJ0YWludHkpfTwvYj5gLFxuICAgIElucHV0cy5iaW5kKGZvcm1CZW5lZml0U2NhbGUsIHZpZXdvZiB1bmNlcnRhaW50eUJlbmVmaXRTY2FsZSksXG4gICAgSW5wdXRzLmJpbmQoZm9ybUNvc3RTY2FsZSwgdmlld29mIHVuY2VydGFpbnR5Q29zdFNjYWxlKVxuICApXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidW5jZXJ0YWludHkgPSBydW5TaW11bGF0aW9uRnJvbUNhc2hmbG93Um93cyhyZWNpcGVfZGF0YUNhc2hmbG93LCB7XG4gIHNpbXVsYXRpb25zOiAyNTAsXG4gIGRpc2NvdW50UmF0ZTogZGlzY291bnRSYXRlLFxuICBiZW5lZml0U2NhbGU6IHtcbiAgICBsb3c6IHVuY2VydGFpbnR5QmVuZWZpdFNjYWxlLmxvdyxcbiAgICBtb2RlOiAxLjAsXG4gICAgaGlnaDogdW5jZXJ0YWludHlCZW5lZml0U2NhbGUuaGlnaCxcbiAgfSxcbiAgY29zdFNjYWxlOiB7XG4gICAgbG93OiB1bmNlcnRhaW50eUNvc3RTY2FsZS5sb3csXG4gICAgbW9kZTogMS4wLFxuICAgIGhpZ2g6IHVuY2VydGFpbnR5Q29zdFNjYWxlLmhpZ2gsXG4gIH0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJiaWdOdW1iZXJzUmVzdWx0cygpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlc3VsdFRhYmxlKCk7XG5kb3dubG9hZEJ1dHRvbihcbiAgd2Fsa3Rocm91Z2hFY29ub21pY0luZGljYXRvcnM/LmVucmljaGVkLFxuICBcInJvaV9kYXRhLmNzdlwiLFxuICBfbGFuZyh7IGVuOiBcIkRvd25sb2FkXCIsIGZyOiBcIlTDqWzDqWNoYXJnZXJcIiB9KSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVzdWx0UGxvdCgpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImluZGljYXRvclNlbGVjdG9yID0ge1xuICAvLyBiaW5kIGlucHV0IHNvIHRvb2x0aXAgY2FuIGJlIGR5bmFtaWNcbiAgcmV0dXJuIElucHV0cy5iaW5kKFxuICAgIElucHV0cy5zZWxlY3QoZGF0YVBpY2tNZXRyaWMsIHtcbiAgICBsYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmdlbmVyYWwudGVybXMuaW5kaWNhdG9yKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBwaWNrTWV0cmljV2Fsa3Rocm91Z2gudG9vbHRpcCxcbiAgICB9KSxcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsRnVsbCxcbiAgfSksIHZpZXdvZiBwaWNrTWV0cmljV2Fsa3Rocm91Z2hcbiAgKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgbGlzdFdoYXQgPSBfbGFuZyhuYlRleHQuaW52ZXN0bWVudFJldHVybnMuYmxvY2tzLmluZm9MaXN0SGVhZGVycy53aGF0KVxuICBjb25zdCBsaXN0SW50ZXJwcmV0ID0gX2xhbmcobmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5pbmZvTGlzdEhlYWRlcnMuaW50ZXJwcmV0KVxuICBjb25zdCBsaXN0VGVsbCA9IF9sYW5nKG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuaW5mb0xpc3RIZWFkZXJzLnRlbGwpXG5cbiAgLy8gaW5kaWNhdG9yIGluZm9cbiAgcmV0dXJuIG1kYCMjIyAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5sYWJlbEZ1bGx9XG5cbi0gKioke2xpc3RXaGF0fSoqOiAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5pbmZvLndoYXR9XG4tICoqJHtsaXN0SW50ZXJwcmV0fSoqOiAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5pbmZvLmludGVycHJldH1cbi0gKioke2xpc3RUZWxsfSoqOiAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5pbmZvLnRlbGx9XG5gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBucHZfcmF0ZSA9IChkaXNjb3VudFJhdGUgKiAxMDApICsgXCIlXCI7XG4gIGNvbnN0IGZhcm1fYmNyID0gYmNyO1xuICBjb25zdCBtZXRob2RzX3RpdGxlID0gbmJNZXRob2RzO1xuXG4gIGNvbnN0IHRlbXBsYXRlID0gX2xhbmcobmJUZXh0LnN1bW1hcnkuYmxvY2tzLmJsb2NrMilcbiAgY29uc3QgdGVtcGxhdGVJdGVtcyA9IFtcbiAgICB7bmFtZTogXCJucHZEaXNvdW50UmF0ZVwiLCB2YWx1ZTogbnB2X3JhdGV9LFxuICAgIHtuYW1lOiBcImZhcm1CY3JcIiwgdmFsdWU6IGZhcm1fYmNyfSxcbiAgICB7bmFtZTogXCJtZXRob2RzU291cmNlc1RpdGxlXCIsIHZhbHVlOiBtZXRob2RzX3RpdGxlfSxcbiAgXVxuICBjb25zdCBmb3JtYXR0ZWQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKHRlbXBsYXRlLCB0ZW1wbGF0ZUl0ZW1zKVxuICByZXR1cm4gbWRgJHtmb3JtYXR0ZWR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1ldGhvZEZpbGVzID0gbmV3IE9iamVjdCh7XG4gIFwiZW5cIjogRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9lY29ub21pY1JldHVybnMvdHJhbnNsYXRpb25zL21ldGhvZHMtZW4ubWRcIiksXG4gIFwiZnJcIjogRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9lY29ub21pY1JldHVybnMvdHJhbnNsYXRpb25zL21ldGhvZHMtZnIubWRcIilcbn0pXG5cbntcbiAgY29uc3Qga2V5ID0gbWFzdGVyTGFuZ3VhZ2Uua2V5XG4gIGNvbnN0IG1kX2NvbnRlbnQgPSBhd2FpdCBtZXRob2RGaWxlc1trZXldLnRleHQoKVxuICByZXR1cm4gcmVuZGVyTWFya2Rvd25XaXRoU2xvdHMoXG4gICAgbWRfY29udGVudCxcbiAgICB7fSxcbiAgKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBEYXRhIGxvYWRlciBjZWxsXG5kYiA9IHtcbiAgbGV0IGRiID0gYXdhaXQgRHVja0RCQ2xpZW50Lm9mKHtcbiAgICBjdl9yYXc6IEZpbGVBdHRhY2htZW50KFwiL2RhdGEvZWNvbm9taWNSZXR1cm5zL2Zhb3N0YXRfcHJvZF9jdi5wYXJxdWV0XCIpXG4gIH0pXG4gIGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICBDUkVBVEUgVEFCTEUgZXhwb3N1cmUgQVMgIC0tIGRhdGEgaXMgfiAxIG1iIHNvIHRhYmxlIHBvc3NpYmx5IG1vcmUgcGVyZm9ybWFudFxuICAgICAgU0VMRUNUXG4gICAgICAgIGlzbzMsXG4gICAgICAgIGFkbWluMF9uYW1lLFxuICAgICAgICBhZG1pbjFfbmFtZSxcbiAgICAgICAgUkVHRVhQX1JFUExBQ0UoY3JvcCwgJy10cm9waWNhbHwtaGlnaGxhbmQnLCAnJykgQVMgY3JvcCxcbiAgICAgICAgQ09OQ0FUKGV4cG9zdXJlLCAnXycsIHVuaXQpIEFTIGV4cG9zdXJlLFxuICAgICAgICBTVU0odmFsdWUpIEFTIHZhbHVlXG4gICAgICBGUk9NIHJlYWRfcGFycXVldChcInMzOi8vZGlnaXRhbC1hdGxhcy9kb21haW49ZXhwb3N1cmUvdHlwZT1jb21iaW5lZC9zb3VyY2U9Z2x3NC0yMDIwX3NwYW0yMDIwQUEvcmVnaW9uPXNzYS9wcm9jZXNzaW5nPWF0bGFzLWhhcm1vbml6ZWQvdmFyaWFibGU9dm9wX25vbWluYWwtdXNkLTIwMjEucGFycXVldFwiKVxuICAgICAgV0hFUkVcbiAgICAgICAgYWRtaW4yX25hbWUgSVMgTlVMTCBBTkQgYWRtaW4xX25hbWUgSVMgTk9UIE5VTExcbiAgICAgICAgQU5EICh0ZWNoID0gJ2FsbCcgT1IgdGVjaCBJUyBOVUxMKVxuICAgICAgICBBTkQgaXNmaW5pdGUodmFsdWUpXG4gICAgICAgIEFORCBjcm9wICF+ICcoXm90aGVyLXxyZXN0LW9mfHRlbXBlcmF0ZS1mcnVpdHx0cm9waWNhbC1mcnVpdHx2ZWdldGFibGVzKSdcbiAgICAgIEdST1VQIEJZXG4gICAgICAgIGlzbzMsXG4gICAgICAgIGFkbWluMF9uYW1lLFxuICAgICAgICBhZG1pbjFfbmFtZSxcbiAgICAgICAgY3JvcCxcbiAgICAgICAgQ09OQ0FUKGV4cG9zdXJlLCAnXycsIHVuaXQpXG4gIGApXG4gIGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICBDUkVBVEUgVklFVyBjdiBBU1xuICAgICAgU0VMRUNUXG4gICAgICAgIGFkbWluMF9uYW1lLFxuICAgICAgICAtLSBjbGVhbiBhbmQgc3RhbmRhcmRpemUgY3JvcCBuYW1lc1xuICAgICAgICBSRUdFWFBfUkVQTEFDRShcbiAgICAgICAgICBSRUdFWFBfUkVQTEFDRShcbiAgICAgICAgICAgIFJFUExBQ0UoUkVQTEFDRShjcm9wLCAnX21lYXQnLCAnJyksICcgJywgJy0nKSxcbiAgICAgICAgICAgICdnb2F0JCcsICdnb2F0cydcbiAgICAgICAgICApLFxuICAgICAgICAgICdwaWckJywgJ3BpZ3MnXG4gICAgICAgICkgQVMgY3JvcCxcbiAgICAgICAgdmFsdWVfZmlsbGVkIEFTIGN2XG4gICAgICBGUk9NIGN2X3Jhd1xuICAgICAgV0hFUkUgTk9UIChjcm9wIElMSUtFICclbWlsayUnIE9SIGNyb3AgSUxJS0UgJyVlZ2dzJScgT1IgTE9XRVIoY3JvcCkgPSAndG90YWwnKVxuXG4gICAgICBVTklPTiBBTExcbiAgICAgIC0tIGFkZCByb2J1c3RhLWNvZmZlZSBhbmQgc21hbGwtbWlsbGV0IHN1YnN0aXR1dGVzXG4gICAgICBTRUxFQ1QgYWRtaW4wX25hbWUsICdyb2J1c3RhLWNvZmZlZScsIHZhbHVlX2ZpbGxlZCBBUyBjdlxuICAgICAgRlJPTSBjdl9yYXdcbiAgICAgIFdIRVJFIGNyb3AgPSAnYXJhYmljYS1jb2ZmZWUnXG5cbiAgICAgIFVOSU9OIEFMTFxuICAgICAgU0VMRUNUIGFkbWluMF9uYW1lLCAnc21hbGwtbWlsbGV0JywgdmFsdWVfZmlsbGVkIEFTIGN2XG4gICAgICBGUk9NIGN2X3Jhd1xuICAgICAgV0hFUkUgY3JvcCA9ICdwZWFybC1taWxsZXQnO1xuYClcbiAgcmV0dXJuIGRiO1xufTtcblxuY291bnRyaWVzID0ge1xuICBjb25zdCBjb3VudHJ5X2xpc3QgPSBhd2FpdCBGaWxlQXR0YWNobWVudChcIi9kYXRhL3NoYXJlZC9hdGxhc19jb3VudHJpZXMuanNvblwiKS5qc29uKCk7XG4gIGNvbnN0IGZpbHRlcmVkQ291bnRyaWVzID0gY291bnRyeV9saXN0XG4gICAgLmZpbHRlcigoYykgPT4gYy5pbmNsdWRlICYmIGMuaXNvM2MgIT09IFwiU0ROXCIpXG4gICAgLm1hcCgoeyBpbmNsdWRlLCAuLi5yZXN0IH0pID0+IHJlc3QpO1xuICByZXR1cm4gZmlsdGVyZWRDb3VudHJpZXM7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFBZG1pblJlZ2lvbnMgPSB7XG4gIGNvbnN0IHJlZ2lvbnMgPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgU0VMRUNUIERJU1RJTkNUIGFkbWluMF9uYW1lLCBhZG1pbjFfbmFtZSwgaXNvM1xuICAgIEZST00gZXhwb3N1cmVcbiAgICBXSEVSRSBhZG1pbjFfbmFtZSBJUyBOT1QgbnVsbFxuICAgIEFORCBpc28zIGluICgnJHtzZWxlY3RfY291bnRyeS5qb2luKFwiJywgJ1wiKX0nKVxuICBgKVxuXG4gIHJldHVybiByZWdpb25zLm1hcChyb3cgPT4gKHtcbiAgICAuLi5yb3csXG4gICAgaWQ6IGAke3Jvdy5pc28zfV8ke3Jvdy5hZG1pbjFfbmFtZX1gXG4gIH0pKTtcbn1cblxuLy9UT0RPOiBOZWVkIHRvIGFkZCB0cmFuc2xhdGlvbnMgYW5kIGxhYmVsIGNsZWFuaW5nIHRvIGl0ZW1zXG5kYXRhQ3JvcHMgPSBhd2FpdCBkYi5xdWVyeShgXG4gIFNFTEVDVCBESVNUSU5DVCBjcm9wIEFTIGl0ZW1cbiAgRlJPTSBleHBvc3VyZVxuICBPUkRFUiBCWSBpdGVtXG5gKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIERlZmF1bHRzIGFuZCBnYXVyZCByYWlscyBmb3IgdGhlIGlucHV0c1xuaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0ID0ge1xuICByZXR1cm4ge1xuICAgIHJhbmdlOiBbMWU2LCA1ZThdLFxuICAgIGxhYmVsOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5jb3N0cy5pbnB1dHMuY29zdElucHV0LmxhYmVsKSxcbiAgICB0b29sdGlwOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5jb3N0cy5pbnB1dHMuY29zdElucHV0LnRvb2x0aXApLFxuICAgIHN0ZXA6IDFlNSxcbiAgICB2YWx1ZTogNTBfMDAwXzAwMCxcbiAgICBmb3JtYXQ6IGQzLmZvcm1hdCgnJC4zcycpLFxuICAgIG91dHB1dFdpZHRoOiA5MCxcbiAgICBwbGFjZWhvbGRlcjogXCJFeC4gJDUsMDAwLDAwMFwiLFxuICAgIHBhdHRlcm46IFwiXlskXT9bMS05XStbMC05LCRdKiRcIixcbiAgICB2YWx1ZVN0cmluZzogXCIkNTAsMDAwLDAwMFwiXG4gIH1cbn1cblxuaW5wdXRPcHRpb25zX3Byb2plY3RZZWFycyA9IHtcbiAgY29uc3QgeWVhcnMgPSBfbGFuZyhcbiAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmlucHV0cy5wcm9qZWN0WWVhckRyb3Bkb3duLnRlcm1zLnllYXIucGx1cmFsLFxuICApO1xuICByZXR1cm4ge1xuICAgIHJhbmdlOiBbMiwgMTZdLFxuICAgIGRhdGE6IGQzXG4gICAgICAucmFuZ2UoMiwgMTYgKyAxLCAxKVxuICAgICAgLm1hcCgoZCkgPT4gKHsgbGFiZWw6IGAke2R9ICR7eWVhcnN9YCwgdmFsdWU6IGQgfSkpLFxuICAgIGxhYmVsOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5jb3N0cy5pbnB1dHMucHJvamVjdFllYXJEcm9wZG93bi5sYWJlbCksXG4gICAgdG9vbHRpcDogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuY29zdHMuaW5wdXRzLnByb2plY3RZZWFyRHJvcGRvd24udG9vbHRpcCksXG4gICAgc3RlcDogMSxcbiAgICB2YWx1ZTogOCxcbiAgICBvdXRwdXRXaWR0aDogOTBcbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygc2VsZWN0X2NvdW50cnkgPSB7XG4gIGNvbnN0IGRhdGEgPSBjb3VudHJpZXNcbiAgICAubWFwKChkKSA9PiAoe1xuICAgICAgdmFsdWU6IGQuaXNvM2MsIC8vTWlncmF0aW5nIHRvIGlzbyBjb2RlcyBmb3IgZnV0dXJlIGZsZXhhYmlsaXR5XG4gICAgICBsYWJlbDogX2xhbmcoZC50cmFuc2xhdGlvbilcbiAgICB9KSlcbiAgbGV0IGlucHV0ID0gZHJvcGRvd25JbnB1dCh7XG4gICAgaW5wdXRMYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNvdW50cnkucGx1cmFsKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MubG9jYXRpb25zLmlucHV0cy5jb3VudHJ5RHJvcGRvd24udG9vbHRpcFxuICAgICAgKVxuICAgIH0pLFxuICAgIGlucHV0SWQ6IFwicG9zaXRpb25zVGVzdFwiLFxuICAgIHBsYWNlaG9sZGVyVGV4dDogXCJTZWxlY3QgQ291bnRyaWVzLi4uXCIsXG4gICAgb3B0aW9uczogZGF0YSxcbiAgICBzZWxlY3RlZDogW1wiS0VOXCIsIFwiVFpBXCJdLFxuICB9KTtcblxuICByZXR1cm4gZGVib3VuY2UoaW5wdXQsIDEwMDApOyAvLyBOb2lzeSBpbnB1dCwgc28gZGVsYXkgaXQgYSBiaXQuXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gYWRtaW4gbXVsdGktc2VsZWN0OiByZWdpb25zXG52aWV3b2Ygc2VsZWN0X3JlZ2lvbiA9IHtcbiAgLy8gZmlsdGVyIHJlZ2lvbnMgYmFzZWQgb24gY291bnRyeSBpZCdzXG4gIGNvbnN0IGZpbHRlcmVkUmVnaW9ucyA9IGRhdGFBZG1pblJlZ2lvbnNcbiAgLy8gY29uc3QgdHJhbnNsYXRlQ291bnRyeSA9IChkKSA9PiBfbGFuZyh0ZC5hZG1pbjBfbmFtZS52YWx1ZXM/LltkXSk7XG4gIGNvbnN0IHRyYW5zbGF0ZUNvdW50cnkgPSAoaXNvKSA9PiBfbGFuZyhjb3VudHJpZXMuZmluZCgoYykgPT4gYy5pc28zYyA9PT0gaXNvKS50cmFuc2xhdGlvbik7XG4gIGNvbnN0IGRhdGEgPSBmaWx0ZXJlZFJlZ2lvbnMubWFwKChkKSA9PiAoe1xuICAgIHZhbHVlOiBkLmlkLFxuICAgIGxhYmVsOiBgJHt0cmFuc2xhdGVDb3VudHJ5KGQuaXNvMyl9OiAke2QuYWRtaW4xX25hbWV9YFxuICB9KSk7XG4gIGNvbnN0IHNlbGVjdGVkSWRzID0gZmlsdGVyZWRSZWdpb25zLm1hcCgoZCkgPT4gZC5pZCk7XG4gIGNvbnN0IHRleHQgPSB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLnJlZ2lvbi5wbHVyYWwpLFxuICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmxvY2F0aW9ucy5pbnB1dHMucmVnaW9uRHJvcGRvd24udG9vbHRpcCksXG4gIH1cbiAgY29uc3QgaW5wdXQgPSBkcm9wZG93bklucHV0KHtcbiAgICBpbnB1dExhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtsYWJlbFRleHQ6IHRleHQubGFiZWwsIHRvb2x0aXBUZXh0OiB0ZXh0LnRvb2x0aXB9KSxcbiAgICBpbnB1dElkOiBcInBvc2l0aW9uc1Rlc3RcIixcbiAgICBwbGFjZWhvbGRlclRleHQ6IFwiU2VsZWN0IHJlZ2lvbnMuLi5cIixcbiAgICBvcHRpb25zOiBkYXRhLFxuICAgIHNlbGVjdGVkOiBzZWxlY3RlZElkc1xuICB9KTtcblxuICByZXR1cm4gZGVib3VuY2UoaW5wdXQsIDEwMDApO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGFkbWluIG11bHRpLXNlbGVjdDogY291bnRyaWVzXG52aWV3b2Ygc2VsZWN0X2Nyb3AgPSB7XG4gIGNvbnN0IGRhdGEgPSBkYXRhQ3JvcHNcbiAgICAubWFwKChkKSA9PiAoe1xuICAgICAgdmFsdWU6IGQuaXRlbSxcbiAgICAgIGxhYmVsOiBMYW5nLnRvU2VudGVuY2VDYXNlKGQuaXRlbSkgLy9UT0RPOiBBZGQgdHJhbnNsYXRpb25zXG4gICAgfSkpXG4gICAgLnNvcnQoKGEsYikgPT4gYS5sYWJlbCA+IGIubGFiZWwpO1xuICBjb25zdCBzZWxlY3RlZElkID0gZGF0YUNyb3BzXG4gICAgLmZpbHRlcigoZCkgPT4gW1wiYmVhblwiLCBcImdvYXRzXCIsIFwibWFpemVcIl0uaW5jbHVkZXMoZC5pdGVtKSlcbiAgICAubWFwKChkKSA9PiBkLml0ZW0pO1xuICBjb25zdCB0ZXh0ID0ge1xuICAgIGxhYmVsOiBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5jb21tb2RpdHkucGx1cmFsKSxcbiAgICB0b29sdGlwOiBfbGFuZyhcbiAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmxvY2F0aW9ucy5pbnB1dHMuY29tbW9kaXR5RHJvcGRvd24udG9vbHRpcFxuICAgIClcbiAgfTtcbiAgY29uc3QgaW5wdXQgPSBkcm9wZG93bklucHV0KHtcbiAgICBpbnB1dExhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogdGV4dC5sYWJlbCxcbiAgICAgIHRvb2x0aXBUZXh0OiB0ZXh0LnRvb2x0aXBcbiAgICB9KSxcbiAgICBpbnB1dElkOiBcInBvc2l0aW9uc1Rlc3RcIixcbiAgICBwbGFjZWhvbGRlclRleHQ6IFwiU2VsZWN0IGNyb3BzLi4uXCIsXG4gICAgb3B0aW9uczogZGF0YSxcbiAgICBzZWxlY3RlZDogc2VsZWN0ZWRJZFxuICB9KTtcblxuICByZXR1cm4gZGVib3VuY2UoaW5wdXQsIDEwMDApO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJhbmdlUHJvamVjdENvc3QgPSB7XG4gIGNvbnN0IHVucGFjayA9IE51bWJlcihpbnB1dFByb2plY3RPcHRpb25zLmNvc3QucmVwbGFjZSgvWyx8JF0vZywgXCJcIikpXG4gIGNvbnN0IG51bWJlciA9IE51bWJlcih1bnBhY2spXG4gIHJldHVybiBudW1iZXJcbn1cblxucHJvamVjdFllYXJzID0gaW5wdXRQcm9qZWN0T3B0aW9ucy55ZWFycy52YWx1ZVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlbmRlcl9lY29uUGVyZldhbGt0aHJvdWdoID0gKCkgPT4ge1xuICBjb25zdCB0ZXJtcyA9IHtcbiAgICBub25lOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRlcm1zLm5vbmUsIHtcbiAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgIH0pLFxuICAgIGxvdzogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy50ZXJtcy5sb3csIHtcbiAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgIH0pLFxuICAgIG1vZGVyYXRlOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRlcm1zLm1vZGVyYXRlLCB7XG4gICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICB9KSxcbiAgICBoaWdoOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRlcm1zLmhpZ2gsIHtcbiAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgIH0pLFxuICAgIGluY3JlbWVudGFsOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRlcm1zLmluY3JlbWVudGFsKSxcbiAgICB0cmFuc2Zvcm1hdGl2ZTogX2xhbmcoXG4gICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRlcm1zLnRyYW5zZm9ybWF0aXZlLFxuICAgICksXG4gIH07XG4gIGNvbnN0IGRhdGFQcm9kSW1wYWN0ID0gW1xuICAgIHsgbGFiZWw6IGAxMCUgKCR7dGVybXMuaW5jcmVtZW50YWx9KWAsIHZhbHVlOiAwLjEgfSxcbiAgICB7IGxhYmVsOiBgMjAlYCwgdmFsdWU6IDAuMiB9LFxuICAgIHsgbGFiZWw6IGAzMCUgKCR7dGVybXMubW9kZXJhdGV9KWAsIHZhbHVlOiAwLjMgfSxcbiAgICB7IGxhYmVsOiBgNDAlYCwgdmFsdWU6IDAuNCB9LFxuICAgIHsgbGFiZWw6IGA1MCUgKCR7dGVybXMudHJhbnNmb3JtYXRpdmV9KWAsIHZhbHVlOiAwLjUgfSxcbiAgXTtcbiAgY29uc3QgaW5wdXRQcm9kSW1wYWN0ID0gSW5wdXRzLnNlbGVjdChkYXRhUHJvZEltcGFjdCwge1xuICAgIGxhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLnByb2RJbXBhY3REcm9wZG93bi5sYWJlbCxcbiAgICAgICksXG4gICAgICB0b29sdGlwVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLnByb2RJbXBhY3REcm9wZG93bi50b29sdGlwLFxuICAgICAgKSxcbiAgICB9KSxcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsLFxuICAgIHZhbHVlOiBkYXRhUHJvZEltcGFjdC5maW5kKChkKSA9PiBkLnZhbHVlID09IDAuMyksXG4gIH0pO1xuICBjb25zdCBkYXRhQWRvcHRpb24gPSBbXG4gICAgeyBsYWJlbDogYDAuNSUgKCR7dGVybXMubG93fSlgLCB2YWx1ZTogMC4wMDUgfSxcbiAgICB7IGxhYmVsOiBgMSUgKCR7dGVybXMubW9kZXJhdGV9KWAsIHZhbHVlOiAwLjAxIH0sXG4gICAgeyBsYWJlbDogYDIlICgke3Rlcm1zLmhpZ2h9KWAsIHZhbHVlOiAwLjAyIH0sXG4gIF07XG4gIGNvbnN0IGlucHV0QWRvcHRpb24gPSBJbnB1dHMuc2VsZWN0KGRhdGFBZG9wdGlvbiwge1xuICAgIGxhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLmFkb3B0aW9uUmF0ZURyb3Bkb3duLmxhYmVsLFxuICAgICAgKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuYWRvcHRpb25SYXRlRHJvcGRvd24udG9vbHRpcCxcbiAgICAgICksXG4gICAgfSksXG4gICAgZm9ybWF0OiAoeCkgPT4geC5sYWJlbCxcbiAgICB2YWx1ZTogZGF0YUFkb3B0aW9uLmZpbmQoKGQpID0+IGQudmFsdWUgPT0gMC4wMSksXG4gIH0pO1xuICBjb25zdCBkYXRhQ2lzSW1wYWN0ID0gW1xuICAgIHsgbGFiZWw6IGAwJSAoJHt0ZXJtcy5ub25lfSlgLCB2YWx1ZTogMCB9LFxuICAgIHsgbGFiZWw6IGAxMCUgKCR7dGVybXMubG93fSlgLCB2YWx1ZTogMC4xIH0sXG4gICAgeyBsYWJlbDogYDI1JSAoJHt0ZXJtcy5tb2RlcmF0ZX0pYCwgdmFsdWU6IDAuMjUgfSxcbiAgICB7IGxhYmVsOiBgNTAlICgke3Rlcm1zLmhpZ2h9KWAsIHZhbHVlOiAwLjUgfSxcbiAgXTtcbiAgY29uc3QgaW5wdXRDaXNJbXBhY3QgPSBJbnB1dHMuc2VsZWN0KGRhdGFDaXNJbXBhY3QsIHtcbiAgICBsYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5jaXNJbXBhY3REcm9wZG93bi5sYWJlbCxcbiAgICAgICksXG4gICAgICB0b29sdGlwVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLmNpc0ltcGFjdERyb3Bkb3duLnRvb2x0aXAsXG4gICAgICApLFxuICAgIH0pLFxuICAgIGZvcm1hdDogKHgpID0+IHgubGFiZWwsXG4gICAgdmFsdWU6IGRhdGFDaXNJbXBhY3QuZmluZCgoZCkgPT4gZC52YWx1ZSA9PSAwLjI1KSxcbiAgfSk7XG4gIHJldHVybiBJbnB1dHMuZm9ybShcbiAgICB7XG4gICAgICBpbnB1dFByb2RJbXBhY3QsXG4gICAgICBpbnB1dEFkb3B0aW9uLFxuICAgICAgaW5wdXRDaXNJbXBhY3QsXG4gICAgfSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogaW5wdXRUZW1wbGF0ZSh7IGdhcDogXCIzZW1cIiB9KSxcbiAgICB9LFxuICApO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgZGlzY291bnRSYXRlID0gSW5wdXRzLnJhbmdlKFswLCAxXSx7c3RlcDogMC4wMSwgZm9ybWF0OiB4ID0+ICh4ICogMTAwKSwgdmFsdWU6IDAuMTIsIGxhYmVsOiBcIkRpc2NvdW50IFJhdGVcIn0gKSAvLyAwLTEgYXMgYSBwY3RcbnZpZXdvZiBiY3IgPSBJbnB1dHMucmFuZ2UoWzAuNSwgMl0sIHtzdGVwOiAwLjAxLCBsYWJlbDogXCJCQ1JcIiwgdmFsdWU6IDEuNjJ9IClcblxuXG52aWV3b2YgdW5jZXJ0YWludHlCZW5lZml0U2NhbGUgPSBJbnB1dHMuZm9ybShcbiAgICB7XG4gICAgICBsb3c6IElucHV0cy5yYW5nZShbMC41LCAxXSwge1xuICAgICAgICBzdGVwOiAwLjAxLFxuICAgICAgICB2YWx1ZTogMC45LFxuICAgICAgfSksXG4gICAgICBoaWdoOiBJbnB1dHMucmFuZ2UoWzEsIDEuOF0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgdmFsdWU6IDEuMixcbiAgICAgIH0pLFxuICAgIH0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IGlucHV0VGVtcGxhdGUoeyBnYXA6IFwiM2VtXCIgfSksXG4gICAgfSxcbiAgKTtcblxudmlld29mIHVuY2VydGFpbnR5Q29zdFNjYWxlID0gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgbG93OiBJbnB1dHMucmFuZ2UoWzAuNSwgMV0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgdmFsdWU6IDAuOSxcbiAgICAgIH0pLFxuICAgICAgaGlnaDogSW5wdXRzLnJhbmdlKFsxLCAxLjhdLCB7XG4gICAgICAgIHN0ZXA6IDAuMDEsXG4gICAgICAgIHZhbHVlOiAxLjIsXG4gICAgICB9KSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHRlbXBsYXRlOiBpbnB1dFRlbXBsYXRlKHsgZ2FwOiBcIjNlbVwiIH0pLFxuICAgIH0sXG4gICk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gUGxvdCBWYXJpYWJsZVxuLy8gYmFzZSBzZWxlY3RvciBmb3IgbWV0cmljIHR5cGVcbnZpZXdvZiBwaWNrTWV0cmljV2Fsa3Rocm91Z2ggPSB7XG4gIHJldHVybiBJbnB1dHMuc2VsZWN0KGRhdGFQaWNrTWV0cmljLCB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmdlbmVyYWwudGVybXMuaW5kaWNhdG9yKSxcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsRnVsbCxcbiAgICB2YWx1ZTogZGF0YVBpY2tNZXRyaWMuZmluZCgoZCkgPT4gZC5rZXkgPT0gXCJpcnJcIilcbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW1wb3J0IHsgZHJvcGRvd25JbnB1dCwgZHJvcGRvd25DU1MgfSBmcm9tIFwiL2hlbHBlcnMvbXVsdGlTZWxlY3Qub2pzXCI7XG5cbmRyb3Bkb3duQ1NTO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRlYm91bmNlID0gKGlucHV0LCBkZWxheSA9IDUwMCkgPT4ge1xuICBjbGFzcyBEZWxheWVkRXZlbnQgZXh0ZW5kcyBFdmVudCB7fVxuICBsZXQgaWQ7XG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZSkgPT4ge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRGVsYXllZEV2ZW50KSByZXR1cm47XG4gICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICBjbGVhclRpbWVvdXQoaWQpO1xuICAgIGlkID0gc2V0VGltZW91dChcbiAgICAgICgpID0+IGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IERlbGF5ZWRFdmVudChcImlucHV0XCIsIHsgYnViYmxlczogdHJ1ZSB9KSksXG4gICAgICBkZWxheSxcbiAgICApO1xuICB9KTtcbiAgcmV0dXJuIGlucHV0O1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBUaGlzIGNlbGwgaXMgdG8gY29udGFpbiBhbGwgdGhlIGhlYWRpbmdzIGFuZCB0aGUgbm90ZWJvb2sgdGl0bGVcbm5iVGl0bGUgPSBfbGFuZyh7XG4gIGVuOiBcIkVzdGltYXRlIEVjb25vbWljIFJldHVybnMgb24gQWRhcHRhdGlvblwiLFxuICBmcjogXCJFc3RpbWVyIGxlcyByZXRvdXJzIHN1ciDDqWNvbm9taXF1ZXMgbCdhZGFwdGF0aW9uXCIsXG59KTtcbi8vIGtleV9pbnNpZ2h0cyA9IF9sYW5nKHtlbjogXCJLZXkgSW5zaWdodHNcIiwgZnI6IFwiUsOpc3Vtw6lcIn0pXG5uYk92ZXJ2aWV3ID0gX2xhbmcoeyBlbjogXCJPdmVydmlld1wiLCBmcjogXCJWdWUgZOKAmUVuc2VtYmxlXCIgfSk7XG5oZWFkaW5nMSA9IF9sYW5nKHsgZW46IFwiUHJvamVjdCBTZXQtVXBcIiwgZnI6IFwiQ29uZmlndXJhdGlvbiBkZSBQcm9qZWN0XCIgfSk7XG5oZWFkaW5nMiA9IF9sYW5nKHsgZW46IFwiSW52ZXN0bWVudCBSZXR1cm5zXCIsIGZyOiBcIlJldG91cnMgZCdJbnZlc3Rpc3NlbWVudHNcIiB9KTtcbm5iU3VtbWFyeSA9IF9sYW5nKHsgZW46IFwiU3VtbWFyeVwiLCBmcjogXCJSw6lzdW3DqVwiIH0pO1xubmJNZXRob2RzID0gX2xhbmcoeyBlbjogXCJNZXRob2RzICYgU291cmNlc1wiLCBmcjogXCJNw6l0aG9kZXMgJiBTb3VyY2VzXCIgfSk7XG5hcHBlbmRpeCA9IF9sYW5nKGdlbmVyYWxfdHJhbnNsYXRpb25zLmFwcGVuZGl4KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbXBvcnQgeyBsYW5nIGFzIExhbmcgfSBmcm9tIFwiL2hlbHBlcnMvbGFuZy5qc1wiXG5cbmdlbmVyYWxfdHJhbnNsYXRpb25zID0gYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9zaGFyZWQvZ2VuZXJhbFRyYW5zbGF0aW9ucy5qc29uXCIpLmpzb24oKVxuXG5uYlRleHQgPSBhd2FpdCBGaWxlQXR0YWNobWVudChcIi9kYXRhL2Vjb25vbWljUmV0dXJucy90cmFuc2xhdGlvbnMuanNvblwiKS5qc29uKClcblxubGFuZ3VhZ2VzID0gW1xuICB7IGtleTogXCJlblwiLCBsYWJlbDogXCJFbmdsaXNoXCIsIGxvY2FsZTogJ2VuLVVTJyB9LFxuICB7IGtleTogXCJmclwiLCBsYWJlbDogXCJGcmFuw6dhaXNcIiwgbG9jYWxlOiAnZnItRlInIH1cbl1cblxuZGVmYXVsdExhbmdLZXkgPSB7XG4gIGNvbnN0IG5hbWUgPSBcImxhbmdcIjtcbiAgY29uc3QgbGlzdCA9IGxhbmd1YWdlcy5tYXAoKGQpID0+IGQua2V5KTtcbiAgY29uc3QgZGVmYXVsdEtleSA9IFwiZW5cIjtcbiAgY29uc3QgcXVlcnlQYXJhbSA9IGF3YWl0IExhbmcuZ2V0UGFyYW1Gcm9tTGlzdCh7IG5hbWUsIGxpc3QgfSk7XG4gIHJldHVybiBxdWVyeVBhcmFtID8/IGRlZmF1bHRLZXk7XG59XG5cbl9sYW5nID0gTGFuZy5sZyhtYXN0ZXJMYW5ndWFnZS5rZXkpXG5cbnZpZXdvZiBtYXN0ZXJMYW5ndWFnZSA9IElucHV0cy5yYWRpbyhsYW5ndWFnZXMsIHtcbiAgbGFiZWw6IFwiTWFpbiBsYW5ndWFnZSB0b2dnbGVcIixcbiAgZm9ybWF0OiAoZCkgPT4gZC5rZXksXG4gIHZhbHVlOiBsYW5ndWFnZXMuZmluZCgoeCkgPT4geC5rZXkgPT09IGRlZmF1bHRMYW5nS2V5KSxcbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gTmF2YmFyTGFuZ1NlbGVjdG9yKGxhbmd1YWdlX29iaiwgbWFzdGVyTGFuZ3VhZ2UpIHtcbiAgbGV0IG5hdkVuZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubmF2YmFyLW5hdi5tcy1hdXRvIC5uYXYtaXRlbS5jb21wYWN0XCIpO1xuICBpZiAobmF2RW5kKSB7XG4gICAgbGV0IGV4aXN0aW5nTGFuZ1NlbGVjdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuYXYtbGFuZy1zZWxlY3RvclwiKTtcbiAgICBpZiAoIWV4aXN0aW5nTGFuZ1NlbGVjdG9yKSB7XG4gICAgICBsZXQgbGFuZ19zZWwgPSBJbnB1dHMuYmluZChcbiAgICAgICAgSW5wdXRzLnJhZGlvKGxhbmd1YWdlX29iaiwge1xuICAgICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICAgIGZvcm1hdDogKGQpID0+IGQubGFiZWxcbiAgICAgICAgfSksXG4gICAgICAgIHZpZXdvZiBtYXN0ZXJMYW5ndWFnZVxuICAgICAgKTtcbiAgICAgIGxhbmdfc2VsLmlkID0gXCJuYXYtbGFuZy1zZWxlY3RvclwiO1xuXG4gICAgICAvLyBIYWNrIHRoZSBjc3MgdG9nZXRoZXIgZm9yIHRoZSBvYnNlcnZhYmxlIGlucHV0c1xuICAgICAgbGFuZ19zZWwuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgbGFuZ19zZWwuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XG4gICAgICBsYW5nX3NlbC5zdHlsZS5tYXJnaW5MZWZ0ID0gXCIxMHB4XCI7XG4gICAgICBsZXQgbGFuZ19kaXYgPSBsYW5nX3NlbC5xdWVyeVNlbGVjdG9yKFwiZGl2XCIpO1xuICAgICAgbGFuZ19kaXYuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgbGFuZ19kaXYuc3R5bGUuZmxleERpcmVjdGlvbiA9IFwiY29sdW1uXCI7XG5cbiAgICAgIC8vIEluc2VydCB0aGUgbmV3IGl0ZW0gYWZ0ZXIgdGhlIEdpdEh1YiBpY29uIGFuZCBvdGhlciBlbGVtZW50c1xuICAgICAgbmF2RW5kLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobGFuZ19zZWwpO1xuICAgIH1cbiAgfVxufVxuXG5OYXZiYXJMYW5nU2VsZWN0b3IobGFuZ3VhZ2VzLCBtYXN0ZXJMYW5ndWFnZSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkYXRhUGlja01ldHJpYyA9IHtcbiAgcmV0dXJuIFtcbiAgICB7XG4gICAgICBrZXk6IFwiaXJyXCIsXG4gICAgICBjb2x1bW5OYW1lOiBcImlyclwiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmlyci5sYWJlbCksXG4gICAgICB0b29sdGlwOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIudG9vbHRpcCksXG4gICAgICBsYWJlbExvbmc6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmlyci5sYWJlbExvbmcpLFxuICAgICAgbGFiZWxGdWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIubGFiZWxGdWxsKSxcbiAgICAgIGluZm86IHtcbiAgICAgICAgd2hhdDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLmluZm8ud2hhdCksXG4gICAgICAgIGludGVycHJldDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLmluZm8uaW50ZXJwcmV0KSxcbiAgICAgICAgdGVsbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLmluZm8udGVsbClcbiAgICAgIH0sXG4gICAgICB5Rm9ybWF0OiAoZCkgPT4gYCR7ZC50b0ZpeGVkKDEpfSVgXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6IFwibWlyclwiLFxuICAgICAgY29sdW1uTmFtZTogXCJtaXJyXCIsXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci5sYWJlbCksXG4gICAgICB0b29sdGlwOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLnRvb2x0aXApLFxuICAgICAgbGFiZWxMb25nOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLmxhYmVsTG9uZyksXG4gICAgICBsYWJlbEZ1bGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm1pcnIubGFiZWxGdWxsKSxcbiAgICAgIGluZm86IHtcbiAgICAgICAgd2hhdDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci5pbmZvLndoYXQpLFxuICAgICAgICBpbnRlcnByZXQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm1pcnIuaW5mby5pbnRlcnByZXQpLFxuICAgICAgICB0ZWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLmluZm8udGVsbClcbiAgICAgIH0sXG4gICAgICB5Rm9ybWF0OiAoZCkgPT4gYCR7ZC50b0ZpeGVkKDEpfSVgXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6IFwibnB2XCIsXG4gICAgICBjb2x1bW5OYW1lOiBcIm5wdlwiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi5sYWJlbCksXG4gICAgICB0b29sdGlwOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5ucHYudG9vbHRpcCksXG4gICAgICBsYWJlbExvbmc6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi5sYWJlbExvbmcpLFxuICAgICAgbGFiZWxGdWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5ucHYubGFiZWxGdWxsKSxcbiAgICAgIGluZm86IHtcbiAgICAgICAgd2hhdDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2LmluZm8ud2hhdCksXG4gICAgICAgIGludGVycHJldDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2LmluZm8uaW50ZXJwcmV0KSxcbiAgICAgICAgdGVsbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2LmluZm8udGVsbClcbiAgICAgIH0sXG4gICAgICAgeUZvcm1hdDogKGQpID0+IGZvcm1hdFVTRCgpKGQpXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6IFwiYmNyXCIsXG4gICAgICBjb2x1bW5OYW1lOiBcImRpc2NvdW50ZWRfYmNyXCIsXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLmxhYmVsKSxcbiAgICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmJjci50b29sdGlwKSxcbiAgICAgIGxhYmVsTG9uZzogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLmxhYmVsTG9uZyksXG4gICAgICBsYWJlbEZ1bGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmJjci5sYWJlbEZ1bGwpLFxuICAgICAgaW5mbzoge1xuICAgICAgICB3aGF0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IuaW5mby53aGF0KSxcbiAgICAgICAgaW50ZXJwcmV0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IuaW5mby5pbnRlcnByZXQpLFxuICAgICAgICB0ZWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IuaW5mby50ZWxsKVxuICAgICAgfSxcbiAgICAgIHlGb3JtYXQ6IGQzLmZvcm1hdChcIi4yZlwiKVxuICAgIH1cbiAgXTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZW5kZXJSZXZpZXcxID0gKCkgPT4ge1xuICBjb25zdCBsYW5nQmFzZVBhdGggPSBuYlRleHQuaW52ZXN0bWVudFJldHVybnMuYmxvY2tzLmluc2lnaHRSZXZpZXcuc2V0dXBCbG9jaztcbiAgY29uc3QgbGFuZ01pc3NpbmdUZW1wbGF0ZSA9IF9sYW5nKGxhbmdCYXNlUGF0aC5taXNzaW5nTWVzc2FnZSwge1xuICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICB9KTtcblxuICBjb25zdCBpc29TZXQgPSBuZXcgU2V0KHNlbGVjdF9jb3VudHJ5KTtcblxuICBjb25zdCBhZG1pbjBMaXN0ID0gY291bnRyaWVzXG4gICAgLmZpbHRlcigoZCkgPT4gaXNvU2V0LmhhcyhkLmlzbzNjKSlcbiAgICAubWFwKChkKSA9PiBkLmFkbWluMF9uYW1lKTtcblxuICBjb25zdCBjcm9wTGlzdCA9IHNlbGVjdF9jcm9wO1xuXG4gIC8vIGNvbnN0IGNyb3BMaXN0ID0gYWRtaW5Dcm9wQ2hvaWNlcy5jcm9wcy5zb3J0KChhLGIpID0+IF9sYW5nKGEudHJhbnNsYXRpb24pID4gX2xhbmcoYi50cmFuc2xhdGlvbikpO1xuICBjb25zdCB0cnVuY2F0ZVNpemUgPSAzO1xuICBjb25zdCBhZG1pbjBMaXN0VHJ1bmNhdGVkID0gYWRtaW4wTGlzdC5zbGljZSgwLCB0cnVuY2F0ZVNpemUpO1xuICBjb25zdCBjcm9wTGlzdFRydW5jYXRlZCA9IGNyb3BMaXN0LnNsaWNlKDAsIHRydW5jYXRlU2l6ZSk7IC8vIC5tYXAoKGQpID0+IF9sYW5nKGQudHJhbnNsYXRpb24pKTtcblxuICBpZiAoYWRtaW4wTGlzdC5sZW5ndGggPT0gMCB8fCBjcm9wTGlzdC5sZW5ndGggPT0gMCkge1xuICAgIHJldHVybiBtZGAke2xhbmdNaXNzaW5nVGVtcGxhdGV9YDtcbiAgfVxuXG4gIC8vIG5ldyBjb2RlXG4gIGNvbnN0IGluc2VydENyb3BDb3VudCA9IGNyb3BMaXN0Lmxlbmd0aDtcbiAgY29uc3QgaW5zZXJ0Q3JvcFdvcmQgPVxuICAgIGNyb3BMaXN0Lmxlbmd0aCA9PSAxXG4gICAgICA/IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNyb3Auc2luZ3VsYXIsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSlcbiAgICAgIDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY3JvcC5wbHVyYWwsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSk7XG4gIGNvbnN0IGluc2VydENyb3BMaXN0ID0gYCgqKiR7Y3JvcExpc3RUcnVuY2F0ZWQuam9pbihcIiwgXCIpfSR7XG4gICAgY3JvcExpc3QubGVuZ3RoID4gdHJ1bmNhdGVTaXplID8gXCIuLi5cIiA6IFwiXCJcbiAgfSoqKWA7XG4gIGNvbnN0IGluc2VydENyb3AgPSBgKioke2luc2VydENyb3BDb3VudH0gJHtpbnNlcnRDcm9wV29yZH0qKiAke2luc2VydENyb3BMaXN0fWA7XG5cbiAgY29uc3QgaW5zZXJ0UmVnaW9uQ291bnQgPSBzZWxlY3RfcmVnaW9uLmxlbmd0aDtcbiAgY29uc3QgaW5zZXJ0UmVnaW9uV29yZCA9XG4gICAgaW5zZXJ0UmVnaW9uQ291bnQgPT0gMVxuICAgICAgPyBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5yZWdpb24uc2luZ3VsYXIsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSlcbiAgICAgIDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMucmVnaW9uLnBsdXJhbCwge1xuICAgICAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgICAgICB9KTtcbiAgY29uc3QgaW5zZXJ0UmVnaW9uID0gYCR7aW5zZXJ0UmVnaW9uQ291bnR9ICR7aW5zZXJ0UmVnaW9uV29yZH1gO1xuXG4gIGNvbnN0IGluc2VydENvdW50cnlDb3VudCA9IGFkbWluMExpc3QubGVuZ3RoO1xuICBjb25zdCBpbnNlcnRDb3VudHJ5V29yZCA9XG4gICAgaW5zZXJ0Q291bnRyeUNvdW50ID09IDFcbiAgICAgID8gX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY291bnRyeS5zaW5ndWxhciwge1xuICAgICAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgICAgICB9KVxuICAgICAgOiBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5jb3VudHJ5LnBsdXJhbCwge1xuICAgICAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgICAgICB9KTtcbiAgY29uc3QgaW5zZXJ0Q291bnRyeUxpc3QgPSBgKCoqJHthZG1pbjBMaXN0VHJ1bmNhdGVkLmpvaW4oXCIsIFwiKX0ke1xuICAgIGluc2VydENvdW50cnlDb3VudCA+IHRydW5jYXRlU2l6ZSA/IFwiLi4uXCIgOiBcIlwiXG4gIH0qKilgO1xuICBjb25zdCBpbnNlcnRDb3VudHJ5ID0gYCoqJHtpbnNlcnRDb3VudHJ5Q291bnR9ICR7aW5zZXJ0Q291bnRyeVdvcmR9KiogJHtpbnNlcnRDb3VudHJ5TGlzdH1gO1xuXG4gIC8vIGluc2VydCB0byB0ZW1wbGF0ZVxuICBjb25zdCBsYW5nVGVtcGxhdGUgPSBfbGFuZyhsYW5nQmFzZVBhdGgudGVtcGxhdGUsIHtcbiAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgfSk7XG4gIGNvbnN0IGxhbmdUZW1wbGF0ZUl0ZW1zID0gW1xuICAgIHsgbmFtZTogXCJjcm9wX3N0cmluZ1wiLCB2YWx1ZTogaW5zZXJ0Q3JvcCB9LFxuICAgIHsgbmFtZTogXCJyZWdpb25fc3RyaW5nXCIsIHZhbHVlOiBpbnNlcnRSZWdpb24gfSxcbiAgICB7IG5hbWU6IFwiY291bnRyeV9zdHJpbmdcIiwgdmFsdWU6IGluc2VydENvdW50cnkgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcImNvc3Rfc3RyaW5nXCIsXG4gICAgICB2YWx1ZTogZm9ybWF0VVNEKHsgbG9jYWxlOiBsYW5ndWFnZS5sb2NhbGUgfSkocmFuZ2VQcm9qZWN0Q29zdCksXG4gICAgfSxcbiAgICB7IG5hbWU6IFwieWVhcl9zdHJpbmdcIiwgdmFsdWU6IHByb2plY3RZZWFycyArIFwiIHllYXJzXCIgfSwgLy9UT0RPOiBhZGQgY29ycmVjdCBcInllYXJzXCIgc3RyaW5nIGF0IGVuZCBvZiB0aGlzXG4gIF07XG4gIGNvbnN0IHNlbGVjdGlvbkZvcm1hdHRlZFRlbXBsYXRlID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBsYW5nVGVtcGxhdGUsXG4gICAgbGFuZ1RlbXBsYXRlSXRlbXMsXG4gICk7XG5cbiAgcmV0dXJuIG1kYCR7c2VsZWN0aW9uRm9ybWF0dGVkVGVtcGxhdGV9YDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVuZGVyUmV2aWV3MiA9ICgpID0+IHtcbiAgY29uc3QgaW52ZXN0bWVudFRlbXBsYXRlID0gX2xhbmcoXG4gICAgbmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5pbnNpZ2h0UmV2aWV3LmluZGljYXRvckJsb2NrLFxuICApO1xuICBjb25zdCBpbnZlc3RtZW50VGVtcGxhdGVJdGVtcyA9IFtcbiAgICB7XG4gICAgICBuYW1lOiBcInByb2RfaW1wYWN0X2xhYmVsXCIsXG4gICAgICB2YWx1ZTogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0UHJvZEltcGFjdC5sYWJlbCxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiYWRvcHRpb25fcmF0ZV9sYWJlbFwiLFxuICAgICAgdmFsdWU6IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dEFkb3B0aW9uLmxhYmVsLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJjaXNfaW1wYWN0X2xhYmVsXCIsXG4gICAgICB2YWx1ZTogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0Q2lzSW1wYWN0LmxhYmVsLFxuICAgIH0sXG4gICAgeyBuYW1lOiBcInllYXJfc3RyaW5nXCIsIHZhbHVlOiBwcm9qZWN0WWVhcnMgKyBcIiB5ZWFyc1wiIH0sXG4gIF07XG5cbiAgcmV0dXJuIG1kYCR7TGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhpbnZlc3RtZW50VGVtcGxhdGUsIGludmVzdG1lbnRUZW1wbGF0ZUl0ZW1zKX06YDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYmlnTnVtYmVyc1Jlc3VsdHMgPSAoKSA9PiB7XG4gIGNvbnN0IHkgPSBwcm9qZWN0WWVhcnM7XG4gIGNvbnN0IGUgPSB3YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycz8uZW5yaWNoZWQ/LmZpbmQoKGQpID0+IGQueWVhciA9PT0geSk7XG5cbiAgY29uc3QgZGF0YSA9IGRhdGFQaWNrTWV0cmljLm1hcCgoZCkgPT4ge1xuICAgIGxldCB2YWx1ZTtcblxuICAgIGlmIChkLmtleSA9PT0gXCJpcnJcIiAmJiBlPy5pcnIgIT0gbnVsbCkge1xuICAgICAgdmFsdWUgPSBlLmlycjsgLy8gSVJSIGFzIHBlcmNlbnRhZ2VcbiAgICB9IGVsc2UgaWYgKGQua2V5ID09PSBcIm1pcnJcIiAmJiBlPy5taXJyICE9IG51bGwpIHtcbiAgICAgIHZhbHVlID0gZS5taXJyOyAvLyBNSVJSIGFzIHBlcmNlbnRhZ2VcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgZC5rZXkgPT09IFwibnB2XCIgJiZcbiAgICAgIGU/LmRpc2NvdW50ZWRfYmVuZWZpdF9jdW0gIT0gbnVsbCAmJlxuICAgICAgZT8uZGlzY291bnRlZF9jb3N0X2N1bSAhPSBudWxsXG4gICAgKSB7XG4gICAgICB2YWx1ZSA9ICsoZS5kaXNjb3VudGVkX2JlbmVmaXRfY3VtIC0gZS5kaXNjb3VudGVkX2Nvc3RfY3VtKS50b0ZpeGVkKDEpOyAvLyBOUFYsIDEgZHBcbiAgICB9IGVsc2UgaWYgKGQua2V5ID09PSBcImJjclwiKSB7XG4gICAgICB2YWx1ZSA9IGU/LmRpc2NvdW50ZWRfYmNyO1xuICAgIH1cblxuICAgIHJldHVybiB7IC4uLmQsIHZhbHVlIH07XG4gIH0pO1xuXG4gIHJldHVybiBodGwuaHRtbGBcbiAgPHN0eWxlPlxuICAgIC5vdXRlci1kaXYge1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGdhcDogMmVtO1xuICAgIH1cbiAgICAuaW5uZXItZGl2IHtcbiAgICAgIHdpZHRoOiAzMCU7XG4gICAgICBwYWRkaW5nOiA4MHB4IDMwcHg7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCAjZWZlZmVmO1xuICAgIH1cbiAgICAubGFiZWwge1xuICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICBmb250LXdlaWdodDogNDAwO1xuICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTtcbiAgICAgIGNvbG9yOiAjNjY2O1xuICAgIH1cbiAgICAudmFsdWUge1xuICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICBmb250LXNpemU6IDQycHg7XG4gICAgfVxuICAgIC5uZWdhdGl2ZSB7XG4gICAgICBjb2xvcjogI0VDNUE0NztcbiAgICB9XG4gICAgLnRvb2x0aXAtY2FyZCB7XG4gICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgIH1cbiAgICAudG9vbHRpcC1jYXJkIC50b29sdGlwdGV4dC1jYXJkIHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICB6LWluZGV4OiAxO1xuICAgICAgICB2aXNpYmlsaXR5OiBoaWRkZW47XG4gICAgICAgIGxlZnQ6IDA7XG4gICAgICAgIGJvdHRvbTogOTAlO1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWZlZmVmO1xuICAgICAgICBjb2xvcjogIzMzMztcbiAgICAgICAgcGFkZGluZzogMTRweCAyMHB4O1xuICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgIGxpbmUtaGVpZ2h0OiAxLjY7XG4gICAgICAgIHRleHQtYWxpZ246IGxlZnQ7XG4gICAgICAgIG9wYWNpdHk6IDA7XG4gICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4zcztcbiAgICB9XG4gICAgLnRvb2x0aXAtY2FyZDpob3ZlciAudG9vbHRpcHRleHQtY2FyZCB7XG4gICAgICAgIHZpc2liaWxpdHk6IHZpc2libGU7XG4gICAgICAgIG9wYWNpdHk6IDE7XG4gICAgICAgIGN1cnNvcjogZGVmYXVsdDtcbiAgICB9XG4gIDwvc3R5bGU+XG5cbiAgPGJvZHk+XG4gICAgPGRpdiBjbGFzcz1cIm91dGVyLWRpdlwiPlxuICAgICAgJHtkYXRhLm1hcChcbiAgICAgICAgKGQpID0+IGh0bC5odG1sYDxkaXYgY2xhc3M9XCJpbm5lci1kaXZcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInRvb2x0aXAtY2FyZFwiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b29sdGlwdGV4dC1jYXJkXCI+JHtkLnRvb2x0aXB9PC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ2YWx1ZSAke2QudmFsdWUgIT0gbnVsbCAmJiBkLnZhbHVlIDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiXCJ9XCI+JHtcbiAgICAgICAgICAgICAgZC52YWx1ZSAhPSBudWxsID8gZC55Rm9ybWF0KGQudmFsdWUpIDogXCItLS1cIlxuICAgICAgICAgICAgfTwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibGFiZWxcIj4ke2QubGFiZWxGdWxsfTwvc3Bhbj5cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvZGl2PmAsXG4gICAgICApfVxuICAgIDwvZGl2PlxuICA8L2JvZHk+YDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVzdWx0VGFibGUgPSAoKSA9PiB7XG4gIGNvbnN0IGZtdFVTRCA9IGZvcm1hdFVTRCh7IGxvY2FsZTogbGFuZ3VhZ2UubG9jYWxlIH0pO1xuICBjb25zdCBzZWxlY3RlZFllYXIgPSBwcm9qZWN0WWVhcnM7XG4gIGNvbnN0IGVucmljaGVkID0gKHdhbGt0aHJvdWdoRWNvbm9taWNJbmRpY2F0b3JzPy5lbnJpY2hlZCA/PyBbXSkuZmlsdGVyKFxuICAgIChkKSA9PiBkLnllYXIgPD0gc2VsZWN0ZWRZZWFyLFxuICApO1xuXG4gIGNvbnN0IHRhYmxlSGVhZGVycyA9XG4gICAgbmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5leHBsb3JlSW5kaWNhdG9ycy50YWJsZUhlYWRlcnM7XG4gIGNvbnN0IGhlYWRlck5hbWVzID0gW1xuICAgIF9sYW5nKHRhYmxlSGVhZGVycy55ZWFyKSxcbiAgICBfbGFuZyh0YWJsZUhlYWRlcnMuYmVuZWZpdCksXG4gICAgX2xhbmcodGFibGVIZWFkZXJzLmNvc3QpLFxuICAgIF9sYW5nKHRhYmxlSGVhZGVycy5jYXNoZmxvdyksXG4gICAgX2xhbmcodGFibGVIZWFkZXJzLmRpc2NvdW50ZWRCZW5lZml0Q3VtKSxcbiAgICBfbGFuZyh0YWJsZUhlYWRlcnMuZGlzY291bnRlZENvc3RDdW0pLFxuICAgIF9sYW5nKHRhYmxlSGVhZGVycy5kaXNjb3VudGVkTnB2Q3VtKSxcbiAgICBfbGFuZyh0YWJsZUhlYWRlcnMuZGlzY291bnRlZEJjciksXG4gICAgX2xhbmcodGFibGVIZWFkZXJzLmlyciksXG4gICAgX2xhbmcodGFibGVIZWFkZXJzLm1pcnIpLFxuICBdO1xuXG4gIHJldHVybiBodG1sYFxuICAgIDxzdHlsZT5cbiAgICAgIC5lY29uLXRhYmxlIHtcbiAgICAgICAgZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7XG4gICAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7XG4gICAgICAgIGZvbnQtc2l6ZTogMTMuNzVweDtcbiAgICAgICAgbWFyZ2luLXRvcDogMWVtO1xuICAgICAgICBtaW4td2lkdGg6IDEwMCU7XG4gICAgICB9XG4gICAgICAuZWNvbi10YWJsZSB0aCwgLmVjb24tdGFibGUgdGQge1xuICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZGRkO1xuICAgICAgICBwYWRkaW5nOiA2cHggMTBweDtcbiAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7XG4gICAgICB9XG4gICAgICAuZWNvbi10YWJsZSB0aCB7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmNGY0ZjQ7XG4gICAgICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7XG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIH1cbiAgICAgIC5lY29uLXRhYmxlIHRkLnllYXItY29sIHtcbiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICAgIH1cbiAgICAgIC5lY29uLXRhYmxlIHRyLmZpbmFsLXJvdyB0ZCB7XG4gICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjFmMWYxO1xuICAgICAgfVxuICAgICAgLnRhYmxlLWNvbnRhaW5lciB7XG4gICAgICAgIG92ZXJmbG93LXg6IGF1dG87XG4gICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgICBwYWRkaW5nLWJvdHRvbTogNHB4O1xuICAgICAgfVxuICAgIDwvc3R5bGU+XG5cbiAgICA8ZGl2IGNsYXNzPVwidGFibGUtY29udGFpbmVyXCI+XG4gICAgICA8dGFibGUgY2xhc3M9XCJlY29uLXRhYmxlXCI+XG4gICAgICAgIDx0aGVhZD5cbiAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAke2hlYWRlck5hbWVzLm1hcCgoaCkgPT4gaHRtbGA8dGggdGl0bGU9XCIke2h9XCI+JHtofTwvdGg+YCl9XG4gICAgICAgICAgPC90cj5cbiAgICAgICAgPC90aGVhZD5cbiAgICAgICAgPHRib2R5PlxuICAgICAgICAgICR7ZW5yaWNoZWQubWFwKChkLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpc0ZpbmFsID0gaSA9PT0gZW5yaWNoZWQubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIGNvbnN0IG5wdl9pID1cbiAgICAgICAgICAgICAgZC5kaXNjb3VudGVkX2JlbmVmaXRfY3VtICE9IG51bGwgJiYgZC5kaXNjb3VudGVkX2Nvc3RfY3VtICE9IG51bGxcbiAgICAgICAgICAgICAgICA/IGQuZGlzY291bnRlZF9iZW5lZml0X2N1bSAtIGQuZGlzY291bnRlZF9jb3N0X2N1bVxuICAgICAgICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICAgICAgcmV0dXJuIGh0bWxgPHRyIGNsYXNzPSR7aXNGaW5hbCA/IFwiZmluYWwtcm93XCIgOiBcIlwifT5cbiAgICAgICAgICAgICAgPHRkIGNsYXNzPVwieWVhci1jb2xcIj4ke2QueWVhcn08L3RkPlxuICAgICAgICAgICAgICA8dGQ+JHtkLnByb2plY3RfYmVuZWZpdCAhPSBudWxsID8gZm10VVNEKGQucHJvamVjdF9iZW5lZml0KSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5jb3N0ICE9IG51bGwgPyBmbXRVU0QoZC5jb3N0KSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5jYXNoZmxvdyAhPSBudWxsID8gZm10VVNEKGQuY2FzaGZsb3cpIDogXCLigJRcIn08L3RkPlxuICAgICAgICAgICAgICA8dGQ+JHtkLmRpc2NvdW50ZWRfYmVuZWZpdF9jdW0gIT0gbnVsbCA/IGZtdFVTRChkLmRpc2NvdW50ZWRfYmVuZWZpdF9jdW0pIDogXCLigJRcIn08L3RkPlxuICAgICAgICAgICAgICA8dGQ+JHtkLmRpc2NvdW50ZWRfY29zdF9jdW0gIT0gbnVsbCA/IGZtdFVTRChkLmRpc2NvdW50ZWRfY29zdF9jdW0pIDogXCLigJRcIn08L3RkPlxuICAgICAgICAgICAgICA8dGQ+JHtucHZfaSAhPSBudWxsID8gZm10VVNEKG5wdl9pKSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5kaXNjb3VudGVkX2JjciAhPSBudWxsID8gZC5kaXNjb3VudGVkX2Jjci50b0ZpeGVkKDIpIDogXCLigJRcIn08L3RkPlxuICAgICAgICAgICAgICA8dGQ+JHtkLmlyciAhPSBudWxsID8gYCR7KGQuaXJyKS50b0ZpeGVkKDIpfSVgIDogXCLigJRcIn08L3RkPlxuICAgICAgICAgICAgICA8dGQ+JHtkLm1pcnIgIT0gbnVsbCA/IGAkeyhkLm1pcnIpLnRvRml4ZWQoMil9JWAgOiBcIuKAlFwifTwvdGQ+XG4gICAgICAgICAgICA8L3RyPmA7XG4gICAgICAgICAgfSl9XG4gICAgICAgIDwvdGJvZHk+XG4gICAgICA8L3RhYmxlPlxuICAgIDwvZGl2PlxuICBgO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZXN1bHRQbG90ID0gKCkgPT4ge1xuICBjb25zdCBwcm9qZWN0WWVhckN1dG9mZiA9IHdhbGt0aHJvdWdoU2VsZWN0aW9ucy5wcm9qZWN0X3llYXJzO1xuICBjb25zdCBzZWxlY3RvciA9IHBpY2tNZXRyaWNXYWxrdGhyb3VnaDtcbiAgY29uc3QgcGxvdERhdGEgPSB3YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycz8uZW5yaWNoZWQgPz8gW107XG4gIGNvbnN0IHVuY2VydGFpbnR5WWVhcmx5ID0gdW5jZXJ0YWludHk/LnllYXJseSA/PyBbXTtcblxuICAvLyBBbHdheXMgaW5jbHVkZSBhbGwgeWVhcnMgZm9yIGNvbnNpc3RlbnQgeC1heGlzXG4gIGNvbnN0IGZ1bGxZZWFycyA9IGQzLnJhbmdlKDAsIHByb2plY3RZZWFycyArIDEpOyAvLyAwIHRvIDggaW5jbHVzaXZlXG4gIGNvbnN0IGNvbXBsZXRlUGxvdERhdGEgPSBmdWxsWWVhcnMubWFwKCh5KSA9PiB7XG4gICAgY29uc3Qgcm93ID0gcGxvdERhdGEuZmluZCgoZCkgPT4gZC55ZWFyID09PSB5KTtcbiAgICByZXR1cm4gcm93ID8/IHsgeWVhcjogeSB9O1xuICB9KTtcblxuICBjb25zdCBiYW5kRGF0YSA9ICgoKSA9PiB7XG4gICAgY29uc3QgbWV0cmljS2V5ID0gc2VsZWN0b3Iua2V5O1xuICAgIHJldHVybiBmdWxsWWVhcnNcbiAgICAgIC5tYXAoKHllYXIpID0+IHtcbiAgICAgICAgY29uc3Qgcm93ID0gdW5jZXJ0YWludHlZZWFybHkuZmluZCgoZCkgPT4gZC55ZWFyID09PSB5ZWFyKTtcbiAgICAgICAgY29uc3QgbG93ID0gcm93Py5bbWV0cmljS2V5XT8ucDEwO1xuICAgICAgICBjb25zdCBoaWdoID0gcm93Py5bbWV0cmljS2V5XT8ucDkwO1xuICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShsb3cpIHx8ICFOdW1iZXIuaXNGaW5pdGUoaGlnaCkpIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4geyB5ZWFyLCBsb3csIGhpZ2ggfTtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKChkKSA9PiBkICE9IG51bGwpO1xuICB9KSgpO1xuXG4gIGNvbnN0IHJ1bGVZVmFsdWUgPSBzZWxlY3Rvci5rZXkgPT09IFwiYmNyXCIgPyAxIDogMDtcblxuICByZXR1cm4gUGxvdC5wbG90KHtcbiAgICB3aWR0aCxcbiAgICBtYXJnaW5SaWdodDogODAsXG4gICAgaW5zZXQ6IDUsXG4gICAgeDoge1xuICAgICAgbGFiZWw6IF9sYW5nKFxuICAgICAgICBuYlRleHQuaW52ZXN0bWVudFJldHVybnMuYmxvY2tzLmV4cGxvcmVJbmRpY2F0b3JzLnByb2plY3RZZWFyLFxuICAgICAgKSxcbiAgICAgIHRpY2tzOiBmdWxsWWVhcnMsXG4gICAgICB0aWNrRm9ybWF0OiBcImRcIixcbiAgICAgIGxhYmVsQW5jaG9yOiBcImNlbnRlclwiLFxuICAgICAgbGFiZWxBcnJvdzogXCJub25lXCIsXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBsYWJlbDogc2VsZWN0b3IubGFiZWwsXG4gICAgICB0aWNrRm9ybWF0OiBzZWxlY3Rvci55Rm9ybWF0LFxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuYXhpc1koe1xuICAgICAgICBhbmNob3I6IFwicmlnaHRcIixcbiAgICAgICAgbGFiZWw6IHNlbGVjdG9yLmxhYmVsLFxuICAgICAgICB0aWNrRm9ybWF0OiBzZWxlY3Rvci55Rm9ybWF0LFxuICAgICAgICB0aWNrU2l6ZTogMCxcbiAgICAgICAgY29sb3I6IChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGQgPj0gMCA/IFwiYmxhY2tcIiA6IFwiI0VDNUE0N1wiO1xuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgICAvLyBob3Jpem9udGFsIHJlZmVyZW5jZSBsaW5lXG4gICAgICBQbG90LnJ1bGVZKFtydWxlWVZhbHVlXSwge1xuICAgICAgICBzdHJva2U6IFwiIzMzM1wiLFxuICAgICAgICBzdHJva2VEYXNoYXJyYXk6IFszXSxcbiAgICAgIH0pLFxuXG4gICAgICBQbG90LmFyZWFZKGJhbmREYXRhLCB7XG4gICAgICAgIHg6IFwieWVhclwiLFxuICAgICAgICB5MTogXCJsb3dcIixcbiAgICAgICAgeTI6IFwiaGlnaFwiLFxuICAgICAgICBmaWxsOiBcIiMyYzdmYjhcIixcbiAgICAgICAgZmlsbE9wYWNpdHk6IDAuMTYsXG4gICAgICB9KSxcblxuICAgICAgLy8gbGluZVxuICAgICAgUGxvdC5saW5lKGNvbXBsZXRlUGxvdERhdGEsIHtcbiAgICAgICAgeDogXCJ5ZWFyXCIsXG4gICAgICAgIHk6IHNlbGVjdG9yLmNvbHVtbk5hbWUsXG4gICAgICAgIHN0cm9rZTogXCIjNDQ0XCIsXG4gICAgICAgIHN0cm9rZU9wYWNpdHk6IDAuNyxcbiAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgIHRpcDogdHJ1ZSxcbiAgICAgIH0pLFxuXG4gICAgICAvLyBkb3RzXG4gICAgICBQbG90LmRvdChjb21wbGV0ZVBsb3REYXRhLCB7XG4gICAgICAgIHg6IFwieWVhclwiLFxuICAgICAgICB5OiBzZWxlY3Rvci5jb2x1bW5OYW1lLFxuICAgICAgICByOiAzLFxuICAgICAgICBmaWxsOiBcIiM0NDRcIixcbiAgICAgICAgc3Ryb2tlOiBcIiNmZmZcIixcbiAgICAgICAgc3Ryb2tlV2lkdGg6IDAuNSxcbiAgICAgICAgdGlwOiB7XG4gICAgICAgICAgZm9ybWF0OiB7XG4gICAgICAgICAgICB4OiB0cnVlLFxuICAgICAgICAgICAgeTogc2VsZWN0b3IueUZvcm1hdCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSksXG5cbiAgICAgIC8vIGhpZ2hsaWdodCBzZWxlY3RlZCB5ZWFyXG4gICAgICBQbG90LmRvdChcbiAgICAgICAgY29tcGxldGVQbG90RGF0YS5maWx0ZXIoKGQpID0+IGQueWVhciA9PT0gcHJvamVjdFllYXJDdXRvZmYpLFxuICAgICAgICB7XG4gICAgICAgICAgeDogXCJ5ZWFyXCIsXG4gICAgICAgICAgeTogc2VsZWN0b3IuY29sdW1uTmFtZSxcbiAgICAgICAgICByOiA3LFxuICAgICAgICAgIGZpbGw6IFwiI2ZmZlwiLFxuICAgICAgICAgIHN0cm9rZTogKGQpID0+IChkW3NlbGVjdG9yLmNvbHVtbk5hbWVdID49IDAgPyBcIiMzMzNcIiA6IFwiI0VDNUE0N1wiKSxcbiAgICAgICAgICBzdHJva2VXaWR0aDogMixcbiAgICAgICAgfSxcbiAgICAgICksXG4gICAgXSxcbiAgfSk7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFkbWluMF9uYW1lcyA9IHtcbiAgY29uc3QgaXNvU2V0ID0gbmV3IFNldChzZWxlY3RfY291bnRyeSk7XG4gIHJldHVybiBjb3VudHJpZXNcbiAgLmZpbHRlcigoZCkgPT4gaXNvU2V0LmhhcyhkLmlzbzNjKSlcbiAgLm1hcCgoZCkgPT4gZC5hZG1pbjBfbmFtZSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gTW9kdWxlIEltcG9ydHMgZm9yIHRoZSBjYWxjdWxhdGlvbiBvZiBST0kgZGF0YVxuaW1wb3J0IHtcbiAgYXZsb3NzQ2FsYyxcbiAgYXZsb3NzQ2FsY1VuY2VydGFpbnR5LFxuICBjYWxjTUlSUixcbiAgY2FsY0lSUixcbiAgbnB2RGlzY3JldGVDdW11bGF0aXZlLFxuICBydW5TaW11bGF0aW9uRnJvbUNhc2hmbG93Um93cyxcbn0gZnJvbSBcIi9ub3RlYm9va3Mvcm9pL3JvaV90b29scy5qc1wiO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im11dGFibGUgY3ZfcmVzdWx0ID0gW107XG5tdXRhYmxlIGN2X2NhY2hlX2tleSA9ICcnO1xuXG5jYWxjQ1YgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGNpc19pbXBhY3QgPSBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRDaXNJbXBhY3QudmFsdWU7XG5cbiAgY29uc3QgY2FjaGVfa2V5ID0gYCR7Wy4uLmFkbWluMF9uYW1lc10uc29ydCgpLmpvaW4oJywnKX18JHtbLi4uc2VsZWN0X2Nyb3BdLnNvcnQoKS5qb2luKCcsJyl9fCR7Y2lzX2ltcGFjdH1gO1xuXG4gIGlmIChjdl9jYWNoZV9rZXkgPT09IGNhY2hlX2tleSkge1xuICAgIGNvbnNvbGUubG9nKCdTa2lwcGVkIGN2IHJ1biBhcyBpbnB1dHMgdGhlIHNhbWUnKTtcbiAgICByZXR1cm4gY3ZfcmVzdWx0O1xuICB9XG5cbiAgY29uc29sZS5sb2coJ1J1bm5pbmcgdGhlIGN2IGFuYWx5c2lzIGFzIGlucHV0cyBjaGFuZ2VkJylcbiAgY29uc3QgY3ZfZGF0YSA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICBTRUxFQ1QgKlxuICAgIEZST00gY3ZcbiAgICBXSEVSRSBjcm9wIGluICgnJHtzZWxlY3RfY3JvcC5qb2luKFwiJywgJ1wiKX0nKVxuICAgIEFORCBhZG1pbjBfbmFtZSBpbiAoJyR7YWRtaW4wX25hbWVzLmpvaW4oXCInLCAnXCIpfScpIC0tIFRoaXMgbmVlZHMgdGhlIGEwX25hbWUgcmF0aGVyIHRoYW4gaXNvM1xuYCk7XG5cbiAgY29uc3QgY3ZfbW9udGVDYXJsbyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgIGN2X2RhdGEubWFwKGFzeW5jICh7IGNyb3AsIGFkbWluMF9uYW1lLCBjdiB9KSA9PiB7XG4gICAgICBjb25zdCBhdiA9IGF3YWl0IGF2bG9zc0NhbGMoY3YsIGNpc19pbXBhY3QpO1xuICAgICAgY29uc3QgYXZsb3NzID0gTWF0aC5hYnMoTnVtYmVyKGF2LnRvRml4ZWQ/Lig0KSA/PyBhdikpO1xuICAgICAgcmV0dXJuIHsgYWRtaW4wX25hbWUsIGNyb3AsIGN2LCBjaXNfaW1wYWN0LCBhdmxvc3MgfTtcbiAgICB9KSxcbiAgKTtcblxuICBjb25zdCBjdl9pbmRleCA9IG5ldyBNYXAoKTtcbiAgZm9yIChjb25zdCB7IGFkbWluMF9uYW1lLCBjcm9wLCBhdmxvc3MgfSBvZiBjdl9tb250ZUNhcmxvKSB7XG4gICAgY3ZfaW5kZXguc2V0KGAke2FkbWluMF9uYW1lfXwke2Nyb3B9YCwgYXZsb3NzKTtcbiAgfVxuXG4gIG11dGFibGUgY3ZfcmVzdWx0ID0gY3ZfaW5kZXhcbiAgbXV0YWJsZSBjdl9jYWNoZV9rZXkgPSBjYWNoZV9rZXlcbiAgcmV0dXJuIGN2X2luZGV4XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZ2V0RXhwb3N1cmVEYXRhID0gYXN5bmMgKGNyb3BzLCBjb3VudHJpZXMpID0+IHtcbi8vIE5PVEU6IE1ha2luZyB0aGlzIGEgZGF0YXNldCByYXRoZXIgdGhhbiBhIGZ1bmN0aW9uIHNvIGl0IG9ubHkgcmUtcnVucyB3aGVuIGNyb3Agb3IgY291bnRyeSBjaGFuZ2UuXG4vLyBEZWZhdWx0aW5nIHRvIGFsbCBhZG1pbiAxIGRhdGEgYXMgYWxsIGFkbWluIHJlZ2lvbnMgYXJlIHNlbGVjdGVkIGJ5IGRlZnVhbHQgYW5kIHRoaXNcbi8vIHdpbGwgcHJldmVudCBoYXZpbmcgdG8gaGF2ZSB1c2VycyByZS1xdWVyeSB0aGUgZGF0YXNldHMgd2hlbiBjaGFuZ2luZyByZWdpb25zIGluIGEgY291bnR5LlxuXG5leHBvc3VyZV9kYXRhID0ge1xuICBsZXQgY3JvcHMgPSBzZWxlY3RfY3JvcDtcbiAgbGV0IGNvdW50cmllcyA9IHNlbGVjdF9jb3VudHJ5O1xuICBsZXQgZGF0YSA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICBTRUxFQ1QgKlxuICAgIEZST00gZXhwb3N1cmVcbiAgICBXSEVSRSBjcm9wIGluICgnJHtjcm9wcy5qb2luKFwiJywgJ1wiKX0nKVxuICAgIEFORCBpc28zIGluICgnJHtjb3VudHJpZXMuam9pbihcIicsICdcIil9JylcbiAgICAtLSBQT1NTSUJMWSBhZGQgYWRtaW4xIG5hbWUgZmlsdGVyLCBidXQgZGVmYXVsdHMgdG8gZnVsbCBjb3VudHJ5LCBzbyBtYXliZSBiaWdnZXIgcXVlcnkgaXMgYmV0dGVyLlxuICBgKTtcbiAgcmV0dXJuIGRhdGE7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNyb3BfYWRvcHRpb24gPSBhc3luYyAoKSA9PiB7XG4gIC8vIEdsb2JhbHMgZnJvbSB0aGUgbm90ZWJvb2tcbiAgY29uc3QgYWRvcHRpb24gPSBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRBZG9wdGlvbi52YWx1ZTtcbiAgY29uc3QgeWVhcnMgPSBwcm9qZWN0WWVhcnM7XG4gIGNvbnN0IHByb2RfaW1wYWN0ID0gb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0UHJvZEltcGFjdC52YWx1ZTtcbiAgLy8gbGV0IGRhdGEgPSBhd2FpdCBnZXRFeHBvc3VyZURhdGEoc2VsZWN0X2Nyb3AsIHNlbGVjdF9jb3VudHJ5KTtcbiAgY29uc3QgZGF0YSA9IGV4cG9zdXJlX2RhdGE7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuXG4gIGZvciAoY29uc3Qgcm93IG9mIGRhdGEpIHtcbiAgICBjb25zdCB2YWx1ZSA9IHJvdy52YWx1ZSB8fCAwO1xuICAgIGxldCB4UHJldiA9IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSB5ZWFyczsgaSsrKSB7XG4gICAgICAvLyBjdW11bGF0aXZlIGFkb3B0aW9uXG4gICAgICBsZXQgeDtcbiAgICAgIGlmIChpID09PSAxKSB7XG4gICAgICAgIHggPSBNYXRoLnJvdW5kKHZhbHVlICogYWRvcHRpb24gKiAxMCkgLyAxMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHggPSBNYXRoLnJvdW5kKCh2YWx1ZSAtIHhQcmV2KSAqIGFkb3B0aW9uICogMTApIC8gMTAgKyB4UHJldjtcbiAgICAgIH1cblxuICAgICAgeFByZXYgPSB4O1xuXG4gICAgICAvLyBwdXNoIGEgbG9uZy1mb3JtIHJvd1xuICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICBhZG1pbjBfbmFtZTogcm93LmFkbWluMF9uYW1lLFxuICAgICAgICBhZG1pbjFfbmFtZTogcm93LmFkbWluMV9uYW1lLFxuICAgICAgICBpc28zYzogcm93LmlzbzMsXG4gICAgICAgIGNyb3A6IHJvdy5jcm9wLFxuICAgICAgICBleHBvc3VyZTogcm93LmV4cG9zdXJlLFxuICAgICAgICB2YWx1ZTogcm93LnZhbHVlLFxuICAgICAgICBhZG9wdGlvbjogYWRvcHRpb24sXG4gICAgICAgIHByb2RfaW1wYWN0OiBwcm9kX2ltcGFjdCxcbiAgICAgICAgeWVhcl9jaGFyOiBgeSR7aX1gLFxuICAgICAgICB5ZWFyOiBpLFxuICAgICAgICByZXN1bHQ6IHgsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzdWx0Lm1hcCgocm93KSA9PiB7XG4gICAgY29uc3QgcmVzdWx0X3dfaW1wYWN0ID1cbiAgICAgIE1hdGgucm91bmQocm93LnJlc3VsdCAqICgxICsgKHJvdy5wcm9kX2ltcGFjdCA/PyAwKSkgKiAxMCkgLyAxMDtcbiAgICBjb25zdCBtYXJnaW5hbF9pbXBhY3QgPVxuICAgICAgTWF0aC5yb3VuZCgocmVzdWx0X3dfaW1wYWN0IC0gcm93LnJlc3VsdCkgKiAxMCkgLyAxMDtcbiAgICByZXR1cm4geyAuLi5yb3csIHJlc3VsdF93X2ltcGFjdCwgbWFyZ2luYWxfaW1wYWN0IH07XG4gIH0pO1xufTtcblxuLy9OT1RFOiBRQVFDIFJFU1VMVFM6XG4vLyAxIHJlZ2lvbiAmIGNyb3A6IFBFUkZFQ1QgLSBUaGlzIG91dHB1dCBtYXRjaGVzIHRoZSBSIHNjcmlwdCBvdXRwdXQgZXhhY3RseVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJvaVJlc3VsdHMgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGluZGV4ID0gYXdhaXQgY2FsY0NWKCk7XG4gIGNvbnN0IGRhdGEgPSBhd2FpdCBjcm9wX2Fkb3B0aW9uKCk7XG5cbiAgY29uc3Qgd2l0aEltcGFjdCA9IGRhdGEubWFwKChyb3cpID0+IHtcbiAgICBjb25zdCBrZXkgPSBgJHtyb3cuYWRtaW4wX25hbWV9fCR7cm93LmNyb3B9YDtcbiAgICBjb25zdCBhdmxvc3MgPSBpbmRleC5nZXQoa2V5KSA/PyAwOyAvLyBkZWZhdWx0IHRvIDAgaWYgbWlzc2luZ1xuXG4gICAgY29uc3QgcmVzdWx0X3dfaW1wYWN0X2NpcyA9XG4gICAgICBNYXRoLnJvdW5kKHJvdy5yZXN1bHRfd19pbXBhY3QgKiAoMSArIGF2bG9zcykgKiAxMCkgLyAxMDtcbiAgICBjb25zdCBtYXJnaW5hbF9jaXMgPVxuICAgICAgTWF0aC5yb3VuZCgocmVzdWx0X3dfaW1wYWN0X2NpcyAtIHJvdy5yZXN1bHRfd19pbXBhY3QpICogMTApIC8gMTA7XG4gICAgY29uc3QgbWFyZ2luYWxfaW1wYWN0X2NpcyA9XG4gICAgICAobWFyZ2luYWxfY2lzIHx8IDApICsgKHJvdy5tYXJnaW5hbF9pbXBhY3QgfHwgMCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4ucm93LFxuICAgICAgYXZsb3NzLFxuICAgICAgcmVzdWx0X3dfaW1wYWN0X2NpcyxcbiAgICAgIG1hcmdpbmFsX2NpcyxcbiAgICAgIG1hcmdpbmFsX2ltcGFjdF9jaXMsXG4gICAgfTtcbiAgfSk7XG5cbiAgcmV0dXJuIHdpdGhJbXBhY3QubWFwKChkKSA9PiB7XG4gICAgY29uc3QgcHJvamVjdF9iZW5lZml0ID1cbiAgICAgIE1hdGgucm91bmQoKGQubWFyZ2luYWxfaW1wYWN0X2NpcyAtIGQubWFyZ2luYWxfaW1wYWN0X2NpcyAvIGJjcikgKiAxMCkgL1xuICAgICAgMTA7XG4gICAgY29uc3QgY2lzX2ltcGFjdCA9IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dENpc0ltcGFjdC52YWx1ZTtcbiAgICByZXR1cm4geyAuLi5kLCBiY3IsIGNpc19pbXBhY3QsIHByb2plY3RfYmVuZWZpdCB9O1xuICB9KTtcbn07XG5cbi8vTk9URTogUUFRQyBSRVNVTFRTOlxuLy8gMSByZWdpb24gJiBjcm9wOiBHb29kIC0gT3V0cHV0IGlzIGNsb3NlLCB0aGUgTUMgc2ltdWxhdGlvbiBnaXZlcyBkaWZmZXJlbnQgcmVzdWx0cywgYnV0IHRoZSBkaWZmZXJlbmNlIGlzIGZldyAkMTAwIGVhY2ggdGltZVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlZ2lvblNldCA9IG5ldyBTZXQoc2VsZWN0X3JlZ2lvbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVjaXBlX2RhdGFTdW1tZWQgPSBhc3luYyAoKSA9PiB7XG4gIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gXCJ3YWl0XCI7XG4gIGNvbnN0IHJvaV9kYXRhID0gYXdhaXQgcm9pUmVzdWx0cygpO1xuXG4gIC8vIEZpbHRlciBkb3duIG9uIHRoaXMgc3RlcCB0byB0aGUgc2VsZWN0ZWQgcmVnaW9uc1xuICBjb25zdCByb2lfZGF0YV9maWx0ZXJlZCA9IHJvaV9kYXRhLmZpbHRlcigoZCkgPT5cbiAgICByZWdpb25TZXQuaGFzKGAke2QuaXNvM2N9XyR7ZC5hZG1pbjFfbmFtZX1gKSxcbiAgKTtcblxuICBjb25zdCBhZ2dyZWdhdGVkID0gZDNcbiAgICAuZmxhdEdyb3VwKFxuICAgICAgcm9pX2RhdGFfZmlsdGVyZWQsXG4gICAgICAoZCkgPT4gZC5hZG9wdGlvbixcbiAgICAgIChkKSA9PiBkLnByb2RfaW1wYWN0LFxuICAgICAgKGQpID0+IGQuY2lzX2ltcGFjdCxcbiAgICAgIChkKSA9PiBkLmJjcixcbiAgICAgIChkKSA9PiBkLnllYXIsXG4gICAgKVxuICAgIC5tYXAoKFthZG9wdGlvbiwgcHJvZF9pbXBhY3QsIGNpc19pbXBhY3QsIGJjciwgeWVhciwgZ3JvdXBdKSA9PiAoe1xuICAgICAgYWRvcHRpb24sXG4gICAgICBwcm9kX2ltcGFjdCxcbiAgICAgIGNpc19pbXBhY3QsXG4gICAgICBiY3IsXG4gICAgICB5ZWFyLFxuICAgICAgcHJvamVjdF9iZW5lZml0OiBkMy5zdW0oZ3JvdXAsIChkKSA9PiBkLnByb2plY3RfYmVuZWZpdCksXG4gICAgfSkpO1xuXG4gIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gXCJkZWZhdWx0XCI7XG4gIHJldHVybiBhZ2dyZWdhdGVkO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZWNpcGVfcGF5bWVudFNjaGVkdWxlID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcHJvamVjdFllYXJzIH0pLm1hcCgoXywgaSkgPT4ge1xuICByZXR1cm4ge1xuICAgIHllYXI6IGksXG4gICAgY29zdDogKDEgLyBwcm9qZWN0WWVhcnMpICogcmFuZ2VQcm9qZWN0Q29zdCxcbiAgICBjb3N0X2N1bTogKChpICsgMSkgLyBwcm9qZWN0WWVhcnMpICogcmFuZ2VQcm9qZWN0Q29zdCxcbiAgfTtcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlY2lwZV9kYXRhQ2FzaGZsb3cgPSB7XG4gIGlmICghcmFuZ2VQcm9qZWN0Q29zdCB8fCByYW5nZVByb2plY3RDb3N0ID09PSAwKSByZXR1cm4gW107XG5cbiAgY29uc3QgcGF5QnlZZWFyID0gbmV3IE1hcChyZWNpcGVfcGF5bWVudFNjaGVkdWxlLm1hcCgoZCkgPT4gW2QueWVhciwgZF0pKTtcblxuICBjb25zdCBkYXRhID0gYXdhaXQgcmVjaXBlX2RhdGFTdW1tZWQoKTtcblxuICByZXR1cm4gZDNcbiAgICAuZmxhdEdyb3VwKFxuICAgICAgZGF0YSxcbiAgICAgIChkKSA9PiBkLmFkb3B0aW9uLFxuICAgICAgKGQpID0+IGQucHJvZF9pbXBhY3QsXG4gICAgICAoZCkgPT4gZC5jaXNfaW1wYWN0LFxuICAgICAgKGQpID0+IGQuYmNyLFxuICAgIClcbiAgICAuZmxhdE1hcCgoW2Fkb3B0aW9uLCBwcm9kX2ltcGFjdCwgY2lzX2ltcGFjdCwgYmNyLCByb3dzXSkgPT4ge1xuICAgICAgY29uc3QgYWxsUm93cyA9IFtcbiAgICAgICAgLi4ucm93cyxcbiAgICAgICAgeyBhZG9wdGlvbiwgcHJvZF9pbXBhY3QsIGNpc19pbXBhY3QsIGJjciwgeWVhcjogMCwgcHJvamVjdF9iZW5lZml0OiAwIH0sXG4gICAgICBdLnNvcnQoKGEsIGIpID0+IGEueWVhciAtIGIueWVhcik7XG5cbiAgICAgIHJldHVybiBhbGxSb3dzLm1hcCgocikgPT4ge1xuICAgICAgICBjb25zdCBwYXkgPSBwYXlCeVllYXIuZ2V0KHIueWVhcikgfHwge307XG4gICAgICAgIGNvbnN0IGNvc3QgPSBwYXkuY29zdCA/PyAwO1xuICAgICAgICBjb25zdCBjb3N0X2N1bSA9IHBheS5jb3N0X2N1bSA/PyByYW5nZVByb2plY3RDb3N0O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnIsXG4gICAgICAgICAgY29zdCxcbiAgICAgICAgICBjb3N0X2N1bSxcbiAgICAgICAgICBjYXNoZmxvdzogKHIucHJvamVjdF9iZW5lZml0ID8/IDApIC0gY29zdCxcbiAgICAgICAgICBkaXNjb3VudF9yYXRlOiBkaXNjb3VudFJhdGUsXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9KTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoid2Fsa3Rocm91Z2hFY29ub21pY0luZGljYXRvcnMgPSB7XG4gIGNvbnN0IHNlbGVjdGlvbiA9IHdhbGt0aHJvdWdoU2VsZWN0aW9ucztcblxuICBjb25zdCBkYXRhID0gcmVjaXBlX2RhdGFDYXNoZmxvd1xuXG4gIGNvbnN0IHllYXJzID0gZGF0YS5tYXAoZCA9PiBkLnllYXIpO1xuICBjb25zdCBiZW5lZml0ID0gZGF0YS5tYXAoZCA9PiBkLnByb2plY3RfYmVuZWZpdCk7XG4gIGNvbnN0IGNvc3QgPSBkYXRhLm1hcChkID0+IGQuY29zdCk7XG4gIGNvbnN0IGNhc2hmbG93ID0gYmVuZWZpdC5tYXAoKGIsIGkpID0+IGIgLSBjb3N0W2ldKTtcbiAgY29uc3QgZGlzY291bnRSYXRlID0gc2VsZWN0aW9uLmRpc2NvdW50X3JhdGU7XG5cbiAgY29uc3QgbnB2ID0gbnB2RGlzY3JldGVDdW11bGF0aXZlKGNhc2hmbG93LCBkaXNjb3VudFJhdGUpO1xuICBjb25zdCBucHZfYmVuZWZpdCA9IG5wdkRpc2NyZXRlQ3VtdWxhdGl2ZShiZW5lZml0LCBkaXNjb3VudFJhdGUpO1xuICBjb25zdCBucHZfY29zdCA9IG5wdkRpc2NyZXRlQ3VtdWxhdGl2ZShjb3N0LCBkaXNjb3VudFJhdGUpO1xuICBjb25zdCBkaXNjb3VudGVkX2JjciA9IG5wdl9iZW5lZml0Lm1hcCgoYiwgaSkgPT4gbnB2X2Nvc3RbaV0gPT09IDAgPyBudWxsIDogYiAvIG5wdl9jb3N0W2ldKTtcblxuICBjb25zdCBwcm9qX2lyciA9IGNhbGNJUlIoY2FzaGZsb3cpO1xuICBjb25zdCBwcm9qX21pcnIgPSBjYWxjTUlSUihjYXNoZmxvdywgZGlzY291bnRSYXRlLCBkaXNjb3VudFJhdGUpO1xuICBjb25zdCBwcm9qX25wdiA9IG5wdi5hdCgtMSk7XG4gIGNvbnN0IHByb2pfYmNyID0gZGlzY291bnRlZF9iY3IuYXQoLTEpO1xuXG4gIC8vID09PSBFbnJpY2hlZCB0YWJsZVxuICBjb25zdCBlbnJpY2hlZERhdGEgPSB5ZWFycy5tYXAoKHllYXIsIGkpID0+IHtcbiAgICBjb25zdCBjYXNoZmxvd1RvRGF0ZSA9IGNhc2hmbG93LnNsaWNlKDAsIGkgKyAxKTtcbiAgICByZXR1cm4ge1xuICAgICAgeWVhcixcbiAgICAgIHByb2plY3RfYmVuZWZpdDogYmVuZWZpdFtpXSxcbiAgICAgIGNvc3Q6IGNvc3RbaV0sXG4gICAgICBjYXNoZmxvdzogY2FzaGZsb3dbaV0sXG4gICAgICBkaXNjb3VudGVkX2JlbmVmaXRfY3VtOiBucHZfYmVuZWZpdFtpXSxcbiAgICAgIGRpc2NvdW50ZWRfY29zdF9jdW06IG5wdl9jb3N0W2ldLFxuICAgICAgZGlzY291bnRlZF9iY3I6IGRpc2NvdW50ZWRfYmNyW2ldLFxuICAgICAgaXJyOiBjYWxjSVJSKGNhc2hmbG93VG9EYXRlKSoxMDAsXG4gICAgICBtaXJyOiBjYWxjTUlSUihjYXNoZmxvd1RvRGF0ZSwgZGlzY291bnRSYXRlLCBkaXNjb3VudFJhdGUpKjEwMCxcbiAgICAgIG5wdjogbnB2W2ldXG4gICAgfTtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBzdW1tYXJ5OiB7XG4gICAgICBwcm9qX25wdixcbiAgICAgIHByb2pfaXJyLFxuICAgICAgcHJval9taXJyLFxuICAgICAgcHJval9iY3JcbiAgICB9LFxuICAgIGVucmljaGVkOiBlbnJpY2hlZERhdGFcbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ3YWxrdGhyb3VnaFNlbGVjdGlvbnMgPSB7XG4gIHJldHVybiB7XG4gICAgY291bnRyaWVzOiBzZWxlY3RfY291bnRyeSxcbiAgICByZWdpb25zOiBzZWxlY3RfcmVnaW9uLFxuICAgIGNyb3BzOiBzZWxlY3RfY3JvcCxcbiAgICBwcm9qZWN0X3llYXJzOiBwcm9qZWN0WWVhcnMsXG4gICAgcHJvamVjdF9jb3N0OiByYW5nZVByb2plY3RDb3N0LFxuICAgIHByb2RfaW1wYWN0OiBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRQcm9kSW1wYWN0LnZhbHVlLFxuICAgIGFkb3B0aW9uOiBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRBZG9wdGlvbi52YWx1ZSxcbiAgICBjaXNfaW1wYWN0OiBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRDaXNJbXBhY3QudmFsdWUsXG4gICAgZGlzY291bnRfcmF0ZTogZGlzY291bnRSYXRlLFxuICAgIGJjcjogYmNyLFxuICAgIC8vIHRpbWVfaG9yaXpvbjogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0VGltZS52YWx1ZSxcbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncHJvZHVjdGlvblZpZXcnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRQcm9qZWN0T3B0aW9ucycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3Rpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2gnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0X2NvdW50cnknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0X3JlZ2lvbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RfY3JvcCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdkaXNjb3VudFJhdGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYmNyJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3VuY2VydGFpbnR5QmVuZWZpdFNjYWxlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3VuY2VydGFpbnR5Q29zdFNjYWxlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3BpY2tNZXRyaWNXYWxrdGhyb3VnaCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdtYXN0ZXJMYW5ndWFnZScpIn1dfQ==</script><script type="module">"file:"===window.location.protocol&&alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."),window._ojs.paths.runtimeToDoc="../../notebooks/roi",window._ojs.paths.runtimeToRoot="../..",window._ojs.paths.docToRoot="../..",window._ojs.selfContained=!1,window._ojs.runtime.interpretFromScriptTags()</script><script id="quarto-html-after-body" type="application/javascript">window.document.addEventListener("DOMContentLoaded",function(t){const e=t=>{for(const e of t.classList)if(e.startsWith("code-annotation-"))return!0;return!1},n=function(t){const e=t.trigger;e.blur(),e.classList.add("code-copy-button-checked");var n=e.getAttribute("title");let o;e.setAttribute("title","Copied!"),window.bootstrap&&(e.setAttribute("data-bs-toggle","tooltip"),e.setAttribute("data-bs-placement","left"),e.setAttribute("data-bs-title","Copied!"),o=new bootstrap.Tooltip(e,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),o.show()),setTimeout(function(){o&&(o.hide(),e.removeAttribute("data-bs-title"),e.removeAttribute("data-bs-toggle"),e.removeAttribute("data-bs-placement")),e.setAttribute("title",n),e.classList.remove("code-copy-button-checked")},1e3),t.clearSelection()},o=function(t){const n=t.parentElement.cloneNode(!0).querySelector("code");for(const t of n.children)e(t)&&t.remove();return n.innerText};if(new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:o}).on("success",n),window.document.getElementById("quarto-embedded-source-code-modal")){new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:o,container:window.document.getElementById("quarto-embedded-source-code-modal")}).on("success",n)}for(var i=new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//),a=new RegExp(/^mailto:/),l=new RegExp("https://adaptationatlas.github.io/atlas_notebooks/"),r=t=>l.test(t)||i.test(t)||a.test(t),d=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),c=0;c<d.length;c++){const t=d[c];r(t.href)||void 0!==t.dataset.originalHref&&(t.href=t.dataset.originalHref)}function s(t,e,n,o){const i={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(t){return t.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};e&&(i.content=e),n&&(i.onTrigger=n),o&&(i.onUntrigger=o),window.tippy(t,i)}const u=window.document.querySelectorAll('a[role="doc-noteref"]');for(c=0;c<u.length;c++){const t=u[c];s(t,function(){let e=t.getAttribute("data-footnote-href")||t.getAttribute("href");try{e=new URL(e).hash}catch{}const n=e.replace(/^#\/?/,""),o=window.document.getElementById(n);return o?o.innerHTML:""})}const h=window.document.querySelectorAll("a.quarto-xref"),m=(t,e)=>{const n=t=>{if(t.classList.remove("page-full","page-columns"),t.children)for(const e of t.children)n(e)};if(n(e),null===t||t.startsWith("sec-")){const t=document.createElement("div");if(e.children&&e.children.length>2){t.appendChild(e.children[0].cloneNode(!0));for(let n=1;n<e.children.length;n++){const o=e.children[n];if("P"!==o.tagName||""!==o.innerText){t.appendChild(o.cloneNode(!0));break}}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}{const t=e.querySelector("a.anchorjs-link");return t&&t.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.classList.contains("callout")?e.outerHTML:e.innerHTML}};for(c=0;c<h.length;c++){const t=h[c];s(t,void 0,function(e){e.disable();let n,o=t.getAttribute("href");if(o.startsWith("#"))n=o;else try{n=new URL(o).hash}catch{}if(n){const t=n.replace(/^#\/?/,""),i=window.document.getElementById(t);if(null!==i)try{const n=m(t,i.cloneNode(!0));e.setContent(n)}finally{e.enable(),e.show()}else fetch(o.split("#")[0]).then(t=>t.text()).then(n=>{const o=(new DOMParser).parseFromString(n,"text/html").getElementById(t);if(null!==o){const n=m(t,o);e.setContent(n)}}).finally(()=>{e.enable(),e.show()})}else fetch(o).then(t=>t.text()).then(t=>{const n=(new DOMParser).parseFromString(t,"text/html").querySelector("main.content");if(null!==n){n.children.length>0&&"HEADER"===n.children[0].tagName&&n.children[0].remove();const t=m(null,n);e.setContent(t)}}).finally(()=>{e.enable(),e.show()})},function(t){})}let w;const g=t=>{window.document;const e=t.getAttribute("data-target-cell"),n=t.getAttribute("data-target-annotation");const o=window.document.querySelector('span[data-code-cell="'+e+'"][data-code-annotation="'+n+'"]').getAttribute("data-code-lines").split(",").map(t=>e+"-"+t);let i=null,a=null,l=null;if(o.length>0){const n=window.document.getElementById(o[0]);if(i=n.offsetTop,a=n.offsetHeight,l=n.parentElement.parentElement,o.length>1){const t=window.document.getElementById(o[o.length-1]);a=t.offsetTop+t.offsetHeight-i}if(null!==i&&null!==a&&null!==l){let t=window.document.getElementById("code-annotation-line-highlight");null===t&&(t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight"),t.style.position="absolute",l.appendChild(t)),t.style.top=i-2+"px",t.style.height=a+4+"px",t.style.left=0;let n=window.document.getElementById("code-annotation-line-highlight-gutter");if(null===n){n=window.document.createElement("div"),n.setAttribute("id","code-annotation-line-highlight-gutter"),n.style.position="absolute";window.document.getElementById(e).querySelector(".code-annotation-gutter").appendChild(n)}n.style.top=i-2+"px",n.style.height=a+4+"px"}w=t}},p=()=>{["code-annotation-line-highlight","code-annotation-line-highlight-gutter"].forEach(t=>{const e=window.document.getElementById(t);e&&e.remove()}),w=void 0};window.addEventListener("resize",function(t,e){let n,o=!1;return(...i)=>{o?(n&&clearTimeout(n),n=setTimeout(()=>{t.apply(this,i),n=o=!1},e)):(t.apply(this,i),o=!0)}}(()=>{elRect=void 0,w&&g(w)},10));const f=window.document.querySelectorAll("dt[data-target-cell]");for(const t of f)t.addEventListener("click",t=>{const e=t.target;if(e!==w){p();const t=window.document.querySelector("dt[data-target-cell].code-annotation-active");t&&t.classList.remove("code-annotation-active"),g(e),e.classList.add("code-annotation-active")}else p(),e.classList.remove("code-annotation-active")});const b=t=>{const e=t.parentElement;if(e){const n=e.dataset.cites;return n?{el:t,cites:n.split(" ")}:b(t.parentElement)}};var y=window.document.querySelectorAll('a[role="doc-biblioref"]');for(c=0;c<y.length;c++){const t=y[c],e=b(t);e&&s(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry");var o=window.document.getElementById("ref-"+e);o&&(n.innerHTML=o.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div></body></html>