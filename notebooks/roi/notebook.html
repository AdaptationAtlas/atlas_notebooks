<!doctype html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta charset="utf-8"><meta name="generator" content="quarto-1.8.27"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"><title>Econimic Returns on Investment</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}</style><script src="../../site_libs/quarto-nav/quarto-nav.js"></script><script src="../../site_libs/quarto-nav/headroom.min.js"></script><link href="../../images/atlas-icon.svg" rel="icon" type="image/svg+xml"><script src="../../site_libs/clipboard/clipboard.min.js"></script><script src="../../site_libs/quarto-html/quarto.js" type="module"></script><script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script><script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script><script src="../../site_libs/quarto-html/popper.min.js"></script><script src="../../site_libs/quarto-html/tippy.umd.min.js"></script><link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-4d9afe2b8d18ee9fa5d0d57b5ed4214d.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles"><script src="../../site_libs/bootstrap/bootstrap.min.js"></script><link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet"><link href="../../site_libs/bootstrap/bootstrap-3af0fd849a04f5f60e5c40811251b476.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light"><link href="../../site_libs/bootstrap/bootstrap-dark-3af0fd849a04f5f60e5c40811251b476.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light"><link href="../../site_libs/bootstrap/bootstrap-3af0fd849a04f5f60e5c40811251b476.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet"><script src="../../components/backToTop.js"></script><link rel="stylesheet" href="../../styles/main.css"></head><body class="nav-fixed fullcontent quarto-light"><div id="quarto-search-results"></div><header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme="dark"><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a href="https://adaptationatlas.cgiar.org" class="navbar-brand navbar-brand-logo"><img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo light-content"> <img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo dark-content"></a></div><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="window.quartoToggleHeadroom&&window.quartoToggleHeadroom()"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item"><a class="nav-link" href="../../docs/doc_index.html"><i class="bi bi-info-circle" role="img" aria-label="More Information"></i> <span class="menu-text">Documentation</span></a></li><li class="nav-item"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks/issues/new"><span class="menu-text">Report an Issue</span></a></li><li class="nav-item compact"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks"><i class="bi bi-github" role="img" aria-label="GitHub"></i> <span class="menu-text"></span></a></li></ul></div><div class="quarto-navbar-tools"></div></div></nav></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header><back-to-top></back-to-top><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="17" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 16"><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  dropdown_section<span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  downloadButton<span class="op">,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  makeTooltipLabel<span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/helpers/uiComponents.ojs"</span><span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { atlasTOC } <span class="im">from</span> <span class="st">"/helpers/toc.ojs"</span><span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { atlasCitation<span class="op">,</span> atlasContributionSection } <span class="im">from</span> <span class="st">"/helpers/citation.js"</span><span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { formatUSD<span class="op">,</span> inputTemplate } <span class="im">from</span> <span class="st">"/helpers/std.ojs"</span><span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { heroImage <span class="im">as</span> atlasHero } <span class="im">from</span> <span class="st">"/helpers/hero.js"</span><span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  filterableDataTable <span class="im">as</span> atlasTable<span class="op">,</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  sparkbar<span class="op">,</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/helpers/atlasTable.ojs"</span><span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { renderMarkdownWithSlots } <span class="im">from</span> <span class="st">"/helpers/mdTranslate.ojs"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-6" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-7" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="40" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 39"><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span><span class="sc">${</span><span class="fu">atlasHero</span>(nbTitle<span class="op">,</span> <span class="st">"./../../images/notebooks/roi.webp"</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="42" data-source-offset="-67"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 41"><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="fu">atlasTOC</span>({</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">skip</span><span class="op">:</span> [<span class="st">"notebook-title"</span><span class="op">,</span> <span class="st">"appendix"</span><span class="op">,</span> <span class="st">"source-code"</span>]<span class="op">,</span> <span class="co">// These should be the section headings in the {# headings}</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="dt">heading</span><span class="op">:</span> <span class="vs">`&lt;b&gt;</span><span class="sc">${</span>Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(<span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">toc</span>))<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">,</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-2" data-nodetype="expression"></div></div></div></div><section id="overview" class="level1"><h1><span><span id="ojs-element-id-1"></span></span></h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="53" data-source-offset="-29"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 52"><span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="55" data-source-offset="-75"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 54"><span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block2</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-2" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="57" data-source-offset="-121"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 56"><span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="fu">dropdown_section</span>(</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Definitions"</span><span class="op">,</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">false</span><span class="op">,</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">overview</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-3" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="69" data-source-offset="-365"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 68"><span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block3</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-4" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="71" data-source-offset="-411"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 70"><span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block4</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-3-5" data-nodetype="expression"></div></div></div></div></section><section id="project-setup" class="level1"><h1><span><span id="ojs-element-id-2"></span></span></h1><p><span><span id="ojs-element-id-3"></span></span></p><p><span><span id="ojs-element-id-4"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="81" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 80"><span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div style="display: flex; gap: 3em; margin-bottom: 1.5em;"&gt;</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_country<span class="sc">}</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_region<span class="sc">}</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>viewof select_crop<span class="sc">}</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-4-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="89" data-source-offset="-166"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 88"><span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>viewof productionView <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"plot"</span><span class="op">,</span> <span class="st">"table"</span>]<span class="op">,</span> {</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">"table"</span><span class="op">,</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">vizType</span><span class="op">.</span><span class="at">title</span>)<span class="op">,</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">vizType</span><span class="op">?.</span>[d])<span class="op">,</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-4-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="97" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 96"><span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (productionView <span class="op">==</span> <span class="st">"table"</span>) {</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a0_clean <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">country</span>)<span class="op">;</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a1_clean <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">region</span>)<span class="op">;</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> commodity_clean <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">commodity</span>)<span class="op">;</span></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxVal <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(exposure_data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">atlasTable</span>(exposure_data<span class="op">,</span> {</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columns</span><span class="op">:</span> [<span class="st">"admin0_name"</span><span class="op">,</span> <span class="st">"admin1_name"</span><span class="op">,</span> <span class="st">"crop"</span><span class="op">,</span> <span class="st">"value"</span>]<span class="op">,</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>      <span class="dt">header</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">"USD"</span><span class="op">,</span> <span class="dt">crop</span><span class="op">:</span> commodity_clean<span class="op">,</span> <span class="dt">admin0_name</span><span class="op">:</span> a0_clean<span class="op">,</span> <span class="dt">admin1_name</span><span class="op">:</span> a1_clean}<span class="op">,</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sort</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>      <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">sparkbar</span>({</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>          <span class="dt">max</span><span class="op">:</span> maxVal<span class="op">,</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>          <span class="dt">align</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>          <span class="dt">background</span><span class="op">:</span> <span class="st">"#D9ECD9"</span><span class="op">,</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>          <span class="dt">color</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>          <span class="dt">formatter</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>()(d)<span class="op">,</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">renderProductionBars</span>()</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-5-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="123" data-source-offset="-792"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 122"><span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>renderProductionBars <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> exposure_data</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>    regionSet<span class="op">.</span><span class="fu">has</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">iso3</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totals <span class="op">=</span> d3<span class="op">.</span><span class="fu">rollup</span>(</span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>    data<span class="op">,</span></span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>    v <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">sum</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span><span class="op">,</span></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">crop</span></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> flatTotals <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(totals<span class="op">,</span> ([admin0_name<span class="op">,</span> crops]) <span class="kw">=&gt;</span></span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(crops<span class="op">,</span> ([crop<span class="op">,</span> value]) <span class="kw">=&gt;</span> ({ admin0_name<span class="op">,</span> crop<span class="op">,</span> value }))</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>  )<span class="op">.</span><span class="fu">flat</span>()<span class="op">;</span></span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _title <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>    <span class="dt">en</span><span class="op">:</span> <span class="st">"Total VoP for selected regions and crops in each country"</span><span class="op">,</span></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fr</span><span class="op">:</span> <span class="st">"Total VoP pour les régions et les cultures sélectionnées dans chaque pays"</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>    <span class="dt">subtitle</span><span class="op">:</span> _title<span class="op">,</span></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">tickFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">`</span> }<span class="op">,</span></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">tickFormat</span><span class="op">:</span>(d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>()(d) }<span class="op">,</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>({<span class="dt">en</span><span class="op">:</span> <span class="st">"Commodity"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Culture"</span>})<span class="op">,</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barY</span>(flatTotals<span class="op">,</span> {</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-5-2" data-nodetype="declaration"></div></div></div></div><section id="langnbtext.projectsetup.blocks.costs.h2" class="level2"><h2 data-anchor-id="langnbtext.projectsetup.blocks.costs.h2"><span><span id="ojs-element-id-5"></span></span></h2><p><span><span id="ojs-element-id-6"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="172" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 171"><span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>viewof inputProjectOptions <span class="op">=</span> {</span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProjectCost <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">text</span>({</span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pattern</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">pattern</span><span class="op">,</span></span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">placeholder</span><span class="op">,</span></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> inputOptions_projectCost<span class="op">.</span><span class="at">valueString</span></span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProjectYears <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(inputOptions_projectYears<span class="op">.</span><span class="at">data</span><span class="op">,</span> {</span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> inputOptions_projectYears<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="dv">8</span>)</span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cost</span><span class="op">:</span> inputProjectCost<span class="op">,</span></span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a>      <span class="dt">years</span><span class="op">:</span>inputProjectYears</span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-6" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="204" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 203"><span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">calloutTemplate</span>)</span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> templateItems <span class="op">=</span> [</span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"money"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatUSD</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(rangeProjectCost)}<span class="op">,</span></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> inputProjectOptions<span class="op">.</span><span class="at">years</span><span class="op">.</span><span class="at">label</span>}<span class="op">,</span></span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> templateItems)</span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>formatted<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-7" data-nodetype="expression"></div></div></div></section><section id="langnbtext.projectsetup.blocks.impacts.h2" class="level2"><h2 data-anchor-id="langnbtext.projectsetup.blocks.impacts.h2"><span><span id="ojs-element-id-7"></span></span></h2><p><span><span id="ojs-element-id-8"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="221" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 220"><span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a>viewof selections_econPerfWalkthrough <span class="op">=</span> {</span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_prodImpact <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_Adoption <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _label_CisImpact <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProdImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">55</span>]<span class="op">,</span></span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_prodImpact<span class="op">,</span></span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">30</span></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputAdoption <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.25</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="fl">0.25</span><span class="op">,</span></span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_Adoption<span class="op">,</span></span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputCisImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">55</span>]<span class="op">,</span></span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a>      <span class="dt">step</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span> <span class="op">:</span> _label_CisImpact<span class="op">,</span></span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">25</span></span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a>      inputProdImpact<span class="op">,</span></span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a>      inputAdoption<span class="op">,</span></span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a>      inputCisImpact</span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a>options_econPerfWalkthrough <span class="op">=</span> {</span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> [key<span class="op">,</span> value] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(selections_econPerfWalkthrough)) {</span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a>    formatted[key] <span class="op">=</span> {</span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>value<span class="sc">}</span><span class="vs">%`</span><span class="op">,</span></span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> value <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> formatted<span class="op">;</span></span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-8-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-8-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="301" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 300"><span id="cb16-301"><a href="#cb16-301" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-302"><a href="#cb16-302" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> advancedControlsText <span class="op">=</span> nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">advancedControls</span><span class="op">;</span></span>
<span id="cb16-303"><a href="#cb16-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-304"><a href="#cb16-304" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _benefitLowLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-305"><a href="#cb16-305" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleLow</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-306"><a href="#cb16-306" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleLow</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-307"><a href="#cb16-307" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-308"><a href="#cb16-308" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _benefitHighLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-309"><a href="#cb16-309" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleHigh</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-310"><a href="#cb16-310" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">benefitScaleHigh</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-311"><a href="#cb16-311" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-312"><a href="#cb16-312" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _costLowLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-313"><a href="#cb16-313" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleLow</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-314"><a href="#cb16-314" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleLow</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-315"><a href="#cb16-315" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-316"><a href="#cb16-316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _costHighLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-317"><a href="#cb16-317" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleHigh</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-318"><a href="#cb16-318" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costScaleHigh</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-319"><a href="#cb16-319" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-320"><a href="#cb16-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-321"><a href="#cb16-321" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formBenefitScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb16-322"><a href="#cb16-322" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-323"><a href="#cb16-323" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb16-324"><a href="#cb16-324" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-325"><a href="#cb16-325" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _benefitLowLabel<span class="op">,</span></span>
<span id="cb16-326"><a href="#cb16-326" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.85</span><span class="op">,</span></span>
<span id="cb16-327"><a href="#cb16-327" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-328"><a href="#cb16-328" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.6</span>]<span class="op">,</span> {</span>
<span id="cb16-329"><a href="#cb16-329" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-330"><a href="#cb16-330" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _benefitHighLabel<span class="op">,</span></span>
<span id="cb16-331"><a href="#cb16-331" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.15</span><span class="op">,</span></span>
<span id="cb16-332"><a href="#cb16-332" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-333"><a href="#cb16-333" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-334"><a href="#cb16-334" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-335"><a href="#cb16-335" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb16-336"><a href="#cb16-336" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-337"><a href="#cb16-337" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb16-338"><a href="#cb16-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-339"><a href="#cb16-339" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formCostScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb16-340"><a href="#cb16-340" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-341"><a href="#cb16-341" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb16-342"><a href="#cb16-342" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-343"><a href="#cb16-343" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _costLowLabel<span class="op">,</span></span>
<span id="cb16-344"><a href="#cb16-344" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.9</span><span class="op">,</span></span>
<span id="cb16-345"><a href="#cb16-345" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-346"><a href="#cb16-346" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.8</span>]<span class="op">,</span> {</span>
<span id="cb16-347"><a href="#cb16-347" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb16-348"><a href="#cb16-348" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> _costHighLabel<span class="op">,</span></span>
<span id="cb16-349"><a href="#cb16-349" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.2</span><span class="op">,</span></span>
<span id="cb16-350"><a href="#cb16-350" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb16-351"><a href="#cb16-351" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-352"><a href="#cb16-352" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-353"><a href="#cb16-353" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb16-354"><a href="#cb16-354" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-355"><a href="#cb16-355" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb16-356"><a href="#cb16-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-357"><a href="#cb16-357" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _discountLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-358"><a href="#cb16-358" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">discountRate</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-359"><a href="#cb16-359" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">discountRate</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-360"><a href="#cb16-360" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-361"><a href="#cb16-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-362"><a href="#cb16-362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _roiLabel <span class="op">=</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb16-363"><a href="#cb16-363" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">roi</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb16-364"><a href="#cb16-364" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">roi</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb16-365"><a href="#cb16-365" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-366"><a href="#cb16-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-367"><a href="#cb16-367" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formFinancialControls <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb16-368"><a href="#cb16-368" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-369"><a href="#cb16-369" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discountRate</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb16-370"><a href="#cb16-370" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb16-371"><a href="#cb16-371" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb16-372"><a href="#cb16-372" aria-hidden="true" tabindex="-1"></a>          {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> (x <span class="op">*</span> <span class="dv">100</span>)<span class="op">,</span> <span class="dt">label</span> <span class="op">:</span> _discountLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.12</span>}</span>
<span id="cb16-373"><a href="#cb16-373" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb16-374"><a href="#cb16-374" aria-hidden="true" tabindex="-1"></a>        viewof discountRate</span>
<span id="cb16-375"><a href="#cb16-375" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb16-376"><a href="#cb16-376" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bcr</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb16-377"><a href="#cb16-377" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb16-378"><a href="#cb16-378" aria-hidden="true" tabindex="-1"></a>          [<span class="fl">0.5</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb16-379"><a href="#cb16-379" aria-hidden="true" tabindex="-1"></a>          {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> _roiLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.62</span>}</span>
<span id="cb16-380"><a href="#cb16-380" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb16-381"><a href="#cb16-381" aria-hidden="true" tabindex="-1"></a>        viewof bcr</span>
<span id="cb16-382"><a href="#cb16-382" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-383"><a href="#cb16-383" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb16-384"><a href="#cb16-384" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-385"><a href="#cb16-385" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb16-386"><a href="#cb16-386" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-387"><a href="#cb16-387" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb16-388"><a href="#cb16-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-389"><a href="#cb16-389" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">dropdown_section</span>(</span>
<span id="cb16-390"><a href="#cb16-390" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">advancedControls</span>)<span class="op">,</span></span>
<span id="cb16-391"><a href="#cb16-391" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span><span class="op">,</span></span>
<span id="cb16-392"><a href="#cb16-392" aria-hidden="true" tabindex="-1"></a>    formFinancialControls<span class="op">,</span></span>
<span id="cb16-393"><a href="#cb16-393" aria-hidden="true" tabindex="-1"></a>    <span class="vs">`&lt;b&gt;</span><span class="sc">${</span><span class="fu">_lang</span>(advancedControlsText<span class="op">.</span><span class="at">modelUncertainty</span>)<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">,</span></span>
<span id="cb16-394"><a href="#cb16-394" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(formBenefitScale<span class="op">,</span> viewof uncertaintyBenefitScale)<span class="op">,</span></span>
<span id="cb16-395"><a href="#cb16-395" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(formCostScale<span class="op">,</span> viewof uncertaintyCostScale)</span>
<span id="cb16-396"><a href="#cb16-396" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-397"><a href="#cb16-397" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-9" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="401" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 400"><span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a>uncertainty <span class="op">=</span> <span class="fu">runSimulationFromCashflowRows</span>(recipe_dataCashflow<span class="op">,</span> {</span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a>  <span class="dt">simulations</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span></span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a>  <span class="dt">discountRate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a>  <span class="dt">benefitScale</span><span class="op">:</span> {</span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a>    <span class="dt">low</span><span class="op">:</span> uncertaintyBenefitScale<span class="op">.</span><span class="at">low</span><span class="op">,</span></span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mode</span><span class="op">:</span> <span class="fl">1.0</span><span class="op">,</span></span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a>    <span class="dt">high</span><span class="op">:</span> uncertaintyBenefitScale<span class="op">.</span><span class="at">high</span><span class="op">,</span></span>
<span id="cb17-408"><a href="#cb17-408" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb17-409"><a href="#cb17-409" aria-hidden="true" tabindex="-1"></a>  <span class="dt">costScale</span><span class="op">:</span> {</span>
<span id="cb17-410"><a href="#cb17-410" aria-hidden="true" tabindex="-1"></a>    <span class="dt">low</span><span class="op">:</span> uncertaintyCostScale<span class="op">.</span><span class="at">low</span><span class="op">,</span></span>
<span id="cb17-411"><a href="#cb17-411" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mode</span><span class="op">:</span> <span class="fl">1.0</span><span class="op">,</span></span>
<span id="cb17-412"><a href="#cb17-412" aria-hidden="true" tabindex="-1"></a>    <span class="dt">high</span><span class="op">:</span> uncertaintyCostScale<span class="op">.</span><span class="at">high</span><span class="op">,</span></span>
<span id="cb17-413"><a href="#cb17-413" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb17-414"><a href="#cb17-414" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-10" data-nodetype="declaration"></div></div></div></section></section><section id="investment-returns" class="level1"><h1><span><span id="ojs-element-id-9"></span></span></h1><p><span><span id="ojs-element-id-10"></span></span></p><p><span><span id="ojs-element-id-11"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="424" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 423"><span id="cb18-424"><a href="#cb18-424" aria-hidden="true" tabindex="-1"></a><span class="fu">bigNumbersResults</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-11" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="429" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 428"><span id="cb19-429"><a href="#cb19-429" aria-hidden="true" tabindex="-1"></a><span class="fu">resultTable</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-12-1" data-nodetype="expression"></div></div></div><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="430" data-source-offset="-15"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 429"><span id="cb20-430"><a href="#cb20-430" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadButton</span>(</span>
<span id="cb20-431"><a href="#cb20-431" aria-hidden="true" tabindex="-1"></a>  walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span><span class="op">,</span></span>
<span id="cb20-432"><a href="#cb20-432" aria-hidden="true" tabindex="-1"></a>  <span class="st">"roi_data.csv"</span><span class="op">,</span></span>
<span id="cb20-433"><a href="#cb20-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Download"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Télécharger"</span> })<span class="op">,</span></span>
<span id="cb20-434"><a href="#cb20-434" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-12-2" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="437" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 436"><span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a><span class="fu">resultPlot</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-13" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="441" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 440"><span id="cb22-441"><a href="#cb22-441" aria-hidden="true" tabindex="-1"></a>indicatorSelector <span class="op">=</span> {</span>
<span id="cb22-442"><a href="#cb22-442" aria-hidden="true" tabindex="-1"></a>  <span class="co">// bind input so tooltip can be dynamic</span></span>
<span id="cb22-443"><a href="#cb22-443" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb22-444"><a href="#cb22-444" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">select</span>(dataPickMetric<span class="op">,</span> {</span>
<span id="cb22-445"><a href="#cb22-445" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb22-446"><a href="#cb22-446" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">indicator</span>)<span class="op">,</span></span>
<span id="cb22-447"><a href="#cb22-447" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> pickMetricWalkthrough<span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb22-448"><a href="#cb22-448" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb22-449"><a href="#cb22-449" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">labelFull</span><span class="op">,</span></span>
<span id="cb22-450"><a href="#cb22-450" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span> viewof pickMetricWalkthrough</span>
<span id="cb22-451"><a href="#cb22-451" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-452"><a href="#cb22-452" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-14" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="456" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 455"><span id="cb23-456"><a href="#cb23-456" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-457"><a href="#cb23-457" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listWhat <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">what</span>)</span>
<span id="cb23-458"><a href="#cb23-458" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listInterpret <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">interpret</span>)</span>
<span id="cb23-459"><a href="#cb23-459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listTell <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">infoListHeaders</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb23-460"><a href="#cb23-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-461"><a href="#cb23-461" aria-hidden="true" tabindex="-1"></a>  <span class="co">// indicator info</span></span>
<span id="cb23-462"><a href="#cb23-462" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">labelFull</span><span class="sc">}</span></span>
<span id="cb23-463"><a href="#cb23-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-464"><a href="#cb23-464" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listWhat<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span><span class="sc">}</span></span>
<span id="cb23-465"><a href="#cb23-465" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listInterpret<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span><span class="sc">}</span></span>
<span id="cb23-466"><a href="#cb23-466" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>listTell<span class="sc">}</span><span class="vs">**: </span><span class="sc">${</span>pickMetricWalkthrough<span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span><span class="sc">}</span></span>
<span id="cb23-467"><a href="#cb23-467" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb23-468"><a href="#cb23-468" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-15" data-nodetype="expression"></div></div></div><p><span><span id="ojs-element-id-12"></span></span></p></section><section id="summary" class="level1"><h1><span><span id="ojs-element-id-13"></span></span></h1><p><span><span id="ojs-element-id-14"></span></span></p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="478" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 477"><span id="cb24-478"><a href="#cb24-478" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb24-479"><a href="#cb24-479" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_rate <span class="op">=</span> (discountRate <span class="op">*</span> <span class="dv">100</span>) <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb24-480"><a href="#cb24-480" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> farm_bcr <span class="op">=</span> bcr<span class="op">;</span></span>
<span id="cb24-481"><a href="#cb24-481" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> methods_title <span class="op">=</span> nbMethods<span class="op">;</span></span>
<span id="cb24-482"><a href="#cb24-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-483"><a href="#cb24-483" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">block2</span>)</span>
<span id="cb24-484"><a href="#cb24-484" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> templateItems <span class="op">=</span> [</span>
<span id="cb24-485"><a href="#cb24-485" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"npvDisountRate"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> npv_rate}<span class="op">,</span></span>
<span id="cb24-486"><a href="#cb24-486" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"farmBcr"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> farm_bcr}<span class="op">,</span></span>
<span id="cb24-487"><a href="#cb24-487" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"methodsSourcesTitle"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> methods_title}<span class="op">,</span></span>
<span id="cb24-488"><a href="#cb24-488" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb24-489"><a href="#cb24-489" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> templateItems)</span>
<span id="cb24-490"><a href="#cb24-490" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>formatted<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb24-491"><a href="#cb24-491" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-16" data-nodetype="expression"></div></div></div></section><section id="methods" class="level1"><h1><span><span id="ojs-element-id-15"></span></span></h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="498" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 497"><span id="cb25-498"><a href="#cb25-498" aria-hidden="true" tabindex="-1"></a>methodFiles <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb25-499"><a href="#cb25-499" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en"</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/translations/methods-en.md"</span>)<span class="op">,</span></span>
<span id="cb25-500"><a href="#cb25-500" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fr"</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/translations/methods-fr.md"</span>)</span>
<span id="cb25-501"><a href="#cb25-501" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-502"><a href="#cb25-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-503"><a href="#cb25-503" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-504"><a href="#cb25-504" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> key <span class="op">=</span> masterLanguage<span class="op">.</span><span class="at">key</span></span>
<span id="cb25-505"><a href="#cb25-505" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> md_content <span class="op">=</span> <span class="cf">await</span> methodFiles[key]<span class="op">.</span><span class="fu">text</span>()</span>
<span id="cb25-506"><a href="#cb25-506" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">renderMarkdownWithSlots</span>(</span>
<span id="cb25-507"><a href="#cb25-507" aria-hidden="true" tabindex="-1"></a>    md_content<span class="op">,</span></span>
<span id="cb25-508"><a href="#cb25-508" aria-hidden="true" tabindex="-1"></a>    {}<span class="op">,</span></span>
<span id="cb25-509"><a href="#cb25-509" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb25-510"><a href="#cb25-510" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-17-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-17-2" data-nodetype="expression"></div></div></div></div></section><section id="contributions" class="level1"><h1><span><span id="ojs-element-id-16"></span></span></h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="515" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 514"><span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contributorList <span class="op">=</span> {</span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a>    <span class="dt">authors</span><span class="op">:</span> [</span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Pete Steward"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">1</span>] }<span class="op">,</span></span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Todd Rosenstock"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>] }<span class="op">,</span></span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Phillip Thornton"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">3</span>] }<span class="op">,</span></span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Brayden Youngberg"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">1</span>] }<span class="op">,</span></span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Lolita Muller"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">1</span>] }<span class="op">,</span></span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a>    <span class="dt">developers</span><span class="op">:</span> [</span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Zach Bogart"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">4</span>] }<span class="op">,</span></span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Brayden Youngberg"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">1</span>] }<span class="op">,</span></span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"Pete Steward"</span><span class="op">,</span> <span class="dt">orgs</span><span class="op">:</span> [<span class="dv">1</span>] }<span class="op">,</span></span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a>    <span class="dt">organizations</span><span class="op">:</span> {</span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span><span class="op">:</span> <span class="st">"Alliance Bioversity and CIAT"</span><span class="op">,</span></span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span><span class="op">:</span> <span class="st">"CGIAR"</span><span class="op">,</span></span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a>      <span class="dv">3</span><span class="op">:</span> <span class="st">"ILRI"</span><span class="op">,</span></span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4</span><span class="op">:</span> <span class="st">"Periscopic"</span></span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contributionSection <span class="op">=</span> <span class="fu">atlasContributionSection</span>(</span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a>    contributorList<span class="op">,</span></span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a>    <span class="fu">atlasCitation</span>(nbTitle)<span class="op">,</span></span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a>    masterLanguage<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>contributionSection<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-18" data-nodetype="expression"></div></div></div></section><section id="appendix" class="level1 hidden"><h1 class="hidden"><span><span id="ojs-element-id-17"></span></span></h1><section id="source-code" class="level2"><h2 data-anchor-id="source-code">Source code</h2></section><section id="data-import-and-cleaning" class="level2"><h2 data-anchor-id="data-import-and-cleaning">Data import and cleaning</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="555" data-source-offset="-20"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 554"><span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> {</span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> db <span class="op">=</span> <span class="cf">await</span> DuckDBClient<span class="op">.</span><span class="fu">of</span>({</span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cv_raw</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/faostat_prod_cv.parquet"</span>)</span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a><span class="vs">    CREATE TABLE exposure AS  -- data is ~ 1 mb so table possibly more performant</span></span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT</span></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a><span class="vs">        iso3,</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin1_name,</span></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a><span class="vs">        REGEXP_REPLACE(crop, '-tropical|-highland', '') AS crop,</span></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a><span class="vs">        CONCAT(exposure, '_', unit) AS exposure,</span></span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a><span class="vs">        SUM(value) AS value</span></span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM read_parquet("s3://digital-atlas/domain=exposure/type=combined/source=glw4-2020_spam2020AA/region=ssa/processing=atlas-harmonized/variable=vop_nominal-usd-2021.parquet")</span></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE</span></span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin2_name IS NULL AND admin1_name IS NOT NULL</span></span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND (tech = 'all' OR tech IS NULL)</span></span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND isfinite(value)</span></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND crop !~ '(^other-|rest-of|temperate-fruit|tropical-fruit|vegetables)'</span></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a><span class="vs">      GROUP BY</span></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="vs">        iso3,</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin1_name,</span></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a><span class="vs">        crop,</span></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="vs">        CONCAT(exposure, '_', unit)</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)</span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a><span class="vs">    CREATE VIEW cv AS</span></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT</span></span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a><span class="vs">        admin0_name,</span></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a><span class="vs">        -- clean and standardize crop names</span></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a><span class="vs">        REGEXP_REPLACE(</span></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a><span class="vs">          REGEXP_REPLACE(</span></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a><span class="vs">            REPLACE(REPLACE(crop, '_meat', ''), ' ', '-'),</span></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a><span class="vs">            'goat$', 'goats'</span></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a><span class="vs">          ),</span></span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a><span class="vs">          'pig$', 'pigs'</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a><span class="vs">        ) AS crop,</span></span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a><span class="vs">        value_filled AS cv</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE NOT (crop ILIKE '%milk%' OR crop ILIKE '%eggs%' OR LOWER(crop) = 'total')</span></span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a><span class="vs">      -- add robusta-coffee and small-millet substitutes</span></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT admin0_name, 'robusta-coffee', value_filled AS cv</span></span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE crop = 'arabica-coffee'</span></span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT admin0_name, 'small-millet', value_filled AS cv</span></span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM cv_raw</span></span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a><span class="vs">      WHERE crop = 'pearl-millet';</span></span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db<span class="op">;</span></span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> {</span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> country_list <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/shared/atlas_countries.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filteredCountries <span class="op">=</span> country_list</span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((c) <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">include</span> <span class="op">&amp;&amp;</span> c<span class="op">.</span><span class="at">iso3c</span> <span class="op">!==</span> <span class="st">"SDN"</span>)</span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(({ include<span class="op">,</span> <span class="op">...</span>rest }) <span class="kw">=&gt;</span> rest)<span class="op">;</span></span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> filteredCountries<span class="op">;</span></span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-19-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-19-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="623" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 622"><span id="cb28-623"><a href="#cb28-623" aria-hidden="true" tabindex="-1"></a>dataAdminRegions <span class="op">=</span> {</span>
<span id="cb28-624"><a href="#cb28-624" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> regions <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb28-625"><a href="#cb28-625" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT DISTINCT admin0_name, admin1_name, iso3</span></span>
<span id="cb28-626"><a href="#cb28-626" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM exposure</span></span>
<span id="cb28-627"><a href="#cb28-627" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE admin1_name IS NOT null</span></span>
<span id="cb28-628"><a href="#cb28-628" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND iso3 in ('</span><span class="sc">${</span>select_country<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb28-629"><a href="#cb28-629" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)</span>
<span id="cb28-630"><a href="#cb28-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-631"><a href="#cb28-631" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> regions<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> ({</span>
<span id="cb28-632"><a href="#cb28-632" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>row<span class="op">,</span></span>
<span id="cb28-633"><a href="#cb28-633" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>row<span class="op">.</span><span class="at">iso3</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>row<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb28-635"><a href="#cb28-635" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-636"><a href="#cb28-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-637"><a href="#cb28-637" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">TODO</span><span class="co">: Need to add translations and label cleaning to items</span></span>
<span id="cb28-638"><a href="#cb28-638" aria-hidden="true" tabindex="-1"></a>dataCrops <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb28-639"><a href="#cb28-639" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT DISTINCT crop AS item</span></span>
<span id="cb28-640"><a href="#cb28-640" aria-hidden="true" tabindex="-1"></a><span class="vs">  FROM exposure</span></span>
<span id="cb28-641"><a href="#cb28-641" aria-hidden="true" tabindex="-1"></a><span class="vs">  ORDER BY item</span></span>
<span id="cb28-642"><a href="#cb28-642" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-20-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-20-2" data-nodetype="declaration"></div></div></div></div></section><section id="inputs" class="level2"><h2 data-anchor-id="inputs">Inputs</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="649" data-source-offset="-43"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 648"><span id="cb29-649"><a href="#cb29-649" aria-hidden="true" tabindex="-1"></a>inputOptions_projectCost <span class="op">=</span> {</span>
<span id="cb29-650"><a href="#cb29-650" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb29-651"><a href="#cb29-651" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="fl">1e6</span><span class="op">,</span> <span class="fl">5e8</span>]<span class="op">,</span></span>
<span id="cb29-652"><a href="#cb29-652" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costInput</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb29-653"><a href="#cb29-653" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">costInput</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb29-654"><a href="#cb29-654" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e5</span><span class="op">,</span></span>
<span id="cb29-655"><a href="#cb29-655" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">50_000_000</span><span class="op">,</span></span>
<span id="cb29-656"><a href="#cb29-656" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'$.3s'</span>)<span class="op">,</span></span>
<span id="cb29-657"><a href="#cb29-657" aria-hidden="true" tabindex="-1"></a>    <span class="dt">outputWidth</span><span class="op">:</span> <span class="dv">90</span><span class="op">,</span></span>
<span id="cb29-658"><a href="#cb29-658" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Ex. $5,000,000"</span><span class="op">,</span></span>
<span id="cb29-659"><a href="#cb29-659" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pattern</span><span class="op">:</span> <span class="st">"^[$]?[1-9]+[0-9,$]*$"</span><span class="op">,</span></span>
<span id="cb29-660"><a href="#cb29-660" aria-hidden="true" tabindex="-1"></a>    <span class="dt">valueString</span><span class="op">:</span> <span class="st">"$50,000,000"</span></span>
<span id="cb29-661"><a href="#cb29-661" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-662"><a href="#cb29-662" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-663"><a href="#cb29-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-664"><a href="#cb29-664" aria-hidden="true" tabindex="-1"></a>inputOptions_projectYears <span class="op">=</span> {</span>
<span id="cb29-665"><a href="#cb29-665" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb29-666"><a href="#cb29-666" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">year</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span></span>
<span id="cb29-667"><a href="#cb29-667" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb29-668"><a href="#cb29-668" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb29-669"><a href="#cb29-669" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">16</span>]<span class="op">,</span></span>
<span id="cb29-670"><a href="#cb29-670" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> d3</span>
<span id="cb29-671"><a href="#cb29-671" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">range</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">16</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb29-672"><a href="#cb29-672" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>years<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d }))<span class="op">,</span></span>
<span id="cb29-673"><a href="#cb29-673" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb29-674"><a href="#cb29-674" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">costs</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">projectYearDropdown</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb29-675"><a href="#cb29-675" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb29-676"><a href="#cb29-676" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb29-677"><a href="#cb29-677" aria-hidden="true" tabindex="-1"></a>    <span class="dt">outputWidth</span><span class="op">:</span> <span class="dv">90</span></span>
<span id="cb29-678"><a href="#cb29-678" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb29-679"><a href="#cb29-679" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-21-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-21-2" data-nodetype="declaration"></div></div></div></div><section id="scope-selectors---country-region-crop" class="level3"><h3 data-anchor-id="scope-selectors---country-region-crop">Scope Selectors - country, region, crop</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="684" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 683"><span id="cb30-684"><a href="#cb30-684" aria-hidden="true" tabindex="-1"></a>viewof select_country <span class="op">=</span> {</span>
<span id="cb30-685"><a href="#cb30-685" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> countries</span>
<span id="cb30-686"><a href="#cb30-686" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb30-687"><a href="#cb30-687" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">iso3c</span><span class="op">,</span> <span class="co">//Migrating to iso codes for future flexability</span></span>
<span id="cb30-688"><a href="#cb30-688" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(d<span class="op">.</span><span class="at">translation</span>)</span>
<span id="cb30-689"><a href="#cb30-689" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb30-690"><a href="#cb30-690" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb30-691"><a href="#cb30-691" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb30-692"><a href="#cb30-692" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb30-693"><a href="#cb30-693" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb30-694"><a href="#cb30-694" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">countryDropdown</span><span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb30-695"><a href="#cb30-695" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb30-696"><a href="#cb30-696" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb30-697"><a href="#cb30-697" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb30-698"><a href="#cb30-698" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select Countries..."</span><span class="op">,</span></span>
<span id="cb30-699"><a href="#cb30-699" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb30-700"><a href="#cb30-700" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> [<span class="st">"KEN"</span><span class="op">,</span> <span class="st">"TZA"</span>]<span class="op">,</span></span>
<span id="cb30-701"><a href="#cb30-701" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb30-702"><a href="#cb30-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-703"><a href="#cb30-703" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span> <span class="co">// Noisy input, so delay it a bit.</span></span>
<span id="cb30-704"><a href="#cb30-704" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-22" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="708" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 707"><span id="cb31-708"><a href="#cb31-708" aria-hidden="true" tabindex="-1"></a><span class="co">// admin multi-select: regions</span></span>
<span id="cb31-709"><a href="#cb31-709" aria-hidden="true" tabindex="-1"></a>viewof select_region <span class="op">=</span> {</span>
<span id="cb31-710"><a href="#cb31-710" aria-hidden="true" tabindex="-1"></a>  <span class="co">// filter regions based on country id's</span></span>
<span id="cb31-711"><a href="#cb31-711" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filteredRegions <span class="op">=</span> dataAdminRegions</span>
<span id="cb31-712"><a href="#cb31-712" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const translateCountry = (d) =&gt; _lang(td.admin0_name.values?.[d]);</span></span>
<span id="cb31-713"><a href="#cb31-713" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> translateCountry <span class="op">=</span> (iso) <span class="kw">=&gt;</span> <span class="fu">_lang</span>(countries<span class="op">.</span><span class="fu">find</span>((c) <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">iso3c</span> <span class="op">===</span> iso)<span class="op">.</span><span class="at">translation</span>)<span class="op">;</span></span>
<span id="cb31-714"><a href="#cb31-714" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> filteredRegions<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb31-715"><a href="#cb31-715" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb31-716"><a href="#cb31-716" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">translateCountry</span>(d<span class="op">.</span><span class="at">iso3</span>)<span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb31-717"><a href="#cb31-717" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb31-718"><a href="#cb31-718" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedIds <span class="op">=</span> filteredRegions<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb31-719"><a href="#cb31-719" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> {</span>
<span id="cb31-720"><a href="#cb31-720" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb31-721"><a href="#cb31-721" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">regionDropdown</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb31-722"><a href="#cb31-722" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-723"><a href="#cb31-723" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb31-724"><a href="#cb31-724" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({<span class="dt">labelText</span><span class="op">:</span> text<span class="op">.</span><span class="at">label</span><span class="op">,</span> <span class="dt">tooltipText</span><span class="op">:</span> text<span class="op">.</span><span class="at">tooltip</span>})<span class="op">,</span></span>
<span id="cb31-725"><a href="#cb31-725" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb31-726"><a href="#cb31-726" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select regions..."</span><span class="op">,</span></span>
<span id="cb31-727"><a href="#cb31-727" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb31-728"><a href="#cb31-728" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> selectedIds</span>
<span id="cb31-729"><a href="#cb31-729" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb31-730"><a href="#cb31-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-731"><a href="#cb31-731" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb31-732"><a href="#cb31-732" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-23" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="736" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 735"><span id="cb32-736"><a href="#cb32-736" aria-hidden="true" tabindex="-1"></a><span class="co">// admin multi-select: countries</span></span>
<span id="cb32-737"><a href="#cb32-737" aria-hidden="true" tabindex="-1"></a>viewof select_crop <span class="op">=</span> {</span>
<span id="cb32-738"><a href="#cb32-738" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataCrops</span>
<span id="cb32-739"><a href="#cb32-739" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb32-740"><a href="#cb32-740" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">item</span><span class="op">,</span></span>
<span id="cb32-741"><a href="#cb32-741" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(d<span class="op">.</span><span class="at">item</span>) <span class="co">//</span><span class="al">TODO</span><span class="co">: Add translations</span></span>
<span id="cb32-742"><a href="#cb32-742" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb32-743"><a href="#cb32-743" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span>b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">label</span> <span class="op">&gt;</span> b<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb32-744"><a href="#cb32-744" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedId <span class="op">=</span> dataCrops</span>
<span id="cb32-745"><a href="#cb32-745" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> [<span class="st">"bean"</span><span class="op">,</span> <span class="st">"goats"</span><span class="op">,</span> <span class="st">"maize"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">item</span>))</span>
<span id="cb32-746"><a href="#cb32-746" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">item</span>)<span class="op">;</span></span>
<span id="cb32-747"><a href="#cb32-747" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> {</span>
<span id="cb32-748"><a href="#cb32-748" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">commodity</span><span class="op">.</span><span class="at">plural</span>)<span class="op">,</span></span>
<span id="cb32-749"><a href="#cb32-749" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb32-750"><a href="#cb32-750" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">locations</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">commodityDropdown</span><span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb32-751"><a href="#cb32-751" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-752"><a href="#cb32-752" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb32-753"><a href="#cb32-753" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">dropdownInput</span>({</span>
<span id="cb32-754"><a href="#cb32-754" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputLabel</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb32-755"><a href="#cb32-755" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> text<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb32-756"><a href="#cb32-756" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> text<span class="op">.</span><span class="at">tooltip</span></span>
<span id="cb32-757"><a href="#cb32-757" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb32-758"><a href="#cb32-758" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inputId</span><span class="op">:</span> <span class="st">"positionsTest"</span><span class="op">,</span></span>
<span id="cb32-759"><a href="#cb32-759" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholderText</span><span class="op">:</span> <span class="st">"Select crops..."</span><span class="op">,</span></span>
<span id="cb32-760"><a href="#cb32-760" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb32-761"><a href="#cb32-761" aria-hidden="true" tabindex="-1"></a>    <span class="dt">selected</span><span class="op">:</span> selectedId</span>
<span id="cb32-762"><a href="#cb32-762" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb32-763"><a href="#cb32-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-764"><a href="#cb32-764" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">debounce</span>(input<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb32-765"><a href="#cb32-765" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-24" data-nodetype="declaration"></div></div></div></section></section><section id="economic-input-variables" class="level2"><h2 data-anchor-id="economic-input-variables">Economic Input Variables</h2><section id="main-control-variables" class="level3"><h3 data-anchor-id="main-control-variables">Main Control Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="774" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 773"><span id="cb33-774"><a href="#cb33-774" aria-hidden="true" tabindex="-1"></a>rangeProjectCost <span class="op">=</span> {</span>
<span id="cb33-775"><a href="#cb33-775" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unpack <span class="op">=</span> <span class="bu">Number</span>(inputProjectOptions<span class="op">.</span><span class="at">cost</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">[,|$]</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>))</span>
<span id="cb33-776"><a href="#cb33-776" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> number <span class="op">=</span> <span class="bu">Number</span>(unpack)</span>
<span id="cb33-777"><a href="#cb33-777" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> number</span>
<span id="cb33-778"><a href="#cb33-778" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-779"><a href="#cb33-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-780"><a href="#cb33-780" aria-hidden="true" tabindex="-1"></a>projectYears <span class="op">=</span> inputProjectOptions<span class="op">.</span><span class="at">years</span><span class="op">.</span><span class="at">value</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-25-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-25-2" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="783" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 782"><span id="cb34-783"><a href="#cb34-783" aria-hidden="true" tabindex="-1"></a>render_econPerfWalkthrough <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb34-784"><a href="#cb34-784" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> terms <span class="op">=</span> {</span>
<span id="cb34-785"><a href="#cb34-785" aria-hidden="true" tabindex="-1"></a>    <span class="dt">none</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">none</span><span class="op">,</span> {</span>
<span id="cb34-786"><a href="#cb34-786" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb34-787"><a href="#cb34-787" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-788"><a href="#cb34-788" aria-hidden="true" tabindex="-1"></a>    <span class="dt">low</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">low</span><span class="op">,</span> {</span>
<span id="cb34-789"><a href="#cb34-789" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb34-790"><a href="#cb34-790" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-791"><a href="#cb34-791" aria-hidden="true" tabindex="-1"></a>    <span class="dt">moderate</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">moderate</span><span class="op">,</span> {</span>
<span id="cb34-792"><a href="#cb34-792" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb34-793"><a href="#cb34-793" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-794"><a href="#cb34-794" aria-hidden="true" tabindex="-1"></a>    <span class="dt">high</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">high</span><span class="op">,</span> {</span>
<span id="cb34-795"><a href="#cb34-795" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb34-796"><a href="#cb34-796" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-797"><a href="#cb34-797" aria-hidden="true" tabindex="-1"></a>    <span class="dt">incremental</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">incremental</span>)<span class="op">,</span></span>
<span id="cb34-798"><a href="#cb34-798" aria-hidden="true" tabindex="-1"></a>    <span class="dt">transformative</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb34-799"><a href="#cb34-799" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">transformative</span><span class="op">,</span></span>
<span id="cb34-800"><a href="#cb34-800" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb34-801"><a href="#cb34-801" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb34-802"><a href="#cb34-802" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataProdImpact <span class="op">=</span> [</span>
<span id="cb34-803"><a href="#cb34-803" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`10% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">incremental</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span> }<span class="op">,</span></span>
<span id="cb34-804"><a href="#cb34-804" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`20%`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.2</span> }<span class="op">,</span></span>
<span id="cb34-805"><a href="#cb34-805" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`30% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.3</span> }<span class="op">,</span></span>
<span id="cb34-806"><a href="#cb34-806" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`40%`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.4</span> }<span class="op">,</span></span>
<span id="cb34-807"><a href="#cb34-807" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`50% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">transformative</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span> }<span class="op">,</span></span>
<span id="cb34-808"><a href="#cb34-808" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb34-809"><a href="#cb34-809" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputProdImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataProdImpact<span class="op">,</span> {</span>
<span id="cb34-810"><a href="#cb34-810" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb34-811"><a href="#cb34-811" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb34-812"><a href="#cb34-812" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb34-813"><a href="#cb34-813" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-814"><a href="#cb34-814" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb34-815"><a href="#cb34-815" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">prodImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb34-816"><a href="#cb34-816" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-817"><a href="#cb34-817" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-818"><a href="#cb34-818" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb34-819"><a href="#cb34-819" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataProdImpact<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.3</span>)<span class="op">,</span></span>
<span id="cb34-820"><a href="#cb34-820" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb34-821"><a href="#cb34-821" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataAdoption <span class="op">=</span> [</span>
<span id="cb34-822"><a href="#cb34-822" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`0.5% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">low</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.005</span> }<span class="op">,</span></span>
<span id="cb34-823"><a href="#cb34-823" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`1% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.01</span> }<span class="op">,</span></span>
<span id="cb34-824"><a href="#cb34-824" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`2% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">high</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.02</span> }<span class="op">,</span></span>
<span id="cb34-825"><a href="#cb34-825" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb34-826"><a href="#cb34-826" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputAdoption <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdoption<span class="op">,</span> {</span>
<span id="cb34-827"><a href="#cb34-827" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb34-828"><a href="#cb34-828" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb34-829"><a href="#cb34-829" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb34-830"><a href="#cb34-830" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-831"><a href="#cb34-831" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb34-832"><a href="#cb34-832" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">adoptionRateDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb34-833"><a href="#cb34-833" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-834"><a href="#cb34-834" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-835"><a href="#cb34-835" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb34-836"><a href="#cb34-836" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataAdoption<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.01</span>)<span class="op">,</span></span>
<span id="cb34-837"><a href="#cb34-837" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb34-838"><a href="#cb34-838" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataCisImpact <span class="op">=</span> [</span>
<span id="cb34-839"><a href="#cb34-839" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`0% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">none</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb34-840"><a href="#cb34-840" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`10% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">low</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span> }<span class="op">,</span></span>
<span id="cb34-841"><a href="#cb34-841" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`25% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">moderate</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.25</span> }<span class="op">,</span></span>
<span id="cb34-842"><a href="#cb34-842" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="vs">`50% (</span><span class="sc">${</span>terms<span class="op">.</span><span class="at">high</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span> }<span class="op">,</span></span>
<span id="cb34-843"><a href="#cb34-843" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb34-844"><a href="#cb34-844" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputCisImpact <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataCisImpact<span class="op">,</span> {</span>
<span id="cb34-845"><a href="#cb34-845" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">makeTooltipLabel</span>({</span>
<span id="cb34-846"><a href="#cb34-846" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb34-847"><a href="#cb34-847" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb34-848"><a href="#cb34-848" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-849"><a href="#cb34-849" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb34-850"><a href="#cb34-850" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">projectSetup</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">impacts</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">cisImpactDropdown</span><span class="op">.</span><span class="at">tooltip</span><span class="op">,</span></span>
<span id="cb34-851"><a href="#cb34-851" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-852"><a href="#cb34-852" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-853"><a href="#cb34-853" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb34-854"><a href="#cb34-854" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataCisImpact<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="fl">0.25</span>)<span class="op">,</span></span>
<span id="cb34-855"><a href="#cb34-855" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb34-856"><a href="#cb34-856" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb34-857"><a href="#cb34-857" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-858"><a href="#cb34-858" aria-hidden="true" tabindex="-1"></a>      inputProdImpact<span class="op">,</span></span>
<span id="cb34-859"><a href="#cb34-859" aria-hidden="true" tabindex="-1"></a>      inputAdoption<span class="op">,</span></span>
<span id="cb34-860"><a href="#cb34-860" aria-hidden="true" tabindex="-1"></a>      inputCisImpact<span class="op">,</span></span>
<span id="cb34-861"><a href="#cb34-861" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-862"><a href="#cb34-862" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-863"><a href="#cb34-863" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb34-864"><a href="#cb34-864" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-865"><a href="#cb34-865" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb34-866"><a href="#cb34-866" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-26" data-nodetype="declaration"></div></div></div></section><section id="advanced-control-variables" class="level3"><h3 data-anchor-id="advanced-control-variables">Advanced Control Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="873" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 872"><span id="cb35-873"><a href="#cb35-873" aria-hidden="true" tabindex="-1"></a>viewof discountRate <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span>{<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> (x <span class="op">*</span> <span class="dv">100</span>)<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.12</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount Rate"</span>} ) <span class="co">// 0-1 as a pct</span></span>
<span id="cb35-874"><a href="#cb35-874" aria-hidden="true" tabindex="-1"></a>viewof bcr <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"BCR"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.62</span>} )</span>
<span id="cb35-875"><a href="#cb35-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-876"><a href="#cb35-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-877"><a href="#cb35-877" aria-hidden="true" tabindex="-1"></a>viewof uncertaintyBenefitScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb35-878"><a href="#cb35-878" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb35-879"><a href="#cb35-879" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb35-880"><a href="#cb35-880" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb35-881"><a href="#cb35-881" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.9</span><span class="op">,</span></span>
<span id="cb35-882"><a href="#cb35-882" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb35-883"><a href="#cb35-883" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.8</span>]<span class="op">,</span> {</span>
<span id="cb35-884"><a href="#cb35-884" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb35-885"><a href="#cb35-885" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.2</span><span class="op">,</span></span>
<span id="cb35-886"><a href="#cb35-886" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb35-887"><a href="#cb35-887" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb35-888"><a href="#cb35-888" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb35-889"><a href="#cb35-889" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb35-890"><a href="#cb35-890" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb35-891"><a href="#cb35-891" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb35-892"><a href="#cb35-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-893"><a href="#cb35-893" aria-hidden="true" tabindex="-1"></a>viewof uncertaintyCostScale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb35-894"><a href="#cb35-894" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb35-895"><a href="#cb35-895" aria-hidden="true" tabindex="-1"></a>      <span class="dt">low</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb35-896"><a href="#cb35-896" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb35-897"><a href="#cb35-897" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">0.9</span><span class="op">,</span></span>
<span id="cb35-898"><a href="#cb35-898" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb35-899"><a href="#cb35-899" aria-hidden="true" tabindex="-1"></a>      <span class="dt">high</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="fl">1.8</span>]<span class="op">,</span> {</span>
<span id="cb35-900"><a href="#cb35-900" aria-hidden="true" tabindex="-1"></a>        <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb35-901"><a href="#cb35-901" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fl">1.2</span><span class="op">,</span></span>
<span id="cb35-902"><a href="#cb35-902" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb35-903"><a href="#cb35-903" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb35-904"><a href="#cb35-904" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb35-905"><a href="#cb35-905" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="fu">inputTemplate</span>({ <span class="dt">gap</span><span class="op">:</span> <span class="st">"3em"</span> })<span class="op">,</span></span>
<span id="cb35-906"><a href="#cb35-906" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb35-907"><a href="#cb35-907" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-27-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-27-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-27-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-27-4" data-nodetype="declaration"></div></div></div></div></section><section id="other-selections" class="level3"><h3 data-anchor-id="other-selections">Other Selections</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="912" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 911"><span id="cb36-912"><a href="#cb36-912" aria-hidden="true" tabindex="-1"></a><span class="co">// Plot Variable</span></span>
<span id="cb36-913"><a href="#cb36-913" aria-hidden="true" tabindex="-1"></a><span class="co">// base selector for metric type</span></span>
<span id="cb36-914"><a href="#cb36-914" aria-hidden="true" tabindex="-1"></a>viewof pickMetricWalkthrough <span class="op">=</span> {</span>
<span id="cb36-915"><a href="#cb36-915" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataPickMetric<span class="op">,</span> {</span>
<span id="cb36-916"><a href="#cb36-916" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">terms</span><span class="op">.</span><span class="at">indicator</span>)<span class="op">,</span></span>
<span id="cb36-917"><a href="#cb36-917" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">labelFull</span><span class="op">,</span></span>
<span id="cb36-918"><a href="#cb36-918" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> dataPickMetric<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"irr"</span>)</span>
<span id="cb36-919"><a href="#cb36-919" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb36-920"><a href="#cb36-920" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-28" data-nodetype="declaration"></div></div></div></section></section><section id="elements" class="level2"><h2 data-anchor-id="elements">Elements</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="927" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 926"><span id="cb37-927"><a href="#cb37-927" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { dropdownInput<span class="op">,</span> dropdownCSS } <span class="im">from</span> <span class="st">"/helpers/multiSelect.ojs"</span><span class="op">;</span></span>
<span id="cb37-928"><a href="#cb37-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-929"><a href="#cb37-929" aria-hidden="true" tabindex="-1"></a>dropdownCSS<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-29-2" data-nodetype="expression"></div></div></div></div></section><section id="helper-functions" class="level2"><h2 data-anchor-id="helper-functions">Helper Functions</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="934" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 933"><span id="cb38-934"><a href="#cb38-934" aria-hidden="true" tabindex="-1"></a>debounce <span class="op">=</span> (input<span class="op">,</span> delay <span class="op">=</span> <span class="dv">500</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb38-935"><a href="#cb38-935" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> DelayedEvent <span class="kw">extends</span> <span class="bu">Event</span> {}</span>
<span id="cb38-936"><a href="#cb38-936" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> id<span class="op">;</span></span>
<span id="cb38-937"><a href="#cb38-937" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb38-938"><a href="#cb38-938" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (e <span class="kw">instanceof</span> DelayedEvent) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb38-939"><a href="#cb38-939" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">stopImmediatePropagation</span>()<span class="op">;</span></span>
<span id="cb38-940"><a href="#cb38-940" aria-hidden="true" tabindex="-1"></a>    <span class="pp">clearTimeout</span>(id)<span class="op">;</span></span>
<span id="cb38-941"><a href="#cb38-941" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="pp">setTimeout</span>(</span>
<span id="cb38-942"><a href="#cb38-942" aria-hidden="true" tabindex="-1"></a>      () <span class="kw">=&gt;</span> input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="fu">DelayedEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">,</span></span>
<span id="cb38-943"><a href="#cb38-943" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">,</span></span>
<span id="cb38-944"><a href="#cb38-944" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb38-945"><a href="#cb38-945" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb38-946"><a href="#cb38-946" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input<span class="op">;</span></span>
<span id="cb38-947"><a href="#cb38-947" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-30" data-nodetype="declaration"></div></div></div></section><section id="language" class="level2"><h2 data-anchor-id="language">Language</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="957" data-source-offset="-67"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 956"><span id="cb39-957"><a href="#cb39-957" aria-hidden="true" tabindex="-1"></a>nbTitle <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb39-958"><a href="#cb39-958" aria-hidden="true" tabindex="-1"></a>  <span class="dt">en</span><span class="op">:</span> <span class="st">"Estimate Economic Returns on Adaptation"</span><span class="op">,</span></span>
<span id="cb39-959"><a href="#cb39-959" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Estimer les retours sur économiques l'adaptation"</span><span class="op">,</span></span>
<span id="cb39-960"><a href="#cb39-960" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb39-961"><a href="#cb39-961" aria-hidden="true" tabindex="-1"></a><span class="co">// key_insights = _lang({en: "Key Insights", fr: "Résumé"})</span></span>
<span id="cb39-962"><a href="#cb39-962" aria-hidden="true" tabindex="-1"></a>nbOverview <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Overview"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Vue d’Ensemble"</span> })<span class="op">;</span></span>
<span id="cb39-963"><a href="#cb39-963" aria-hidden="true" tabindex="-1"></a>heading1 <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Project Set-Up"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Configuration de Project"</span> })<span class="op">;</span></span>
<span id="cb39-964"><a href="#cb39-964" aria-hidden="true" tabindex="-1"></a>heading2 <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Investment Returns"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Retours d'Investissements"</span> })<span class="op">;</span></span>
<span id="cb39-965"><a href="#cb39-965" aria-hidden="true" tabindex="-1"></a>nbSummary <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Summary"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Résumé"</span> })<span class="op">;</span></span>
<span id="cb39-966"><a href="#cb39-966" aria-hidden="true" tabindex="-1"></a>nbMethods <span class="op">=</span> <span class="fu">_lang</span>({ <span class="dt">en</span><span class="op">:</span> <span class="st">"Methods &amp; Sources"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Méthodes &amp; Sources"</span> })<span class="op">;</span></span>
<span id="cb39-967"><a href="#cb39-967" aria-hidden="true" tabindex="-1"></a>contributions <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">contributors</span>)<span class="op">;</span></span>
<span id="cb39-968"><a href="#cb39-968" aria-hidden="true" tabindex="-1"></a>appendix <span class="op">=</span> <span class="fu">_lang</span>(general_translations<span class="op">.</span><span class="at">appendix</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-6" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-7" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-31-8" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="972" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 971"><span id="cb40-972"><a href="#cb40-972" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { lang <span class="im">as</span> Lang } <span class="im">from</span> <span class="st">"/helpers/lang.js"</span></span>
<span id="cb40-973"><a href="#cb40-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-974"><a href="#cb40-974" aria-hidden="true" tabindex="-1"></a>general_translations <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/shared/generalTranslations.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb40-975"><a href="#cb40-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-976"><a href="#cb40-976" aria-hidden="true" tabindex="-1"></a>nbText <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"/data/economicReturns/translations.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb40-977"><a href="#cb40-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-978"><a href="#cb40-978" aria-hidden="true" tabindex="-1"></a>languages <span class="op">=</span> [</span>
<span id="cb40-979"><a href="#cb40-979" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"en"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"English"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">'en-US'</span> }<span class="op">,</span></span>
<span id="cb40-980"><a href="#cb40-980" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"fr"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Français"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">'fr-FR'</span> }</span>
<span id="cb40-981"><a href="#cb40-981" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb40-982"><a href="#cb40-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-983"><a href="#cb40-983" aria-hidden="true" tabindex="-1"></a>defaultLangKey <span class="op">=</span> {</span>
<span id="cb40-984"><a href="#cb40-984" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> name <span class="op">=</span> <span class="st">"lang"</span><span class="op">;</span></span>
<span id="cb40-985"><a href="#cb40-985" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> list <span class="op">=</span> languages<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb40-986"><a href="#cb40-986" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defaultKey <span class="op">=</span> <span class="st">"en"</span><span class="op">;</span></span>
<span id="cb40-987"><a href="#cb40-987" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> queryParam <span class="op">=</span> <span class="cf">await</span> Lang<span class="op">.</span><span class="fu">getParamFromList</span>({ name<span class="op">,</span> list })<span class="op">;</span></span>
<span id="cb40-988"><a href="#cb40-988" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> queryParam <span class="op">??</span> defaultKey<span class="op">;</span></span>
<span id="cb40-989"><a href="#cb40-989" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-990"><a href="#cb40-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-991"><a href="#cb40-991" aria-hidden="true" tabindex="-1"></a>_lang <span class="op">=</span> Lang<span class="op">.</span><span class="fu">lg</span>(masterLanguage<span class="op">.</span><span class="at">key</span>)</span>
<span id="cb40-992"><a href="#cb40-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-993"><a href="#cb40-993" aria-hidden="true" tabindex="-1"></a>viewof masterLanguage <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb40-994"><a href="#cb40-994" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Main language toggle"</span><span class="op">,</span></span>
<span id="cb40-995"><a href="#cb40-995" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb40-996"><a href="#cb40-996" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> languages<span class="op">.</span><span class="fu">find</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">key</span> <span class="op">===</span> defaultLangKey)<span class="op">,</span></span>
<span id="cb40-997"><a href="#cb40-997" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-4" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-5" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-6" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-32-7" data-nodetype="declaration"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1001" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1000"><span id="cb41-1001"><a href="#cb41-1001" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">NavbarLangSelector</span>(language_obj<span class="op">,</span> masterLanguage) {</span>
<span id="cb41-1002"><a href="#cb41-1002" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> navEnd <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">".navbar-nav.ms-auto .nav-item.compact"</span>)<span class="op">;</span></span>
<span id="cb41-1003"><a href="#cb41-1003" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (navEnd) {</span>
<span id="cb41-1004"><a href="#cb41-1004" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> existingLangSelector <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"nav-lang-selector"</span>)<span class="op">;</span></span>
<span id="cb41-1005"><a href="#cb41-1005" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>existingLangSelector) {</span>
<span id="cb41-1006"><a href="#cb41-1006" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lang_sel <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb41-1007"><a href="#cb41-1007" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">radio</span>(language_obj<span class="op">,</span> {</span>
<span id="cb41-1008"><a href="#cb41-1008" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> <span class="st">""</span><span class="op">,</span></span>
<span id="cb41-1009"><a href="#cb41-1009" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span></span>
<span id="cb41-1010"><a href="#cb41-1010" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb41-1011"><a href="#cb41-1011" aria-hidden="true" tabindex="-1"></a>        viewof masterLanguage</span>
<span id="cb41-1012"><a href="#cb41-1012" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb41-1013"><a href="#cb41-1013" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">id</span> <span class="op">=</span> <span class="st">"nav-lang-selector"</span><span class="op">;</span></span>
<span id="cb41-1014"><a href="#cb41-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1015"><a href="#cb41-1015" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Hack the css together for the observable inputs</span></span>
<span id="cb41-1016"><a href="#cb41-1016" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"flex"</span><span class="op">;</span></span>
<span id="cb41-1017"><a href="#cb41-1017" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">alignItems</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb41-1018"><a href="#cb41-1018" aria-hidden="true" tabindex="-1"></a>      lang_sel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">marginLeft</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb41-1019"><a href="#cb41-1019" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lang_div <span class="op">=</span> lang_sel<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb41-1020"><a href="#cb41-1020" aria-hidden="true" tabindex="-1"></a>      lang_div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"flex"</span><span class="op">;</span></span>
<span id="cb41-1021"><a href="#cb41-1021" aria-hidden="true" tabindex="-1"></a>      lang_div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">flexDirection</span> <span class="op">=</span> <span class="st">"column"</span><span class="op">;</span></span>
<span id="cb41-1022"><a href="#cb41-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1023"><a href="#cb41-1023" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Insert the new item after the GitHub icon and other elements</span></span>
<span id="cb41-1024"><a href="#cb41-1024" aria-hidden="true" tabindex="-1"></a>      navEnd<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="fu">appendChild</span>(lang_sel)<span class="op">;</span></span>
<span id="cb41-1025"><a href="#cb41-1025" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-1026"><a href="#cb41-1026" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-1027"><a href="#cb41-1027" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-1028"><a href="#cb41-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1029"><a href="#cb41-1029" aria-hidden="true" tabindex="-1"></a><span class="fu">NavbarLangSelector</span>(languages<span class="op">,</span> masterLanguage)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-33-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-33-2" data-nodetype="expression"></div></div></div></div><section id="markdown-notebook-text" class="level3"><h3 data-anchor-id="markdown-notebook-text">Markdown notebook text</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1034" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1033"><span id="cb42-1034"><a href="#cb42-1034" aria-hidden="true" tabindex="-1"></a>dataPickMetric <span class="op">=</span> {</span>
<span id="cb42-1035"><a href="#cb42-1035" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb42-1036"><a href="#cb42-1036" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-1037"><a href="#cb42-1037" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"irr"</span><span class="op">,</span></span>
<span id="cb42-1038"><a href="#cb42-1038" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"irr"</span><span class="op">,</span></span>
<span id="cb42-1039"><a href="#cb42-1039" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb42-1040"><a href="#cb42-1040" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb42-1041"><a href="#cb42-1041" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb42-1042"><a href="#cb42-1042" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb42-1043"><a href="#cb42-1043" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb42-1044"><a href="#cb42-1044" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb42-1045"><a href="#cb42-1045" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb42-1046"><a href="#cb42-1046" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">irr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb42-1047"><a href="#cb42-1047" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb42-1048"><a href="#cb42-1048" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb42-1049"><a href="#cb42-1049" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb42-1050"><a href="#cb42-1050" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-1051"><a href="#cb42-1051" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"mirr"</span><span class="op">,</span></span>
<span id="cb42-1052"><a href="#cb42-1052" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"mirr"</span><span class="op">,</span></span>
<span id="cb42-1053"><a href="#cb42-1053" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb42-1054"><a href="#cb42-1054" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb42-1055"><a href="#cb42-1055" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb42-1056"><a href="#cb42-1056" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb42-1057"><a href="#cb42-1057" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb42-1058"><a href="#cb42-1058" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb42-1059"><a href="#cb42-1059" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb42-1060"><a href="#cb42-1060" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">mirr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb42-1061"><a href="#cb42-1061" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb42-1062"><a href="#cb42-1062" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb42-1063"><a href="#cb42-1063" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb42-1064"><a href="#cb42-1064" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-1065"><a href="#cb42-1065" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"npv"</span><span class="op">,</span></span>
<span id="cb42-1066"><a href="#cb42-1066" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"npv"</span><span class="op">,</span></span>
<span id="cb42-1067"><a href="#cb42-1067" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb42-1068"><a href="#cb42-1068" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb42-1069"><a href="#cb42-1069" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb42-1070"><a href="#cb42-1070" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb42-1071"><a href="#cb42-1071" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb42-1072"><a href="#cb42-1072" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb42-1073"><a href="#cb42-1073" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb42-1074"><a href="#cb42-1074" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">npv</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb42-1075"><a href="#cb42-1075" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb42-1076"><a href="#cb42-1076" aria-hidden="true" tabindex="-1"></a>       <span class="dt">yFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>()(d)</span>
<span id="cb42-1077"><a href="#cb42-1077" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb42-1078"><a href="#cb42-1078" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-1079"><a href="#cb42-1079" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"bcr"</span><span class="op">,</span></span>
<span id="cb42-1080"><a href="#cb42-1080" aria-hidden="true" tabindex="-1"></a>      <span class="dt">columnName</span><span class="op">:</span> <span class="st">"discounted_bcr"</span><span class="op">,</span></span>
<span id="cb42-1081"><a href="#cb42-1081" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb42-1082"><a href="#cb42-1082" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">tooltip</span>)<span class="op">,</span></span>
<span id="cb42-1083"><a href="#cb42-1083" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLong</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">labelLong</span>)<span class="op">,</span></span>
<span id="cb42-1084"><a href="#cb42-1084" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelFull</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">labelFull</span>)<span class="op">,</span></span>
<span id="cb42-1085"><a href="#cb42-1085" aria-hidden="true" tabindex="-1"></a>      <span class="dt">info</span><span class="op">:</span> {</span>
<span id="cb42-1086"><a href="#cb42-1086" aria-hidden="true" tabindex="-1"></a>        <span class="dt">what</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">what</span>)<span class="op">,</span></span>
<span id="cb42-1087"><a href="#cb42-1087" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpret</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">interpret</span>)<span class="op">,</span></span>
<span id="cb42-1088"><a href="#cb42-1088" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tell</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">indicators</span><span class="op">.</span><span class="at">bcr</span><span class="op">.</span><span class="at">info</span><span class="op">.</span><span class="at">tell</span>)</span>
<span id="cb42-1089"><a href="#cb42-1089" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb42-1090"><a href="#cb42-1090" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yFormat</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".2f"</span>)</span>
<span id="cb42-1091"><a href="#cb42-1091" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-1092"><a href="#cb42-1092" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb42-1093"><a href="#cb42-1093" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-34" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1097" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1096"><span id="cb43-1097"><a href="#cb43-1097" aria-hidden="true" tabindex="-1"></a>renderReview1 <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb43-1098"><a href="#cb43-1098" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langBasePath <span class="op">=</span> nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">insightReview</span><span class="op">.</span><span class="at">setupBlock</span><span class="op">;</span></span>
<span id="cb43-1099"><a href="#cb43-1099" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langMissingTemplate <span class="op">=</span> <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">missingMessage</span><span class="op">,</span> {</span>
<span id="cb43-1100"><a href="#cb43-1100" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1101"><a href="#cb43-1101" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb43-1102"><a href="#cb43-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1103"><a href="#cb43-1103" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isoSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_country)<span class="op">;</span></span>
<span id="cb43-1104"><a href="#cb43-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1105"><a href="#cb43-1105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0List <span class="op">=</span> countries</span>
<span id="cb43-1106"><a href="#cb43-1106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> isoSet<span class="op">.</span><span class="fu">has</span>(d<span class="op">.</span><span class="at">iso3c</span>))</span>
<span id="cb43-1107"><a href="#cb43-1107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span>)<span class="op">;</span></span>
<span id="cb43-1108"><a href="#cb43-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1109"><a href="#cb43-1109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cropList <span class="op">=</span> select_crop<span class="op">;</span></span>
<span id="cb43-1110"><a href="#cb43-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1111"><a href="#cb43-1111" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const cropList = adminCropChoices.crops.sort((a,b) =&gt; _lang(a.translation) &gt; _lang(b.translation));</span></span>
<span id="cb43-1112"><a href="#cb43-1112" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> truncateSize <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb43-1113"><a href="#cb43-1113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0ListTruncated <span class="op">=</span> admin0List<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> truncateSize)<span class="op">;</span></span>
<span id="cb43-1114"><a href="#cb43-1114" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cropListTruncated <span class="op">=</span> cropList<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> truncateSize)<span class="op">;</span> <span class="co">// .map((d) =&gt; _lang(d.translation));</span></span>
<span id="cb43-1115"><a href="#cb43-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1116"><a href="#cb43-1116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (admin0List<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">||</span> cropList<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb43-1117"><a href="#cb43-1117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>langMissingTemplate<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb43-1118"><a href="#cb43-1118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-1119"><a href="#cb43-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1120"><a href="#cb43-1120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// new code</span></span>
<span id="cb43-1121"><a href="#cb43-1121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropCount <span class="op">=</span> cropList<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb43-1122"><a href="#cb43-1122" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropWord <span class="op">=</span></span>
<span id="cb43-1123"><a href="#cb43-1123" aria-hidden="true" tabindex="-1"></a>    cropList<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb43-1124"><a href="#cb43-1124" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb43-1125"><a href="#cb43-1125" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1126"><a href="#cb43-1126" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb43-1127"><a href="#cb43-1127" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb43-1128"><a href="#cb43-1128" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1129"><a href="#cb43-1129" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb43-1130"><a href="#cb43-1130" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCropList <span class="op">=</span> <span class="vs">`(**</span><span class="sc">${</span>cropListTruncated<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>)<span class="sc">}${</span></span>
<span id="cb43-1131"><a href="#cb43-1131" aria-hidden="true" tabindex="-1"></a>    cropList<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> truncateSize <span class="op">?</span> <span class="st">"..."</span> <span class="op">:</span> <span class="st">""</span></span>
<span id="cb43-1132"><a href="#cb43-1132" aria-hidden="true" tabindex="-1"></a>  <span class="sc">}</span><span class="vs">**)`</span><span class="op">;</span></span>
<span id="cb43-1133"><a href="#cb43-1133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCrop <span class="op">=</span> <span class="vs">`**</span><span class="sc">${</span>insertCropCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertCropWord<span class="sc">}</span><span class="vs">** </span><span class="sc">${</span>insertCropList<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb43-1134"><a href="#cb43-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1135"><a href="#cb43-1135" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegionCount <span class="op">=</span> select_region<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb43-1136"><a href="#cb43-1136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegionWord <span class="op">=</span></span>
<span id="cb43-1137"><a href="#cb43-1137" aria-hidden="true" tabindex="-1"></a>    insertRegionCount <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb43-1138"><a href="#cb43-1138" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb43-1139"><a href="#cb43-1139" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1140"><a href="#cb43-1140" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb43-1141"><a href="#cb43-1141" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb43-1142"><a href="#cb43-1142" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1143"><a href="#cb43-1143" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb43-1144"><a href="#cb43-1144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertRegion <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>insertRegionCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertRegionWord<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb43-1145"><a href="#cb43-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1146"><a href="#cb43-1146" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryCount <span class="op">=</span> admin0List<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb43-1147"><a href="#cb43-1147" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryWord <span class="op">=</span></span>
<span id="cb43-1148"><a href="#cb43-1148" aria-hidden="true" tabindex="-1"></a>    insertCountryCount <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb43-1149"><a href="#cb43-1149" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">singular</span><span class="op">,</span> {</span>
<span id="cb43-1150"><a href="#cb43-1150" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1151"><a href="#cb43-1151" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb43-1152"><a href="#cb43-1152" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">plural</span><span class="op">,</span> {</span>
<span id="cb43-1153"><a href="#cb43-1153" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1154"><a href="#cb43-1154" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb43-1155"><a href="#cb43-1155" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountryList <span class="op">=</span> <span class="vs">`(**</span><span class="sc">${</span>admin0ListTruncated<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>)<span class="sc">}${</span></span>
<span id="cb43-1156"><a href="#cb43-1156" aria-hidden="true" tabindex="-1"></a>    insertCountryCount <span class="op">&gt;</span> truncateSize <span class="op">?</span> <span class="st">"..."</span> <span class="op">:</span> <span class="st">""</span></span>
<span id="cb43-1157"><a href="#cb43-1157" aria-hidden="true" tabindex="-1"></a>  <span class="sc">}</span><span class="vs">**)`</span><span class="op">;</span></span>
<span id="cb43-1158"><a href="#cb43-1158" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertCountry <span class="op">=</span> <span class="vs">`**</span><span class="sc">${</span>insertCountryCount<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>insertCountryWord<span class="sc">}</span><span class="vs">** </span><span class="sc">${</span>insertCountryList<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb43-1159"><a href="#cb43-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1160"><a href="#cb43-1160" aria-hidden="true" tabindex="-1"></a>  <span class="co">// insert to template</span></span>
<span id="cb43-1161"><a href="#cb43-1161" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTemplate <span class="op">=</span> <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">template</span><span class="op">,</span> {</span>
<span id="cb43-1162"><a href="#cb43-1162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> language<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb43-1163"><a href="#cb43-1163" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb43-1164"><a href="#cb43-1164" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTemplateItems <span class="op">=</span> [</span>
<span id="cb43-1165"><a href="#cb43-1165" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"crop_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertCrop }<span class="op">,</span></span>
<span id="cb43-1166"><a href="#cb43-1166" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"region_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertRegion }<span class="op">,</span></span>
<span id="cb43-1167"><a href="#cb43-1167" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"country_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> insertCountry }<span class="op">,</span></span>
<span id="cb43-1168"><a href="#cb43-1168" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb43-1169"><a href="#cb43-1169" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"cost_string"</span><span class="op">,</span></span>
<span id="cb43-1170"><a href="#cb43-1170" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="fu">formatUSD</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })(rangeProjectCost)<span class="op">,</span></span>
<span id="cb43-1171"><a href="#cb43-1171" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1172"><a href="#cb43-1172" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"year_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projectYears <span class="op">+</span> <span class="st">" years"</span> }<span class="op">,</span> <span class="co">//</span><span class="al">TODO</span><span class="co">: add correct "years" string at end of this</span></span>
<span id="cb43-1173"><a href="#cb43-1173" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb43-1174"><a href="#cb43-1174" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectionFormattedTemplate <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb43-1175"><a href="#cb43-1175" aria-hidden="true" tabindex="-1"></a>    langTemplate<span class="op">,</span></span>
<span id="cb43-1176"><a href="#cb43-1176" aria-hidden="true" tabindex="-1"></a>    langTemplateItems<span class="op">,</span></span>
<span id="cb43-1177"><a href="#cb43-1177" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb43-1178"><a href="#cb43-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1179"><a href="#cb43-1179" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>selectionFormattedTemplate<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb43-1180"><a href="#cb43-1180" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-35" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1184" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1183"><span id="cb44-1184"><a href="#cb44-1184" aria-hidden="true" tabindex="-1"></a>renderReview2 <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb44-1185"><a href="#cb44-1185" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> investmentTemplate <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb44-1186"><a href="#cb44-1186" aria-hidden="true" tabindex="-1"></a>    nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">insightReview</span><span class="op">.</span><span class="at">indicatorBlock</span><span class="op">,</span></span>
<span id="cb44-1187"><a href="#cb44-1187" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb44-1188"><a href="#cb44-1188" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> investmentTemplateItems <span class="op">=</span> [</span>
<span id="cb44-1189"><a href="#cb44-1189" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb44-1190"><a href="#cb44-1190" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"prod_impact_label"</span><span class="op">,</span></span>
<span id="cb44-1191"><a href="#cb44-1191" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb44-1192"><a href="#cb44-1192" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb44-1193"><a href="#cb44-1193" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb44-1194"><a href="#cb44-1194" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"adoption_rate_label"</span><span class="op">,</span></span>
<span id="cb44-1195"><a href="#cb44-1195" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb44-1196"><a href="#cb44-1196" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb44-1197"><a href="#cb44-1197" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb44-1198"><a href="#cb44-1198" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"cis_impact_label"</span><span class="op">,</span></span>
<span id="cb44-1199"><a href="#cb44-1199" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb44-1200"><a href="#cb44-1200" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb44-1201"><a href="#cb44-1201" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"year_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projectYears <span class="op">+</span> <span class="st">" years"</span> }<span class="op">,</span></span>
<span id="cb44-1202"><a href="#cb44-1202" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb44-1203"><a href="#cb44-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1204"><a href="#cb44-1204" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(investmentTemplate<span class="op">,</span> investmentTemplateItems)<span class="sc">}</span><span class="vs">:`</span><span class="op">;</span></span>
<span id="cb44-1205"><a href="#cb44-1205" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-36" data-nodetype="declaration"></div></div></div></section><section id="result-elements" class="level3"><h3 data-anchor-id="result-elements">Result Elements</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1211" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1210"><span id="cb45-1211"><a href="#cb45-1211" aria-hidden="true" tabindex="-1"></a>bigNumbersResults <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb45-1212"><a href="#cb45-1212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb45-1213"><a href="#cb45-1213" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> e <span class="op">=</span> walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span><span class="op">?.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> y)<span class="op">;</span></span>
<span id="cb45-1214"><a href="#cb45-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1215"><a href="#cb45-1215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataPickMetric<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb45-1216"><a href="#cb45-1216" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> value<span class="op">;</span></span>
<span id="cb45-1217"><a href="#cb45-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1218"><a href="#cb45-1218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"irr"</span> <span class="op">&amp;&amp;</span> e<span class="op">?.</span><span class="at">irr</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb45-1219"><a href="#cb45-1219" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">.</span><span class="at">irr</span><span class="op">;</span> <span class="co">// IRR as percentage</span></span>
<span id="cb45-1220"><a href="#cb45-1220" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"mirr"</span> <span class="op">&amp;&amp;</span> e<span class="op">?.</span><span class="at">mirr</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb45-1221"><a href="#cb45-1221" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">.</span><span class="at">mirr</span><span class="op">;</span> <span class="co">// MIRR as percentage</span></span>
<span id="cb45-1222"><a href="#cb45-1222" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (</span>
<span id="cb45-1223"><a href="#cb45-1223" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"npv"</span> <span class="op">&amp;&amp;</span></span>
<span id="cb45-1224"><a href="#cb45-1224" aria-hidden="true" tabindex="-1"></a>      e<span class="op">?.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span></span>
<span id="cb45-1225"><a href="#cb45-1225" aria-hidden="true" tabindex="-1"></a>      e<span class="op">?.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span></span>
<span id="cb45-1226"><a href="#cb45-1226" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb45-1227"><a href="#cb45-1227" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> <span class="op">+</span>(e<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">-</span> e<span class="op">.</span><span class="at">discounted_cost_cum</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="co">// NPV, 1 dp</span></span>
<span id="cb45-1228"><a href="#cb45-1228" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"bcr"</span>) {</span>
<span id="cb45-1229"><a href="#cb45-1229" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> e<span class="op">?.</span><span class="at">discounted_bcr</span><span class="op">;</span></span>
<span id="cb45-1230"><a href="#cb45-1230" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-1231"><a href="#cb45-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1232"><a href="#cb45-1232" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>d<span class="op">,</span> value }<span class="op">;</span></span>
<span id="cb45-1233"><a href="#cb45-1233" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb45-1234"><a href="#cb45-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1235"><a href="#cb45-1235" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb45-1236"><a href="#cb45-1236" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;style&gt;</span></span>
<span id="cb45-1237"><a href="#cb45-1237" aria-hidden="true" tabindex="-1"></a><span class="vs">    .outer-div {</span></span>
<span id="cb45-1238"><a href="#cb45-1238" aria-hidden="true" tabindex="-1"></a><span class="vs">      display: flex;</span></span>
<span id="cb45-1239"><a href="#cb45-1239" aria-hidden="true" tabindex="-1"></a><span class="vs">      gap: 2em;</span></span>
<span id="cb45-1240"><a href="#cb45-1240" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1241"><a href="#cb45-1241" aria-hidden="true" tabindex="-1"></a><span class="vs">    .inner-div {</span></span>
<span id="cb45-1242"><a href="#cb45-1242" aria-hidden="true" tabindex="-1"></a><span class="vs">      width: 30%;</span></span>
<span id="cb45-1243"><a href="#cb45-1243" aria-hidden="true" tabindex="-1"></a><span class="vs">      padding: 80px 30px;</span></span>
<span id="cb45-1244"><a href="#cb45-1244" aria-hidden="true" tabindex="-1"></a><span class="vs">      border: 1px solid #efefef;</span></span>
<span id="cb45-1245"><a href="#cb45-1245" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1246"><a href="#cb45-1246" aria-hidden="true" tabindex="-1"></a><span class="vs">    .label {</span></span>
<span id="cb45-1247"><a href="#cb45-1247" aria-hidden="true" tabindex="-1"></a><span class="vs">      display: block;</span></span>
<span id="cb45-1248"><a href="#cb45-1248" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-weight: 400;</span></span>
<span id="cb45-1249"><a href="#cb45-1249" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-size: 14px;</span></span>
<span id="cb45-1250"><a href="#cb45-1250" aria-hidden="true" tabindex="-1"></a><span class="vs">      text-transform: uppercase;</span></span>
<span id="cb45-1251"><a href="#cb45-1251" aria-hidden="true" tabindex="-1"></a><span class="vs">      color: #666;</span></span>
<span id="cb45-1252"><a href="#cb45-1252" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1253"><a href="#cb45-1253" aria-hidden="true" tabindex="-1"></a><span class="vs">    .value {</span></span>
<span id="cb45-1254"><a href="#cb45-1254" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-weight: bold;</span></span>
<span id="cb45-1255"><a href="#cb45-1255" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-size: 42px;</span></span>
<span id="cb45-1256"><a href="#cb45-1256" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1257"><a href="#cb45-1257" aria-hidden="true" tabindex="-1"></a><span class="vs">    .negative {</span></span>
<span id="cb45-1258"><a href="#cb45-1258" aria-hidden="true" tabindex="-1"></a><span class="vs">      color: #EC5A47;</span></span>
<span id="cb45-1259"><a href="#cb45-1259" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1260"><a href="#cb45-1260" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card {</span></span>
<span id="cb45-1261"><a href="#cb45-1261" aria-hidden="true" tabindex="-1"></a><span class="vs">        position: relative;</span></span>
<span id="cb45-1262"><a href="#cb45-1262" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: inline-block;</span></span>
<span id="cb45-1263"><a href="#cb45-1263" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb45-1264"><a href="#cb45-1264" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 100%;</span></span>
<span id="cb45-1265"><a href="#cb45-1265" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1266"><a href="#cb45-1266" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card .tooltiptext-card {</span></span>
<span id="cb45-1267"><a href="#cb45-1267" aria-hidden="true" tabindex="-1"></a><span class="vs">        position: absolute;</span></span>
<span id="cb45-1268"><a href="#cb45-1268" aria-hidden="true" tabindex="-1"></a><span class="vs">        z-index: 1;</span></span>
<span id="cb45-1269"><a href="#cb45-1269" aria-hidden="true" tabindex="-1"></a><span class="vs">        visibility: hidden;</span></span>
<span id="cb45-1270"><a href="#cb45-1270" aria-hidden="true" tabindex="-1"></a><span class="vs">        left: 0;</span></span>
<span id="cb45-1271"><a href="#cb45-1271" aria-hidden="true" tabindex="-1"></a><span class="vs">        bottom: 90%;</span></span>
<span id="cb45-1272"><a href="#cb45-1272" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #efefef;</span></span>
<span id="cb45-1273"><a href="#cb45-1273" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #333;</span></span>
<span id="cb45-1274"><a href="#cb45-1274" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 14px 20px;</span></span>
<span id="cb45-1275"><a href="#cb45-1275" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb45-1276"><a href="#cb45-1276" aria-hidden="true" tabindex="-1"></a><span class="vs">        line-height: 1.6;</span></span>
<span id="cb45-1277"><a href="#cb45-1277" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: left;</span></span>
<span id="cb45-1278"><a href="#cb45-1278" aria-hidden="true" tabindex="-1"></a><span class="vs">        opacity: 0;</span></span>
<span id="cb45-1279"><a href="#cb45-1279" aria-hidden="true" tabindex="-1"></a><span class="vs">        transition: opacity 0.3s;</span></span>
<span id="cb45-1280"><a href="#cb45-1280" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1281"><a href="#cb45-1281" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-card:hover .tooltiptext-card {</span></span>
<span id="cb45-1282"><a href="#cb45-1282" aria-hidden="true" tabindex="-1"></a><span class="vs">        visibility: visible;</span></span>
<span id="cb45-1283"><a href="#cb45-1283" aria-hidden="true" tabindex="-1"></a><span class="vs">        opacity: 1;</span></span>
<span id="cb45-1284"><a href="#cb45-1284" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: default;</span></span>
<span id="cb45-1285"><a href="#cb45-1285" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb45-1286"><a href="#cb45-1286" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/style&gt;</span></span>
<span id="cb45-1287"><a href="#cb45-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1288"><a href="#cb45-1288" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;body&gt;</span></span>
<span id="cb45-1289"><a href="#cb45-1289" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="outer-div"&gt;</span></span>
<span id="cb45-1290"><a href="#cb45-1290" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>data<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb45-1291"><a href="#cb45-1291" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div class="inner-div"&gt;</span></span>
<span id="cb45-1292"><a href="#cb45-1292" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;span class="tooltip-card"&gt;</span></span>
<span id="cb45-1293"><a href="#cb45-1293" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="tooltiptext-card"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">tooltip</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb45-1294"><a href="#cb45-1294" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="value </span><span class="sc">${</span>d<span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"negative"</span> <span class="op">:</span> <span class="st">""</span><span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span></span>
<span id="cb45-1295"><a href="#cb45-1295" aria-hidden="true" tabindex="-1"></a>              d<span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> d<span class="op">.</span><span class="fu">yFormat</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">:</span> <span class="st">"---"</span></span>
<span id="cb45-1296"><a href="#cb45-1296" aria-hidden="true" tabindex="-1"></a>            <span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb45-1297"><a href="#cb45-1297" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class="label"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">labelFull</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb45-1298"><a href="#cb45-1298" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/span&gt;</span></span>
<span id="cb45-1299"><a href="#cb45-1299" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb45-1300"><a href="#cb45-1300" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">}</span></span>
<span id="cb45-1301"><a href="#cb45-1301" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb45-1302"><a href="#cb45-1302" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/body&gt;`</span><span class="op">;</span></span>
<span id="cb45-1303"><a href="#cb45-1303" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-37" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1307" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1306"><span id="cb46-1307"><a href="#cb46-1307" aria-hidden="true" tabindex="-1"></a>resultTable <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb46-1308"><a href="#cb46-1308" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fmtUSD <span class="op">=</span> <span class="fu">formatUSD</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })<span class="op">;</span></span>
<span id="cb46-1309"><a href="#cb46-1309" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedYear <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb46-1310"><a href="#cb46-1310" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> enriched <span class="op">=</span> (walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span> <span class="op">??</span> [])<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb46-1311"><a href="#cb46-1311" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">&lt;=</span> selectedYear<span class="op">,</span></span>
<span id="cb46-1312"><a href="#cb46-1312" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb46-1313"><a href="#cb46-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1314"><a href="#cb46-1314" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tableHeaders <span class="op">=</span></span>
<span id="cb46-1315"><a href="#cb46-1315" aria-hidden="true" tabindex="-1"></a>    nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">exploreIndicators</span><span class="op">.</span><span class="at">tableHeaders</span><span class="op">;</span></span>
<span id="cb46-1316"><a href="#cb46-1316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> headerNames <span class="op">=</span> [</span>
<span id="cb46-1317"><a href="#cb46-1317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">year</span>)<span class="op">,</span></span>
<span id="cb46-1318"><a href="#cb46-1318" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">benefit</span>)<span class="op">,</span></span>
<span id="cb46-1319"><a href="#cb46-1319" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">cost</span>)<span class="op">,</span></span>
<span id="cb46-1320"><a href="#cb46-1320" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">cashflow</span>)<span class="op">,</span></span>
<span id="cb46-1321"><a href="#cb46-1321" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedBenefitCum</span>)<span class="op">,</span></span>
<span id="cb46-1322"><a href="#cb46-1322" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedCostCum</span>)<span class="op">,</span></span>
<span id="cb46-1323"><a href="#cb46-1323" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedNpvCum</span>)<span class="op">,</span></span>
<span id="cb46-1324"><a href="#cb46-1324" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">discountedBcr</span>)<span class="op">,</span></span>
<span id="cb46-1325"><a href="#cb46-1325" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">irr</span>)<span class="op">,</span></span>
<span id="cb46-1326"><a href="#cb46-1326" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(tableHeaders<span class="op">.</span><span class="at">mirr</span>)<span class="op">,</span></span>
<span id="cb46-1327"><a href="#cb46-1327" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb46-1328"><a href="#cb46-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1329"><a href="#cb46-1329" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb46-1330"><a href="#cb46-1330" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;style&gt;</span></span>
<span id="cb46-1331"><a href="#cb46-1331" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table {</span></span>
<span id="cb46-1332"><a href="#cb46-1332" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-family: sans-serif;</span></span>
<span id="cb46-1333"><a href="#cb46-1333" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-collapse: collapse;</span></span>
<span id="cb46-1334"><a href="#cb46-1334" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 13.75px;</span></span>
<span id="cb46-1335"><a href="#cb46-1335" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-top: 1em;</span></span>
<span id="cb46-1336"><a href="#cb46-1336" aria-hidden="true" tabindex="-1"></a><span class="vs">        min-width: 100%;</span></span>
<span id="cb46-1337"><a href="#cb46-1337" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb46-1338"><a href="#cb46-1338" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table th, .econ-table td {</span></span>
<span id="cb46-1339"><a href="#cb46-1339" aria-hidden="true" tabindex="-1"></a><span class="vs">        border: 1px solid #ddd;</span></span>
<span id="cb46-1340"><a href="#cb46-1340" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 6px 10px;</span></span>
<span id="cb46-1341"><a href="#cb46-1341" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: right;</span></span>
<span id="cb46-1342"><a href="#cb46-1342" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb46-1343"><a href="#cb46-1343" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table th {</span></span>
<span id="cb46-1344"><a href="#cb46-1344" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #f4f4f4;</span></span>
<span id="cb46-1345"><a href="#cb46-1345" aria-hidden="true" tabindex="-1"></a><span class="vs">        white-space: normal;</span></span>
<span id="cb46-1346"><a href="#cb46-1346" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb46-1347"><a href="#cb46-1347" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb46-1348"><a href="#cb46-1348" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table td.year-col {</span></span>
<span id="cb46-1349"><a href="#cb46-1349" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb46-1350"><a href="#cb46-1350" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: bold;</span></span>
<span id="cb46-1351"><a href="#cb46-1351" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb46-1352"><a href="#cb46-1352" aria-hidden="true" tabindex="-1"></a><span class="vs">      .econ-table tr.final-row td {</span></span>
<span id="cb46-1353"><a href="#cb46-1353" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: bold;</span></span>
<span id="cb46-1354"><a href="#cb46-1354" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #f1f1f1;</span></span>
<span id="cb46-1355"><a href="#cb46-1355" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb46-1356"><a href="#cb46-1356" aria-hidden="true" tabindex="-1"></a><span class="vs">      .table-container {</span></span>
<span id="cb46-1357"><a href="#cb46-1357" aria-hidden="true" tabindex="-1"></a><span class="vs">        overflow-x: auto;</span></span>
<span id="cb46-1358"><a href="#cb46-1358" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: block;</span></span>
<span id="cb46-1359"><a href="#cb46-1359" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding-bottom: 4px;</span></span>
<span id="cb46-1360"><a href="#cb46-1360" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb46-1361"><a href="#cb46-1361" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/style&gt;</span></span>
<span id="cb46-1362"><a href="#cb46-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1363"><a href="#cb46-1363" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="table-container"&gt;</span></span>
<span id="cb46-1364"><a href="#cb46-1364" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;table class="econ-table"&gt;</span></span>
<span id="cb46-1365"><a href="#cb46-1365" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;thead&gt;</span></span>
<span id="cb46-1366"><a href="#cb46-1366" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;tr&gt;</span></span>
<span id="cb46-1367"><a href="#cb46-1367" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">${</span>headerNames<span class="op">.</span><span class="fu">map</span>((h) <span class="kw">=&gt;</span> <span class="fu">html</span><span class="vs">`&lt;th title="</span><span class="sc">${</span>h<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>h<span class="sc">}</span><span class="vs">&lt;/th&gt;`</span>)<span class="sc">}</span></span>
<span id="cb46-1368"><a href="#cb46-1368" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/tr&gt;</span></span>
<span id="cb46-1369"><a href="#cb46-1369" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/thead&gt;</span></span>
<span id="cb46-1370"><a href="#cb46-1370" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;tbody&gt;</span></span>
<span id="cb46-1371"><a href="#cb46-1371" aria-hidden="true" tabindex="-1"></a><span class="vs">          </span><span class="sc">${</span>enriched<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1372"><a href="#cb46-1372" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> isFinal <span class="op">=</span> i <span class="op">===</span> enriched<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb46-1373"><a href="#cb46-1373" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> npv_i <span class="op">=</span></span>
<span id="cb46-1374"><a href="#cb46-1374" aria-hidden="true" tabindex="-1"></a>              d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span></span>
<span id="cb46-1375"><a href="#cb46-1375" aria-hidden="true" tabindex="-1"></a>                <span class="op">?</span> d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">-</span> d<span class="op">.</span><span class="at">discounted_cost_cum</span></span>
<span id="cb46-1376"><a href="#cb46-1376" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb46-1377"><a href="#cb46-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1378"><a href="#cb46-1378" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;tr class=</span><span class="sc">${</span>isFinal <span class="op">?</span> <span class="st">"final-row"</span> <span class="op">:</span> <span class="st">""</span><span class="sc">}</span><span class="vs">&gt;</span></span>
<span id="cb46-1379"><a href="#cb46-1379" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td class="year-col"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">year</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1380"><a href="#cb46-1380" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">project_benefit</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">project_benefit</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1381"><a href="#cb46-1381" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">cost</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">cost</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1382"><a href="#cb46-1382" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">cashflow</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">cashflow</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1383"><a href="#cb46-1383" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_benefit_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">discounted_benefit_cum</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1384"><a href="#cb46-1384" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_cost_cum</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(d<span class="op">.</span><span class="at">discounted_cost_cum</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1385"><a href="#cb46-1385" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>npv_i <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">fmtUSD</span>(npv_i) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1386"><a href="#cb46-1386" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">discounted_bcr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> d<span class="op">.</span><span class="at">discounted_bcr</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1387"><a href="#cb46-1387" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">irr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>(d<span class="op">.</span><span class="at">irr</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">%`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1388"><a href="#cb46-1388" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">mirr</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>(d<span class="op">.</span><span class="at">mirr</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">%`</span> <span class="op">:</span> <span class="st">"—"</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb46-1389"><a href="#cb46-1389" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/tr&gt;`</span><span class="op">;</span></span>
<span id="cb46-1390"><a href="#cb46-1390" aria-hidden="true" tabindex="-1"></a>          })<span class="sc">}</span></span>
<span id="cb46-1391"><a href="#cb46-1391" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/tbody&gt;</span></span>
<span id="cb46-1392"><a href="#cb46-1392" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/table&gt;</span></span>
<span id="cb46-1393"><a href="#cb46-1393" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb46-1394"><a href="#cb46-1394" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb46-1395"><a href="#cb46-1395" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-38" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1399" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1398"><span id="cb47-1399"><a href="#cb47-1399" aria-hidden="true" tabindex="-1"></a>resultPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb47-1400"><a href="#cb47-1400" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectYearCutoff <span class="op">=</span> walkthroughSelections<span class="op">.</span><span class="at">project_years</span><span class="op">;</span></span>
<span id="cb47-1401"><a href="#cb47-1401" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selector <span class="op">=</span> pickMetricWalkthrough<span class="op">;</span></span>
<span id="cb47-1402"><a href="#cb47-1402" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotData <span class="op">=</span> walkthroughEconomicIndicators<span class="op">?.</span><span class="at">enriched</span> <span class="op">??</span> []<span class="op">;</span></span>
<span id="cb47-1403"><a href="#cb47-1403" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uncertaintyYearly <span class="op">=</span> uncertainty<span class="op">?.</span><span class="at">yearly</span> <span class="op">??</span> []<span class="op">;</span></span>
<span id="cb47-1404"><a href="#cb47-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1405"><a href="#cb47-1405" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Always include all years for consistent x-axis</span></span>
<span id="cb47-1406"><a href="#cb47-1406" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fullYears <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> projectYears <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// 0 to 8 inclusive</span></span>
<span id="cb47-1407"><a href="#cb47-1407" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> completePlotData <span class="op">=</span> fullYears<span class="op">.</span><span class="fu">map</span>((y) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1408"><a href="#cb47-1408" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> row <span class="op">=</span> plotData<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> y)<span class="op">;</span></span>
<span id="cb47-1409"><a href="#cb47-1409" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> row <span class="op">??</span> { <span class="dt">year</span><span class="op">:</span> y }<span class="op">;</span></span>
<span id="cb47-1410"><a href="#cb47-1410" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb47-1411"><a href="#cb47-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1412"><a href="#cb47-1412" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bandData <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb47-1413"><a href="#cb47-1413" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> metricKey <span class="op">=</span> selector<span class="op">.</span><span class="at">key</span><span class="op">;</span></span>
<span id="cb47-1414"><a href="#cb47-1414" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fullYears</span>
<span id="cb47-1415"><a href="#cb47-1415" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span>((year) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1416"><a href="#cb47-1416" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> row <span class="op">=</span> uncertaintyYearly<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> year)<span class="op">;</span></span>
<span id="cb47-1417"><a href="#cb47-1417" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> low <span class="op">=</span> row<span class="op">?.</span>[metricKey]<span class="op">?.</span><span class="at">p10</span><span class="op">;</span></span>
<span id="cb47-1418"><a href="#cb47-1418" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> high <span class="op">=</span> row<span class="op">?.</span>[metricKey]<span class="op">?.</span><span class="at">p90</span><span class="op">;</span></span>
<span id="cb47-1419"><a href="#cb47-1419" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(low) <span class="op">||</span> <span class="op">!</span><span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(high)) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb47-1420"><a href="#cb47-1420" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> { year<span class="op">,</span> low<span class="op">,</span> high }<span class="op">;</span></span>
<span id="cb47-1421"><a href="#cb47-1421" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb47-1422"><a href="#cb47-1422" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d <span class="op">!=</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb47-1423"><a href="#cb47-1423" aria-hidden="true" tabindex="-1"></a>  })()<span class="op">;</span></span>
<span id="cb47-1424"><a href="#cb47-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1425"><a href="#cb47-1425" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ruleYValue <span class="op">=</span> selector<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"bcr"</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb47-1426"><a href="#cb47-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1427"><a href="#cb47-1427" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb47-1428"><a href="#cb47-1428" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb47-1429"><a href="#cb47-1429" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb47-1430"><a href="#cb47-1430" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inset</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb47-1431"><a href="#cb47-1431" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb47-1432"><a href="#cb47-1432" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb47-1433"><a href="#cb47-1433" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">investmentReturns</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">exploreIndicators</span><span class="op">.</span><span class="at">projectYear</span><span class="op">,</span></span>
<span id="cb47-1434"><a href="#cb47-1434" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb47-1435"><a href="#cb47-1435" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> fullYears<span class="op">,</span></span>
<span id="cb47-1436"><a href="#cb47-1436" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> <span class="st">"d"</span><span class="op">,</span></span>
<span id="cb47-1437"><a href="#cb47-1437" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb47-1438"><a href="#cb47-1438" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelArrow</span><span class="op">:</span> <span class="st">"none"</span><span class="op">,</span></span>
<span id="cb47-1439"><a href="#cb47-1439" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb47-1440"><a href="#cb47-1440" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb47-1441"><a href="#cb47-1441" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb47-1442"><a href="#cb47-1442" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb47-1443"><a href="#cb47-1443" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb47-1444"><a href="#cb47-1444" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb47-1445"><a href="#cb47-1445" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>({</span>
<span id="cb47-1446"><a href="#cb47-1446" aria-hidden="true" tabindex="-1"></a>        <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb47-1447"><a href="#cb47-1447" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb47-1448"><a href="#cb47-1448" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickFormat</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb47-1449"><a href="#cb47-1449" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb47-1450"><a href="#cb47-1450" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1451"><a href="#cb47-1451" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> d <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"#EC5A47"</span><span class="op">;</span></span>
<span id="cb47-1452"><a href="#cb47-1452" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb47-1453"><a href="#cb47-1453" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb47-1454"><a href="#cb47-1454" aria-hidden="true" tabindex="-1"></a>      <span class="co">// horizontal reference line</span></span>
<span id="cb47-1455"><a href="#cb47-1455" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([ruleYValue]<span class="op">,</span> {</span>
<span id="cb47-1456"><a href="#cb47-1456" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb47-1457"><a href="#cb47-1457" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeDasharray</span><span class="op">:</span> [<span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb47-1458"><a href="#cb47-1458" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb47-1459"><a href="#cb47-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1460"><a href="#cb47-1460" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">areaY</span>(bandData<span class="op">,</span> {</span>
<span id="cb47-1461"><a href="#cb47-1461" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb47-1462"><a href="#cb47-1462" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> <span class="st">"low"</span><span class="op">,</span></span>
<span id="cb47-1463"><a href="#cb47-1463" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> <span class="st">"high"</span><span class="op">,</span></span>
<span id="cb47-1464"><a href="#cb47-1464" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"#2c7fb8"</span><span class="op">,</span></span>
<span id="cb47-1465"><a href="#cb47-1465" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.16</span><span class="op">,</span></span>
<span id="cb47-1466"><a href="#cb47-1466" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb47-1467"><a href="#cb47-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1468"><a href="#cb47-1468" aria-hidden="true" tabindex="-1"></a>      <span class="co">// line</span></span>
<span id="cb47-1469"><a href="#cb47-1469" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">line</span>(completePlotData<span class="op">,</span> {</span>
<span id="cb47-1470"><a href="#cb47-1470" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb47-1471"><a href="#cb47-1471" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb47-1472"><a href="#cb47-1472" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb47-1473"><a href="#cb47-1473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb47-1474"><a href="#cb47-1474" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb47-1475"><a href="#cb47-1475" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb47-1476"><a href="#cb47-1476" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb47-1477"><a href="#cb47-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1478"><a href="#cb47-1478" aria-hidden="true" tabindex="-1"></a>      <span class="co">// dots</span></span>
<span id="cb47-1479"><a href="#cb47-1479" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(completePlotData<span class="op">,</span> {</span>
<span id="cb47-1480"><a href="#cb47-1480" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb47-1481"><a href="#cb47-1481" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb47-1482"><a href="#cb47-1482" aria-hidden="true" tabindex="-1"></a>        <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb47-1483"><a href="#cb47-1483" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb47-1484"><a href="#cb47-1484" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb47-1485"><a href="#cb47-1485" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb47-1486"><a href="#cb47-1486" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> {</span>
<span id="cb47-1487"><a href="#cb47-1487" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb47-1488"><a href="#cb47-1488" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb47-1489"><a href="#cb47-1489" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">yFormat</span><span class="op">,</span></span>
<span id="cb47-1490"><a href="#cb47-1490" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb47-1491"><a href="#cb47-1491" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb47-1492"><a href="#cb47-1492" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb47-1493"><a href="#cb47-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1494"><a href="#cb47-1494" aria-hidden="true" tabindex="-1"></a>      <span class="co">// highlight selected year</span></span>
<span id="cb47-1495"><a href="#cb47-1495" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb47-1496"><a href="#cb47-1496" aria-hidden="true" tabindex="-1"></a>        completePlotData<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> projectYearCutoff)<span class="op">,</span></span>
<span id="cb47-1497"><a href="#cb47-1497" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb47-1498"><a href="#cb47-1498" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span></span>
<span id="cb47-1499"><a href="#cb47-1499" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> selector<span class="op">.</span><span class="at">columnName</span><span class="op">,</span></span>
<span id="cb47-1500"><a href="#cb47-1500" aria-hidden="true" tabindex="-1"></a>          <span class="dt">r</span><span class="op">:</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb47-1501"><a href="#cb47-1501" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb47-1502"><a href="#cb47-1502" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d[selector<span class="op">.</span><span class="at">columnName</span>] <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"#333"</span> <span class="op">:</span> <span class="st">"#EC5A47"</span>)<span class="op">,</span></span>
<span id="cb47-1503"><a href="#cb47-1503" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb47-1504"><a href="#cb47-1504" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb47-1505"><a href="#cb47-1505" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb47-1506"><a href="#cb47-1506" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb47-1507"><a href="#cb47-1507" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb47-1508"><a href="#cb47-1508" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-39" data-nodetype="declaration"></div></div></div></section></section><section id="data-analysis-and-processing" class="level2"><h2 data-anchor-id="data-analysis-and-processing">Data Analysis and Processing</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1514" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1513"><span id="cb48-1514"><a href="#cb48-1514" aria-hidden="true" tabindex="-1"></a>admin0_names <span class="op">=</span> {</span>
<span id="cb48-1515"><a href="#cb48-1515" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isoSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_country)<span class="op">;</span></span>
<span id="cb48-1516"><a href="#cb48-1516" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> countries</span>
<span id="cb48-1517"><a href="#cb48-1517" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> isoSet<span class="op">.</span><span class="fu">has</span>(d<span class="op">.</span><span class="at">iso3c</span>))</span>
<span id="cb48-1518"><a href="#cb48-1518" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span>)<span class="op">;</span></span>
<span id="cb48-1519"><a href="#cb48-1519" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-40" data-nodetype="declaration"></div></div></div><section id="cv-data" class="level3"><h3 data-anchor-id="cv-data">CV Data</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1525" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1524"><span id="cb49-1525"><a href="#cb49-1525" aria-hidden="true" tabindex="-1"></a><span class="co">// Module Imports for the calculation of ROI data</span></span>
<span id="cb49-1526"><a href="#cb49-1526" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb49-1527"><a href="#cb49-1527" aria-hidden="true" tabindex="-1"></a>  avlossCalc<span class="op">,</span></span>
<span id="cb49-1528"><a href="#cb49-1528" aria-hidden="true" tabindex="-1"></a>  avlossCalcUncertainty<span class="op">,</span></span>
<span id="cb49-1529"><a href="#cb49-1529" aria-hidden="true" tabindex="-1"></a>  calcMIRR<span class="op">,</span></span>
<span id="cb49-1530"><a href="#cb49-1530" aria-hidden="true" tabindex="-1"></a>  calcIRR<span class="op">,</span></span>
<span id="cb49-1531"><a href="#cb49-1531" aria-hidden="true" tabindex="-1"></a>  npvDiscreteCumulative<span class="op">,</span></span>
<span id="cb49-1532"><a href="#cb49-1532" aria-hidden="true" tabindex="-1"></a>  runSimulationFromCashflowRows<span class="op">,</span></span>
<span id="cb49-1533"><a href="#cb49-1533" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"/notebooks/roi/roi_tools.js"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-41" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1538" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1537"><span id="cb50-1538"><a href="#cb50-1538" aria-hidden="true" tabindex="-1"></a>mutable cv_result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb50-1539"><a href="#cb50-1539" aria-hidden="true" tabindex="-1"></a>mutable cv_cache_key <span class="op">=</span> <span class="st">''</span><span class="op">;</span></span>
<span id="cb50-1540"><a href="#cb50-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1541"><a href="#cb50-1541" aria-hidden="true" tabindex="-1"></a>calcCV <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb50-1542"><a href="#cb50-1542" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cis_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb50-1543"><a href="#cb50-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1544"><a href="#cb50-1544" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cache_key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>[<span class="op">...</span>admin0_names]<span class="op">.</span><span class="fu">sort</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>[<span class="op">...</span>select_crop]<span class="op">.</span><span class="fu">sort</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>cis_impact<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb50-1545"><a href="#cb50-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1546"><a href="#cb50-1546" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cv_cache_key <span class="op">===</span> cache_key) {</span>
<span id="cb50-1547"><a href="#cb50-1547" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Skipped cv run as inputs the same'</span>)<span class="op">;</span></span>
<span id="cb50-1548"><a href="#cb50-1548" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cv_result<span class="op">;</span></span>
<span id="cb50-1549"><a href="#cb50-1549" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-1550"><a href="#cb50-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1551"><a href="#cb50-1551" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Running the cv analysis as inputs changed'</span>)</span>
<span id="cb50-1552"><a href="#cb50-1552" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb50-1553"><a href="#cb50-1553" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb50-1554"><a href="#cb50-1554" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM cv</span></span>
<span id="cb50-1555"><a href="#cb50-1555" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE crop in ('</span><span class="sc">${</span>select_crop<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb50-1556"><a href="#cb50-1556" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND admin0_name in ('</span><span class="sc">${</span>admin0_names<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">') -- This needs the a0_name rather than iso3</span></span>
<span id="cb50-1557"><a href="#cb50-1557" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb50-1558"><a href="#cb50-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1559"><a href="#cb50-1559" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_monteCarlo <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>(</span>
<span id="cb50-1560"><a href="#cb50-1560" aria-hidden="true" tabindex="-1"></a>    cv_data<span class="op">.</span><span class="fu">map</span>(<span class="kw">async</span> ({ crop<span class="op">,</span> admin0_name<span class="op">,</span> cv }) <span class="kw">=&gt;</span> {</span>
<span id="cb50-1561"><a href="#cb50-1561" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> av <span class="op">=</span> <span class="cf">await</span> <span class="fu">avlossCalc</span>(cv<span class="op">,</span> cis_impact)<span class="op">;</span></span>
<span id="cb50-1562"><a href="#cb50-1562" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> avloss <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="bu">Number</span>(av<span class="op">.</span><span class="at">toFixed</span><span class="op">?.</span>(<span class="dv">4</span>) <span class="op">??</span> av))<span class="op">;</span></span>
<span id="cb50-1563"><a href="#cb50-1563" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { admin0_name<span class="op">,</span> crop<span class="op">,</span> cv<span class="op">,</span> cis_impact<span class="op">,</span> avloss }<span class="op">;</span></span>
<span id="cb50-1564"><a href="#cb50-1564" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb50-1565"><a href="#cb50-1565" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb50-1566"><a href="#cb50-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1567"><a href="#cb50-1567" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cv_index <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb50-1568"><a href="#cb50-1568" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> { admin0_name<span class="op">,</span> crop<span class="op">,</span> avloss } <span class="kw">of</span> cv_monteCarlo) {</span>
<span id="cb50-1569"><a href="#cb50-1569" aria-hidden="true" tabindex="-1"></a>    cv_index<span class="op">.</span><span class="fu">set</span>(<span class="vs">`</span><span class="sc">${</span>admin0_name<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>crop<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> avloss)<span class="op">;</span></span>
<span id="cb50-1570"><a href="#cb50-1570" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-1571"><a href="#cb50-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-1572"><a href="#cb50-1572" aria-hidden="true" tabindex="-1"></a>  mutable cv_result <span class="op">=</span> cv_index</span>
<span id="cb50-1573"><a href="#cb50-1573" aria-hidden="true" tabindex="-1"></a>  mutable cv_cache_key <span class="op">=</span> cache_key</span>
<span id="cb50-1574"><a href="#cb50-1574" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> cv_index</span>
<span id="cb50-1575"><a href="#cb50-1575" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-42-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-42-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-42-3" data-nodetype="declaration"></div></div></div></div></section><section id="other-roi-x-exposure-variables" class="level3"><h3 data-anchor-id="other-roi-x-exposure-variables">Other ROI X Exposure Variables</h3><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1580" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1579"><span id="cb51-1580"><a href="#cb51-1580" aria-hidden="true" tabindex="-1"></a><span class="co">// getExposureData = async (crops, countries) =&gt; {</span></span>
<span id="cb51-1581"><a href="#cb51-1581" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">NOTE</span><span class="co">: Making this a dataset rather than a function so it only re-runs when crop or country change.</span></span>
<span id="cb51-1582"><a href="#cb51-1582" aria-hidden="true" tabindex="-1"></a><span class="co">// Defaulting to all admin 1 data as all admin regions are selected by defualt and this</span></span>
<span id="cb51-1583"><a href="#cb51-1583" aria-hidden="true" tabindex="-1"></a><span class="co">// will prevent having to have users re-query the datasets when changing regions in a county.</span></span>
<span id="cb51-1584"><a href="#cb51-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1585"><a href="#cb51-1585" aria-hidden="true" tabindex="-1"></a>exposure_data <span class="op">=</span> {</span>
<span id="cb51-1586"><a href="#cb51-1586" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> crops <span class="op">=</span> select_crop<span class="op">;</span></span>
<span id="cb51-1587"><a href="#cb51-1587" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> countries <span class="op">=</span> select_country<span class="op">;</span></span>
<span id="cb51-1588"><a href="#cb51-1588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb51-1589"><a href="#cb51-1589" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb51-1590"><a href="#cb51-1590" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM exposure</span></span>
<span id="cb51-1591"><a href="#cb51-1591" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE crop in ('</span><span class="sc">${</span>crops<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb51-1592"><a href="#cb51-1592" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND iso3 in ('</span><span class="sc">${</span>countries<span class="op">.</span><span class="fu">join</span>(<span class="st">"', '"</span>)<span class="sc">}</span><span class="vs">')</span></span>
<span id="cb51-1593"><a href="#cb51-1593" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- POSSIBLY add admin1 name filter, but defaults to full country, so maybe bigger query is better.</span></span>
<span id="cb51-1594"><a href="#cb51-1594" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span>)<span class="op">;</span></span>
<span id="cb51-1595"><a href="#cb51-1595" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb51-1596"><a href="#cb51-1596" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-43" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1600" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1599"><span id="cb52-1600"><a href="#cb52-1600" aria-hidden="true" tabindex="-1"></a>crop_adoption <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb52-1601"><a href="#cb52-1601" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Globals from the notebook</span></span>
<span id="cb52-1602"><a href="#cb52-1602" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adoption <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb52-1603"><a href="#cb52-1603" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> projectYears<span class="op">;</span></span>
<span id="cb52-1604"><a href="#cb52-1604" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> prod_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb52-1605"><a href="#cb52-1605" aria-hidden="true" tabindex="-1"></a>  <span class="co">// let data = await getExposureData(select_crop, select_country);</span></span>
<span id="cb52-1606"><a href="#cb52-1606" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> exposure_data<span class="op">;</span></span>
<span id="cb52-1607"><a href="#cb52-1607" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> result <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb52-1608"><a href="#cb52-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1609"><a href="#cb52-1609" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> row <span class="kw">of</span> data) {</span>
<span id="cb52-1610"><a href="#cb52-1610" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> value <span class="op">=</span> row<span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb52-1611"><a href="#cb52-1611" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xPrev <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb52-1612"><a href="#cb52-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1613"><a href="#cb52-1613" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> years<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb52-1614"><a href="#cb52-1614" aria-hidden="true" tabindex="-1"></a>      <span class="co">// cumulative adoption</span></span>
<span id="cb52-1615"><a href="#cb52-1615" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> x<span class="op">;</span></span>
<span id="cb52-1616"><a href="#cb52-1616" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb52-1617"><a href="#cb52-1617" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(value <span class="op">*</span> adoption <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb52-1618"><a href="#cb52-1618" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb52-1619"><a href="#cb52-1619" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((value <span class="op">-</span> xPrev) <span class="op">*</span> adoption <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> xPrev<span class="op">;</span></span>
<span id="cb52-1620"><a href="#cb52-1620" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb52-1621"><a href="#cb52-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1622"><a href="#cb52-1622" aria-hidden="true" tabindex="-1"></a>      xPrev <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb52-1623"><a href="#cb52-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1624"><a href="#cb52-1624" aria-hidden="true" tabindex="-1"></a>      <span class="co">// push a long-form row</span></span>
<span id="cb52-1625"><a href="#cb52-1625" aria-hidden="true" tabindex="-1"></a>      result<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb52-1626"><a href="#cb52-1626" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin0_name</span><span class="op">:</span> row<span class="op">.</span><span class="at">admin0_name</span><span class="op">,</span></span>
<span id="cb52-1627"><a href="#cb52-1627" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin1_name</span><span class="op">:</span> row<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span></span>
<span id="cb52-1628"><a href="#cb52-1628" aria-hidden="true" tabindex="-1"></a>        <span class="dt">iso3c</span><span class="op">:</span> row<span class="op">.</span><span class="at">iso3</span><span class="op">,</span></span>
<span id="cb52-1629"><a href="#cb52-1629" aria-hidden="true" tabindex="-1"></a>        <span class="dt">crop</span><span class="op">:</span> row<span class="op">.</span><span class="at">crop</span><span class="op">,</span></span>
<span id="cb52-1630"><a href="#cb52-1630" aria-hidden="true" tabindex="-1"></a>        <span class="dt">exposure</span><span class="op">:</span> row<span class="op">.</span><span class="at">exposure</span><span class="op">,</span></span>
<span id="cb52-1631"><a href="#cb52-1631" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> row<span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb52-1632"><a href="#cb52-1632" aria-hidden="true" tabindex="-1"></a>        <span class="dt">adoption</span><span class="op">:</span> adoption<span class="op">,</span></span>
<span id="cb52-1633"><a href="#cb52-1633" aria-hidden="true" tabindex="-1"></a>        <span class="dt">prod_impact</span><span class="op">:</span> prod_impact<span class="op">,</span></span>
<span id="cb52-1634"><a href="#cb52-1634" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year_char</span><span class="op">:</span> <span class="vs">`y</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb52-1635"><a href="#cb52-1635" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> i<span class="op">,</span></span>
<span id="cb52-1636"><a href="#cb52-1636" aria-hidden="true" tabindex="-1"></a>        <span class="dt">result</span><span class="op">:</span> x<span class="op">,</span></span>
<span id="cb52-1637"><a href="#cb52-1637" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb52-1638"><a href="#cb52-1638" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-1639"><a href="#cb52-1639" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-1640"><a href="#cb52-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1641"><a href="#cb52-1641" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">.</span><span class="fu">map</span>((row) <span class="kw">=&gt;</span> {</span>
<span id="cb52-1642"><a href="#cb52-1642" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result_w_impact <span class="op">=</span></span>
<span id="cb52-1643"><a href="#cb52-1643" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(row<span class="op">.</span><span class="at">result</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> (row<span class="op">.</span><span class="at">prod_impact</span> <span class="op">??</span> <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb52-1644"><a href="#cb52-1644" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_impact <span class="op">=</span></span>
<span id="cb52-1645"><a href="#cb52-1645" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((result_w_impact <span class="op">-</span> row<span class="op">.</span><span class="at">result</span>) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb52-1646"><a href="#cb52-1646" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>row<span class="op">,</span> result_w_impact<span class="op">,</span> marginal_impact }<span class="op">;</span></span>
<span id="cb52-1647"><a href="#cb52-1647" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb52-1648"><a href="#cb52-1648" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb52-1649"><a href="#cb52-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1650"><a href="#cb52-1650" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">NOTE</span><span class="co">: QAQC RESULTS:</span></span>
<span id="cb52-1651"><a href="#cb52-1651" aria-hidden="true" tabindex="-1"></a><span class="co">// 1 region &amp; crop: PERFECT - This output matches the R script output exactly</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-44" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="1655" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1654"><span id="cb53-1655"><a href="#cb53-1655" aria-hidden="true" tabindex="-1"></a>roiResults <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb53-1656"><a href="#cb53-1656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> index <span class="op">=</span> <span class="cf">await</span> <span class="fu">calcCV</span>()<span class="op">;</span></span>
<span id="cb53-1657"><a href="#cb53-1657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">crop_adoption</span>()<span class="op">;</span></span>
<span id="cb53-1658"><a href="#cb53-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1659"><a href="#cb53-1659" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> withImpact <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>((row) <span class="kw">=&gt;</span> {</span>
<span id="cb53-1660"><a href="#cb53-1660" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>row<span class="op">.</span><span class="at">admin0_name</span><span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>row<span class="op">.</span><span class="at">crop</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb53-1661"><a href="#cb53-1661" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> avloss <span class="op">=</span> index<span class="op">.</span><span class="fu">get</span>(key) <span class="op">??</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// default to 0 if missing</span></span>
<span id="cb53-1662"><a href="#cb53-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1663"><a href="#cb53-1663" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result_w_impact_cis <span class="op">=</span></span>
<span id="cb53-1664"><a href="#cb53-1664" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(row<span class="op">.</span><span class="at">result_w_impact</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> avloss) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb53-1665"><a href="#cb53-1665" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_cis <span class="op">=</span></span>
<span id="cb53-1666"><a href="#cb53-1666" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((result_w_impact_cis <span class="op">-</span> row<span class="op">.</span><span class="at">result_w_impact</span>) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb53-1667"><a href="#cb53-1667" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginal_impact_cis <span class="op">=</span></span>
<span id="cb53-1668"><a href="#cb53-1668" aria-hidden="true" tabindex="-1"></a>      (marginal_cis <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> (row<span class="op">.</span><span class="at">marginal_impact</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb53-1669"><a href="#cb53-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1670"><a href="#cb53-1670" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb53-1671"><a href="#cb53-1671" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>row<span class="op">,</span></span>
<span id="cb53-1672"><a href="#cb53-1672" aria-hidden="true" tabindex="-1"></a>      avloss<span class="op">,</span></span>
<span id="cb53-1673"><a href="#cb53-1673" aria-hidden="true" tabindex="-1"></a>      result_w_impact_cis<span class="op">,</span></span>
<span id="cb53-1674"><a href="#cb53-1674" aria-hidden="true" tabindex="-1"></a>      marginal_cis<span class="op">,</span></span>
<span id="cb53-1675"><a href="#cb53-1675" aria-hidden="true" tabindex="-1"></a>      marginal_impact_cis<span class="op">,</span></span>
<span id="cb53-1676"><a href="#cb53-1676" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb53-1677"><a href="#cb53-1677" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb53-1678"><a href="#cb53-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1679"><a href="#cb53-1679" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> withImpact<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb53-1680"><a href="#cb53-1680" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> project_benefit <span class="op">=</span></span>
<span id="cb53-1681"><a href="#cb53-1681" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((d<span class="op">.</span><span class="at">marginal_impact_cis</span> <span class="op">-</span> d<span class="op">.</span><span class="at">marginal_impact_cis</span> <span class="op">/</span> bcr) <span class="op">*</span> <span class="dv">10</span>) <span class="op">/</span></span>
<span id="cb53-1682"><a href="#cb53-1682" aria-hidden="true" tabindex="-1"></a>      <span class="dv">10</span><span class="op">;</span></span>
<span id="cb53-1683"><a href="#cb53-1683" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cis_impact <span class="op">=</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb53-1684"><a href="#cb53-1684" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span>d<span class="op">,</span> bcr<span class="op">,</span> cis_impact<span class="op">,</span> project_benefit }<span class="op">;</span></span>
<span id="cb53-1685"><a href="#cb53-1685" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb53-1686"><a href="#cb53-1686" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb53-1687"><a href="#cb53-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1688"><a href="#cb53-1688" aria-hidden="true" tabindex="-1"></a><span class="co">//</span><span class="al">NOTE</span><span class="co">: QAQC RESULTS:</span></span>
<span id="cb53-1689"><a href="#cb53-1689" aria-hidden="true" tabindex="-1"></a><span class="co">// 1 region &amp; crop: Good - Output is close, the MC simulation gives different results, but the difference is few $100 each time</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-45" data-nodetype="declaration"></div></div></div></section><section id="roi-x-inputs-calculations" class="level3"><h3 data-anchor-id="roi-x-inputs-calculations">ROI X inputs Calculations</h3><section id="sum-across-admins-and-crops" class="level4"><h4 data-anchor-id="sum-across-admins-and-crops">Sum across admins and crops</h4><p>We select all the data for admin regions and crops, and sum up to get the benefit across all parameter combos.</p><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="1700" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1699"><span id="cb54-1700"><a href="#cb54-1700" aria-hidden="true" tabindex="-1"></a>regionSet <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(select_region)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-46" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="1704" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1703"><span id="cb55-1704"><a href="#cb55-1704" aria-hidden="true" tabindex="-1"></a>recipe_dataSummed <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb55-1705"><a href="#cb55-1705" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"wait"</span><span class="op">;</span></span>
<span id="cb55-1706"><a href="#cb55-1706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> roi_data <span class="op">=</span> <span class="cf">await</span> <span class="fu">roiResults</span>()<span class="op">;</span></span>
<span id="cb55-1707"><a href="#cb55-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1708"><a href="#cb55-1708" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filter down on this step to the selected regions</span></span>
<span id="cb55-1709"><a href="#cb55-1709" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> roi_data_filtered <span class="op">=</span> roi_data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb55-1710"><a href="#cb55-1710" aria-hidden="true" tabindex="-1"></a>    regionSet<span class="op">.</span><span class="fu">has</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">iso3c</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb55-1711"><a href="#cb55-1711" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb55-1712"><a href="#cb55-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1713"><a href="#cb55-1713" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> aggregated <span class="op">=</span> d3</span>
<span id="cb55-1714"><a href="#cb55-1714" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatGroup</span>(</span>
<span id="cb55-1715"><a href="#cb55-1715" aria-hidden="true" tabindex="-1"></a>      roi_data_filtered<span class="op">,</span></span>
<span id="cb55-1716"><a href="#cb55-1716" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">adoption</span><span class="op">,</span></span>
<span id="cb55-1717"><a href="#cb55-1717" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prod_impact</span><span class="op">,</span></span>
<span id="cb55-1718"><a href="#cb55-1718" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cis_impact</span><span class="op">,</span></span>
<span id="cb55-1719"><a href="#cb55-1719" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bcr</span><span class="op">,</span></span>
<span id="cb55-1720"><a href="#cb55-1720" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span><span class="op">,</span></span>
<span id="cb55-1721"><a href="#cb55-1721" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1722"><a href="#cb55-1722" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(([adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> year<span class="op">,</span> group]) <span class="kw">=&gt;</span> ({</span>
<span id="cb55-1723"><a href="#cb55-1723" aria-hidden="true" tabindex="-1"></a>      adoption<span class="op">,</span></span>
<span id="cb55-1724"><a href="#cb55-1724" aria-hidden="true" tabindex="-1"></a>      prod_impact<span class="op">,</span></span>
<span id="cb55-1725"><a href="#cb55-1725" aria-hidden="true" tabindex="-1"></a>      cis_impact<span class="op">,</span></span>
<span id="cb55-1726"><a href="#cb55-1726" aria-hidden="true" tabindex="-1"></a>      bcr<span class="op">,</span></span>
<span id="cb55-1727"><a href="#cb55-1727" aria-hidden="true" tabindex="-1"></a>      year<span class="op">,</span></span>
<span id="cb55-1728"><a href="#cb55-1728" aria-hidden="true" tabindex="-1"></a>      <span class="dt">project_benefit</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">sum</span>(group<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">project_benefit</span>)<span class="op">,</span></span>
<span id="cb55-1729"><a href="#cb55-1729" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb55-1730"><a href="#cb55-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1731"><a href="#cb55-1731" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"default"</span><span class="op">;</span></span>
<span id="cb55-1732"><a href="#cb55-1732" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> aggregated<span class="op">;</span></span>
<span id="cb55-1733"><a href="#cb55-1733" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-47" data-nodetype="declaration"></div></div></div></section><section id="define-project-payment-schedule" class="level4"><h4 data-anchor-id="define-project-payment-schedule">Define project payment schedule</h4><p>Below we define the project cost schedule</p><ul><li>Cost is evenly distributed across years (<ul><li>Ex. 1M over 5 years is 200K, 400K, 600K, 800K, 1M; the first year has no project benefit ($200K, 0 benefit)</li></ul></li></ul><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="1745" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1744"><span id="cb56-1745"><a href="#cb56-1745" aria-hidden="true" tabindex="-1"></a>recipe_paymentSchedule <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> projectYears })<span class="op">.</span><span class="fu">map</span>((_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb56-1746"><a href="#cb56-1746" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb56-1747"><a href="#cb56-1747" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> i<span class="op">,</span></span>
<span id="cb56-1748"><a href="#cb56-1748" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cost</span><span class="op">:</span> (<span class="dv">1</span> <span class="op">/</span> projectYears) <span class="op">*</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb56-1749"><a href="#cb56-1749" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cost_cum</span><span class="op">:</span> ((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> projectYears) <span class="op">*</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb56-1750"><a href="#cb56-1750" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb56-1751"><a href="#cb56-1751" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-48" data-nodetype="declaration"></div></div></div></section><section id="add-project-scope-to-data" class="level4"><h4 data-anchor-id="add-project-scope-to-data">Add project scope to data</h4><ul><li>Add a zero year at the start (the return rate is hardcoded to one year)</li><li>Also if the project cost is zero, return an empty array</li></ul><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="1760" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1759"><span id="cb57-1760"><a href="#cb57-1760" aria-hidden="true" tabindex="-1"></a>recipe_dataCashflow <span class="op">=</span> {</span>
<span id="cb57-1761"><a href="#cb57-1761" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>rangeProjectCost <span class="op">||</span> rangeProjectCost <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb57-1762"><a href="#cb57-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1763"><a href="#cb57-1763" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payByYear <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(recipe_paymentSchedule<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">year</span><span class="op">,</span> d]))<span class="op">;</span></span>
<span id="cb57-1764"><a href="#cb57-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1765"><a href="#cb57-1765" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">recipe_dataSummed</span>()<span class="op">;</span></span>
<span id="cb57-1766"><a href="#cb57-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1767"><a href="#cb57-1767" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3</span>
<span id="cb57-1768"><a href="#cb57-1768" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatGroup</span>(</span>
<span id="cb57-1769"><a href="#cb57-1769" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb57-1770"><a href="#cb57-1770" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">adoption</span><span class="op">,</span></span>
<span id="cb57-1771"><a href="#cb57-1771" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prod_impact</span><span class="op">,</span></span>
<span id="cb57-1772"><a href="#cb57-1772" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cis_impact</span><span class="op">,</span></span>
<span id="cb57-1773"><a href="#cb57-1773" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">bcr</span><span class="op">,</span></span>
<span id="cb57-1774"><a href="#cb57-1774" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-1775"><a href="#cb57-1775" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatMap</span>(([adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> rows]) <span class="kw">=&gt;</span> {</span>
<span id="cb57-1776"><a href="#cb57-1776" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> allRows <span class="op">=</span> [</span>
<span id="cb57-1777"><a href="#cb57-1777" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>rows<span class="op">,</span></span>
<span id="cb57-1778"><a href="#cb57-1778" aria-hidden="true" tabindex="-1"></a>        { adoption<span class="op">,</span> prod_impact<span class="op">,</span> cis_impact<span class="op">,</span> bcr<span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">project_benefit</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb57-1779"><a href="#cb57-1779" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb57-1780"><a href="#cb57-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1781"><a href="#cb57-1781" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> allRows<span class="op">.</span><span class="fu">map</span>((r) <span class="kw">=&gt;</span> {</span>
<span id="cb57-1782"><a href="#cb57-1782" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> pay <span class="op">=</span> payByYear<span class="op">.</span><span class="fu">get</span>(r<span class="op">.</span><span class="at">year</span>) <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb57-1783"><a href="#cb57-1783" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cost <span class="op">=</span> pay<span class="op">.</span><span class="at">cost</span> <span class="op">??</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb57-1784"><a href="#cb57-1784" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cost_cum <span class="op">=</span> pay<span class="op">.</span><span class="at">cost_cum</span> <span class="op">??</span> rangeProjectCost<span class="op">;</span></span>
<span id="cb57-1785"><a href="#cb57-1785" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb57-1786"><a href="#cb57-1786" aria-hidden="true" tabindex="-1"></a>          <span class="op">...</span>r<span class="op">,</span></span>
<span id="cb57-1787"><a href="#cb57-1787" aria-hidden="true" tabindex="-1"></a>          cost<span class="op">,</span></span>
<span id="cb57-1788"><a href="#cb57-1788" aria-hidden="true" tabindex="-1"></a>          cost_cum<span class="op">,</span></span>
<span id="cb57-1789"><a href="#cb57-1789" aria-hidden="true" tabindex="-1"></a>          <span class="dt">cashflow</span><span class="op">:</span> (r<span class="op">.</span><span class="at">project_benefit</span> <span class="op">??</span> <span class="dv">0</span>) <span class="op">-</span> cost<span class="op">,</span></span>
<span id="cb57-1790"><a href="#cb57-1790" aria-hidden="true" tabindex="-1"></a>          <span class="dt">discount_rate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb57-1791"><a href="#cb57-1791" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb57-1792"><a href="#cb57-1792" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb57-1793"><a href="#cb57-1793" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb57-1794"><a href="#cb57-1794" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-49" data-nodetype="declaration"></div></div></div></section><section id="format-that-into-final-indicators" class="level4"><h4 data-anchor-id="format-that-into-final-indicators">Format that into final indicators</h4><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="1800" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1799"><span id="cb58-1800"><a href="#cb58-1800" aria-hidden="true" tabindex="-1"></a>walkthroughEconomicIndicators <span class="op">=</span> {</span>
<span id="cb58-1801"><a href="#cb58-1801" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selection <span class="op">=</span> walkthroughSelections<span class="op">;</span></span>
<span id="cb58-1802"><a href="#cb58-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1803"><a href="#cb58-1803" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> recipe_dataCashflow</span>
<span id="cb58-1804"><a href="#cb58-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1805"><a href="#cb58-1805" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> years <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb58-1806"><a href="#cb58-1806" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> benefit <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">project_benefit</span>)<span class="op">;</span></span>
<span id="cb58-1807"><a href="#cb58-1807" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cost <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cost</span>)<span class="op">;</span></span>
<span id="cb58-1808"><a href="#cb58-1808" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cashflow <span class="op">=</span> benefit<span class="op">.</span><span class="fu">map</span>((b<span class="op">,</span> i) <span class="kw">=&gt;</span> b <span class="op">-</span> cost[i])<span class="op">;</span></span>
<span id="cb58-1809"><a href="#cb58-1809" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> discountRate <span class="op">=</span> selection<span class="op">.</span><span class="at">discount_rate</span><span class="op">;</span></span>
<span id="cb58-1810"><a href="#cb58-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1811"><a href="#cb58-1811" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(cashflow<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb58-1812"><a href="#cb58-1812" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_benefit <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(benefit<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb58-1813"><a href="#cb58-1813" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> npv_cost <span class="op">=</span> <span class="fu">npvDiscreteCumulative</span>(cost<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb58-1814"><a href="#cb58-1814" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> discounted_bcr <span class="op">=</span> npv_benefit<span class="op">.</span><span class="fu">map</span>((b<span class="op">,</span> i) <span class="kw">=&gt;</span> npv_cost[i] <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> b <span class="op">/</span> npv_cost[i])<span class="op">;</span></span>
<span id="cb58-1815"><a href="#cb58-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1816"><a href="#cb58-1816" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_irr <span class="op">=</span> <span class="fu">calcIRR</span>(cashflow)<span class="op">;</span></span>
<span id="cb58-1817"><a href="#cb58-1817" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_mirr <span class="op">=</span> <span class="fu">calcMIRR</span>(cashflow<span class="op">,</span> discountRate<span class="op">,</span> discountRate)<span class="op">;</span></span>
<span id="cb58-1818"><a href="#cb58-1818" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_npv <span class="op">=</span> npv<span class="op">.</span><span class="fu">at</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb58-1819"><a href="#cb58-1819" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj_bcr <span class="op">=</span> discounted_bcr<span class="op">.</span><span class="fu">at</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb58-1820"><a href="#cb58-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1821"><a href="#cb58-1821" aria-hidden="true" tabindex="-1"></a>  <span class="co">// === Enriched table</span></span>
<span id="cb58-1822"><a href="#cb58-1822" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> enrichedData <span class="op">=</span> years<span class="op">.</span><span class="fu">map</span>((year<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb58-1823"><a href="#cb58-1823" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cashflowToDate <span class="op">=</span> cashflow<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb58-1824"><a href="#cb58-1824" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb58-1825"><a href="#cb58-1825" aria-hidden="true" tabindex="-1"></a>      year<span class="op">,</span></span>
<span id="cb58-1826"><a href="#cb58-1826" aria-hidden="true" tabindex="-1"></a>      <span class="dt">project_benefit</span><span class="op">:</span> benefit[i]<span class="op">,</span></span>
<span id="cb58-1827"><a href="#cb58-1827" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cost</span><span class="op">:</span> cost[i]<span class="op">,</span></span>
<span id="cb58-1828"><a href="#cb58-1828" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cashflow</span><span class="op">:</span> cashflow[i]<span class="op">,</span></span>
<span id="cb58-1829"><a href="#cb58-1829" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_benefit_cum</span><span class="op">:</span> npv_benefit[i]<span class="op">,</span></span>
<span id="cb58-1830"><a href="#cb58-1830" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_cost_cum</span><span class="op">:</span> npv_cost[i]<span class="op">,</span></span>
<span id="cb58-1831"><a href="#cb58-1831" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discounted_bcr</span><span class="op">:</span> discounted_bcr[i]<span class="op">,</span></span>
<span id="cb58-1832"><a href="#cb58-1832" aria-hidden="true" tabindex="-1"></a>      <span class="dt">irr</span><span class="op">:</span> <span class="fu">calcIRR</span>(cashflowToDate)<span class="op">*</span><span class="dv">100</span><span class="op">,</span></span>
<span id="cb58-1833"><a href="#cb58-1833" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mirr</span><span class="op">:</span> <span class="fu">calcMIRR</span>(cashflowToDate<span class="op">,</span> discountRate<span class="op">,</span> discountRate)<span class="op">*</span><span class="dv">100</span><span class="op">,</span></span>
<span id="cb58-1834"><a href="#cb58-1834" aria-hidden="true" tabindex="-1"></a>      <span class="dt">npv</span><span class="op">:</span> npv[i]</span>
<span id="cb58-1835"><a href="#cb58-1835" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb58-1836"><a href="#cb58-1836" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb58-1837"><a href="#cb58-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1838"><a href="#cb58-1838" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb58-1839"><a href="#cb58-1839" aria-hidden="true" tabindex="-1"></a>    <span class="dt">summary</span><span class="op">:</span> {</span>
<span id="cb58-1840"><a href="#cb58-1840" aria-hidden="true" tabindex="-1"></a>      proj_npv<span class="op">,</span></span>
<span id="cb58-1841"><a href="#cb58-1841" aria-hidden="true" tabindex="-1"></a>      proj_irr<span class="op">,</span></span>
<span id="cb58-1842"><a href="#cb58-1842" aria-hidden="true" tabindex="-1"></a>      proj_mirr<span class="op">,</span></span>
<span id="cb58-1843"><a href="#cb58-1843" aria-hidden="true" tabindex="-1"></a>      proj_bcr</span>
<span id="cb58-1844"><a href="#cb58-1844" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb58-1845"><a href="#cb58-1845" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enriched</span><span class="op">:</span> enrichedData</span>
<span id="cb58-1846"><a href="#cb58-1846" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb58-1847"><a href="#cb58-1847" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-50" data-nodetype="declaration"></div></div></div></section><section id="calculate-final-values" class="level4"><h4 data-anchor-id="calculate-final-values">Calculate final values</h4><p>At this point, following the recipe, we have the timeseries for the selected parameters, with financial values calculated. Specifically:</p><ul><li>adoption</li><li>prod_impact</li><li>cis_impact</li><li>bcr</li><li>discount_rate</li></ul><p>Across:</p><ul><li>year</li></ul><p>Data:</p><ul><li>project_benifit</li><li>cost and cashflow</li><li>Project IRR</li><li>Project NPV</li><li>Project BCR</li></ul></section></section></section><section id="selections" class="level2"><h2 data-anchor-id="selections">Selections</h2><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb59" data-startfrom="1876" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1875"><span id="cb59-1876"><a href="#cb59-1876" aria-hidden="true" tabindex="-1"></a>walkthroughSelections <span class="op">=</span> {</span>
<span id="cb59-1877"><a href="#cb59-1877" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb59-1878"><a href="#cb59-1878" aria-hidden="true" tabindex="-1"></a>    <span class="dt">countries</span><span class="op">:</span> select_country<span class="op">,</span></span>
<span id="cb59-1879"><a href="#cb59-1879" aria-hidden="true" tabindex="-1"></a>    <span class="dt">regions</span><span class="op">:</span> select_region<span class="op">,</span></span>
<span id="cb59-1880"><a href="#cb59-1880" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crops</span><span class="op">:</span> select_crop<span class="op">,</span></span>
<span id="cb59-1881"><a href="#cb59-1881" aria-hidden="true" tabindex="-1"></a>    <span class="dt">project_years</span><span class="op">:</span> projectYears<span class="op">,</span></span>
<span id="cb59-1882"><a href="#cb59-1882" aria-hidden="true" tabindex="-1"></a>    <span class="dt">project_cost</span><span class="op">:</span> rangeProjectCost<span class="op">,</span></span>
<span id="cb59-1883"><a href="#cb59-1883" aria-hidden="true" tabindex="-1"></a>    <span class="dt">prod_impact</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputProdImpact</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb59-1884"><a href="#cb59-1884" aria-hidden="true" tabindex="-1"></a>    <span class="dt">adoption</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputAdoption</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb59-1885"><a href="#cb59-1885" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cis_impact</span><span class="op">:</span> options_econPerfWalkthrough<span class="op">.</span><span class="at">inputCisImpact</span><span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb59-1886"><a href="#cb59-1886" aria-hidden="true" tabindex="-1"></a>    <span class="dt">discount_rate</span><span class="op">:</span> discountRate<span class="op">,</span></span>
<span id="cb59-1887"><a href="#cb59-1887" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bcr</span><span class="op">:</span> bcr<span class="op">,</span></span>
<span id="cb59-1888"><a href="#cb59-1888" aria-hidden="true" tabindex="-1"></a>    <span class="co">// time_horizon: options_econPerfWalkthrough.inputTime.value,</span></span>
<span id="cb59-1889"><a href="#cb59-1889" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb59-1890"><a href="#cb59-1890" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-51" data-nodetype="declaration"></div></div></div><div class="ojs-auto-generated hidden"><script type="ojs-module-contents">eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7bmJPdmVydmlld308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2hlYWRpbmcxfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7X2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3Mub3BlbmVyMSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0zIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5vcGVuZXIyKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmgyKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTUifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLnRleHQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7X2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5oMil9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRleHQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7aGVhZGluZzJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC05In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtyZW5kZXJSZXZpZXcxKCl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7cmVuZGVyUmV2aWV3MigpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuY2xvc2VyMSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7bmJTdW1tYXJ5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTMifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke19sYW5nKG5iVGV4dC5zdW1tYXJ5LmJsb2Nrcy5ibG9jazEpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke25iTWV0aG9kc308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE1In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtjb250cmlidXRpb25zfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTYifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2FwcGVuZGl4fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTcifV19</script></div></section></section></main><script type="ojs-module-contents">eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7XG4gIGRyb3Bkb3duX3NlY3Rpb24sXG4gIGRvd25sb2FkQnV0dG9uLFxuICBtYWtlVG9vbHRpcExhYmVsLFxufSBmcm9tIFwiL2hlbHBlcnMvdWlDb21wb25lbnRzLm9qc1wiO1xuXG5pbXBvcnQgeyBhdGxhc1RPQyB9IGZyb20gXCIvaGVscGVycy90b2Mub2pzXCI7XG5cbmltcG9ydCB7IGF0bGFzQ2l0YXRpb24sIGF0bGFzQ29udHJpYnV0aW9uU2VjdGlvbiB9IGZyb20gXCIvaGVscGVycy9jaXRhdGlvbi5qc1wiO1xuXG5pbXBvcnQgeyBmb3JtYXRVU0QsIGlucHV0VGVtcGxhdGUgfSBmcm9tIFwiL2hlbHBlcnMvc3RkLm9qc1wiO1xuXG5pbXBvcnQgeyBoZXJvSW1hZ2UgYXMgYXRsYXNIZXJvIH0gZnJvbSBcIi9oZWxwZXJzL2hlcm8uanNcIjtcblxuaW1wb3J0IHtcbiAgZmlsdGVyYWJsZURhdGFUYWJsZSBhcyBhdGxhc1RhYmxlLFxuICBzcGFya2Jhcixcbn0gZnJvbSBcIi9oZWxwZXJzL2F0bGFzVGFibGUub2pzXCI7XG5cbmltcG9ydCB7IHJlbmRlck1hcmtkb3duV2l0aFNsb3RzIH0gZnJvbSBcIi9oZWxwZXJzL21kVHJhbnNsYXRlLm9qc1wiO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaHRtbGAke2F0bGFzSGVybyhuYlRpdGxlLCBcIi4vLi4vLi4vaW1hZ2VzL25vdGVib29rcy9yb2kud2VicFwiKX1gO1xuXG5hdGxhc1RPQyh7XG4gIHNraXA6IFtcIm5vdGVib29rLXRpdGxlXCIsIFwiYXBwZW5kaXhcIiwgXCJzb3VyY2UtY29kZVwiXSwgLy8gVGhlc2Ugc2hvdWxkIGJlIHRoZSBzZWN0aW9uIGhlYWRpbmdzIGluIHRoZSB7IyBoZWFkaW5nc31cbiAgaGVhZGluZzogYDxiPiR7TGFuZy50b1NlbnRlbmNlQ2FzZShfbGFuZyhnZW5lcmFsX3RyYW5zbGF0aW9ucy50b2MpKX08L2I+YCxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gVGV4dCBmb3Igb3ZlcnZpZXcgc2VjdGlvblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrMSl9YDtcblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrMil9YDtcblxuZHJvcGRvd25fc2VjdGlvbihcbiAgXCJEZWZpbml0aW9uc1wiLFxuICBmYWxzZSxcbiAgbWRgJHtfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIub3ZlcnZpZXcpfWAsXG5cbiAgbWRgJHtfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLm92ZXJ2aWV3KX1gLFxuXG4gIG1kYCR7X2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2Lm92ZXJ2aWV3KX1gLFxuXG4gIG1kYCR7X2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLm92ZXJ2aWV3KX1gLFxuKTtcblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrMyl9YDtcblxubWRgJHtfbGFuZyhuYlRleHQub3ZlcnZpZXcuYmxvY2tzLmJsb2NrNCl9YDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imh0bC5odG1sYFxuPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGdhcDogM2VtOyBtYXJnaW4tYm90dG9tOiAxLjVlbTtcIj5cbiAgICAke3ZpZXdvZiBzZWxlY3RfY291bnRyeX1cbiAgICAke3ZpZXdvZiBzZWxlY3RfcmVnaW9ufVxuICAgICR7dmlld29mIHNlbGVjdF9jcm9wfVxuICA8L2Rpdj5cbmBcblxudmlld29mIHByb2R1Y3Rpb25WaWV3ID0gSW5wdXRzLnJhZGlvKFtcInBsb3RcIiwgXCJ0YWJsZVwiXSwge1xuICB2YWx1ZTogXCJ0YWJsZVwiLFxuICBsYWJlbDogX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMudml6VHlwZS50aXRsZSksXG4gIGZvcm1hdDogKGQpID0+IF9sYW5nKGdlbmVyYWxfdHJhbnNsYXRpb25zLnZpelR5cGU/LltkXSksXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBpZiAocHJvZHVjdGlvblZpZXcgPT0gXCJ0YWJsZVwiKSB7XG4gICAgY29uc3QgYTBfY2xlYW4gPSBfbGFuZyhnZW5lcmFsX3RyYW5zbGF0aW9ucy5jb3VudHJ5KTtcbiAgICBjb25zdCBhMV9jbGVhbiA9IF9sYW5nKGdlbmVyYWxfdHJhbnNsYXRpb25zLnJlZ2lvbik7XG4gICAgY29uc3QgY29tbW9kaXR5X2NsZWFuID0gX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMuY29tbW9kaXR5KTtcbiAgICBjb25zdCBtYXhWYWwgPSBkMy5tYXgoZXhwb3N1cmVfZGF0YSwgZCA9PiBkLnZhbHVlKTtcbiAgICByZXR1cm4gYXRsYXNUYWJsZShleHBvc3VyZV9kYXRhLCB7XG4gICAgICBjb2x1bW5zOiBbXCJhZG1pbjBfbmFtZVwiLCBcImFkbWluMV9uYW1lXCIsIFwiY3JvcFwiLCBcInZhbHVlXCJdLFxuICAgICAgaGVhZGVyOiB7dmFsdWU6IFwiVVNEXCIsIGNyb3A6IGNvbW1vZGl0eV9jbGVhbiwgYWRtaW4wX25hbWU6IGEwX2NsZWFuLCBhZG1pbjFfbmFtZTogYTFfY2xlYW59LFxuICAgICAgc29ydDogXCJ2YWx1ZVwiLFxuICAgICAgcmV2ZXJzZTogdHJ1ZSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICB2YWx1ZTogc3BhcmtiYXIoe1xuICAgICAgICAgIG1heDogbWF4VmFsLFxuICAgICAgICAgIGFsaWduOiBcInJpZ2h0XCIsXG4gICAgICAgICAgYmFja2dyb3VuZDogXCIjRDlFQ0Q5XCIsXG4gICAgICAgICAgY29sb3I6IFwiYmxhY2tcIixcbiAgICAgICAgICBmb3JtYXR0ZXI6IChkKSA9PiBmb3JtYXRVU0QoKShkKSxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVuZGVyUHJvZHVjdGlvbkJhcnMoKVxuICB9XG59XG5cbnJlbmRlclByb2R1Y3Rpb25CYXJzID0gKCkgPT4ge1xuICBjb25zdCBkYXRhID0gZXhwb3N1cmVfZGF0YVxuICAgIC5maWx0ZXIoKGQpID0+XG4gICAgcmVnaW9uU2V0LmhhcyhgJHtkLmlzbzN9XyR7ZC5hZG1pbjFfbmFtZX1gKSxcbiAgKTtcblxuICBjb25zdCB0b3RhbHMgPSBkMy5yb2xsdXAoXG4gICAgZGF0YSxcbiAgICB2ID0+IGQzLnN1bSh2LCBkID0+IGQudmFsdWUpLFxuICAgIGQgPT4gZC5hZG1pbjBfbmFtZSxcbiAgICBkID0+IGQuY3JvcFxuICApO1xuXG4gIGNvbnN0IGZsYXRUb3RhbHMgPSBBcnJheS5mcm9tKHRvdGFscywgKFthZG1pbjBfbmFtZSwgY3JvcHNdKSA9PlxuICAgIEFycmF5LmZyb20oY3JvcHMsIChbY3JvcCwgdmFsdWVdKSA9PiAoeyBhZG1pbjBfbmFtZSwgY3JvcCwgdmFsdWUgfSkpXG4gICkuZmxhdCgpO1xuXG4gIGNvbnN0IF90aXRsZSA9IF9sYW5nKHtcbiAgICBlbjogXCJUb3RhbCBWb1AgZm9yIHNlbGVjdGVkIHJlZ2lvbnMgYW5kIGNyb3BzIGluIGVhY2ggY291bnRyeVwiLFxuICAgIGZyOiBcIlRvdGFsIFZvUCBwb3VyIGxlcyByZcyBZ2lvbnMgZXQgbGVzIGN1bHR1cmVzIHNlzIFsZWN0aW9ubmXMgWVzIGRhbnMgY2hhcXVlIHBheXNcIlxuICB9KVxuXG4gIHJldHVybiBQbG90LnBsb3Qoe1xuICAgIHN1YnRpdGxlOiBfdGl0bGUsXG4gICAgbWFyZ2luTGVmdDogNTAsXG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0OiA1MDAsXG4gICAgeDogeyBsYWJlbDogbnVsbCwgdGlja0Zvcm1hdDogKGQpID0+IGAke2R9YCB9LFxuICAgIHk6IHsgdGlja0Zvcm1hdDooZCkgPT4gZm9ybWF0VVNEKCkoZCkgfSxcbiAgICBjb2xvcjoge1xuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgbGFiZWw6IF9sYW5nKHtlbjogXCJDb21tb2RpdHlcIiwgZnI6IFwiQ3VsdHVyZVwifSksXG4gICAgfSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5iYXJZKGZsYXRUb3RhbHMsIHtcbiAgICAgICAgeDogXCJhZG1pbjBfbmFtZVwiLFxuICAgICAgICB5OiBcInZhbHVlXCIsXG4gICAgICAgIGZpbGw6IFwiY3JvcFwiLFxuICAgICAgICB0aXA6IHRydWVcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0UHJvamVjdE9wdGlvbnMgPSB7XG4gIGNvbnN0IGlucHV0UHJvamVjdENvc3QgPSBJbnB1dHMudGV4dCh7XG4gICAgbGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBpbnB1dE9wdGlvbnNfcHJvamVjdENvc3QubGFiZWwsXG4gICAgICB0b29sdGlwVGV4dDogaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0LnRvb2x0aXBcbiAgICB9KSxcbiAgICBwYXR0ZXJuOiBpbnB1dE9wdGlvbnNfcHJvamVjdENvc3QucGF0dGVybixcbiAgICBwbGFjZWhvbGRlcjogaW5wdXRPcHRpb25zX3Byb2plY3RDb3N0LnBsYWNlaG9sZGVyLFxuICAgIHZhbHVlOiBpbnB1dE9wdGlvbnNfcHJvamVjdENvc3QudmFsdWVTdHJpbmdcbiAgfSk7XG4gIGNvbnN0IGlucHV0UHJvamVjdFllYXJzID0gSW5wdXRzLnNlbGVjdChpbnB1dE9wdGlvbnNfcHJvamVjdFllYXJzLmRhdGEsIHtcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsLFxuICAgIGxhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogaW5wdXRPcHRpb25zX3Byb2plY3RZZWFycy5sYWJlbCxcbiAgICAgIHRvb2x0aXBUZXh0OiBpbnB1dE9wdGlvbnNfcHJvamVjdFllYXJzLnRvb2x0aXBcbiAgICB9KSxcbiAgICB2YWx1ZTogaW5wdXRPcHRpb25zX3Byb2plY3RZZWFycy5kYXRhLmZpbmQoKGQpID0+IGQudmFsdWUgPT0gOClcbiAgICB9KTtcblxuICByZXR1cm4gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgY29zdDogaW5wdXRQcm9qZWN0Q29zdCxcbiAgICAgIHllYXJzOmlucHV0UHJvamVjdFllYXJzXG4gICAgfSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogaW5wdXRUZW1wbGF0ZSh7IGdhcDogXCIzZW1cIiB9KSxcbiAgICB9XG4gICk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRlbXBsYXRlID0gX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuY29zdHMuY2FsbG91dFRlbXBsYXRlKVxuICBjb25zdCB0ZW1wbGF0ZUl0ZW1zID0gW1xuICAgIHtuYW1lOiBcIm1vbmV5XCIsIHZhbHVlOiBmb3JtYXRVU0Qoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSkocmFuZ2VQcm9qZWN0Q29zdCl9LFxuICAgIHtuYW1lOiBcInRpbWVcIiwgdmFsdWU6IGlucHV0UHJvamVjdE9wdGlvbnMueWVhcnMubGFiZWx9LFxuICBdXG4gIGNvbnN0IGZvcm1hdHRlZCA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXModGVtcGxhdGUsIHRlbXBsYXRlSXRlbXMpXG4gIHJldHVybiBtZGAke2Zvcm1hdHRlZH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygc2VsZWN0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoID0ge1xuICBjb25zdCBfbGFiZWxfcHJvZEltcGFjdCA9IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMucHJvZEltcGFjdERyb3Bkb3duLmxhYmVsLFxuICAgICAgKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMucHJvZEltcGFjdERyb3Bkb3duLnRvb2x0aXAsXG4gICAgICApLFxuICAgIH0pXG5cbiAgY29uc3QgX2xhYmVsX0Fkb3B0aW9uID0gbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5hZG9wdGlvblJhdGVEcm9wZG93bi5sYWJlbCxcbiAgICAgICksXG4gICAgICB0b29sdGlwVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLmFkb3B0aW9uUmF0ZURyb3Bkb3duLnRvb2x0aXAsXG4gICAgICApLFxuICAgIH0pXG5cbiAgY29uc3QgX2xhYmVsX0Npc0ltcGFjdCA9IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuY2lzSW1wYWN0RHJvcGRvd24ubGFiZWwsXG4gICAgICApLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5jaXNJbXBhY3REcm9wZG93bi50b29sdGlwLFxuICAgICAgKSxcbiAgICB9KVxuXG4gIGNvbnN0IGlucHV0UHJvZEltcGFjdCA9IElucHV0cy5yYW5nZShcbiAgICBbMCwgNTVdLFxuICAgIHtcbiAgICAgIHN0ZXA6IDUsXG4gICAgICBsYWJlbCA6IF9sYWJlbF9wcm9kSW1wYWN0LFxuICAgICAgdmFsdWU6IDMwXG4gICAgfSxcbiAgKVxuXG4gIGNvbnN0IGlucHV0QWRvcHRpb24gPSBJbnB1dHMucmFuZ2UoXG4gICAgWzAuMjUsIDJdLFxuICAgIHtcbiAgICAgIHN0ZXA6IDAuMjUsXG4gICAgICBsYWJlbCA6IF9sYWJlbF9BZG9wdGlvbixcbiAgICAgIHZhbHVlOiAxXG4gICAgfSxcbiAgKVxuXG4gIGNvbnN0IGlucHV0Q2lzSW1wYWN0ID0gSW5wdXRzLnJhbmdlKFxuICAgIFswLCA1NV0sXG4gICAge1xuICAgICAgc3RlcDogNSxcbiAgICAgIGxhYmVsIDogX2xhYmVsX0Npc0ltcGFjdCxcbiAgICAgIHZhbHVlOiAyNVxuICAgIH0sXG5cbiAgKVxuXG4gIHJldHVybiBJbnB1dHMuZm9ybShcbiAgICB7XG4gICAgICBpbnB1dFByb2RJbXBhY3QsXG4gICAgICBpbnB1dEFkb3B0aW9uLFxuICAgICAgaW5wdXRDaXNJbXBhY3Rcbn0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IGlucHV0VGVtcGxhdGUoeyBnYXA6IFwiM2VtXCIgfSksXG4gICAgfVxuICApXG59XG5cbm9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCA9IHtcbiAgY29uc3QgZm9ybWF0dGVkID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHNlbGVjdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaCkpIHtcbiAgICBmb3JtYXR0ZWRba2V5XSA9IHtcbiAgICAgIGxhYmVsOiBgJHt2YWx1ZX0lYCxcbiAgICAgIHZhbHVlOiB2YWx1ZSAvIDEwMFxuICAgIH07XG4gIH1cbiAgcmV0dXJuIGZvcm1hdHRlZDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgYWR2YW5jZWRDb250cm9sc1RleHQgPSBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5jb3N0cy5hZHZhbmNlZENvbnRyb2xzO1xuXG4gIGNvbnN0IF9iZW5lZml0TG93TGFiZWwgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICBsYWJlbFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5iZW5lZml0U2NhbGVMb3cubGFiZWwpLFxuICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuYmVuZWZpdFNjYWxlTG93LnRvb2x0aXApLFxuICB9KTtcbiAgY29uc3QgX2JlbmVmaXRIaWdoTGFiZWwgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICBsYWJlbFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5iZW5lZml0U2NhbGVIaWdoLmxhYmVsKSxcbiAgICB0b29sdGlwVGV4dDogX2xhbmcoYWR2YW5jZWRDb250cm9sc1RleHQuaW5wdXRzLmJlbmVmaXRTY2FsZUhpZ2gudG9vbHRpcCksXG4gIH0pO1xuICBjb25zdCBfY29zdExvd0xhYmVsID0gbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgbGFiZWxUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuY29zdFNjYWxlTG93LmxhYmVsKSxcbiAgICB0b29sdGlwVGV4dDogX2xhbmcoYWR2YW5jZWRDb250cm9sc1RleHQuaW5wdXRzLmNvc3RTY2FsZUxvdy50b29sdGlwKSxcbiAgfSk7XG4gIGNvbnN0IF9jb3N0SGlnaExhYmVsID0gbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgbGFiZWxUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuY29zdFNjYWxlSGlnaC5sYWJlbCksXG4gICAgdG9vbHRpcFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5jb3N0U2NhbGVIaWdoLnRvb2x0aXApLFxuICB9KTtcblxuICBjb25zdCBmb3JtQmVuZWZpdFNjYWxlID0gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgbG93OiBJbnB1dHMucmFuZ2UoWzAuNSwgMV0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgbGFiZWw6IF9iZW5lZml0TG93TGFiZWwsXG4gICAgICAgIHZhbHVlOiAwLjg1LFxuICAgICAgfSksXG4gICAgICBoaWdoOiBJbnB1dHMucmFuZ2UoWzEsIDEuNl0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgbGFiZWw6IF9iZW5lZml0SGlnaExhYmVsLFxuICAgICAgICB2YWx1ZTogMS4xNSxcbiAgICAgIH0pLFxuICAgIH0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IGlucHV0VGVtcGxhdGUoeyBnYXA6IFwiM2VtXCIgfSksXG4gICAgfSxcbiAgKTtcblxuICBjb25zdCBmb3JtQ29zdFNjYWxlID0gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgbG93OiBJbnB1dHMucmFuZ2UoWzAuNSwgMV0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgbGFiZWw6IF9jb3N0TG93TGFiZWwsXG4gICAgICAgIHZhbHVlOiAwLjksXG4gICAgICB9KSxcbiAgICAgIGhpZ2g6IElucHV0cy5yYW5nZShbMSwgMS44XSwge1xuICAgICAgICBzdGVwOiAwLjAxLFxuICAgICAgICBsYWJlbDogX2Nvc3RIaWdoTGFiZWwsXG4gICAgICAgIHZhbHVlOiAxLjIsXG4gICAgICB9KSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHRlbXBsYXRlOiBpbnB1dFRlbXBsYXRlKHsgZ2FwOiBcIjNlbVwiIH0pLFxuICAgIH0sXG4gICk7XG5cbiAgY29uc3QgX2Rpc2NvdW50TGFiZWwgPSBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICBsYWJlbFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5kaXNjb3VudFJhdGUubGFiZWwpLFxuICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhhZHZhbmNlZENvbnRyb2xzVGV4dC5pbnB1dHMuZGlzY291bnRSYXRlLnRvb2x0aXApLFxuICB9KVxuXG4gIGNvbnN0IF9yb2lMYWJlbCA9IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgIGxhYmVsVGV4dDogX2xhbmcoYWR2YW5jZWRDb250cm9sc1RleHQuaW5wdXRzLnJvaS5sYWJlbCksXG4gICAgdG9vbHRpcFRleHQ6IF9sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0LmlucHV0cy5yb2kudG9vbHRpcCksXG4gIH0pXG5cbiAgY29uc3QgZm9ybUZpbmFuY2lhbENvbnRyb2xzID0gSW5wdXRzLmZvcm0oXG4gICAge1xuICAgICAgZGlzY291bnRSYXRlOiBJbnB1dHMuYmluZChcbiAgICAgICAgSW5wdXRzLnJhbmdlKFxuICAgICAgICAgIFswLCAxXSxcbiAgICAgICAgICB7c3RlcDogMC4wMSwgZm9ybWF0OiB4ID0+ICh4ICogMTAwKSwgbGFiZWwgOiBfZGlzY291bnRMYWJlbCwgdmFsdWU6IDAuMTJ9XG4gICAgICAgICksXG4gICAgICAgIHZpZXdvZiBkaXNjb3VudFJhdGVcbiAgICAgICksXG4gICAgICBiY3I6IElucHV0cy5iaW5kKFxuICAgICAgICBJbnB1dHMucmFuZ2UoXG4gICAgICAgICAgWzAuNSwgMl0sXG4gICAgICAgICAge3N0ZXA6IDAuMDEsIGxhYmVsOiBfcm9pTGFiZWwsIHZhbHVlOiAxLjYyfVxuICAgICAgICApLFxuICAgICAgICB2aWV3b2YgYmNyXG4gICAgICApXG4gICAgfSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogaW5wdXRUZW1wbGF0ZSh7IGdhcDogXCIzZW1cIiB9KSxcbiAgICB9XG4gICk7XG5cbiAgcmV0dXJuIGRyb3Bkb3duX3NlY3Rpb24oXG4gICAgX2xhbmcoZ2VuZXJhbF90cmFuc2xhdGlvbnMuYWR2YW5jZWRDb250cm9scyksXG4gICAgZmFsc2UsXG4gICAgZm9ybUZpbmFuY2lhbENvbnRyb2xzLFxuICAgIGA8Yj4ke19sYW5nKGFkdmFuY2VkQ29udHJvbHNUZXh0Lm1vZGVsVW5jZXJ0YWludHkpfTwvYj5gLFxuICAgIElucHV0cy5iaW5kKGZvcm1CZW5lZml0U2NhbGUsIHZpZXdvZiB1bmNlcnRhaW50eUJlbmVmaXRTY2FsZSksXG4gICAgSW5wdXRzLmJpbmQoZm9ybUNvc3RTY2FsZSwgdmlld29mIHVuY2VydGFpbnR5Q29zdFNjYWxlKVxuICApXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidW5jZXJ0YWludHkgPSBydW5TaW11bGF0aW9uRnJvbUNhc2hmbG93Um93cyhyZWNpcGVfZGF0YUNhc2hmbG93LCB7XG4gIHNpbXVsYXRpb25zOiAyNTAsXG4gIGRpc2NvdW50UmF0ZTogZGlzY291bnRSYXRlLFxuICBiZW5lZml0U2NhbGU6IHtcbiAgICBsb3c6IHVuY2VydGFpbnR5QmVuZWZpdFNjYWxlLmxvdyxcbiAgICBtb2RlOiAxLjAsXG4gICAgaGlnaDogdW5jZXJ0YWludHlCZW5lZml0U2NhbGUuaGlnaCxcbiAgfSxcbiAgY29zdFNjYWxlOiB7XG4gICAgbG93OiB1bmNlcnRhaW50eUNvc3RTY2FsZS5sb3csXG4gICAgbW9kZTogMS4wLFxuICAgIGhpZ2g6IHVuY2VydGFpbnR5Q29zdFNjYWxlLmhpZ2gsXG4gIH0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJiaWdOdW1iZXJzUmVzdWx0cygpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlc3VsdFRhYmxlKCk7XG5kb3dubG9hZEJ1dHRvbihcbiAgd2Fsa3Rocm91Z2hFY29ub21pY0luZGljYXRvcnM/LmVucmljaGVkLFxuICBcInJvaV9kYXRhLmNzdlwiLFxuICBfbGFuZyh7IGVuOiBcIkRvd25sb2FkXCIsIGZyOiBcIlTDqWzDqWNoYXJnZXJcIiB9KSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVzdWx0UGxvdCgpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImluZGljYXRvclNlbGVjdG9yID0ge1xuICAvLyBiaW5kIGlucHV0IHNvIHRvb2x0aXAgY2FuIGJlIGR5bmFtaWNcbiAgcmV0dXJuIElucHV0cy5iaW5kKFxuICAgIElucHV0cy5zZWxlY3QoZGF0YVBpY2tNZXRyaWMsIHtcbiAgICBsYWJlbDogbWFrZVRvb2x0aXBMYWJlbCh7XG4gICAgICBsYWJlbFRleHQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmdlbmVyYWwudGVybXMuaW5kaWNhdG9yKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBwaWNrTWV0cmljV2Fsa3Rocm91Z2gudG9vbHRpcCxcbiAgICB9KSxcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsRnVsbCxcbiAgfSksIHZpZXdvZiBwaWNrTWV0cmljV2Fsa3Rocm91Z2hcbiAgKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgbGlzdFdoYXQgPSBfbGFuZyhuYlRleHQuaW52ZXN0bWVudFJldHVybnMuYmxvY2tzLmluZm9MaXN0SGVhZGVycy53aGF0KVxuICBjb25zdCBsaXN0SW50ZXJwcmV0ID0gX2xhbmcobmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5pbmZvTGlzdEhlYWRlcnMuaW50ZXJwcmV0KVxuICBjb25zdCBsaXN0VGVsbCA9IF9sYW5nKG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuaW5mb0xpc3RIZWFkZXJzLnRlbGwpXG5cbiAgLy8gaW5kaWNhdG9yIGluZm9cbiAgcmV0dXJuIG1kYCMjIyAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5sYWJlbEZ1bGx9XG5cbi0gKioke2xpc3RXaGF0fSoqOiAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5pbmZvLndoYXR9XG4tICoqJHtsaXN0SW50ZXJwcmV0fSoqOiAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5pbmZvLmludGVycHJldH1cbi0gKioke2xpc3RUZWxsfSoqOiAke3BpY2tNZXRyaWNXYWxrdGhyb3VnaC5pbmZvLnRlbGx9XG5gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBucHZfcmF0ZSA9IChkaXNjb3VudFJhdGUgKiAxMDApICsgXCIlXCI7XG4gIGNvbnN0IGZhcm1fYmNyID0gYmNyO1xuICBjb25zdCBtZXRob2RzX3RpdGxlID0gbmJNZXRob2RzO1xuXG4gIGNvbnN0IHRlbXBsYXRlID0gX2xhbmcobmJUZXh0LnN1bW1hcnkuYmxvY2tzLmJsb2NrMilcbiAgY29uc3QgdGVtcGxhdGVJdGVtcyA9IFtcbiAgICB7bmFtZTogXCJucHZEaXNvdW50UmF0ZVwiLCB2YWx1ZTogbnB2X3JhdGV9LFxuICAgIHtuYW1lOiBcImZhcm1CY3JcIiwgdmFsdWU6IGZhcm1fYmNyfSxcbiAgICB7bmFtZTogXCJtZXRob2RzU291cmNlc1RpdGxlXCIsIHZhbHVlOiBtZXRob2RzX3RpdGxlfSxcbiAgXVxuICBjb25zdCBmb3JtYXR0ZWQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKHRlbXBsYXRlLCB0ZW1wbGF0ZUl0ZW1zKVxuICByZXR1cm4gbWRgJHtmb3JtYXR0ZWR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1ldGhvZEZpbGVzID0gbmV3IE9iamVjdCh7XG4gIFwiZW5cIjogRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9lY29ub21pY1JldHVybnMvdHJhbnNsYXRpb25zL21ldGhvZHMtZW4ubWRcIiksXG4gIFwiZnJcIjogRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9lY29ub21pY1JldHVybnMvdHJhbnNsYXRpb25zL21ldGhvZHMtZnIubWRcIilcbn0pXG5cbntcbiAgY29uc3Qga2V5ID0gbWFzdGVyTGFuZ3VhZ2Uua2V5XG4gIGNvbnN0IG1kX2NvbnRlbnQgPSBhd2FpdCBtZXRob2RGaWxlc1trZXldLnRleHQoKVxuICByZXR1cm4gcmVuZGVyTWFya2Rvd25XaXRoU2xvdHMoXG4gICAgbWRfY29udGVudCxcbiAgICB7fSxcbiAgKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IGNvbnRyaWJ1dG9yTGlzdCA9IHtcbiAgICBhdXRob3JzOiBbXG4gICAgICB7IG5hbWU6IFwiUGV0ZSBTdGV3YXJkXCIsIG9yZ3M6IFsxXSB9LFxuICAgICAgeyBuYW1lOiBcIlRvZGQgUm9zZW5zdG9ja1wiLCBvcmdzOiBbMSwgMl0gfSxcbiAgICAgIHsgbmFtZTogXCJQaGlsbGlwIFRob3JudG9uXCIsIG9yZ3M6IFszXSB9LFxuICAgICAgeyBuYW1lOiBcIkJyYXlkZW4gWW91bmdiZXJnXCIsIG9yZ3M6IFsxXSB9LFxuICAgICAgeyBuYW1lOiBcIkxvbGl0YSBNdWxsZXJcIiwgb3JnczogWzFdIH0sXG4gICAgXSxcbiAgICBkZXZlbG9wZXJzOiBbXG4gICAgICB7IG5hbWU6IFwiWmFjaCBCb2dhcnRcIiwgb3JnczogWzRdIH0sXG4gICAgICB7IG5hbWU6IFwiQnJheWRlbiBZb3VuZ2JlcmdcIiwgb3JnczogWzFdIH0sXG4gICAgICB7IG5hbWU6IFwiUGV0ZSBTdGV3YXJkXCIsIG9yZ3M6IFsxXSB9LFxuICAgIF0sXG4gICAgb3JnYW5pemF0aW9uczoge1xuICAgICAgMTogXCJBbGxpYW5jZSBCaW92ZXJzaXR5IGFuZCBDSUFUXCIsXG4gICAgICAyOiBcIkNHSUFSXCIsXG4gICAgICAzOiBcIklMUklcIixcbiAgICAgIDQ6IFwiUGVyaXNjb3BpY1wiXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBjb250cmlidXRpb25TZWN0aW9uID0gYXRsYXNDb250cmlidXRpb25TZWN0aW9uKFxuICAgIGNvbnRyaWJ1dG9yTGlzdCxcbiAgICBhdGxhc0NpdGF0aW9uKG5iVGl0bGUpLFxuICAgIG1hc3Rlckxhbmd1YWdlLmtleSxcbiAgKTtcbiAgcmV0dXJuIGh0bWxgJHtjb250cmlidXRpb25TZWN0aW9ufWA7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIERhdGEgbG9hZGVyIGNlbGxcbmRiID0ge1xuICBsZXQgZGIgPSBhd2FpdCBEdWNrREJDbGllbnQub2Yoe1xuICAgIGN2X3JhdzogRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9lY29ub21pY1JldHVybnMvZmFvc3RhdF9wcm9kX2N2LnBhcnF1ZXRcIilcbiAgfSlcbiAgYXdhaXQgZGIucXVlcnkoYFxuICAgIENSRUFURSBUQUJMRSBleHBvc3VyZSBBUyAgLS0gZGF0YSBpcyB+IDEgbWIgc28gdGFibGUgcG9zc2libHkgbW9yZSBwZXJmb3JtYW50XG4gICAgICBTRUxFQ1RcbiAgICAgICAgaXNvMyxcbiAgICAgICAgYWRtaW4wX25hbWUsXG4gICAgICAgIGFkbWluMV9uYW1lLFxuICAgICAgICBSRUdFWFBfUkVQTEFDRShjcm9wLCAnLXRyb3BpY2FsfC1oaWdobGFuZCcsICcnKSBBUyBjcm9wLFxuICAgICAgICBDT05DQVQoZXhwb3N1cmUsICdfJywgdW5pdCkgQVMgZXhwb3N1cmUsXG4gICAgICAgIFNVTSh2YWx1ZSkgQVMgdmFsdWVcbiAgICAgIEZST00gcmVhZF9wYXJxdWV0KFwiczM6Ly9kaWdpdGFsLWF0bGFzL2RvbWFpbj1leHBvc3VyZS90eXBlPWNvbWJpbmVkL3NvdXJjZT1nbHc0LTIwMjBfc3BhbTIwMjBBQS9yZWdpb249c3NhL3Byb2Nlc3Npbmc9YXRsYXMtaGFybW9uaXplZC92YXJpYWJsZT12b3Bfbm9taW5hbC11c2QtMjAyMS5wYXJxdWV0XCIpXG4gICAgICBXSEVSRVxuICAgICAgICBhZG1pbjJfbmFtZSBJUyBOVUxMIEFORCBhZG1pbjFfbmFtZSBJUyBOT1QgTlVMTFxuICAgICAgICBBTkQgKHRlY2ggPSAnYWxsJyBPUiB0ZWNoIElTIE5VTEwpXG4gICAgICAgIEFORCBpc2Zpbml0ZSh2YWx1ZSlcbiAgICAgICAgQU5EIGNyb3AgIX4gJyheb3RoZXItfHJlc3Qtb2Z8dGVtcGVyYXRlLWZydWl0fHRyb3BpY2FsLWZydWl0fHZlZ2V0YWJsZXMpJ1xuICAgICAgR1JPVVAgQllcbiAgICAgICAgaXNvMyxcbiAgICAgICAgYWRtaW4wX25hbWUsXG4gICAgICAgIGFkbWluMV9uYW1lLFxuICAgICAgICBjcm9wLFxuICAgICAgICBDT05DQVQoZXhwb3N1cmUsICdfJywgdW5pdClcbiAgYClcbiAgYXdhaXQgZGIucXVlcnkoYFxuICAgIENSRUFURSBWSUVXIGN2IEFTXG4gICAgICBTRUxFQ1RcbiAgICAgICAgYWRtaW4wX25hbWUsXG4gICAgICAgIC0tIGNsZWFuIGFuZCBzdGFuZGFyZGl6ZSBjcm9wIG5hbWVzXG4gICAgICAgIFJFR0VYUF9SRVBMQUNFKFxuICAgICAgICAgIFJFR0VYUF9SRVBMQUNFKFxuICAgICAgICAgICAgUkVQTEFDRShSRVBMQUNFKGNyb3AsICdfbWVhdCcsICcnKSwgJyAnLCAnLScpLFxuICAgICAgICAgICAgJ2dvYXQkJywgJ2dvYXRzJ1xuICAgICAgICAgICksXG4gICAgICAgICAgJ3BpZyQnLCAncGlncydcbiAgICAgICAgKSBBUyBjcm9wLFxuICAgICAgICB2YWx1ZV9maWxsZWQgQVMgY3ZcbiAgICAgIEZST00gY3ZfcmF3XG4gICAgICBXSEVSRSBOT1QgKGNyb3AgSUxJS0UgJyVtaWxrJScgT1IgY3JvcCBJTElLRSAnJWVnZ3MlJyBPUiBMT1dFUihjcm9wKSA9ICd0b3RhbCcpXG5cbiAgICAgIFVOSU9OIEFMTFxuICAgICAgLS0gYWRkIHJvYnVzdGEtY29mZmVlIGFuZCBzbWFsbC1taWxsZXQgc3Vic3RpdHV0ZXNcbiAgICAgIFNFTEVDVCBhZG1pbjBfbmFtZSwgJ3JvYnVzdGEtY29mZmVlJywgdmFsdWVfZmlsbGVkIEFTIGN2XG4gICAgICBGUk9NIGN2X3Jhd1xuICAgICAgV0hFUkUgY3JvcCA9ICdhcmFiaWNhLWNvZmZlZSdcblxuICAgICAgVU5JT04gQUxMXG4gICAgICBTRUxFQ1QgYWRtaW4wX25hbWUsICdzbWFsbC1taWxsZXQnLCB2YWx1ZV9maWxsZWQgQVMgY3ZcbiAgICAgIEZST00gY3ZfcmF3XG4gICAgICBXSEVSRSBjcm9wID0gJ3BlYXJsLW1pbGxldCc7XG5gKVxuICByZXR1cm4gZGI7XG59O1xuXG5jb3VudHJpZXMgPSB7XG4gIGNvbnN0IGNvdW50cnlfbGlzdCA9IGF3YWl0IEZpbGVBdHRhY2htZW50KFwiL2RhdGEvc2hhcmVkL2F0bGFzX2NvdW50cmllcy5qc29uXCIpLmpzb24oKTtcbiAgY29uc3QgZmlsdGVyZWRDb3VudHJpZXMgPSBjb3VudHJ5X2xpc3RcbiAgICAuZmlsdGVyKChjKSA9PiBjLmluY2x1ZGUgJiYgYy5pc28zYyAhPT0gXCJTRE5cIilcbiAgICAubWFwKCh7IGluY2x1ZGUsIC4uLnJlc3QgfSkgPT4gcmVzdCk7XG4gIHJldHVybiBmaWx0ZXJlZENvdW50cmllcztcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YUFkbWluUmVnaW9ucyA9IHtcbiAgY29uc3QgcmVnaW9ucyA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICBTRUxFQ1QgRElTVElOQ1QgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBpc28zXG4gICAgRlJPTSBleHBvc3VyZVxuICAgIFdIRVJFIGFkbWluMV9uYW1lIElTIE5PVCBudWxsXG4gICAgQU5EIGlzbzMgaW4gKCcke3NlbGVjdF9jb3VudHJ5LmpvaW4oXCInLCAnXCIpfScpXG4gIGApXG5cbiAgcmV0dXJuIHJlZ2lvbnMubWFwKHJvdyA9PiAoe1xuICAgIC4uLnJvdyxcbiAgICBpZDogYCR7cm93LmlzbzN9XyR7cm93LmFkbWluMV9uYW1lfWBcbiAgfSkpO1xufVxuXG4vL1RPRE86IE5lZWQgdG8gYWRkIHRyYW5zbGF0aW9ucyBhbmQgbGFiZWwgY2xlYW5pbmcgdG8gaXRlbXNcbmRhdGFDcm9wcyA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgU0VMRUNUIERJU1RJTkNUIGNyb3AgQVMgaXRlbVxuICBGUk9NIGV4cG9zdXJlXG4gIE9SREVSIEJZIGl0ZW1cbmApXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gRGVmYXVsdHMgYW5kIGdhdXJkIHJhaWxzIGZvciB0aGUgaW5wdXRzXG5pbnB1dE9wdGlvbnNfcHJvamVjdENvc3QgPSB7XG4gIHJldHVybiB7XG4gICAgcmFuZ2U6IFsxZTYsIDVlOF0sXG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmlucHV0cy5jb3N0SW5wdXQubGFiZWwpLFxuICAgIHRvb2x0aXA6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmlucHV0cy5jb3N0SW5wdXQudG9vbHRpcCksXG4gICAgc3RlcDogMWU1LFxuICAgIHZhbHVlOiA1MF8wMDBfMDAwLFxuICAgIGZvcm1hdDogZDMuZm9ybWF0KCckLjNzJyksXG4gICAgb3V0cHV0V2lkdGg6IDkwLFxuICAgIHBsYWNlaG9sZGVyOiBcIkV4LiAkNSwwMDAsMDAwXCIsXG4gICAgcGF0dGVybjogXCJeWyRdP1sxLTldK1swLTksJF0qJFwiLFxuICAgIHZhbHVlU3RyaW5nOiBcIiQ1MCwwMDAsMDAwXCJcbiAgfVxufVxuXG5pbnB1dE9wdGlvbnNfcHJvamVjdFllYXJzID0ge1xuICBjb25zdCB5ZWFycyA9IF9sYW5nKFxuICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuY29zdHMuaW5wdXRzLnByb2plY3RZZWFyRHJvcGRvd24udGVybXMueWVhci5wbHVyYWwsXG4gICk7XG4gIHJldHVybiB7XG4gICAgcmFuZ2U6IFsyLCAxNl0sXG4gICAgZGF0YTogZDNcbiAgICAgIC5yYW5nZSgyLCAxNiArIDEsIDEpXG4gICAgICAubWFwKChkKSA9PiAoeyBsYWJlbDogYCR7ZH0gJHt5ZWFyc31gLCB2YWx1ZTogZCB9KSksXG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmNvc3RzLmlucHV0cy5wcm9qZWN0WWVhckRyb3Bkb3duLmxhYmVsKSxcbiAgICB0b29sdGlwOiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5jb3N0cy5pbnB1dHMucHJvamVjdFllYXJEcm9wZG93bi50b29sdGlwKSxcbiAgICBzdGVwOiAxLFxuICAgIHZhbHVlOiA4LFxuICAgIG91dHB1dFdpZHRoOiA5MFxuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzZWxlY3RfY291bnRyeSA9IHtcbiAgY29uc3QgZGF0YSA9IGNvdW50cmllc1xuICAgIC5tYXAoKGQpID0+ICh7XG4gICAgICB2YWx1ZTogZC5pc28zYywgLy9NaWdyYXRpbmcgdG8gaXNvIGNvZGVzIGZvciBmdXR1cmUgZmxleGFiaWxpdHlcbiAgICAgIGxhYmVsOiBfbGFuZyhkLnRyYW5zbGF0aW9uKVxuICAgIH0pKVxuICBsZXQgaW5wdXQgPSBkcm9wZG93bklucHV0KHtcbiAgICBpbnB1dExhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY291bnRyeS5wbHVyYWwpLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5sb2NhdGlvbnMuaW5wdXRzLmNvdW50cnlEcm9wZG93bi50b29sdGlwXG4gICAgICApXG4gICAgfSksXG4gICAgaW5wdXRJZDogXCJwb3NpdGlvbnNUZXN0XCIsXG4gICAgcGxhY2Vob2xkZXJUZXh0OiBcIlNlbGVjdCBDb3VudHJpZXMuLi5cIixcbiAgICBvcHRpb25zOiBkYXRhLFxuICAgIHNlbGVjdGVkOiBbXCJLRU5cIiwgXCJUWkFcIl0sXG4gIH0pO1xuXG4gIHJldHVybiBkZWJvdW5jZShpbnB1dCwgMTAwMCk7IC8vIE5vaXN5IGlucHV0LCBzbyBkZWxheSBpdCBhIGJpdC5cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBhZG1pbiBtdWx0aS1zZWxlY3Q6IHJlZ2lvbnNcbnZpZXdvZiBzZWxlY3RfcmVnaW9uID0ge1xuICAvLyBmaWx0ZXIgcmVnaW9ucyBiYXNlZCBvbiBjb3VudHJ5IGlkJ3NcbiAgY29uc3QgZmlsdGVyZWRSZWdpb25zID0gZGF0YUFkbWluUmVnaW9uc1xuICAvLyBjb25zdCB0cmFuc2xhdGVDb3VudHJ5ID0gKGQpID0+IF9sYW5nKHRkLmFkbWluMF9uYW1lLnZhbHVlcz8uW2RdKTtcbiAgY29uc3QgdHJhbnNsYXRlQ291bnRyeSA9IChpc28pID0+IF9sYW5nKGNvdW50cmllcy5maW5kKChjKSA9PiBjLmlzbzNjID09PSBpc28pLnRyYW5zbGF0aW9uKTtcbiAgY29uc3QgZGF0YSA9IGZpbHRlcmVkUmVnaW9ucy5tYXAoKGQpID0+ICh7XG4gICAgdmFsdWU6IGQuaWQsXG4gICAgbGFiZWw6IGAke3RyYW5zbGF0ZUNvdW50cnkoZC5pc28zKX06ICR7ZC5hZG1pbjFfbmFtZX1gXG4gIH0pKTtcbiAgY29uc3Qgc2VsZWN0ZWRJZHMgPSBmaWx0ZXJlZFJlZ2lvbnMubWFwKChkKSA9PiBkLmlkKTtcbiAgY29uc3QgdGV4dCA9IHtcbiAgICBsYWJlbDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMucmVnaW9uLnBsdXJhbCksXG4gICAgdG9vbHRpcDogX2xhbmcobmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MubG9jYXRpb25zLmlucHV0cy5yZWdpb25Ecm9wZG93bi50b29sdGlwKSxcbiAgfVxuICBjb25zdCBpbnB1dCA9IGRyb3Bkb3duSW5wdXQoe1xuICAgIGlucHV0TGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe2xhYmVsVGV4dDogdGV4dC5sYWJlbCwgdG9vbHRpcFRleHQ6IHRleHQudG9vbHRpcH0pLFxuICAgIGlucHV0SWQ6IFwicG9zaXRpb25zVGVzdFwiLFxuICAgIHBsYWNlaG9sZGVyVGV4dDogXCJTZWxlY3QgcmVnaW9ucy4uLlwiLFxuICAgIG9wdGlvbnM6IGRhdGEsXG4gICAgc2VsZWN0ZWQ6IHNlbGVjdGVkSWRzXG4gIH0pO1xuXG4gIHJldHVybiBkZWJvdW5jZShpbnB1dCwgMTAwMCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gYWRtaW4gbXVsdGktc2VsZWN0OiBjb3VudHJpZXNcbnZpZXdvZiBzZWxlY3RfY3JvcCA9IHtcbiAgY29uc3QgZGF0YSA9IGRhdGFDcm9wc1xuICAgIC5tYXAoKGQpID0+ICh7XG4gICAgICB2YWx1ZTogZC5pdGVtLFxuICAgICAgbGFiZWw6IExhbmcudG9TZW50ZW5jZUNhc2UoZC5pdGVtKSAvL1RPRE86IEFkZCB0cmFuc2xhdGlvbnNcbiAgICB9KSlcbiAgICAuc29ydCgoYSxiKSA9PiBhLmxhYmVsID4gYi5sYWJlbCk7XG4gIGNvbnN0IHNlbGVjdGVkSWQgPSBkYXRhQ3JvcHNcbiAgICAuZmlsdGVyKChkKSA9PiBbXCJiZWFuXCIsIFwiZ29hdHNcIiwgXCJtYWl6ZVwiXS5pbmNsdWRlcyhkLml0ZW0pKVxuICAgIC5tYXAoKGQpID0+IGQuaXRlbSk7XG4gIGNvbnN0IHRleHQgPSB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNvbW1vZGl0eS5wbHVyYWwpLFxuICAgIHRvb2x0aXA6IF9sYW5nKFxuICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MubG9jYXRpb25zLmlucHV0cy5jb21tb2RpdHlEcm9wZG93bi50b29sdGlwXG4gICAgKVxuICB9O1xuICBjb25zdCBpbnB1dCA9IGRyb3Bkb3duSW5wdXQoe1xuICAgIGlucHV0TGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiB0ZXh0LmxhYmVsLFxuICAgICAgdG9vbHRpcFRleHQ6IHRleHQudG9vbHRpcFxuICAgIH0pLFxuICAgIGlucHV0SWQ6IFwicG9zaXRpb25zVGVzdFwiLFxuICAgIHBsYWNlaG9sZGVyVGV4dDogXCJTZWxlY3QgY3JvcHMuLi5cIixcbiAgICBvcHRpb25zOiBkYXRhLFxuICAgIHNlbGVjdGVkOiBzZWxlY3RlZElkXG4gIH0pO1xuXG4gIHJldHVybiBkZWJvdW5jZShpbnB1dCwgMTAwMCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmFuZ2VQcm9qZWN0Q29zdCA9IHtcbiAgY29uc3QgdW5wYWNrID0gTnVtYmVyKGlucHV0UHJvamVjdE9wdGlvbnMuY29zdC5yZXBsYWNlKC9bLHwkXS9nLCBcIlwiKSlcbiAgY29uc3QgbnVtYmVyID0gTnVtYmVyKHVucGFjaylcbiAgcmV0dXJuIG51bWJlclxufVxuXG5wcm9qZWN0WWVhcnMgPSBpbnB1dFByb2plY3RPcHRpb25zLnllYXJzLnZhbHVlXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVuZGVyX2Vjb25QZXJmV2Fsa3Rocm91Z2ggPSAoKSA9PiB7XG4gIGNvbnN0IHRlcm1zID0ge1xuICAgIG5vbmU6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMudGVybXMubm9uZSwge1xuICAgICAga2V5OiBsYW5ndWFnZS5rZXksXG4gICAgfSksXG4gICAgbG93OiBfbGFuZyhuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLnRlcm1zLmxvdywge1xuICAgICAga2V5OiBsYW5ndWFnZS5rZXksXG4gICAgfSksXG4gICAgbW9kZXJhdGU6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMudGVybXMubW9kZXJhdGUsIHtcbiAgICAgIGtleTogbGFuZ3VhZ2Uua2V5LFxuICAgIH0pLFxuICAgIGhpZ2g6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMudGVybXMuaGlnaCwge1xuICAgICAga2V5OiBsYW5ndWFnZS5rZXksXG4gICAgfSksXG4gICAgaW5jcmVtZW50YWw6IF9sYW5nKG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMudGVybXMuaW5jcmVtZW50YWwpLFxuICAgIHRyYW5zZm9ybWF0aXZlOiBfbGFuZyhcbiAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMudGVybXMudHJhbnNmb3JtYXRpdmUsXG4gICAgKSxcbiAgfTtcbiAgY29uc3QgZGF0YVByb2RJbXBhY3QgPSBbXG4gICAgeyBsYWJlbDogYDEwJSAoJHt0ZXJtcy5pbmNyZW1lbnRhbH0pYCwgdmFsdWU6IDAuMSB9LFxuICAgIHsgbGFiZWw6IGAyMCVgLCB2YWx1ZTogMC4yIH0sXG4gICAgeyBsYWJlbDogYDMwJSAoJHt0ZXJtcy5tb2RlcmF0ZX0pYCwgdmFsdWU6IDAuMyB9LFxuICAgIHsgbGFiZWw6IGA0MCVgLCB2YWx1ZTogMC40IH0sXG4gICAgeyBsYWJlbDogYDUwJSAoJHt0ZXJtcy50cmFuc2Zvcm1hdGl2ZX0pYCwgdmFsdWU6IDAuNSB9LFxuICBdO1xuICBjb25zdCBpbnB1dFByb2RJbXBhY3QgPSBJbnB1dHMuc2VsZWN0KGRhdGFQcm9kSW1wYWN0LCB7XG4gICAgbGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMucHJvZEltcGFjdERyb3Bkb3duLmxhYmVsLFxuICAgICAgKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMucHJvZEltcGFjdERyb3Bkb3duLnRvb2x0aXAsXG4gICAgICApLFxuICAgIH0pLFxuICAgIGZvcm1hdDogKHgpID0+IHgubGFiZWwsXG4gICAgdmFsdWU6IGRhdGFQcm9kSW1wYWN0LmZpbmQoKGQpID0+IGQudmFsdWUgPT0gMC4zKSxcbiAgfSk7XG4gIGNvbnN0IGRhdGFBZG9wdGlvbiA9IFtcbiAgICB7IGxhYmVsOiBgMC41JSAoJHt0ZXJtcy5sb3d9KWAsIHZhbHVlOiAwLjAwNSB9LFxuICAgIHsgbGFiZWw6IGAxJSAoJHt0ZXJtcy5tb2RlcmF0ZX0pYCwgdmFsdWU6IDAuMDEgfSxcbiAgICB7IGxhYmVsOiBgMiUgKCR7dGVybXMuaGlnaH0pYCwgdmFsdWU6IDAuMDIgfSxcbiAgXTtcbiAgY29uc3QgaW5wdXRBZG9wdGlvbiA9IElucHV0cy5zZWxlY3QoZGF0YUFkb3B0aW9uLCB7XG4gICAgbGFiZWw6IG1ha2VUb29sdGlwTGFiZWwoe1xuICAgICAgbGFiZWxUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuYWRvcHRpb25SYXRlRHJvcGRvd24ubGFiZWwsXG4gICAgICApLFxuICAgICAgdG9vbHRpcFRleHQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQucHJvamVjdFNldHVwLmJsb2Nrcy5pbXBhY3RzLmlucHV0cy5hZG9wdGlvblJhdGVEcm9wZG93bi50b29sdGlwLFxuICAgICAgKSxcbiAgICB9KSxcbiAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsLFxuICAgIHZhbHVlOiBkYXRhQWRvcHRpb24uZmluZCgoZCkgPT4gZC52YWx1ZSA9PSAwLjAxKSxcbiAgfSk7XG4gIGNvbnN0IGRhdGFDaXNJbXBhY3QgPSBbXG4gICAgeyBsYWJlbDogYDAlICgke3Rlcm1zLm5vbmV9KWAsIHZhbHVlOiAwIH0sXG4gICAgeyBsYWJlbDogYDEwJSAoJHt0ZXJtcy5sb3d9KWAsIHZhbHVlOiAwLjEgfSxcbiAgICB7IGxhYmVsOiBgMjUlICgke3Rlcm1zLm1vZGVyYXRlfSlgLCB2YWx1ZTogMC4yNSB9LFxuICAgIHsgbGFiZWw6IGA1MCUgKCR7dGVybXMuaGlnaH0pYCwgdmFsdWU6IDAuNSB9LFxuICBdO1xuICBjb25zdCBpbnB1dENpc0ltcGFjdCA9IElucHV0cy5zZWxlY3QoZGF0YUNpc0ltcGFjdCwge1xuICAgIGxhYmVsOiBtYWtlVG9vbHRpcExhYmVsKHtcbiAgICAgIGxhYmVsVGV4dDogX2xhbmcoXG4gICAgICAgIG5iVGV4dC5wcm9qZWN0U2V0dXAuYmxvY2tzLmltcGFjdHMuaW5wdXRzLmNpc0ltcGFjdERyb3Bkb3duLmxhYmVsLFxuICAgICAgKSxcbiAgICAgIHRvb2x0aXBUZXh0OiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LnByb2plY3RTZXR1cC5ibG9ja3MuaW1wYWN0cy5pbnB1dHMuY2lzSW1wYWN0RHJvcGRvd24udG9vbHRpcCxcbiAgICAgICksXG4gICAgfSksXG4gICAgZm9ybWF0OiAoeCkgPT4geC5sYWJlbCxcbiAgICB2YWx1ZTogZGF0YUNpc0ltcGFjdC5maW5kKChkKSA9PiBkLnZhbHVlID09IDAuMjUpLFxuICB9KTtcbiAgcmV0dXJuIElucHV0cy5mb3JtKFxuICAgIHtcbiAgICAgIGlucHV0UHJvZEltcGFjdCxcbiAgICAgIGlucHV0QWRvcHRpb24sXG4gICAgICBpbnB1dENpc0ltcGFjdCxcbiAgICB9LFxuICAgIHtcbiAgICAgIHRlbXBsYXRlOiBpbnB1dFRlbXBsYXRlKHsgZ2FwOiBcIjNlbVwiIH0pLFxuICAgIH0sXG4gICk7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBkaXNjb3VudFJhdGUgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLHtzdGVwOiAwLjAxLCBmb3JtYXQ6IHggPT4gKHggKiAxMDApLCB2YWx1ZTogMC4xMiwgbGFiZWw6IFwiRGlzY291bnQgUmF0ZVwifSApIC8vIDAtMSBhcyBhIHBjdFxudmlld29mIGJjciA9IElucHV0cy5yYW5nZShbMC41LCAyXSwge3N0ZXA6IDAuMDEsIGxhYmVsOiBcIkJDUlwiLCB2YWx1ZTogMS42Mn0gKVxuXG5cbnZpZXdvZiB1bmNlcnRhaW50eUJlbmVmaXRTY2FsZSA9IElucHV0cy5mb3JtKFxuICAgIHtcbiAgICAgIGxvdzogSW5wdXRzLnJhbmdlKFswLjUsIDFdLCB7XG4gICAgICAgIHN0ZXA6IDAuMDEsXG4gICAgICAgIHZhbHVlOiAwLjksXG4gICAgICB9KSxcbiAgICAgIGhpZ2g6IElucHV0cy5yYW5nZShbMSwgMS44XSwge1xuICAgICAgICBzdGVwOiAwLjAxLFxuICAgICAgICB2YWx1ZTogMS4yLFxuICAgICAgfSksXG4gICAgfSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogaW5wdXRUZW1wbGF0ZSh7IGdhcDogXCIzZW1cIiB9KSxcbiAgICB9LFxuICApO1xuXG52aWV3b2YgdW5jZXJ0YWludHlDb3N0U2NhbGUgPSBJbnB1dHMuZm9ybShcbiAgICB7XG4gICAgICBsb3c6IElucHV0cy5yYW5nZShbMC41LCAxXSwge1xuICAgICAgICBzdGVwOiAwLjAxLFxuICAgICAgICB2YWx1ZTogMC45LFxuICAgICAgfSksXG4gICAgICBoaWdoOiBJbnB1dHMucmFuZ2UoWzEsIDEuOF0sIHtcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgdmFsdWU6IDEuMixcbiAgICAgIH0pLFxuICAgIH0sXG4gICAge1xuICAgICAgdGVtcGxhdGU6IGlucHV0VGVtcGxhdGUoeyBnYXA6IFwiM2VtXCIgfSksXG4gICAgfSxcbiAgKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBQbG90IFZhcmlhYmxlXG4vLyBiYXNlIHNlbGVjdG9yIGZvciBtZXRyaWMgdHlwZVxudmlld29mIHBpY2tNZXRyaWNXYWxrdGhyb3VnaCA9IHtcbiAgcmV0dXJuIElucHV0cy5zZWxlY3QoZGF0YVBpY2tNZXRyaWMsIHtcbiAgICBsYWJlbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuZ2VuZXJhbC50ZXJtcy5pbmRpY2F0b3IpLFxuICAgIGZvcm1hdDogKHgpID0+IHgubGFiZWxGdWxsLFxuICAgIHZhbHVlOiBkYXRhUGlja01ldHJpYy5maW5kKChkKSA9PiBkLmtleSA9PSBcImlyclwiKVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbXBvcnQgeyBkcm9wZG93bklucHV0LCBkcm9wZG93bkNTUyB9IGZyb20gXCIvaGVscGVycy9tdWx0aVNlbGVjdC5vanNcIjtcblxuZHJvcGRvd25DU1M7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGVib3VuY2UgPSAoaW5wdXQsIGRlbGF5ID0gNTAwKSA9PiB7XG4gIGNsYXNzIERlbGF5ZWRFdmVudCBleHRlbmRzIEV2ZW50IHt9XG4gIGxldCBpZDtcbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIChlKSA9PiB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBEZWxheWVkRXZlbnQpIHJldHVybjtcbiAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgIGNsZWFyVGltZW91dChpZCk7XG4gICAgaWQgPSBzZXRUaW1lb3V0KFxuICAgICAgKCkgPT4gaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRGVsYXllZEV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKSxcbiAgICAgIGRlbGF5LFxuICAgICk7XG4gIH0pO1xuICByZXR1cm4gaW5wdXQ7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIFRoaXMgY2VsbCBpcyB0byBjb250YWluIGFsbCB0aGUgaGVhZGluZ3MgYW5kIHRoZSBub3RlYm9vayB0aXRsZVxubmJUaXRsZSA9IF9sYW5nKHtcbiAgZW46IFwiRXN0aW1hdGUgRWNvbm9taWMgUmV0dXJucyBvbiBBZGFwdGF0aW9uXCIsXG4gIGZyOiBcIkVzdGltZXIgbGVzIHJldG91cnMgc3VyIMOpY29ub21pcXVlcyBsJ2FkYXB0YXRpb25cIixcbn0pO1xuLy8ga2V5X2luc2lnaHRzID0gX2xhbmcoe2VuOiBcIktleSBJbnNpZ2h0c1wiLCBmcjogXCJSw6lzdW3DqVwifSlcbm5iT3ZlcnZpZXcgPSBfbGFuZyh7IGVuOiBcIk92ZXJ2aWV3XCIsIGZyOiBcIlZ1ZSBk4oCZRW5zZW1ibGVcIiB9KTtcbmhlYWRpbmcxID0gX2xhbmcoeyBlbjogXCJQcm9qZWN0IFNldC1VcFwiLCBmcjogXCJDb25maWd1cmF0aW9uIGRlIFByb2plY3RcIiB9KTtcbmhlYWRpbmcyID0gX2xhbmcoeyBlbjogXCJJbnZlc3RtZW50IFJldHVybnNcIiwgZnI6IFwiUmV0b3VycyBkJ0ludmVzdGlzc2VtZW50c1wiIH0pO1xubmJTdW1tYXJ5ID0gX2xhbmcoeyBlbjogXCJTdW1tYXJ5XCIsIGZyOiBcIlLDqXN1bcOpXCIgfSk7XG5uYk1ldGhvZHMgPSBfbGFuZyh7IGVuOiBcIk1ldGhvZHMgJiBTb3VyY2VzXCIsIGZyOiBcIk3DqXRob2RlcyAmIFNvdXJjZXNcIiB9KTtcbmNvbnRyaWJ1dGlvbnMgPSBfbGFuZyhnZW5lcmFsX3RyYW5zbGF0aW9ucy5jb250cmlidXRvcnMpO1xuYXBwZW5kaXggPSBfbGFuZyhnZW5lcmFsX3RyYW5zbGF0aW9ucy5hcHBlbmRpeCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW1wb3J0IHsgbGFuZyBhcyBMYW5nIH0gZnJvbSBcIi9oZWxwZXJzL2xhbmcuanNcIlxuXG5nZW5lcmFsX3RyYW5zbGF0aW9ucyA9IGF3YWl0IEZpbGVBdHRhY2htZW50KFwiL2RhdGEvc2hhcmVkL2dlbmVyYWxUcmFuc2xhdGlvbnMuanNvblwiKS5qc29uKClcblxubmJUZXh0ID0gYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCIvZGF0YS9lY29ub21pY1JldHVybnMvdHJhbnNsYXRpb25zLmpzb25cIikuanNvbigpXG5cbmxhbmd1YWdlcyA9IFtcbiAgeyBrZXk6IFwiZW5cIiwgbGFiZWw6IFwiRW5nbGlzaFwiLCBsb2NhbGU6ICdlbi1VUycgfSxcbiAgeyBrZXk6IFwiZnJcIiwgbGFiZWw6IFwiRnJhbsOnYWlzXCIsIGxvY2FsZTogJ2ZyLUZSJyB9XG5dXG5cbmRlZmF1bHRMYW5nS2V5ID0ge1xuICBjb25zdCBuYW1lID0gXCJsYW5nXCI7XG4gIGNvbnN0IGxpc3QgPSBsYW5ndWFnZXMubWFwKChkKSA9PiBkLmtleSk7XG4gIGNvbnN0IGRlZmF1bHRLZXkgPSBcImVuXCI7XG4gIGNvbnN0IHF1ZXJ5UGFyYW0gPSBhd2FpdCBMYW5nLmdldFBhcmFtRnJvbUxpc3QoeyBuYW1lLCBsaXN0IH0pO1xuICByZXR1cm4gcXVlcnlQYXJhbSA/PyBkZWZhdWx0S2V5O1xufVxuXG5fbGFuZyA9IExhbmcubGcobWFzdGVyTGFuZ3VhZ2Uua2V5KVxuXG52aWV3b2YgbWFzdGVyTGFuZ3VhZ2UgPSBJbnB1dHMucmFkaW8obGFuZ3VhZ2VzLCB7XG4gIGxhYmVsOiBcIk1haW4gbGFuZ3VhZ2UgdG9nZ2xlXCIsXG4gIGZvcm1hdDogKGQpID0+IGQua2V5LFxuICB2YWx1ZTogbGFuZ3VhZ2VzLmZpbmQoKHgpID0+IHgua2V5ID09PSBkZWZhdWx0TGFuZ0tleSksXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIE5hdmJhckxhbmdTZWxlY3RvcihsYW5ndWFnZV9vYmosIG1hc3Rlckxhbmd1YWdlKSB7XG4gIGxldCBuYXZFbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5hdmJhci1uYXYubXMtYXV0byAubmF2LWl0ZW0uY29tcGFjdFwiKTtcbiAgaWYgKG5hdkVuZCkge1xuICAgIGxldCBleGlzdGluZ0xhbmdTZWxlY3RvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmF2LWxhbmctc2VsZWN0b3JcIik7XG4gICAgaWYgKCFleGlzdGluZ0xhbmdTZWxlY3Rvcikge1xuICAgICAgbGV0IGxhbmdfc2VsID0gSW5wdXRzLmJpbmQoXG4gICAgICAgIElucHV0cy5yYWRpbyhsYW5ndWFnZV9vYmosIHtcbiAgICAgICAgICBsYWJlbDogXCJcIixcbiAgICAgICAgICBmb3JtYXQ6IChkKSA9PiBkLmxhYmVsXG4gICAgICAgIH0pLFxuICAgICAgICB2aWV3b2YgbWFzdGVyTGFuZ3VhZ2VcbiAgICAgICk7XG4gICAgICBsYW5nX3NlbC5pZCA9IFwibmF2LWxhbmctc2VsZWN0b3JcIjtcblxuICAgICAgLy8gSGFjayB0aGUgY3NzIHRvZ2V0aGVyIGZvciB0aGUgb2JzZXJ2YWJsZSBpbnB1dHNcbiAgICAgIGxhbmdfc2VsLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIGxhbmdfc2VsLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xuICAgICAgbGFuZ19zZWwuc3R5bGUubWFyZ2luTGVmdCA9IFwiMTBweFwiO1xuICAgICAgbGV0IGxhbmdfZGl2ID0gbGFuZ19zZWwucXVlcnlTZWxlY3RvcihcImRpdlwiKTtcbiAgICAgIGxhbmdfZGl2LnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgIGxhbmdfZGl2LnN0eWxlLmZsZXhEaXJlY3Rpb24gPSBcImNvbHVtblwiO1xuXG4gICAgICAvLyBJbnNlcnQgdGhlIG5ldyBpdGVtIGFmdGVyIHRoZSBHaXRIdWIgaWNvbiBhbmQgb3RoZXIgZWxlbWVudHNcbiAgICAgIG5hdkVuZC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGxhbmdfc2VsKTtcbiAgICB9XG4gIH1cbn1cblxuTmF2YmFyTGFuZ1NlbGVjdG9yKGxhbmd1YWdlcywgbWFzdGVyTGFuZ3VhZ2UpXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YVBpY2tNZXRyaWMgPSB7XG4gIHJldHVybiBbXG4gICAge1xuICAgICAga2V5OiBcImlyclwiLFxuICAgICAgY29sdW1uTmFtZTogXCJpcnJcIixcbiAgICAgIGxhYmVsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIubGFiZWwpLFxuICAgICAgdG9vbHRpcDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLnRvb2x0aXApLFxuICAgICAgbGFiZWxMb25nOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5pcnIubGFiZWxMb25nKSxcbiAgICAgIGxhYmVsRnVsbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuaXJyLmxhYmVsRnVsbCksXG4gICAgICBpbmZvOiB7XG4gICAgICAgIHdoYXQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmlyci5pbmZvLndoYXQpLFxuICAgICAgICBpbnRlcnByZXQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmlyci5pbmZvLmludGVycHJldCksXG4gICAgICAgIHRlbGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmlyci5pbmZvLnRlbGwpXG4gICAgICB9LFxuICAgICAgeUZvcm1hdDogKGQpID0+IGAke2QudG9GaXhlZCgxKX0lYFxuICAgIH0sXG4gICAge1xuICAgICAga2V5OiBcIm1pcnJcIixcbiAgICAgIGNvbHVtbk5hbWU6IFwibWlyclwiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm1pcnIubGFiZWwpLFxuICAgICAgdG9vbHRpcDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci50b29sdGlwKSxcbiAgICAgIGxhYmVsTG9uZzogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci5sYWJlbExvbmcpLFxuICAgICAgbGFiZWxGdWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLmxhYmVsRnVsbCksXG4gICAgICBpbmZvOiB7XG4gICAgICAgIHdoYXQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm1pcnIuaW5mby53aGF0KSxcbiAgICAgICAgaW50ZXJwcmV0OiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5taXJyLmluZm8uaW50ZXJwcmV0KSxcbiAgICAgICAgdGVsbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubWlyci5pbmZvLnRlbGwpXG4gICAgICB9LFxuICAgICAgeUZvcm1hdDogKGQpID0+IGAke2QudG9GaXhlZCgxKX0lYFxuICAgIH0sXG4gICAge1xuICAgICAga2V5OiBcIm5wdlwiLFxuICAgICAgY29sdW1uTmFtZTogXCJucHZcIixcbiAgICAgIGxhYmVsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5ucHYubGFiZWwpLFxuICAgICAgdG9vbHRpcDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2LnRvb2x0aXApLFxuICAgICAgbGFiZWxMb25nOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5ucHYubGFiZWxMb25nKSxcbiAgICAgIGxhYmVsRnVsbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMubnB2LmxhYmVsRnVsbCksXG4gICAgICBpbmZvOiB7XG4gICAgICAgIHdoYXQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi5pbmZvLndoYXQpLFxuICAgICAgICBpbnRlcnByZXQ6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi5pbmZvLmludGVycHJldCksXG4gICAgICAgIHRlbGw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLm5wdi5pbmZvLnRlbGwpXG4gICAgICB9LFxuICAgICAgIHlGb3JtYXQ6IChkKSA9PiBmb3JtYXRVU0QoKShkKVxuICAgIH0sXG4gICAge1xuICAgICAga2V5OiBcImJjclwiLFxuICAgICAgY29sdW1uTmFtZTogXCJkaXNjb3VudGVkX2JjclwiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmJjci5sYWJlbCksXG4gICAgICB0b29sdGlwOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IudG9vbHRpcCksXG4gICAgICBsYWJlbExvbmc6IF9sYW5nKG5iVGV4dC5pbmRpY2F0b3JzLmJjci5sYWJlbExvbmcpLFxuICAgICAgbGFiZWxGdWxsOiBfbGFuZyhuYlRleHQuaW5kaWNhdG9ycy5iY3IubGFiZWxGdWxsKSxcbiAgICAgIGluZm86IHtcbiAgICAgICAgd2hhdDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLmluZm8ud2hhdCksXG4gICAgICAgIGludGVycHJldDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLmluZm8uaW50ZXJwcmV0KSxcbiAgICAgICAgdGVsbDogX2xhbmcobmJUZXh0LmluZGljYXRvcnMuYmNyLmluZm8udGVsbClcbiAgICAgIH0sXG4gICAgICB5Rm9ybWF0OiBkMy5mb3JtYXQoXCIuMmZcIilcbiAgICB9XG4gIF07XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVuZGVyUmV2aWV3MSA9ICgpID0+IHtcbiAgY29uc3QgbGFuZ0Jhc2VQYXRoID0gbmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5pbnNpZ2h0UmV2aWV3LnNldHVwQmxvY2s7XG4gIGNvbnN0IGxhbmdNaXNzaW5nVGVtcGxhdGUgPSBfbGFuZyhsYW5nQmFzZVBhdGgubWlzc2luZ01lc3NhZ2UsIHtcbiAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgfSk7XG5cbiAgY29uc3QgaXNvU2V0ID0gbmV3IFNldChzZWxlY3RfY291bnRyeSk7XG5cbiAgY29uc3QgYWRtaW4wTGlzdCA9IGNvdW50cmllc1xuICAgIC5maWx0ZXIoKGQpID0+IGlzb1NldC5oYXMoZC5pc28zYykpXG4gICAgLm1hcCgoZCkgPT4gZC5hZG1pbjBfbmFtZSk7XG5cbiAgY29uc3QgY3JvcExpc3QgPSBzZWxlY3RfY3JvcDtcblxuICAvLyBjb25zdCBjcm9wTGlzdCA9IGFkbWluQ3JvcENob2ljZXMuY3JvcHMuc29ydCgoYSxiKSA9PiBfbGFuZyhhLnRyYW5zbGF0aW9uKSA+IF9sYW5nKGIudHJhbnNsYXRpb24pKTtcbiAgY29uc3QgdHJ1bmNhdGVTaXplID0gMztcbiAgY29uc3QgYWRtaW4wTGlzdFRydW5jYXRlZCA9IGFkbWluMExpc3Quc2xpY2UoMCwgdHJ1bmNhdGVTaXplKTtcbiAgY29uc3QgY3JvcExpc3RUcnVuY2F0ZWQgPSBjcm9wTGlzdC5zbGljZSgwLCB0cnVuY2F0ZVNpemUpOyAvLyAubWFwKChkKSA9PiBfbGFuZyhkLnRyYW5zbGF0aW9uKSk7XG5cbiAgaWYgKGFkbWluMExpc3QubGVuZ3RoID09IDAgfHwgY3JvcExpc3QubGVuZ3RoID09IDApIHtcbiAgICByZXR1cm4gbWRgJHtsYW5nTWlzc2luZ1RlbXBsYXRlfWA7XG4gIH1cblxuICAvLyBuZXcgY29kZVxuICBjb25zdCBpbnNlcnRDcm9wQ291bnQgPSBjcm9wTGlzdC5sZW5ndGg7XG4gIGNvbnN0IGluc2VydENyb3BXb3JkID1cbiAgICBjcm9wTGlzdC5sZW5ndGggPT0gMVxuICAgICAgPyBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5jcm9wLnNpbmd1bGFyLCB7XG4gICAgICAgICAga2V5OiBsYW5ndWFnZS5rZXksXG4gICAgICAgIH0pXG4gICAgICA6IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNyb3AucGx1cmFsLCB7XG4gICAgICAgICAga2V5OiBsYW5ndWFnZS5rZXksXG4gICAgICAgIH0pO1xuICBjb25zdCBpbnNlcnRDcm9wTGlzdCA9IGAoKioke2Nyb3BMaXN0VHJ1bmNhdGVkLmpvaW4oXCIsIFwiKX0ke1xuICAgIGNyb3BMaXN0Lmxlbmd0aCA+IHRydW5jYXRlU2l6ZSA/IFwiLi4uXCIgOiBcIlwiXG4gIH0qKilgO1xuICBjb25zdCBpbnNlcnRDcm9wID0gYCoqJHtpbnNlcnRDcm9wQ291bnR9ICR7aW5zZXJ0Q3JvcFdvcmR9KiogJHtpbnNlcnRDcm9wTGlzdH1gO1xuXG4gIGNvbnN0IGluc2VydFJlZ2lvbkNvdW50ID0gc2VsZWN0X3JlZ2lvbi5sZW5ndGg7XG4gIGNvbnN0IGluc2VydFJlZ2lvbldvcmQgPVxuICAgIGluc2VydFJlZ2lvbkNvdW50ID09IDFcbiAgICAgID8gX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMucmVnaW9uLnNpbmd1bGFyLCB7XG4gICAgICAgICAga2V5OiBsYW5ndWFnZS5rZXksXG4gICAgICAgIH0pXG4gICAgICA6IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLnJlZ2lvbi5wbHVyYWwsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSk7XG4gIGNvbnN0IGluc2VydFJlZ2lvbiA9IGAke2luc2VydFJlZ2lvbkNvdW50fSAke2luc2VydFJlZ2lvbldvcmR9YDtcblxuICBjb25zdCBpbnNlcnRDb3VudHJ5Q291bnQgPSBhZG1pbjBMaXN0Lmxlbmd0aDtcbiAgY29uc3QgaW5zZXJ0Q291bnRyeVdvcmQgPVxuICAgIGluc2VydENvdW50cnlDb3VudCA9PSAxXG4gICAgICA/IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNvdW50cnkuc2luZ3VsYXIsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSlcbiAgICAgIDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMuY291bnRyeS5wbHVyYWwsIHtcbiAgICAgICAgICBrZXk6IGxhbmd1YWdlLmtleSxcbiAgICAgICAgfSk7XG4gIGNvbnN0IGluc2VydENvdW50cnlMaXN0ID0gYCgqKiR7YWRtaW4wTGlzdFRydW5jYXRlZC5qb2luKFwiLCBcIil9JHtcbiAgICBpbnNlcnRDb3VudHJ5Q291bnQgPiB0cnVuY2F0ZVNpemUgPyBcIi4uLlwiIDogXCJcIlxuICB9KiopYDtcbiAgY29uc3QgaW5zZXJ0Q291bnRyeSA9IGAqKiR7aW5zZXJ0Q291bnRyeUNvdW50fSAke2luc2VydENvdW50cnlXb3JkfSoqICR7aW5zZXJ0Q291bnRyeUxpc3R9YDtcblxuICAvLyBpbnNlcnQgdG8gdGVtcGxhdGVcbiAgY29uc3QgbGFuZ1RlbXBsYXRlID0gX2xhbmcobGFuZ0Jhc2VQYXRoLnRlbXBsYXRlLCB7XG4gICAga2V5OiBsYW5ndWFnZS5rZXksXG4gIH0pO1xuICBjb25zdCBsYW5nVGVtcGxhdGVJdGVtcyA9IFtcbiAgICB7IG5hbWU6IFwiY3JvcF9zdHJpbmdcIiwgdmFsdWU6IGluc2VydENyb3AgfSxcbiAgICB7IG5hbWU6IFwicmVnaW9uX3N0cmluZ1wiLCB2YWx1ZTogaW5zZXJ0UmVnaW9uIH0sXG4gICAgeyBuYW1lOiBcImNvdW50cnlfc3RyaW5nXCIsIHZhbHVlOiBpbnNlcnRDb3VudHJ5IH0sXG4gICAge1xuICAgICAgbmFtZTogXCJjb3N0X3N0cmluZ1wiLFxuICAgICAgdmFsdWU6IGZvcm1hdFVTRCh7IGxvY2FsZTogbGFuZ3VhZ2UubG9jYWxlIH0pKHJhbmdlUHJvamVjdENvc3QpLFxuICAgIH0sXG4gICAgeyBuYW1lOiBcInllYXJfc3RyaW5nXCIsIHZhbHVlOiBwcm9qZWN0WWVhcnMgKyBcIiB5ZWFyc1wiIH0sIC8vVE9ETzogYWRkIGNvcnJlY3QgXCJ5ZWFyc1wiIHN0cmluZyBhdCBlbmQgb2YgdGhpc1xuICBdO1xuICBjb25zdCBzZWxlY3Rpb25Gb3JtYXR0ZWRUZW1wbGF0ZSA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgbGFuZ1RlbXBsYXRlLFxuICAgIGxhbmdUZW1wbGF0ZUl0ZW1zLFxuICApO1xuXG4gIHJldHVybiBtZGAke3NlbGVjdGlvbkZvcm1hdHRlZFRlbXBsYXRlfWA7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlbmRlclJldmlldzIgPSAoKSA9PiB7XG4gIGNvbnN0IGludmVzdG1lbnRUZW1wbGF0ZSA9IF9sYW5nKFxuICAgIG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuaW5zaWdodFJldmlldy5pbmRpY2F0b3JCbG9jayxcbiAgKTtcbiAgY29uc3QgaW52ZXN0bWVudFRlbXBsYXRlSXRlbXMgPSBbXG4gICAge1xuICAgICAgbmFtZTogXCJwcm9kX2ltcGFjdF9sYWJlbFwiLFxuICAgICAgdmFsdWU6IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dFByb2RJbXBhY3QubGFiZWwsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcImFkb3B0aW9uX3JhdGVfbGFiZWxcIixcbiAgICAgIHZhbHVlOiBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRBZG9wdGlvbi5sYWJlbCxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiY2lzX2ltcGFjdF9sYWJlbFwiLFxuICAgICAgdmFsdWU6IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dENpc0ltcGFjdC5sYWJlbCxcbiAgICB9LFxuICAgIHsgbmFtZTogXCJ5ZWFyX3N0cmluZ1wiLCB2YWx1ZTogcHJvamVjdFllYXJzICsgXCIgeWVhcnNcIiB9LFxuICBdO1xuXG4gIHJldHVybiBtZGAke0xhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoaW52ZXN0bWVudFRlbXBsYXRlLCBpbnZlc3RtZW50VGVtcGxhdGVJdGVtcyl9OmA7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJpZ051bWJlcnNSZXN1bHRzID0gKCkgPT4ge1xuICBjb25zdCB5ID0gcHJvamVjdFllYXJzO1xuICBjb25zdCBlID0gd2Fsa3Rocm91Z2hFY29ub21pY0luZGljYXRvcnM/LmVucmljaGVkPy5maW5kKChkKSA9PiBkLnllYXIgPT09IHkpO1xuXG4gIGNvbnN0IGRhdGEgPSBkYXRhUGlja01ldHJpYy5tYXAoKGQpID0+IHtcbiAgICBsZXQgdmFsdWU7XG5cbiAgICBpZiAoZC5rZXkgPT09IFwiaXJyXCIgJiYgZT8uaXJyICE9IG51bGwpIHtcbiAgICAgIHZhbHVlID0gZS5pcnI7IC8vIElSUiBhcyBwZXJjZW50YWdlXG4gICAgfSBlbHNlIGlmIChkLmtleSA9PT0gXCJtaXJyXCIgJiYgZT8ubWlyciAhPSBudWxsKSB7XG4gICAgICB2YWx1ZSA9IGUubWlycjsgLy8gTUlSUiBhcyBwZXJjZW50YWdlXG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGQua2V5ID09PSBcIm5wdlwiICYmXG4gICAgICBlPy5kaXNjb3VudGVkX2JlbmVmaXRfY3VtICE9IG51bGwgJiZcbiAgICAgIGU/LmRpc2NvdW50ZWRfY29zdF9jdW0gIT0gbnVsbFxuICAgICkge1xuICAgICAgdmFsdWUgPSArKGUuZGlzY291bnRlZF9iZW5lZml0X2N1bSAtIGUuZGlzY291bnRlZF9jb3N0X2N1bSkudG9GaXhlZCgxKTsgLy8gTlBWLCAxIGRwXG4gICAgfSBlbHNlIGlmIChkLmtleSA9PT0gXCJiY3JcIikge1xuICAgICAgdmFsdWUgPSBlPy5kaXNjb3VudGVkX2JjcjtcbiAgICB9XG5cbiAgICByZXR1cm4geyAuLi5kLCB2YWx1ZSB9O1xuICB9KTtcblxuICByZXR1cm4gaHRsLmh0bWxgXG4gIDxzdHlsZT5cbiAgICAub3V0ZXItZGl2IHtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBnYXA6IDJlbTtcbiAgICB9XG4gICAgLmlubmVyLWRpdiB7XG4gICAgICB3aWR0aDogMzAlO1xuICAgICAgcGFkZGluZzogODBweCAzMHB4O1xuICAgICAgYm9yZGVyOiAxcHggc29saWQgI2VmZWZlZjtcbiAgICB9XG4gICAgLmxhYmVsIHtcbiAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7XG4gICAgICBjb2xvcjogIzY2NjtcbiAgICB9XG4gICAgLnZhbHVlIHtcbiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgICAgZm9udC1zaXplOiA0MnB4O1xuICAgIH1cbiAgICAubmVnYXRpdmUge1xuICAgICAgY29sb3I6ICNFQzVBNDc7XG4gICAgfVxuICAgIC50b29sdGlwLWNhcmQge1xuICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICB9XG4gICAgLnRvb2x0aXAtY2FyZCAudG9vbHRpcHRleHQtY2FyZCB7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgei1pbmRleDogMTtcbiAgICAgICAgdmlzaWJpbGl0eTogaGlkZGVuO1xuICAgICAgICBsZWZ0OiAwO1xuICAgICAgICBib3R0b206IDkwJTtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2VmZWZlZjtcbiAgICAgICAgY29sb3I6ICMzMzM7XG4gICAgICAgIHBhZGRpbmc6IDE0cHggMjBweDtcbiAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICBsaW5lLWhlaWdodDogMS42O1xuICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0O1xuICAgICAgICBvcGFjaXR5OiAwO1xuICAgICAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuM3M7XG4gICAgfVxuICAgIC50b29sdGlwLWNhcmQ6aG92ZXIgLnRvb2x0aXB0ZXh0LWNhcmQge1xuICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlO1xuICAgICAgICBvcGFjaXR5OiAxO1xuICAgICAgICBjdXJzb3I6IGRlZmF1bHQ7XG4gICAgfVxuICA8L3N0eWxlPlxuXG4gIDxib2R5PlxuICAgIDxkaXYgY2xhc3M9XCJvdXRlci1kaXZcIj5cbiAgICAgICR7ZGF0YS5tYXAoXG4gICAgICAgIChkKSA9PiBodGwuaHRtbGA8ZGl2IGNsYXNzPVwiaW5uZXItZGl2XCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b29sdGlwLWNhcmRcIj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidG9vbHRpcHRleHQtY2FyZFwiPiR7ZC50b29sdGlwfTwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidmFsdWUgJHtkLnZhbHVlICE9IG51bGwgJiYgZC52YWx1ZSA8IDAgPyBcIm5lZ2F0aXZlXCIgOiBcIlwifVwiPiR7XG4gICAgICAgICAgICAgIGQudmFsdWUgIT0gbnVsbCA/IGQueUZvcm1hdChkLnZhbHVlKSA6IFwiLS0tXCJcbiAgICAgICAgICAgIH08L3NwYW4+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImxhYmVsXCI+JHtkLmxhYmVsRnVsbH08L3NwYW4+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L2Rpdj5gLFxuICAgICAgKX1cbiAgICA8L2Rpdj5cbiAgPC9ib2R5PmA7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlc3VsdFRhYmxlID0gKCkgPT4ge1xuICBjb25zdCBmbXRVU0QgPSBmb3JtYXRVU0QoeyBsb2NhbGU6IGxhbmd1YWdlLmxvY2FsZSB9KTtcbiAgY29uc3Qgc2VsZWN0ZWRZZWFyID0gcHJvamVjdFllYXJzO1xuICBjb25zdCBlbnJpY2hlZCA9ICh3YWxrdGhyb3VnaEVjb25vbWljSW5kaWNhdG9ycz8uZW5yaWNoZWQgPz8gW10pLmZpbHRlcihcbiAgICAoZCkgPT4gZC55ZWFyIDw9IHNlbGVjdGVkWWVhcixcbiAgKTtcblxuICBjb25zdCB0YWJsZUhlYWRlcnMgPVxuICAgIG5iVGV4dC5pbnZlc3RtZW50UmV0dXJucy5ibG9ja3MuZXhwbG9yZUluZGljYXRvcnMudGFibGVIZWFkZXJzO1xuICBjb25zdCBoZWFkZXJOYW1lcyA9IFtcbiAgICBfbGFuZyh0YWJsZUhlYWRlcnMueWVhciksXG4gICAgX2xhbmcodGFibGVIZWFkZXJzLmJlbmVmaXQpLFxuICAgIF9sYW5nKHRhYmxlSGVhZGVycy5jb3N0KSxcbiAgICBfbGFuZyh0YWJsZUhlYWRlcnMuY2FzaGZsb3cpLFxuICAgIF9sYW5nKHRhYmxlSGVhZGVycy5kaXNjb3VudGVkQmVuZWZpdEN1bSksXG4gICAgX2xhbmcodGFibGVIZWFkZXJzLmRpc2NvdW50ZWRDb3N0Q3VtKSxcbiAgICBfbGFuZyh0YWJsZUhlYWRlcnMuZGlzY291bnRlZE5wdkN1bSksXG4gICAgX2xhbmcodGFibGVIZWFkZXJzLmRpc2NvdW50ZWRCY3IpLFxuICAgIF9sYW5nKHRhYmxlSGVhZGVycy5pcnIpLFxuICAgIF9sYW5nKHRhYmxlSGVhZGVycy5taXJyKSxcbiAgXTtcblxuICByZXR1cm4gaHRtbGBcbiAgICA8c3R5bGU+XG4gICAgICAuZWNvbi10YWJsZSB7XG4gICAgICAgIGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmO1xuICAgICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlO1xuICAgICAgICBmb250LXNpemU6IDEzLjc1cHg7XG4gICAgICAgIG1hcmdpbi10b3A6IDFlbTtcbiAgICAgICAgbWluLXdpZHRoOiAxMDAlO1xuICAgICAgfVxuICAgICAgLmVjb24tdGFibGUgdGgsIC5lY29uLXRhYmxlIHRkIHtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDtcbiAgICAgICAgcGFkZGluZzogNnB4IDEwcHg7XG4gICAgICAgIHRleHQtYWxpZ246IHJpZ2h0O1xuICAgICAgfVxuICAgICAgLmVjb24tdGFibGUgdGgge1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjRmNGY0O1xuICAgICAgICB3aGl0ZS1zcGFjZTogbm9ybWFsO1xuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICB9XG4gICAgICAuZWNvbi10YWJsZSB0ZC55ZWFyLWNvbCB7XG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICB9XG4gICAgICAuZWNvbi10YWJsZSB0ci5maW5hbC1yb3cgdGQge1xuICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2YxZjFmMTtcbiAgICAgIH1cbiAgICAgIC50YWJsZS1jb250YWluZXIge1xuICAgICAgICBvdmVyZmxvdy14OiBhdXRvO1xuICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgcGFkZGluZy1ib3R0b206IDRweDtcbiAgICAgIH1cbiAgICA8L3N0eWxlPlxuXG4gICAgPGRpdiBjbGFzcz1cInRhYmxlLWNvbnRhaW5lclwiPlxuICAgICAgPHRhYmxlIGNsYXNzPVwiZWNvbi10YWJsZVwiPlxuICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgPHRyPlxuICAgICAgICAgICAgJHtoZWFkZXJOYW1lcy5tYXAoKGgpID0+IGh0bWxgPHRoIHRpdGxlPVwiJHtofVwiPiR7aH08L3RoPmApfVxuICAgICAgICAgIDwvdHI+XG4gICAgICAgIDwvdGhlYWQ+XG4gICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAke2VucmljaGVkLm1hcCgoZCwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXNGaW5hbCA9IGkgPT09IGVucmljaGVkLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICBjb25zdCBucHZfaSA9XG4gICAgICAgICAgICAgIGQuZGlzY291bnRlZF9iZW5lZml0X2N1bSAhPSBudWxsICYmIGQuZGlzY291bnRlZF9jb3N0X2N1bSAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBkLmRpc2NvdW50ZWRfYmVuZWZpdF9jdW0gLSBkLmRpc2NvdW50ZWRfY29zdF9jdW1cbiAgICAgICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgICAgIHJldHVybiBodG1sYDx0ciBjbGFzcz0ke2lzRmluYWwgPyBcImZpbmFsLXJvd1wiIDogXCJcIn0+XG4gICAgICAgICAgICAgIDx0ZCBjbGFzcz1cInllYXItY29sXCI+JHtkLnllYXJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5wcm9qZWN0X2JlbmVmaXQgIT0gbnVsbCA/IGZtdFVTRChkLnByb2plY3RfYmVuZWZpdCkgOiBcIuKAlFwifTwvdGQ+XG4gICAgICAgICAgICAgIDx0ZD4ke2QuY29zdCAhPSBudWxsID8gZm10VVNEKGQuY29zdCkgOiBcIuKAlFwifTwvdGQ+XG4gICAgICAgICAgICAgIDx0ZD4ke2QuY2FzaGZsb3cgIT0gbnVsbCA/IGZtdFVTRChkLmNhc2hmbG93KSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5kaXNjb3VudGVkX2JlbmVmaXRfY3VtICE9IG51bGwgPyBmbXRVU0QoZC5kaXNjb3VudGVkX2JlbmVmaXRfY3VtKSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5kaXNjb3VudGVkX2Nvc3RfY3VtICE9IG51bGwgPyBmbXRVU0QoZC5kaXNjb3VudGVkX2Nvc3RfY3VtKSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7bnB2X2kgIT0gbnVsbCA/IGZtdFVTRChucHZfaSkgOiBcIuKAlFwifTwvdGQ+XG4gICAgICAgICAgICAgIDx0ZD4ke2QuZGlzY291bnRlZF9iY3IgIT0gbnVsbCA/IGQuZGlzY291bnRlZF9iY3IudG9GaXhlZCgyKSA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5pcnIgIT0gbnVsbCA/IGAkeyhkLmlycikudG9GaXhlZCgyKX0lYCA6IFwi4oCUXCJ9PC90ZD5cbiAgICAgICAgICAgICAgPHRkPiR7ZC5taXJyICE9IG51bGwgPyBgJHsoZC5taXJyKS50b0ZpeGVkKDIpfSVgIDogXCLigJRcIn08L3RkPlxuICAgICAgICAgICAgPC90cj5gO1xuICAgICAgICAgIH0pfVxuICAgICAgICA8L3Rib2R5PlxuICAgICAgPC90YWJsZT5cbiAgICA8L2Rpdj5cbiAgYDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVzdWx0UGxvdCA9ICgpID0+IHtcbiAgY29uc3QgcHJvamVjdFllYXJDdXRvZmYgPSB3YWxrdGhyb3VnaFNlbGVjdGlvbnMucHJvamVjdF95ZWFycztcbiAgY29uc3Qgc2VsZWN0b3IgPSBwaWNrTWV0cmljV2Fsa3Rocm91Z2g7XG4gIGNvbnN0IHBsb3REYXRhID0gd2Fsa3Rocm91Z2hFY29ub21pY0luZGljYXRvcnM/LmVucmljaGVkID8/IFtdO1xuICBjb25zdCB1bmNlcnRhaW50eVllYXJseSA9IHVuY2VydGFpbnR5Py55ZWFybHkgPz8gW107XG5cbiAgLy8gQWx3YXlzIGluY2x1ZGUgYWxsIHllYXJzIGZvciBjb25zaXN0ZW50IHgtYXhpc1xuICBjb25zdCBmdWxsWWVhcnMgPSBkMy5yYW5nZSgwLCBwcm9qZWN0WWVhcnMgKyAxKTsgLy8gMCB0byA4IGluY2x1c2l2ZVxuICBjb25zdCBjb21wbGV0ZVBsb3REYXRhID0gZnVsbFllYXJzLm1hcCgoeSkgPT4ge1xuICAgIGNvbnN0IHJvdyA9IHBsb3REYXRhLmZpbmQoKGQpID0+IGQueWVhciA9PT0geSk7XG4gICAgcmV0dXJuIHJvdyA/PyB7IHllYXI6IHkgfTtcbiAgfSk7XG5cbiAgY29uc3QgYmFuZERhdGEgPSAoKCkgPT4ge1xuICAgIGNvbnN0IG1ldHJpY0tleSA9IHNlbGVjdG9yLmtleTtcbiAgICByZXR1cm4gZnVsbFllYXJzXG4gICAgICAubWFwKCh5ZWFyKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdyA9IHVuY2VydGFpbnR5WWVhcmx5LmZpbmQoKGQpID0+IGQueWVhciA9PT0geWVhcik7XG4gICAgICAgIGNvbnN0IGxvdyA9IHJvdz8uW21ldHJpY0tleV0/LnAxMDtcbiAgICAgICAgY29uc3QgaGlnaCA9IHJvdz8uW21ldHJpY0tleV0/LnA5MDtcbiAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUobG93KSB8fCAhTnVtYmVyLmlzRmluaXRlKGhpZ2gpKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIHsgeWVhciwgbG93LCBoaWdoIH07XG4gICAgICB9KVxuICAgICAgLmZpbHRlcigoZCkgPT4gZCAhPSBudWxsKTtcbiAgfSkoKTtcblxuICBjb25zdCBydWxlWVZhbHVlID0gc2VsZWN0b3Iua2V5ID09PSBcImJjclwiID8gMSA6IDA7XG5cbiAgcmV0dXJuIFBsb3QucGxvdCh7XG4gICAgd2lkdGgsXG4gICAgbWFyZ2luUmlnaHQ6IDgwLFxuICAgIGluc2V0OiA1LFxuICAgIHg6IHtcbiAgICAgIGxhYmVsOiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LmludmVzdG1lbnRSZXR1cm5zLmJsb2Nrcy5leHBsb3JlSW5kaWNhdG9ycy5wcm9qZWN0WWVhcixcbiAgICAgICksXG4gICAgICB0aWNrczogZnVsbFllYXJzLFxuICAgICAgdGlja0Zvcm1hdDogXCJkXCIsXG4gICAgICBsYWJlbEFuY2hvcjogXCJjZW50ZXJcIixcbiAgICAgIGxhYmVsQXJyb3c6IFwibm9uZVwiLFxuICAgIH0sXG4gICAgeToge1xuICAgICAgbGFiZWw6IHNlbGVjdG9yLmxhYmVsLFxuICAgICAgdGlja0Zvcm1hdDogc2VsZWN0b3IueUZvcm1hdCxcbiAgICB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmF4aXNZKHtcbiAgICAgICAgYW5jaG9yOiBcInJpZ2h0XCIsXG4gICAgICAgIGxhYmVsOiBzZWxlY3Rvci5sYWJlbCxcbiAgICAgICAgdGlja0Zvcm1hdDogc2VsZWN0b3IueUZvcm1hdCxcbiAgICAgICAgdGlja1NpemU6IDAsXG4gICAgICAgIGNvbG9yOiAoZCkgPT4ge1xuICAgICAgICAgIHJldHVybiBkID49IDAgPyBcImJsYWNrXCIgOiBcIiNFQzVBNDdcIjtcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgLy8gaG9yaXpvbnRhbCByZWZlcmVuY2UgbGluZVxuICAgICAgUGxvdC5ydWxlWShbcnVsZVlWYWx1ZV0sIHtcbiAgICAgICAgc3Ryb2tlOiBcIiMzMzNcIixcbiAgICAgICAgc3Ryb2tlRGFzaGFycmF5OiBbM10sXG4gICAgICB9KSxcblxuICAgICAgUGxvdC5hcmVhWShiYW5kRGF0YSwge1xuICAgICAgICB4OiBcInllYXJcIixcbiAgICAgICAgeTE6IFwibG93XCIsXG4gICAgICAgIHkyOiBcImhpZ2hcIixcbiAgICAgICAgZmlsbDogXCIjMmM3ZmI4XCIsXG4gICAgICAgIGZpbGxPcGFjaXR5OiAwLjE2LFxuICAgICAgfSksXG5cbiAgICAgIC8vIGxpbmVcbiAgICAgIFBsb3QubGluZShjb21wbGV0ZVBsb3REYXRhLCB7XG4gICAgICAgIHg6IFwieWVhclwiLFxuICAgICAgICB5OiBzZWxlY3Rvci5jb2x1bW5OYW1lLFxuICAgICAgICBzdHJva2U6IFwiIzQ0NFwiLFxuICAgICAgICBzdHJva2VPcGFjaXR5OiAwLjcsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgICB0aXA6IHRydWUsXG4gICAgICB9KSxcblxuICAgICAgLy8gZG90c1xuICAgICAgUGxvdC5kb3QoY29tcGxldGVQbG90RGF0YSwge1xuICAgICAgICB4OiBcInllYXJcIixcbiAgICAgICAgeTogc2VsZWN0b3IuY29sdW1uTmFtZSxcbiAgICAgICAgcjogMyxcbiAgICAgICAgZmlsbDogXCIjNDQ0XCIsXG4gICAgICAgIHN0cm9rZTogXCIjZmZmXCIsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAwLjUsXG4gICAgICAgIHRpcDoge1xuICAgICAgICAgIGZvcm1hdDoge1xuICAgICAgICAgICAgeDogdHJ1ZSxcbiAgICAgICAgICAgIHk6IHNlbGVjdG9yLnlGb3JtYXQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuXG4gICAgICAvLyBoaWdobGlnaHQgc2VsZWN0ZWQgeWVhclxuICAgICAgUGxvdC5kb3QoXG4gICAgICAgIGNvbXBsZXRlUGxvdERhdGEuZmlsdGVyKChkKSA9PiBkLnllYXIgPT09IHByb2plY3RZZWFyQ3V0b2ZmKSxcbiAgICAgICAge1xuICAgICAgICAgIHg6IFwieWVhclwiLFxuICAgICAgICAgIHk6IHNlbGVjdG9yLmNvbHVtbk5hbWUsXG4gICAgICAgICAgcjogNyxcbiAgICAgICAgICBmaWxsOiBcIiNmZmZcIixcbiAgICAgICAgICBzdHJva2U6IChkKSA9PiAoZFtzZWxlY3Rvci5jb2x1bW5OYW1lXSA+PSAwID8gXCIjMzMzXCIgOiBcIiNFQzVBNDdcIiksXG4gICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgIH0sXG4gICAgICApLFxuICAgIF0sXG4gIH0pO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJhZG1pbjBfbmFtZXMgPSB7XG4gIGNvbnN0IGlzb1NldCA9IG5ldyBTZXQoc2VsZWN0X2NvdW50cnkpO1xuICByZXR1cm4gY291bnRyaWVzXG4gIC5maWx0ZXIoKGQpID0+IGlzb1NldC5oYXMoZC5pc28zYykpXG4gIC5tYXAoKGQpID0+IGQuYWRtaW4wX25hbWUpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIE1vZHVsZSBJbXBvcnRzIGZvciB0aGUgY2FsY3VsYXRpb24gb2YgUk9JIGRhdGFcbmltcG9ydCB7XG4gIGF2bG9zc0NhbGMsXG4gIGF2bG9zc0NhbGNVbmNlcnRhaW50eSxcbiAgY2FsY01JUlIsXG4gIGNhbGNJUlIsXG4gIG5wdkRpc2NyZXRlQ3VtdWxhdGl2ZSxcbiAgcnVuU2ltdWxhdGlvbkZyb21DYXNoZmxvd1Jvd3MsXG59IGZyb20gXCIvbm90ZWJvb2tzL3JvaS9yb2lfdG9vbHMuanNcIjtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtdXRhYmxlIGN2X3Jlc3VsdCA9IFtdO1xubXV0YWJsZSBjdl9jYWNoZV9rZXkgPSAnJztcblxuY2FsY0NWID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCBjaXNfaW1wYWN0ID0gb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0Q2lzSW1wYWN0LnZhbHVlO1xuXG4gIGNvbnN0IGNhY2hlX2tleSA9IGAke1suLi5hZG1pbjBfbmFtZXNdLnNvcnQoKS5qb2luKCcsJyl9fCR7Wy4uLnNlbGVjdF9jcm9wXS5zb3J0KCkuam9pbignLCcpfXwke2Npc19pbXBhY3R9YDtcblxuICBpZiAoY3ZfY2FjaGVfa2V5ID09PSBjYWNoZV9rZXkpIHtcbiAgICBjb25zb2xlLmxvZygnU2tpcHBlZCBjdiBydW4gYXMgaW5wdXRzIHRoZSBzYW1lJyk7XG4gICAgcmV0dXJuIGN2X3Jlc3VsdDtcbiAgfVxuXG4gIGNvbnNvbGUubG9nKCdSdW5uaW5nIHRoZSBjdiBhbmFseXNpcyBhcyBpbnB1dHMgY2hhbmdlZCcpXG4gIGNvbnN0IGN2X2RhdGEgPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgU0VMRUNUICpcbiAgICBGUk9NIGN2XG4gICAgV0hFUkUgY3JvcCBpbiAoJyR7c2VsZWN0X2Nyb3Auam9pbihcIicsICdcIil9JylcbiAgICBBTkQgYWRtaW4wX25hbWUgaW4gKCcke2FkbWluMF9uYW1lcy5qb2luKFwiJywgJ1wiKX0nKSAtLSBUaGlzIG5lZWRzIHRoZSBhMF9uYW1lIHJhdGhlciB0aGFuIGlzbzNcbmApO1xuXG4gIGNvbnN0IGN2X21vbnRlQ2FybG8gPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICBjdl9kYXRhLm1hcChhc3luYyAoeyBjcm9wLCBhZG1pbjBfbmFtZSwgY3YgfSkgPT4ge1xuICAgICAgY29uc3QgYXYgPSBhd2FpdCBhdmxvc3NDYWxjKGN2LCBjaXNfaW1wYWN0KTtcbiAgICAgIGNvbnN0IGF2bG9zcyA9IE1hdGguYWJzKE51bWJlcihhdi50b0ZpeGVkPy4oNCkgPz8gYXYpKTtcbiAgICAgIHJldHVybiB7IGFkbWluMF9uYW1lLCBjcm9wLCBjdiwgY2lzX2ltcGFjdCwgYXZsb3NzIH07XG4gICAgfSksXG4gICk7XG5cbiAgY29uc3QgY3ZfaW5kZXggPSBuZXcgTWFwKCk7XG4gIGZvciAoY29uc3QgeyBhZG1pbjBfbmFtZSwgY3JvcCwgYXZsb3NzIH0gb2YgY3ZfbW9udGVDYXJsbykge1xuICAgIGN2X2luZGV4LnNldChgJHthZG1pbjBfbmFtZX18JHtjcm9wfWAsIGF2bG9zcyk7XG4gIH1cblxuICBtdXRhYmxlIGN2X3Jlc3VsdCA9IGN2X2luZGV4XG4gIG11dGFibGUgY3ZfY2FjaGVfa2V5ID0gY2FjaGVfa2V5XG4gIHJldHVybiBjdl9pbmRleFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGdldEV4cG9zdXJlRGF0YSA9IGFzeW5jIChjcm9wcywgY291bnRyaWVzKSA9PiB7XG4vLyBOT1RFOiBNYWtpbmcgdGhpcyBhIGRhdGFzZXQgcmF0aGVyIHRoYW4gYSBmdW5jdGlvbiBzbyBpdCBvbmx5IHJlLXJ1bnMgd2hlbiBjcm9wIG9yIGNvdW50cnkgY2hhbmdlLlxuLy8gRGVmYXVsdGluZyB0byBhbGwgYWRtaW4gMSBkYXRhIGFzIGFsbCBhZG1pbiByZWdpb25zIGFyZSBzZWxlY3RlZCBieSBkZWZ1YWx0IGFuZCB0aGlzXG4vLyB3aWxsIHByZXZlbnQgaGF2aW5nIHRvIGhhdmUgdXNlcnMgcmUtcXVlcnkgdGhlIGRhdGFzZXRzIHdoZW4gY2hhbmdpbmcgcmVnaW9ucyBpbiBhIGNvdW50eS5cblxuZXhwb3N1cmVfZGF0YSA9IHtcbiAgbGV0IGNyb3BzID0gc2VsZWN0X2Nyb3A7XG4gIGxldCBjb3VudHJpZXMgPSBzZWxlY3RfY291bnRyeTtcbiAgbGV0IGRhdGEgPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgU0VMRUNUICpcbiAgICBGUk9NIGV4cG9zdXJlXG4gICAgV0hFUkUgY3JvcCBpbiAoJyR7Y3JvcHMuam9pbihcIicsICdcIil9JylcbiAgICBBTkQgaXNvMyBpbiAoJyR7Y291bnRyaWVzLmpvaW4oXCInLCAnXCIpfScpXG4gICAgLS0gUE9TU0lCTFkgYWRkIGFkbWluMSBuYW1lIGZpbHRlciwgYnV0IGRlZmF1bHRzIHRvIGZ1bGwgY291bnRyeSwgc28gbWF5YmUgYmlnZ2VyIHF1ZXJ5IGlzIGJldHRlci5cbiAgYCk7XG4gIHJldHVybiBkYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJjcm9wX2Fkb3B0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAvLyBHbG9iYWxzIGZyb20gdGhlIG5vdGVib29rXG4gIGNvbnN0IGFkb3B0aW9uID0gb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0QWRvcHRpb24udmFsdWU7XG4gIGNvbnN0IHllYXJzID0gcHJvamVjdFllYXJzO1xuICBjb25zdCBwcm9kX2ltcGFjdCA9IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dFByb2RJbXBhY3QudmFsdWU7XG4gIC8vIGxldCBkYXRhID0gYXdhaXQgZ2V0RXhwb3N1cmVEYXRhKHNlbGVjdF9jcm9wLCBzZWxlY3RfY291bnRyeSk7XG4gIGNvbnN0IGRhdGEgPSBleHBvc3VyZV9kYXRhO1xuICBjb25zdCByZXN1bHQgPSBbXTtcblxuICBmb3IgKGNvbnN0IHJvdyBvZiBkYXRhKSB7XG4gICAgY29uc3QgdmFsdWUgPSByb3cudmFsdWUgfHwgMDtcbiAgICBsZXQgeFByZXYgPSAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0geWVhcnM7IGkrKykge1xuICAgICAgLy8gY3VtdWxhdGl2ZSBhZG9wdGlvblxuICAgICAgbGV0IHg7XG4gICAgICBpZiAoaSA9PT0gMSkge1xuICAgICAgICB4ID0gTWF0aC5yb3VuZCh2YWx1ZSAqIGFkb3B0aW9uICogMTApIC8gMTA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB4ID0gTWF0aC5yb3VuZCgodmFsdWUgLSB4UHJldikgKiBhZG9wdGlvbiAqIDEwKSAvIDEwICsgeFByZXY7XG4gICAgICB9XG5cbiAgICAgIHhQcmV2ID0geDtcblxuICAgICAgLy8gcHVzaCBhIGxvbmctZm9ybSByb3dcbiAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgYWRtaW4wX25hbWU6IHJvdy5hZG1pbjBfbmFtZSxcbiAgICAgICAgYWRtaW4xX25hbWU6IHJvdy5hZG1pbjFfbmFtZSxcbiAgICAgICAgaXNvM2M6IHJvdy5pc28zLFxuICAgICAgICBjcm9wOiByb3cuY3JvcCxcbiAgICAgICAgZXhwb3N1cmU6IHJvdy5leHBvc3VyZSxcbiAgICAgICAgdmFsdWU6IHJvdy52YWx1ZSxcbiAgICAgICAgYWRvcHRpb246IGFkb3B0aW9uLFxuICAgICAgICBwcm9kX2ltcGFjdDogcHJvZF9pbXBhY3QsXG4gICAgICAgIHllYXJfY2hhcjogYHkke2l9YCxcbiAgICAgICAgeWVhcjogaSxcbiAgICAgICAgcmVzdWx0OiB4LFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC5tYXAoKHJvdykgPT4ge1xuICAgIGNvbnN0IHJlc3VsdF93X2ltcGFjdCA9XG4gICAgICBNYXRoLnJvdW5kKHJvdy5yZXN1bHQgKiAoMSArIChyb3cucHJvZF9pbXBhY3QgPz8gMCkpICogMTApIC8gMTA7XG4gICAgY29uc3QgbWFyZ2luYWxfaW1wYWN0ID1cbiAgICAgIE1hdGgucm91bmQoKHJlc3VsdF93X2ltcGFjdCAtIHJvdy5yZXN1bHQpICogMTApIC8gMTA7XG4gICAgcmV0dXJuIHsgLi4ucm93LCByZXN1bHRfd19pbXBhY3QsIG1hcmdpbmFsX2ltcGFjdCB9O1xuICB9KTtcbn07XG5cbi8vTk9URTogUUFRQyBSRVNVTFRTOlxuLy8gMSByZWdpb24gJiBjcm9wOiBQRVJGRUNUIC0gVGhpcyBvdXRwdXQgbWF0Y2hlcyB0aGUgUiBzY3JpcHQgb3V0cHV0IGV4YWN0bHlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyb2lSZXN1bHRzID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCBpbmRleCA9IGF3YWl0IGNhbGNDVigpO1xuICBjb25zdCBkYXRhID0gYXdhaXQgY3JvcF9hZG9wdGlvbigpO1xuXG4gIGNvbnN0IHdpdGhJbXBhY3QgPSBkYXRhLm1hcCgocm93KSA9PiB7XG4gICAgY29uc3Qga2V5ID0gYCR7cm93LmFkbWluMF9uYW1lfXwke3Jvdy5jcm9wfWA7XG4gICAgY29uc3QgYXZsb3NzID0gaW5kZXguZ2V0KGtleSkgPz8gMDsgLy8gZGVmYXVsdCB0byAwIGlmIG1pc3NpbmdcblxuICAgIGNvbnN0IHJlc3VsdF93X2ltcGFjdF9jaXMgPVxuICAgICAgTWF0aC5yb3VuZChyb3cucmVzdWx0X3dfaW1wYWN0ICogKDEgKyBhdmxvc3MpICogMTApIC8gMTA7XG4gICAgY29uc3QgbWFyZ2luYWxfY2lzID1cbiAgICAgIE1hdGgucm91bmQoKHJlc3VsdF93X2ltcGFjdF9jaXMgLSByb3cucmVzdWx0X3dfaW1wYWN0KSAqIDEwKSAvIDEwO1xuICAgIGNvbnN0IG1hcmdpbmFsX2ltcGFjdF9jaXMgPVxuICAgICAgKG1hcmdpbmFsX2NpcyB8fCAwKSArIChyb3cubWFyZ2luYWxfaW1wYWN0IHx8IDApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnJvdyxcbiAgICAgIGF2bG9zcyxcbiAgICAgIHJlc3VsdF93X2ltcGFjdF9jaXMsXG4gICAgICBtYXJnaW5hbF9jaXMsXG4gICAgICBtYXJnaW5hbF9pbXBhY3RfY2lzLFxuICAgIH07XG4gIH0pO1xuXG4gIHJldHVybiB3aXRoSW1wYWN0Lm1hcCgoZCkgPT4ge1xuICAgIGNvbnN0IHByb2plY3RfYmVuZWZpdCA9XG4gICAgICBNYXRoLnJvdW5kKChkLm1hcmdpbmFsX2ltcGFjdF9jaXMgLSBkLm1hcmdpbmFsX2ltcGFjdF9jaXMgLyBiY3IpICogMTApIC9cbiAgICAgIDEwO1xuICAgIGNvbnN0IGNpc19pbXBhY3QgPSBvcHRpb25zX2Vjb25QZXJmV2Fsa3Rocm91Z2guaW5wdXRDaXNJbXBhY3QudmFsdWU7XG4gICAgcmV0dXJuIHsgLi4uZCwgYmNyLCBjaXNfaW1wYWN0LCBwcm9qZWN0X2JlbmVmaXQgfTtcbiAgfSk7XG59O1xuXG4vL05PVEU6IFFBUUMgUkVTVUxUUzpcbi8vIDEgcmVnaW9uICYgY3JvcDogR29vZCAtIE91dHB1dCBpcyBjbG9zZSwgdGhlIE1DIHNpbXVsYXRpb24gZ2l2ZXMgZGlmZmVyZW50IHJlc3VsdHMsIGJ1dCB0aGUgZGlmZmVyZW5jZSBpcyBmZXcgJDEwMCBlYWNoIHRpbWVcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZWdpb25TZXQgPSBuZXcgU2V0KHNlbGVjdF9yZWdpb24pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlY2lwZV9kYXRhU3VtbWVkID0gYXN5bmMgKCkgPT4ge1xuICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9IFwid2FpdFwiO1xuICBjb25zdCByb2lfZGF0YSA9IGF3YWl0IHJvaVJlc3VsdHMoKTtcblxuICAvLyBGaWx0ZXIgZG93biBvbiB0aGlzIHN0ZXAgdG8gdGhlIHNlbGVjdGVkIHJlZ2lvbnNcbiAgY29uc3Qgcm9pX2RhdGFfZmlsdGVyZWQgPSByb2lfZGF0YS5maWx0ZXIoKGQpID0+XG4gICAgcmVnaW9uU2V0LmhhcyhgJHtkLmlzbzNjfV8ke2QuYWRtaW4xX25hbWV9YCksXG4gICk7XG5cbiAgY29uc3QgYWdncmVnYXRlZCA9IGQzXG4gICAgLmZsYXRHcm91cChcbiAgICAgIHJvaV9kYXRhX2ZpbHRlcmVkLFxuICAgICAgKGQpID0+IGQuYWRvcHRpb24sXG4gICAgICAoZCkgPT4gZC5wcm9kX2ltcGFjdCxcbiAgICAgIChkKSA9PiBkLmNpc19pbXBhY3QsXG4gICAgICAoZCkgPT4gZC5iY3IsXG4gICAgICAoZCkgPT4gZC55ZWFyLFxuICAgIClcbiAgICAubWFwKChbYWRvcHRpb24sIHByb2RfaW1wYWN0LCBjaXNfaW1wYWN0LCBiY3IsIHllYXIsIGdyb3VwXSkgPT4gKHtcbiAgICAgIGFkb3B0aW9uLFxuICAgICAgcHJvZF9pbXBhY3QsXG4gICAgICBjaXNfaW1wYWN0LFxuICAgICAgYmNyLFxuICAgICAgeWVhcixcbiAgICAgIHByb2plY3RfYmVuZWZpdDogZDMuc3VtKGdyb3VwLCAoZCkgPT4gZC5wcm9qZWN0X2JlbmVmaXQpLFxuICAgIH0pKTtcblxuICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9IFwiZGVmYXVsdFwiO1xuICByZXR1cm4gYWdncmVnYXRlZDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVjaXBlX3BheW1lbnRTY2hlZHVsZSA9IEFycmF5LmZyb20oeyBsZW5ndGg6IHByb2plY3RZZWFycyB9KS5tYXAoKF8sIGkpID0+IHtcbiAgcmV0dXJuIHtcbiAgICB5ZWFyOiBpLFxuICAgIGNvc3Q6ICgxIC8gcHJvamVjdFllYXJzKSAqIHJhbmdlUHJvamVjdENvc3QsXG4gICAgY29zdF9jdW06ICgoaSArIDEpIC8gcHJvamVjdFllYXJzKSAqIHJhbmdlUHJvamVjdENvc3QsXG4gIH07XG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZWNpcGVfZGF0YUNhc2hmbG93ID0ge1xuICBpZiAoIXJhbmdlUHJvamVjdENvc3QgfHwgcmFuZ2VQcm9qZWN0Q29zdCA9PT0gMCkgcmV0dXJuIFtdO1xuXG4gIGNvbnN0IHBheUJ5WWVhciA9IG5ldyBNYXAocmVjaXBlX3BheW1lbnRTY2hlZHVsZS5tYXAoKGQpID0+IFtkLnllYXIsIGRdKSk7XG5cbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlY2lwZV9kYXRhU3VtbWVkKCk7XG5cbiAgcmV0dXJuIGQzXG4gICAgLmZsYXRHcm91cChcbiAgICAgIGRhdGEsXG4gICAgICAoZCkgPT4gZC5hZG9wdGlvbixcbiAgICAgIChkKSA9PiBkLnByb2RfaW1wYWN0LFxuICAgICAgKGQpID0+IGQuY2lzX2ltcGFjdCxcbiAgICAgIChkKSA9PiBkLmJjcixcbiAgICApXG4gICAgLmZsYXRNYXAoKFthZG9wdGlvbiwgcHJvZF9pbXBhY3QsIGNpc19pbXBhY3QsIGJjciwgcm93c10pID0+IHtcbiAgICAgIGNvbnN0IGFsbFJvd3MgPSBbXG4gICAgICAgIC4uLnJvd3MsXG4gICAgICAgIHsgYWRvcHRpb24sIHByb2RfaW1wYWN0LCBjaXNfaW1wYWN0LCBiY3IsIHllYXI6IDAsIHByb2plY3RfYmVuZWZpdDogMCB9LFxuICAgICAgXS5zb3J0KChhLCBiKSA9PiBhLnllYXIgLSBiLnllYXIpO1xuXG4gICAgICByZXR1cm4gYWxsUm93cy5tYXAoKHIpID0+IHtcbiAgICAgICAgY29uc3QgcGF5ID0gcGF5QnlZZWFyLmdldChyLnllYXIpIHx8IHt9O1xuICAgICAgICBjb25zdCBjb3N0ID0gcGF5LmNvc3QgPz8gMDtcbiAgICAgICAgY29uc3QgY29zdF9jdW0gPSBwYXkuY29zdF9jdW0gPz8gcmFuZ2VQcm9qZWN0Q29zdDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5yLFxuICAgICAgICAgIGNvc3QsXG4gICAgICAgICAgY29zdF9jdW0sXG4gICAgICAgICAgY2FzaGZsb3c6IChyLnByb2plY3RfYmVuZWZpdCA/PyAwKSAtIGNvc3QsXG4gICAgICAgICAgZGlzY291bnRfcmF0ZTogZGlzY291bnRSYXRlLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfSk7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IndhbGt0aHJvdWdoRWNvbm9taWNJbmRpY2F0b3JzID0ge1xuICBjb25zdCBzZWxlY3Rpb24gPSB3YWxrdGhyb3VnaFNlbGVjdGlvbnM7XG5cbiAgY29uc3QgZGF0YSA9IHJlY2lwZV9kYXRhQ2FzaGZsb3dcblxuICBjb25zdCB5ZWFycyA9IGRhdGEubWFwKGQgPT4gZC55ZWFyKTtcbiAgY29uc3QgYmVuZWZpdCA9IGRhdGEubWFwKGQgPT4gZC5wcm9qZWN0X2JlbmVmaXQpO1xuICBjb25zdCBjb3N0ID0gZGF0YS5tYXAoZCA9PiBkLmNvc3QpO1xuICBjb25zdCBjYXNoZmxvdyA9IGJlbmVmaXQubWFwKChiLCBpKSA9PiBiIC0gY29zdFtpXSk7XG4gIGNvbnN0IGRpc2NvdW50UmF0ZSA9IHNlbGVjdGlvbi5kaXNjb3VudF9yYXRlO1xuXG4gIGNvbnN0IG5wdiA9IG5wdkRpc2NyZXRlQ3VtdWxhdGl2ZShjYXNoZmxvdywgZGlzY291bnRSYXRlKTtcbiAgY29uc3QgbnB2X2JlbmVmaXQgPSBucHZEaXNjcmV0ZUN1bXVsYXRpdmUoYmVuZWZpdCwgZGlzY291bnRSYXRlKTtcbiAgY29uc3QgbnB2X2Nvc3QgPSBucHZEaXNjcmV0ZUN1bXVsYXRpdmUoY29zdCwgZGlzY291bnRSYXRlKTtcbiAgY29uc3QgZGlzY291bnRlZF9iY3IgPSBucHZfYmVuZWZpdC5tYXAoKGIsIGkpID0+IG5wdl9jb3N0W2ldID09PSAwID8gbnVsbCA6IGIgLyBucHZfY29zdFtpXSk7XG5cbiAgY29uc3QgcHJval9pcnIgPSBjYWxjSVJSKGNhc2hmbG93KTtcbiAgY29uc3QgcHJval9taXJyID0gY2FsY01JUlIoY2FzaGZsb3csIGRpc2NvdW50UmF0ZSwgZGlzY291bnRSYXRlKTtcbiAgY29uc3QgcHJval9ucHYgPSBucHYuYXQoLTEpO1xuICBjb25zdCBwcm9qX2JjciA9IGRpc2NvdW50ZWRfYmNyLmF0KC0xKTtcblxuICAvLyA9PT0gRW5yaWNoZWQgdGFibGVcbiAgY29uc3QgZW5yaWNoZWREYXRhID0geWVhcnMubWFwKCh5ZWFyLCBpKSA9PiB7XG4gICAgY29uc3QgY2FzaGZsb3dUb0RhdGUgPSBjYXNoZmxvdy5zbGljZSgwLCBpICsgMSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHllYXIsXG4gICAgICBwcm9qZWN0X2JlbmVmaXQ6IGJlbmVmaXRbaV0sXG4gICAgICBjb3N0OiBjb3N0W2ldLFxuICAgICAgY2FzaGZsb3c6IGNhc2hmbG93W2ldLFxuICAgICAgZGlzY291bnRlZF9iZW5lZml0X2N1bTogbnB2X2JlbmVmaXRbaV0sXG4gICAgICBkaXNjb3VudGVkX2Nvc3RfY3VtOiBucHZfY29zdFtpXSxcbiAgICAgIGRpc2NvdW50ZWRfYmNyOiBkaXNjb3VudGVkX2JjcltpXSxcbiAgICAgIGlycjogY2FsY0lSUihjYXNoZmxvd1RvRGF0ZSkqMTAwLFxuICAgICAgbWlycjogY2FsY01JUlIoY2FzaGZsb3dUb0RhdGUsIGRpc2NvdW50UmF0ZSwgZGlzY291bnRSYXRlKSoxMDAsXG4gICAgICBucHY6IG5wdltpXVxuICAgIH07XG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgc3VtbWFyeToge1xuICAgICAgcHJval9ucHYsXG4gICAgICBwcm9qX2lycixcbiAgICAgIHByb2pfbWlycixcbiAgICAgIHByb2pfYmNyXG4gICAgfSxcbiAgICBlbnJpY2hlZDogZW5yaWNoZWREYXRhXG4gIH07XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoid2Fsa3Rocm91Z2hTZWxlY3Rpb25zID0ge1xuICByZXR1cm4ge1xuICAgIGNvdW50cmllczogc2VsZWN0X2NvdW50cnksXG4gICAgcmVnaW9uczogc2VsZWN0X3JlZ2lvbixcbiAgICBjcm9wczogc2VsZWN0X2Nyb3AsXG4gICAgcHJvamVjdF95ZWFyczogcHJvamVjdFllYXJzLFxuICAgIHByb2plY3RfY29zdDogcmFuZ2VQcm9qZWN0Q29zdCxcbiAgICBwcm9kX2ltcGFjdDogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0UHJvZEltcGFjdC52YWx1ZSxcbiAgICBhZG9wdGlvbjogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0QWRvcHRpb24udmFsdWUsXG4gICAgY2lzX2ltcGFjdDogb3B0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoLmlucHV0Q2lzSW1wYWN0LnZhbHVlLFxuICAgIGRpc2NvdW50X3JhdGU6IGRpc2NvdW50UmF0ZSxcbiAgICBiY3I6IGJjcixcbiAgICAvLyB0aW1lX2hvcml6b246IG9wdGlvbnNfZWNvblBlcmZXYWxrdGhyb3VnaC5pbnB1dFRpbWUudmFsdWUsXG4gIH07XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3Byb2R1Y3Rpb25WaWV3JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0UHJvamVjdE9wdGlvbnMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0aW9uc19lY29uUGVyZldhbGt0aHJvdWdoJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdF9jb3VudHJ5JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdF9yZWdpb24nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0X2Nyb3AnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZGlzY291bnRSYXRlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2JjcicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd1bmNlcnRhaW50eUJlbmVmaXRTY2FsZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd1bmNlcnRhaW50eUNvc3RTY2FsZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdwaWNrTWV0cmljV2Fsa3Rocm91Z2gnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbWFzdGVyTGFuZ3VhZ2UnKSJ9XX0=</script><script type="module">"file:"===window.location.protocol&&alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."),window._ojs.paths.runtimeToDoc="../../notebooks/roi",window._ojs.paths.runtimeToRoot="../..",window._ojs.paths.docToRoot="../..",window._ojs.selfContained=!1,window._ojs.runtime.interpretFromScriptTags()</script><script id="quarto-html-after-body" type="application/javascript">window.document.addEventListener("DOMContentLoaded",function(t){const e=t=>{for(const e of t.classList)if(e.startsWith("code-annotation-"))return!0;return!1},n=function(t){const e=t.trigger;e.blur(),e.classList.add("code-copy-button-checked");var n=e.getAttribute("title");let o;e.setAttribute("title","Copied!"),window.bootstrap&&(e.setAttribute("data-bs-toggle","tooltip"),e.setAttribute("data-bs-placement","left"),e.setAttribute("data-bs-title","Copied!"),o=new bootstrap.Tooltip(e,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),o.show()),setTimeout(function(){o&&(o.hide(),e.removeAttribute("data-bs-title"),e.removeAttribute("data-bs-toggle"),e.removeAttribute("data-bs-placement")),e.setAttribute("title",n),e.classList.remove("code-copy-button-checked")},1e3),t.clearSelection()},o=function(t){const n=t.parentElement.cloneNode(!0).querySelector("code");for(const t of n.children)e(t)&&t.remove();return n.innerText};if(new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:o}).on("success",n),window.document.getElementById("quarto-embedded-source-code-modal")){new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:o,container:window.document.getElementById("quarto-embedded-source-code-modal")}).on("success",n)}for(var i=new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//),a=new RegExp(/^mailto:/),l=new RegExp("https://adaptationatlas.github.io/atlas_notebooks/"),r=t=>l.test(t)||i.test(t)||a.test(t),d=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),c=0;c<d.length;c++){const t=d[c];r(t.href)||void 0!==t.dataset.originalHref&&(t.href=t.dataset.originalHref)}function s(t,e,n,o){const i={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(t){return t.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};e&&(i.content=e),n&&(i.onTrigger=n),o&&(i.onUntrigger=o),window.tippy(t,i)}const u=window.document.querySelectorAll('a[role="doc-noteref"]');for(c=0;c<u.length;c++){const t=u[c];s(t,function(){let e=t.getAttribute("data-footnote-href")||t.getAttribute("href");try{e=new URL(e).hash}catch{}const n=e.replace(/^#\/?/,""),o=window.document.getElementById(n);return o?o.innerHTML:""})}const h=window.document.querySelectorAll("a.quarto-xref"),m=(t,e)=>{const n=t=>{if(t.classList.remove("page-full","page-columns"),t.children)for(const e of t.children)n(e)};if(n(e),null===t||t.startsWith("sec-")){const t=document.createElement("div");if(e.children&&e.children.length>2){t.appendChild(e.children[0].cloneNode(!0));for(let n=1;n<e.children.length;n++){const o=e.children[n];if("P"!==o.tagName||""!==o.innerText){t.appendChild(o.cloneNode(!0));break}}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}{const t=e.querySelector("a.anchorjs-link");return t&&t.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.classList.contains("callout")?e.outerHTML:e.innerHTML}};for(c=0;c<h.length;c++){const t=h[c];s(t,void 0,function(e){e.disable();let n,o=t.getAttribute("href");if(o.startsWith("#"))n=o;else try{n=new URL(o).hash}catch{}if(n){const t=n.replace(/^#\/?/,""),i=window.document.getElementById(t);if(null!==i)try{const n=m(t,i.cloneNode(!0));e.setContent(n)}finally{e.enable(),e.show()}else fetch(o.split("#")[0]).then(t=>t.text()).then(n=>{const o=(new DOMParser).parseFromString(n,"text/html").getElementById(t);if(null!==o){const n=m(t,o);e.setContent(n)}}).finally(()=>{e.enable(),e.show()})}else fetch(o).then(t=>t.text()).then(t=>{const n=(new DOMParser).parseFromString(t,"text/html").querySelector("main.content");if(null!==n){n.children.length>0&&"HEADER"===n.children[0].tagName&&n.children[0].remove();const t=m(null,n);e.setContent(t)}}).finally(()=>{e.enable(),e.show()})},function(t){})}let w;const g=t=>{window.document;const e=t.getAttribute("data-target-cell"),n=t.getAttribute("data-target-annotation");const o=window.document.querySelector('span[data-code-cell="'+e+'"][data-code-annotation="'+n+'"]').getAttribute("data-code-lines").split(",").map(t=>e+"-"+t);let i=null,a=null,l=null;if(o.length>0){const n=window.document.getElementById(o[0]);if(i=n.offsetTop,a=n.offsetHeight,l=n.parentElement.parentElement,o.length>1){const t=window.document.getElementById(o[o.length-1]);a=t.offsetTop+t.offsetHeight-i}if(null!==i&&null!==a&&null!==l){let t=window.document.getElementById("code-annotation-line-highlight");null===t&&(t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight"),t.style.position="absolute",l.appendChild(t)),t.style.top=i-2+"px",t.style.height=a+4+"px",t.style.left=0;let n=window.document.getElementById("code-annotation-line-highlight-gutter");if(null===n){n=window.document.createElement("div"),n.setAttribute("id","code-annotation-line-highlight-gutter"),n.style.position="absolute";window.document.getElementById(e).querySelector(".code-annotation-gutter").appendChild(n)}n.style.top=i-2+"px",n.style.height=a+4+"px"}w=t}},p=()=>{["code-annotation-line-highlight","code-annotation-line-highlight-gutter"].forEach(t=>{const e=window.document.getElementById(t);e&&e.remove()}),w=void 0};window.addEventListener("resize",function(t,e){let n,o=!1;return(...i)=>{o?(n&&clearTimeout(n),n=setTimeout(()=>{t.apply(this,i),n=o=!1},e)):(t.apply(this,i),o=!0)}}(()=>{elRect=void 0,w&&g(w)},10));const f=window.document.querySelectorAll("dt[data-target-cell]");for(const t of f)t.addEventListener("click",t=>{const e=t.target;if(e!==w){p();const t=window.document.querySelector("dt[data-target-cell].code-annotation-active");t&&t.classList.remove("code-annotation-active"),g(e),e.classList.add("code-annotation-active")}else p(),e.classList.remove("code-annotation-active")});const b=t=>{const e=t.parentElement;if(e){const n=e.dataset.cites;return n?{el:t,cites:n.split(" ")}:b(t.parentElement)}};var y=window.document.querySelectorAll('a[role="doc-biblioref"]');for(c=0;c<y.length;c++){const t=y[c],e=b(t);e&&s(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry");var o=window.document.getElementById("ref-"+e);o&&(n.innerHTML=o.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div><footer class="footer"><div class="nav-footer"><div class="nav-footer-left"><p>© 2026 AAA &amp; CGIAR</p></div><div class="nav-footer-center">&nbsp;</div><div class="nav-footer-right">&nbsp;</div></div></footer></body></html>