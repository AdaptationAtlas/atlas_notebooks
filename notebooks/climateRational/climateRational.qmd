---
pagetitle: "Formulate A Climate Rational"
nb-authors:
  - Brayden Youngberg
  - Pete Stewart
date-created: "2025-02-19"
date-edited: today
---

```{ojs}
import { atlasTOC, atlasHero } from "/helpers/uiComponents.ojs";

atlasHero(nbTitle, hero_url);
```

# `{ojs} heading1` {#overview}

```{ojs}
md`${_lang(nbText.sections.intro.text)}`; // wrapped in md for lists to work
```

# `{ojs} heading2` {#keyFacts}

`{ojs} _lang(nbText.sections.keyFacts.introText)`

# `{ojs} heading3` {#recentChanges}

`{ojs} _lang(nbText.sections.recentChanges.introText)`

# `{ojs} heading4` {#futureProjections}

`{ojs} _lang(nbText.sections.futureProjections.introText)`

# `{ojs} heading5` {#hazardExposure}

`{ojs} _lang(nbText.sections.hazardExposure.introText)`

# `{ojs} summary` {#summary}

{{< lipsum 1 >}}

# `{ojs} appendix` {#appendix}

```{ojs}
toc_bottom = atlasTOC({
  skip: ["notebook-title", "appendix", "source-code"], // These should be the section headings in the {# headings}
  heading: `<b>${Lang.toSentenceCase(_lang(general_translations.toc))}</b>`,
});

htl.html`
  <div class='floating-toc'>
    ${toc_bottom}
  </div>
`;
```

# Source code {#source-code .hidden}

## Text and Language Translations

```{ojs}
// This cell is to contain all the headings and the notebook title
nbTitle = _lang({
  en: "Formulate A Climate Rational",
  fr: "Formuler une justification climatique",
});

heading1 = _lang(general_translations.overview);
heading2 = _lang(nbText.sections.keyFacts.title);
heading3 = _lang(nbText.sections.recentChanges.title);
heading4 = _lang(nbText.sections.futureProjections.title);
heading5 = _lang(nbText.sections.hazardExposure.title);
summary = _lang(general_translations.summary);
appendix = _lang(general_translations.appendix);
```

```{ojs}
import { lang as Lang } from "/helpers/lang.js";

nbText = await FileAttachment("/data/climateRationale/nbText.json").json();

general_translations = await FileAttachment(
  "/data/shared/generalTranslations.json",
).json();

languages = [
  { key: "en", label: "English", locale: 'en-US' },
  { key: "fr", label: "FranÃ§ais", locale: 'fr-FR' }
]

defaultLangKey = {
  const name = "lang";
  const list = languages.map((d) => d.key);
  const defaultKey = "en";
  const queryParam = await Lang.getParamFromList({ name, list });
  return queryParam ?? defaultKey;
}

_lang = Lang.lg(masterLanguage.key)

viewof masterLanguage = Inputs.radio(languages, {
  label: "Main language toggle",
  format: (d) => d.key,
  value: languages.find((x) => x.key === defaultLangKey),
})
```

## General

### formatters

```{ojs}
// format number, short notation
formatNumCompactShort = ({ locale = "en-US" } = {}) =>
  new Intl.NumberFormat(locale, {
    notation: "compact",
    compactDisplay: "short",
  }).format;

// format number, to significant figures
formatNumCompactSigFigs = ({ locale = "en-US", sigFigs = 3 } = {}) => {
  // Return a formatting function
  return (number) => {
    // Adjust number to specified significant figures
    const formattedNumber = Number(number).toLocaleString(locale, {
      maximumSignificantDigits: sigFigs,
      notation: "compact",
      compactDisplay: "short",
    });

    return formattedNumber;
  };
};

function formatUSD({ locale = "en-US" } = {}) {
  const formatter = formatNumCompactShort({ locale });

  return (number) => {
    const formattedNum = formatter(number);
    return "$" + formattedNum;
  };
}

function formatIntDollar({ locale = "en-US" } = {}) {
  return (number, unit = intDollarUnit.replace("$", "")) => {
    let formattedNumber = formatUSD({ locale })(number);
    let intDollar = unit + formattedNumber;
    return intDollar;
  };
}
```

```{ojs}
// template for observable input forms
inputTemplate = ({ gap = "2em" } = {}) => {
  // template for input display
  return (inputs) =>
    html`<div style="display: flex; gap: ${gap};">${inputs}</div>`;
};

// create where clause that handles null cases
sqlWhereNull = ({ value, field } = {}) => {
  return value === null ? `and ${field} is null` : `and ${field} = '${value}'`;
};

// alphabetic sort, nulls first
sortByField = (a, b, { field } = {}) => {
  const av = a[field];
  const bv = b[field];

  // nulls first
  if (av === null || bv === null) {
    if (av === bv) return 0;
    return av === null ? -1 : 1;
  }

  // alphabetical compare
  return av.localeCompare(bv);
};
```

## Styling

```{ojs}
// import { NavbarLangSelector } from "/helpers/uiComponents.ojs"
function NavbarLangSelector(language_obj, masterLanguage) {
  let navEnd = document.querySelector(".navbar-nav.ms-auto .nav-item.compact");
  if (navEnd) {
    let existingLangSelector = document.getElementById("nav-lang-selector");
    if (!existingLangSelector) {
      let lang_sel = Inputs.bind(
        Inputs.radio(language_obj, {
          label: "",
          format: (d) => d.label
        }),
        viewof masterLanguage
      );
      lang_sel.id = "nav-lang-selector";
      
      // Hack the css together for the observable inputs
      lang_sel.style.display = "flex";
      lang_sel.style.alignItems = "center";
      lang_sel.style.marginLeft = "10px";
      let lang_div = lang_sel.querySelector("div");
      lang_div.style.display = "flex";
      lang_div.style.flexDirection = "column";

      // Insert the new item after the GitHub icon and other elements
      navEnd.parentNode.appendChild(lang_sel);
    }
  }
}

NavbarLangSelector(languages, masterLanguage)
```

```{ojs}
prettyLanguageView = {
  return Inputs.bind(
    Inputs.radio(languages, {
      label: _lang(general_translations.language),
      format: (d) => d.label
    }),
    viewof masterLanguage
  );
}
```

## Data

### Database

### Global Selectors

## Content
