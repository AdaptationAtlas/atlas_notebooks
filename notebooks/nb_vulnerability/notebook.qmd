---
pagetitle: "Vulnerability Assessment - Adaptation Atlas"
nb-authors:
  - Johnson Mwakazi
  - Brayden Youngberg
  - Pete Stewart
date-created: "2025-02-19"
date-edited: today
# css: styles.css
---

```{ojs}
// Core imports and dependencies
import { lang as Lang } from "/helpers/lang.js";
import { atlasHero, downloadButton } from "/helpers/uiComponents.ojs";
import { patchWindowsCache, cleanAdminInput_SQL } from "/helpers/std.ojs";
import { atlasTOC } from "/helpers/toc.ojs";
import { renderGeoMap } from "/helpers/figures.ojs";
import { filterableDataTable } from "/components/atlasTable.ojs";

// Data imports
general_translations = await FileAttachment(
  "/data/shared/generalTranslations.json",
).json();

vulnerability_translations = await FileAttachment(
  "/data/vulnerability_notebook/translations.json",
).json();
```

```{ojs}
// New admin selectors
import {
  admin0Select,
  admin1Select,
  admin2Select,
  admin012Form,
  admin01Form,
} from "/components/_adminSelectors.ojs";

getAdminNameString = () => {
  return [
    _lang(admin0Select.translation),
    admin1Select?.admin1_name,
    admin2Select?.admin2_name,
  ]
    .filter(Boolean)
    .join(", ");
};

removals = { 
  // Not all data avalaible for all countries (i.e. exposure is ssa only, so filter to these countries)
  const country_list = await FileAttachment("/data/shared/atlas_countries.json").json();
  const excluded = country_list
    .filter(({ include }) => !include)
    .map(({ admin0_name }) => admin0_name);
  
  return excluded;
};

sqlAdminQuery = () => {
  const admin0 = cleanAdminInput_SQL(admin0Select?.admin0_name);
  const admin1 = cleanAdminInput_SQL(admin1Select?.admin1_name);
  const admin2 = cleanAdminInput_SQL(admin2Select?.admin2_name);

  const conditions = [
    admin0
      ? `admin0_name = '${admin0}' AND admin1_name IS NOT NULL`
      : `admin1_name IS NULL`,

    admin1 ? `admin1_name = '${admin1}'` : `admin2_name IS NULL`,

    admin1 && `admin2_name IS NOT NULL`,

    `admin0_name NOT IN ('${removals.join("', '")}')`,
  ];

  return conditions.filter(Boolean).join(" AND ");
};

sqlAdminQuerySpecific = () => {
  const admin0 = cleanAdminInput_SQL(admin0Select?.admin0_name);
  const admin1 = cleanAdminInput_SQL(admin1Select?.admin1_name);
  const admin2 = cleanAdminInput_SQL(admin2Select?.admin2_name);

  const conditions = [
    admin0 ? `admin0_name = '${admin0}'` : `admin0_name = 'SSA'`,
    admin1 ? `admin1_name = '${admin1}'` : `admin1_name IS NULL`,
    admin2 ? `admin2_name = '${admin2}'` : `admin2_name IS NULL`,
  ];

  return conditions.join(" AND ");
};
```

```{ojs}
hero_url = "./../../images/default_crop.webp";

atlasHero(nbTitle, hero_url);
```

```{ojs}
atlasTOC({
  skip: ["notebook-title", "appendix", "source-code"],
  heading: `<b>${_lang(general_translations.toc)}</b>`,
});
```

# `{ojs} overview` {#overview}

`{ojs} _lang(vulnerability_translations.notebook_overview_text1)`

`{ojs} _lang(vulnerability_translations.notebook_overview_text2)`

{{< include _composite_index_section.qmd >}}

{{< include _exposure_section.qmd >}}

{{< include _sensitivity_section.qmd >}}

{{< include _adaptive_capacity_section.qmd >}}

# `{ojs} appendix` {#appendix}

```{ojs}
// About this notebook
aboutSection = htl.html`
  <div>
    <h3 style="margin: 0 0 16px 0; color: #2d3748;">
      ${_lang({ en: "About This Notebook", fr: "À propos de ce carnet" })}
    </h3>
    <p style="margin: 0 0 12px 0; line-height: 1.6;">
      ${_lang({
        en: "This vulnerability assessment notebook helps you understand climate vulnerability through three key dimensions: exposure to climate hazards, sensitivity of populations, and adaptive capacity of communities.",
        fr: "Ce carnet d'évaluation de la vulnérabilité vous aide à comprendre la vulnérabilité climatique à travers trois dimensions clés : l'exposition aux dangers climatiques, la sensibilité des populations et la capacité d'adaptation des communautés.",
      })}
    </p>
    <p style="margin: 0 0 12px 0; line-height: 1.6;">
      ${_lang({
        en: "The notebook uses interactive visualizations to explore vulnerability patterns across Sub-Saharan Africa, with data that can be filtered by administrative regions and demographic characteristics.",
        fr: "Le carnet utilise des visualisations interactives pour explorer les schémas de vulnérabilité à travers l'Afrique subsaharienne, avec des données qui peuvent être filtrées par régions administratives et caractéristiques démographiques.",
      })}
    </p>
    <p style="margin: 0; line-height: 1.6; font-size: 14px; color: #6b7280;">
      ${_lang({
        en: "For questions or feedback about this notebook, please contact the Adaptation Atlas team.",
        fr: "Pour des questions ou commentaires sur ce carnet, veuillez contacter l'équipe de l'Atlas d'adaptation.",
      })}
    </p>
  </div>
`;
```

# Source code {#source-code .hidden}

{{< include _shared.qmd >}}

```{ojs}
// Key notebook Headings
nbTitle = _lang(vulnerability_translations.notebook_title);
overview = _lang(vulnerability_translations.notebook_overview);
appendix = _lang(general_translations.appendix);
```

```{ojs}
// Navbar language selector integration
function NavbarLangSelector(language_obj, masterLanguage) {
  let navEnd = document.querySelector(".navbar-nav.ms-auto .nav-item.compact");
  if (navEnd) {
    let existingLangSelector = document.getElementById("nav-lang-selector");
    if (!existingLangSelector) {
      let lang_sel = Inputs.bind(
        Inputs.radio(language_obj, {
          label: "",
          format: (d) => d.label
        }),
        viewof masterLanguage
      );
      lang_sel.id = "nav-lang-selector";

      // Style the language selector for navbar integration
      lang_sel.style.display = "flex";
      lang_sel.style.alignItems = "center";
      lang_sel.style.marginLeft = "10px";
      let lang_div = lang_sel.querySelector("div");
      lang_div.style.display = "flex";
      lang_div.style.flexDirection = "column";

      navEnd.parentNode.appendChild(lang_sel);
    }
  }
}

NavbarLangSelector(languages, masterLanguage)
```
