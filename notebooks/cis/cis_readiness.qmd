---
pagetitle: "Identifying Climate Information Readiness"
nb-authors:
  - Johnson Mwakazi
  - Brayden Youngberg
  - Pete Stewart
  - Shalika Vyas
  - Harold Achicanoy
date-created: "2025-11-17"
date-edited: today
---

```{ojs}
// ============================================================================
// CIS READINESS NOTEBOOK - MAIN ORCHESTRATION FILE
// ============================================================================
// This is the main entry point for the Climate Information Services (CIS)
// Readiness notebook. It orchestrates:
//
// 1. Translations & i18n: Loads translations and sets up language switching
// 2. UI Components: Imports shared components (hero, buttons, multiselect)
// 3. Synced Selectors: Defines the createSyncedAdminSelector function used
//    by all sections to keep admin selections synchronized
// 4. Sections: Includes the three analysis sections via Quarto {{< include >}}
//
// File Structure:
// - cis_readiness.qmd (this file) - orchestration & shared definitions
// - _cis_readiness_index.qmd - Section 1: CIS Readiness components
// - _cis_hazard_intersection.qmd - Section 2: Readiness × Hazard bivariate
// - _cis_implementation.qmd - Section 3: Readiness × Access bivariate
//
// IMPORTANT: The order of definitions matters! UI components must be imported
// BEFORE sections that use them, and createSyncedAdminSelector must be
// defined BEFORE the includes run.
// ============================================================================

cis = await FileAttachment(
  "/data/cis/translations.json",
).json();
```

```{ojs}
// ============================================================================
// UI COMPONENT IMPORTS
// ============================================================================
// Import shared UI components from helpers directory.
// CRITICAL: These must be imported BEFORE any cells that use them!
// 
// Components:
// - atlasHero: Hero banner with title and background image
// - downloadButton: CSV download button for data tables
// - tooltipStyle: Global CSS for consistent tooltip styling
// - atlasTOC/tocStyle: Table of Contents navigation
// - multiSelect/dropdownCSS: Multi-select dropdown component
// ============================================================================

import { atlasHero, downloadButton, tooltipStyle } from "/helpers/uiComponents.ojs";
import { atlasTOC, tocStyle } from "/helpers/toc.ojs";
import { dropdownInput as multiSelect, dropdownCSS } from "/helpers/multiSelect.ojs";
```

```{ojs}
// ============================================================================
// LANGUAGE SETUP: Internationalization (i18n)
// ============================================================================
// The notebook supports multiple languages (English, French).
// Language switching:
// 1. Check URL for ?lang= parameter
// 2. Fall back to default (English)
// 3. Store selection in masterLanguage reactive
// 4. Use _lang() helper to get translated strings
//
// The language selector is added to the navbar by NavbarLangSelector (below).
// ============================================================================

import { lang as Lang } from "/helpers/lang.js"

general_translations = await FileAttachment("/data/shared/generalTranslations.json").json()

// Supported languages with locale codes for formatting
languages = [
  { key: "en", label: "English", locale: 'en-US' },
  { key: "fr", label: "Français", locale: 'fr-FR' }
]

// Determine default language from URL param or fallback to English
defaultLangKey = {
  const name = "lang";
  const list = languages.map((d) => d.key);
  const defaultKey = "en";
  const queryParam = await Lang.getParamFromList({ name, list });
  return queryParam ?? defaultKey;
}

// Hidden radio input that serves as the source of truth for language
// Other components bind to this via Inputs.bind()
viewof masterLanguage = {
  const el = Inputs.radio(languages, {
    label: "Main language toggle",
    format: (d) => d.key,
    value: languages.find((x) => x.key === defaultLangKey),
  })
  el.style.display = 'none';  // Hidden - controlled via navbar selector
  return el;
}

// Translation helper function:
// Usage: _lang({ en: "Hello", fr: "Bonjour" }) => returns "Hello" or "Bonjour"
// based on current masterLanguage.key value
_lang = Lang.lg(masterLanguage.key)
```

```{ojs}
// ============================================================================
// SYNCED ADMIN SELECTOR FACTORY
// ============================================================================
// Creates admin selectors that stay synchronized with master selectors.
// 
// Problem: Each section needs its own visual selector, but selections must
// be synchronized across all sections (selecting Kenya in Section 1 should
// also select Kenya in Sections 2 and 3).
//
// Solution: Use Observable's Inputs.bind() to create two-way binding between
// section-specific selectors and the master selectors (defined in Section 1).
//
// Parameters:
// - level: Admin level (0=country, 1=region, 2=district)
// - masterView: Reference to master selector's viewof (e.g., viewof selectedAdmin0)
// - options: Array of { value, label } options for dropdown
// - uniqueId: Unique identifier for this selector's DOM element (e.g., "s2", "s3")
// - labelString: Display label for the selector
// - placeholderString: Placeholder text when nothing selected
//
// Returns: A multiSelect component bound bidirectionally to the master selector
//
// Example usage in section files:
//   viewof s2Admin0 = createSyncedAdminSelector(
//     0, viewof selectedAdmin0, uniqueAdmin0.map(d => ({value: d, label: d})),
//     "s2", "Country", "Select countries..."
//   )
// ============================================================================

createSyncedAdminSelector = function(level, masterView, options, uniqueId, labelString, placeholderString) {
  // Create a new selector initialized with master's current selection
  const selector = multiSelect({
    inputLabel: labelString,
    inputId: `admin${level}Select-${uniqueId}`,
    placeholderText: placeholderString,
    options: options,
    selected: masterView.value ? masterView.value.slice() : [],
    maxSelections: 10
  });
  
  // Bind this selector to the master - creates two-way sync:
  // When master changes → this selector updates
  // When this selector changes → master updates
  return Inputs.bind(selector, masterView);
}
```

```{ojs}
//| echo: false

// Hero section
hero_url = "./../../images/default_crop.webp";
nbTitle = _lang({
  en: "Identifying Climate Information Readiness",
  fr: "Identifiant la Readiness des informations climatiques",
});
atlasHero(nbTitle, hero_url);
tooltipStyle

// Add global hover effect styles for Observable Plot maps
mapHoverStyles = htl.html`<style>
  /* Hover effect for Observable Plot geo paths - white stroke default, black on hover */
  figure svg g[aria-label*="geo"] path,
  svg g path[fill] {
    transition: stroke 0.15s ease, stroke-width 0.15s ease;
  }
  figure svg g[aria-label*="geo"] path:hover,
  svg g path[fill]:hover {
    stroke: black !important;
    stroke-width: 2px !important;
  }
</style>`
```


```{ojs}
overviewTitle = _lang(cis.overviewTitle);
overviewContent = _lang(cis.overviewContent);

```

# `{ojs} overviewTitle` {#overviewTitle}

`{ojs} overviewContent` 


{{< include _cis_readiness_index.qmd >}}

{{< include _cis_hazard_intersection.qmd >}}

{{< include _cis_implementation.qmd >}}

# `{ojs} appendix` {#appendix}

```{ojs}
methodsTitle = _lang(cis.methodsTitle)
```

## `{ojs} methodsTitle`

`{ojs} _lang(cis.methodsContent)`

### `{ojs} _lang(cis.methodologyTitle)`

`{ojs} _lang(cis.methodologyContent)`

### `{ojs} _lang(cis.acknowledgementsTitle)`

`{ojs} _lang(cis.acknowledgementsContent)`

---

```{ojs}
toc_bottom = atlasTOC({
  skip: ["notebook-title", "appendix", "source-code"], // These should be the section headings in the {# headings}
  heading: `${Lang.toSentenceCase(_lang(general_translations.toc))}`,
});

htl.html`
      ${tocStyle}
      ${toc_bottom}
      `;
```

# Source code {#source-code .hidden}

<!--
NOTE:Everything below this point will not appear in the notebook.
This is useful to hide all of the code, master selectors (language, admin level, etc.),
and other things that are needed for the notebook to run but would be messy if
actually appearing in the notebook.
-->

<!-- Import UI Components FIRST -->
<!-- NOTE: Imports have been moved to the top of the file (after translations) to ensure they're available to all cells -->

<!-- Text and Language Translations -->

```{ojs}
// This cell is to contain additional headings
// (nbTitle is now defined earlier before the includes)
// key_insights = _lang({en: "Key Insights", fr: "Résumé"})
heading1 = _lang({ en: "Heading 1", fr: "Titre 1" });
heading2 = _lang({ en: "Heading 2", fr: "Titre 2" });
heading3 = _lang({ en: "Heading 3", fr: "Titre 3" });
heading4 = _lang({ en: "Heading 4", fr: "Titre 4" });
nbSummary = _lang({ en: "Summary", fr: "Résumé" });
appendix = _lang(general_translations.appendix);
```

```{ojs}
mutable hoverCountry = "SSA" // This mutable is defined here and updated in _template_plot.qmd. It should only be defined once.

keyInsights = {
  let template = _lang({
        en: `This is where some key insights should go, they will be dynamic based on the selections such as country (**:::country:::**) and crop type (**:::cropType:::**)`,
        fr: `Ceci est là où les résumés clés devraient être, ils seront dynamiques en fonction des sélections comme pays (**:::country:::**) et type de culture (**:::cropType:::**)`
  })

  let fill_items = [
      { name: "country", value: hoverCountry },
      { name: "cropType", value: _lang({en: 'potatoes', fr: 'pomme de terre'}) }
    ]
  let keyText =  md`${Lang.reduceReplaceTemplateItems(template, fill_items)}`
  return keyText
}
```


```{ojs}
// import { NavbarLangSelector } from "/helpers/uiComponents.ojs"
function NavbarLangSelector(language_obj, masterLanguage) {
  let navEnd = document.querySelector(".navbar-nav.ms-auto .nav-item.compact");
  if (navEnd) {
    let existingLangSelector = document.getElementById("nav-lang-selector");
    if (!existingLangSelector) {
      let lang_sel = Inputs.bind(
        Inputs.radio(language_obj, {
          label: "",
          format: (d) => d.label
        }),
        viewof masterLanguage
      );
      lang_sel.id = "nav-lang-selector";

      // Hack the css together for the observable inputs
      lang_sel.style.display = "flex";
      lang_sel.style.alignItems = "center";
      lang_sel.style.marginLeft = "10px";
      let lang_div = lang_sel.querySelector("div");
      lang_div.style.display = "flex";
      lang_div.style.flexDirection = "column";

      // Insert the new item after the GitHub icon and other elements
      navEnd.parentNode.appendChild(lang_sel);
    }
  }
}

NavbarLangSelector(languages, masterLanguage)
```

```{ojs}
prettyLanguageView = {
  return Inputs.bind(
    Inputs.radio(languages, {
      label: _lang(general_translations.language),
      format: (d) => d.label
    }),
    viewof masterLanguage
  );
}
```

<!--

# Prototypes for future use to hack a sidebar into notebooks:

{.column-margin}

```{ojs}
htl.html`
<style>
.sticky-margin-div {
  position: fixed;
  }
@media (max-width: 768px) {
  .sticky-margin-div {
    position: static;
    }
}
</style>

<div class = "sticky-margin-div">
    <div>
      ${Inputs.radio(languages, {
        label: "Main language toggle",
        format: (d) => d.key,
        value: languages.find((x) => x.key === defaultLangKey),
      })}
    </div>
  </div>`
```

:-::

-->

<!-- Floating Sidebar: Self-contained HTML, CSS, and JS -->
<!--
<div id="floating-sidebar">

</div>

<style>
  #floating-sidebar {
    position: fixed;
    top: 150px;           /* Distance from top of the page */
    left: 20px;          /* Distance from left of the page */
    width: 260px;        /* Sidebar width */
    min-height: 400px;   /* Minimum height */
    max-height: 80vh;    /* Max height relative to viewport */
    background: #ffffff;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    border-radius: 8px;
    padding: 20px;
    overflow-y: auto;
    z-index: 9999;
    transition: box-shadow 0.2s;
  }
  #floating-sidebar:hover {
    box-shadow: 0 8px 24px rgba(0,0,0,0.18);
  }
  /* Responsive: hide on small screens */
  @media (max-width: 800px) {
    #floating-sidebar {
      display: none;
    }
  }
</style>

<script>
  // Optional: Add any JS for interactivity here
  // Example: Toggle sidebar visibility with a keyboard shortcut (Ctrl+B)
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'b') {
      const sidebar = document.getElementById('floating-sidebar');
      sidebar.style.display = (sidebar.style.display === 'none') ? 'block' : 'none';
    }
  });
</script> -->
